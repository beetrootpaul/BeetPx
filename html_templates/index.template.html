<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--
    BASE64 content generated with:
      base64 -i logo/BeetPx\ logo\ \(x5\).png
    -->
    <link
      rel="icon"
      type="image/png"
      sizes="80x80"
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAAAXNSR0IArs4c6QAAAVdJREFUeJzt3MFNw0AQQFFAdMCRymiCrjlSQyiAPVh5o7Uh/x2jCIevlQd7Y55vnx+3pwfy9vX7te/3+9/34h/psRUQFRAVEL2uXlydQP8z+X1bgaiAqICogKiAqICogKiAqIBoeSXyF61uNR3VlciJCogKiAqItgyR6RP80T2M6c+y0gpEBUQFRAVE40Pk6gNj+hitQFRAVEBUQERDZPqveiGDQLQCUQFRAVEB0eEhsmNgHD2GXGGstCdyogKiAqICosNDZMctpOnPMn3clVYgKiAqICogGt8T2TEw5NZVeyIXU0BUQFRAtOXbWdN7E2dd2ay0AlEBUQFRAdGWPZHpfzWyet9ZT9m3AlEBUQFRAdFpDxtO31Y6SysQFRAVEBUQ0RCRE/yOZzh2aAWiAqICogKi8W9nTf+8Kw2MlVYgKiAqICogWg6RKz1EeHWtQFRAVEBUQPQDHRdHQWx83G0AAAAASUVORK5CYII="
    />

    <!-- TODO: start button to initiate sounds!  -->

    <!-- TODO: mouse GUI all aspect ratios  -->

    <!-- TODO: Allow a game title injection as build script params -->
    <title>BeetPx game</title>

    <!--
    Keep styles embedded in HTML here, because external CSS file is loaded by Vite in a way which can make GUI flicker.
    -->
    <style>
      :root {
        --loading-bg-color: #49333b;
        --gui-bg-color: #5f574f;
      }

      * {
        margin: 0;
        box-sizing: border-box;
        image-rendering: pixelated;

        /* Dear Safari, please do NOT highlight any text or div when I press
           it for a longer time. Those are game buttons and they are meant
           to be kept pressedâ€¦ */
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
      }

      html {
        width: 100vw;
        height: 100vh;
      }

      body {
        width: 100vw;
        height: 100vh;
        overflow: hidden;

        font-family: monospace;

        background-color: var(--gui-bg-color);
      }

      * {
        /*
        This prevents panning on touch-drag:
          https://developer.mozilla.org/en-US/docs/Web/API/Pointer_events#touch-action_css_property
        */
        touch-action: none;
      }

      #screen_loading {
        position: absolute;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;

        padding: 0.2em;

        color: #c2c3c7;
        font-size: 24px;
        text-align: center;
        line-break: anywhere;

        background-color: var(--loading-bg-color);

        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
      }

      .loaded #screen_loading {
        display: none;
      }

      /* TODO: Polish this screen */
      #screen_start_game {
        position: absolute;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;

        padding: 0.2em;

        background-color: var(--loading-bg-color);

        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
      }

      .started #screen_start_game {
        display: none;
      }

      #screen_start_game__button {
        width: Min(60vw, 50vh);
        height: Min(60vw, 50vh);

        font-family: monospace;
        font-size: Min(15vw, 15vh);

        padding: 8px;

        color: #ff004d;
        background-color: #f3ef7d;
        border-color: #ff004d;

        border-width: 0;
        border-bottom-width: Min(1vh, 1vw);
      }

      #screen_start_game__button:active {
        color: #754665;
        background-color: #c2c3c7;
        border-bottom-width: 0;
        transform: translateY(Min(1vh, 1vw));
      }

      /* TODO: Polish this screen */
      #screen_unsupported_aspect_ratio {
        position: absolute;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;

        padding: 0.2em;

        color: #c2c3c7;
        font-size: 24px;
        text-align: center;
        line-break: anywhere;

        background-color: var(--gui-bg-color);

        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
      }

      #game_display {
        width: 100vw;
        height: 100vh;

        /*
        We need this bg color to be set on the element which is zoomed in when in a full
          screen and we cannot do this for the entire <body>, because Safari ignores
          body's bg color on full screen, and includes only the zoomed in element.
        */
        background-color: var(--gui-bg-color);

        border-color: #c2c3c7;
        border-style: solid;
        border-width: 0;

        gap: 0 0;
      }

      #game_canvas {
        width: 100%;
        height: 100%;

        background-color: #000000;
        border: 1px solid #000000;
        box-sizing: border-box;
      }

      .debug #game_canvas {
        border-color: red;
      }

      #game_canvas {
        grid-area: canv;
      }

      .gui_sprite {
        background-image: url(.beetpx/gui.png);
        background-size: calc(var(--spr_cell_size) * 20);
      }

      #dpad_u {
        grid-area: dp_u;
        background-position: calc(var(--spr_cell_size) * -1) 0;
      }

      .pressed_l #dpad_u {
        background-position-y: calc(var(--spr_cell_size) * -4);
      }

      .pressed_u.pressed_l #dpad_u {
        background-position-y: calc(var(--spr_cell_size) * -8);
      }

      #dpad_d {
        grid-area: dp_d;
        background-position: calc(var(--spr_cell_size) * -1)
          calc(var(--spr_cell_size) * -2);
      }

      .pressed_l #dpad_d {
        background-position-y: calc(var(--spr_cell_size) * -6);
      }

      .pressed_u.pressed_l #dpad_d {
        background-position-y: calc(var(--spr_cell_size) * -10);
      }

      #dpad_l {
        grid-area: dp_l;
        background-position: 0 calc(var(--spr_cell_size) * -1);
      }

      .pressed_l #dpad_l {
        background-position-y: calc(var(--spr_cell_size) * -5);
      }

      .pressed_u.pressed_l #dpad_l {
        background-position-y: calc(var(--spr_cell_size) * -9);
      }

      #dpad_r {
        grid-area: dp_r;
        background-position: calc(var(--spr_cell_size) * -2)
          calc(var(--spr_cell_size) * -1);
      }

      .pressed_l #dpad_r {
        background-position-y: calc(var(--spr_cell_size) * -5);
      }

      .pressed_u.pressed_l #dpad_r {
        background-position-y: calc(var(--spr_cell_size) * -9);
      }

      #dpad_center {
        grid-area: dp_c;
        background-position: calc(var(--spr_cell_size) * -1)
          calc(var(--spr_cell_size) * -1);
      }

      .pressed_l #dpad_center {
        background-position-y: calc(var(--spr_cell_size) * -5);
      }

      .pressed_u.pressed_l #dpad_center {
        background-position-y: calc(var(--spr_cell_size) * -9);
      }

      #dpad_ul {
        grid-area: dp_ul;
      }

      #dpad_ur {
        grid-area: dp_ur;
      }

      #dpad_dl {
        grid-area: dp_dl;
      }

      #dpad_dr {
        grid-area: dp_dr;
      }

      #button_a {
        grid-area: btn_a;
        background-position: calc(var(--spr_cell_size) * -4) 0;
      }

      .pressed_a #button_a {
        background-position-y: calc(var(--spr_cell_size) * -3);
      }

      #button_b {
        grid-area: btn_b;
        background-position: calc(var(--spr_cell_size) * -7) 0;
      }

      .pressed_b #button_b {
        background-position-y: calc(var(--spr_cell_size) * -3);
      }

      #button_menu {
        grid-area: menu;
        background-position: calc(var(--spr_cell_size) * -10) 0;
      }

      .pressed_menu #button_menu {
        background-position-y: calc(var(--spr_cell_size) * -3);
      }

      #button_mute {
        grid-area: b_mu;
        background-position: calc(var(--spr_cell_size) * -13) 0;
      }

      .pressed_mute #button_mute {
        background-position-y: calc(var(--spr_cell_size) * -3);
      }

      #button_fullscreen {
        grid-area: fs;
        background-position: calc(var(--spr_cell_size) * -15) 0;
      }

      .pressed_fullscreen #button_fullscreen {
        background-position-y: calc(var(--spr_cell_size) * -3);
      }

      #indicator_mute {
        grid-area: i_mu;
        background-position: calc(var(--spr_cell_size) * -14)
          calc(var(--spr_cell_size) * -1);
      }

      .muted #indicator_mute {
        grid-area: i_mu;
        background-position-x: calc(var(--spr_cell_size) * -18);
      }

      @media not (pointer: coarse) {
        #button_mute {
          background-position-x: calc(var(--spr_cell_size) * -17);
        }

        #button_fullscreen {
          background-position-x: calc(var(--spr_cell_size) * -19);
        }
      }

      /* TODO: polish mute + (optional)fs layout on desktop both variants */

      /*
       * REGULAR GUI for a DESKTOP (portrait)
       */
      :root {
        --spr_cell_size: 10vh;
      }

      #screen_unsupported_aspect_ratio {
        display: none;
      }

      #game_display {
        display: grid;

        border-width: 1vw;
        border-bottom-width: 2vw;
        padding: 1vh;

        grid-template-areas:
          "."
          "canv"
          ".";
        grid-template-columns: 96vw;
        grid-template-rows: 1fr 96vw 1fr;
      }

      #game_canvas {
        border-width: 1vw;
      }

      /*
       * REGULAR GUI for a DESKTOP (landscape)
       */
      @media (min-aspect-ratio: 1/1) {
        :root {
          --spr_cell_size: 10vh;
        }

        #screen_unsupported_aspect_ratio {
          display: none;
        }

        #game_display {
          display: grid;

          border-width: 1vh;
          border-bottom-width: 2vh;
          padding: 1vh;

          grid-template-areas:
            ".    . . canv .  . ."
            ". b_mu . canv . fs ."
            ". i_mu . canv .  . ."
            ".    . . canv .  . .";
          grid-template-columns: 1fr 10vh 4vh 95vh 4vh 10vh 1fr;
          grid-template-rows: 4vh 10vh 10vh 71vh;
        }

        #game_canvas {
          border-width: 1vh;
        }
      }

      /*
       * TOUCH GUI for a SUPER THIN screen
       */
      @media (pointer: coarse) {
        #screen_unsupported_aspect_ratio {
          display: flex;
        }

        #game_display {
          display: none;
        }
      }

      /*
       * TOUCH GUI for a REALLY VERTICAL screen
       */
      @media (pointer: coarse) and (min-aspect-ratio: 310/600) {
        :root {
          --spr_cell_size: 8vw;
        }

        #screen_unsupported_aspect_ratio {
          display: none;
        }

        #game_display {
          display: grid;

          border-width: 1vw;
          border-bottom-width: 2vw;
          padding: 1vw;

          grid-template-areas:
            "canv  canv canv  canv canv canv canv canv canv   canv  canv  canv  canv canv"
            "   .     .    .     .    .    .    .    .    .      .     .     .     .    ."
            "   . dp_ul dp_u dp_ur    .    . menu menu    .      .     . btn_b btn_b    ."
            "   .  dp_l dp_c  dp_r    .    .    .    .    .      .     . btn_b btn_b    ."
            "   .  dp_l dp_c  dp_r    .    . b_mu    .    .      .     . btn_b btn_b    ."
            "   . dp_dl dp_d dp_dr    .    . b_mu    .    .  btn_a btn_a     .     .    ."
            "   . dp_dl dp_d dp_dr    .    . i_mu    .    .  btn_a btn_a     .     .    ."
            "   .     .    .     .    .    .   fs    .    .  btn_a btn_a     .     .    ."
            "   .     .    .     .    .    .    .    .    .      .     .     .     .    .";
          grid-template-columns: 4vw 8vw 8vw 8vw 8vw 4vw 8vw 8vw 4vw 8vw 8vw 8vw 8vw 4vw;
          grid-template-rows: 96vw 1fr 8vw 4vw 4vw 4vw 4vw 8vw 2fr;
        }

        #game_canvas {
          border-width: 1vw;
        }
      }

      /*
       * TOUCH GUI for a SLIGHTLY VERTICAL screen
       */
      @media (pointer: coarse) and (min-aspect-ratio: 310/450) {
        :root {
          --spr_cell_size: 8vw;
        }

        #screen_unsupported_aspect_ratio {
          display: none;
        }

        #game_display {
          display: grid;

          border-width: 1vw;
          border-bottom-width: 2vw;
          padding: 1vw;

          grid-template-areas:
            "canv  canv canv  canv canv canv canv canv canv  canv  canv  canv  canv canv"
            "   .     .    .     .    .    .    .    .    .     .     .     .     .    ."
            "   . dp_ul dp_u dp_ur    . b_mu    . menu menu     .     . btn_b btn_b    ."
            "   .  dp_l dp_c  dp_r    . i_mu    .    .    . btn_a btn_a btn_b btn_b    ."
            "   . dp_dl dp_d dp_dr    .   fs    .    .    . btn_a btn_a     .     .    ."
            "   .     .    .     .    .    .    .    .    .     .     .     .     .    .";
          grid-template-columns: 2vw 8vw 8vw 8vw 7vw 8vw 5vw 8vw 8vw 8vw 8vw 8vw 8vw 2vw;
          grid-template-rows: 96vw 2vw 8vw 8vw 8vw 1fr;
        }

        #game_canvas {
          border-width: 1vw;
        }
      }

      /*
       * TOUCH GUI for a TALLER SQUARE screen
       */
      @media (pointer: coarse) and (min-aspect-ratio: 310/400) {
        :root {
          --spr_cell_size: 6vh;
        }

        #screen_unsupported_aspect_ratio {
          display: none;
        }

        #game_display {
          display: grid;

          border-width: 1vh;
          border-bottom-width: 2vh;
          padding: 1vh;

          grid-template-areas:
            ". canv  canv canv  canv canv canv canv canv canv  canv  canv  canv  canv canv ."
            ".    .     .    .     .    .    .    .    .    .     .     .     .     .    . ."
            ".    . dp_ul dp_u dp_ur    . b_mu    . menu menu     .     . btn_b btn_b    . ."
            ".    .  dp_l dp_c  dp_r    . i_mu    .    .    . btn_a btn_a btn_b btn_b    . ."
            ".    . dp_dl dp_d dp_dr    .   fs    .    .    . btn_a btn_a     .     .    . ."
            ".    .     .    .     .    .    .    .    .    .     .     .     .     .    . .";
          grid-template-columns: 1fr 2vh 6vh 6vh 6vh 5vh 6vh 4vh 6vh 6vh 6vh 6vh 6vh 6vh 2vh 1fr;
          grid-template-rows: 73vh 2vh 6vh 6vh 6vh 1fr;
        }

        #game_canvas {
          border-width: 1vh;
        }
      }

      /*
       * TOUCH GUI for a KINDA SQUARE screen
       */
      @media (pointer: coarse) and (min-aspect-ratio: 310/310) {
        :root {
          --spr_cell_size: 7vh;
        }

        #screen_unsupported_aspect_ratio {
          display: none;
        }

        #game_display {
          display: grid;

          border-width: 1vh;
          border-bottom-width: 2vh;
          padding: 1vh;

          grid-template-areas:
            ".     .    . canv  canv canv canv  canv  canv  canv     .     . ."
            ".  b_mu    . canv  canv canv canv  canv  canv  canv     .     . ."
            ".  i_mu    . canv  canv canv canv  canv  canv  canv     .     . ."
            ".    fs    . canv  canv canv canv  canv  canv  canv     .     . ."
            ".     .    . canv  canv canv canv  canv  canv  canv     .     . ."
            ".     .    .    .     .    .    .     .     .     .     .     . ."
            ". dp_ul dp_u dp_u dp_ur    . menu  menu     . btn_b btn_b btn_b ."
            ".  dp_l dp_c dp_c  dp_r    .    . btn_a btn_a btn_b btn_b btn_b ."
            ". dp_dl dp_d dp_d dp_dr    .    . btn_a btn_a     .     .     . ."
            ".     .    .    .     .    .    .     .     .     .     .     . .";
          grid-template-columns: 1fr 7vh 2vh 5vh 7vh 29vh 11vh 3vh 11vh 5vh 2vh 7vh 1fr;
          grid-template-rows: 4vh 7vh 7vh 7vh 46vh 2vh 7vh 7vh 7vh 1fr;
        }

        #game_canvas {
          border-width: 1vh;
        }
      }

      /*
       * TOUCH GUI for a WIDER SQUARE screen
       */
      @media (pointer: coarse) and (min-aspect-ratio: 350/250) {
        :root {
          --spr_cell_size: 10vh;
        }

        #screen_unsupported_aspect_ratio {
          display: none;
        }

        #game_display {
          display: grid;

          border-width: 1vh;
          border-bottom-width: 2vh;
          padding: 1vh;

          grid-template-areas:
            ".     .    .     .  . canv .     .     .     . ."
            ".     . b_mu     .  . canv .     .     .     . ."
            ".     . i_mu     .  . canv .     .  menu  menu ."
            ".     .   fs     .  . canv .     .     .     . ."
            ".     .    .     .  . canv .     .     .     . ."
            ".     .    .     .  . canv .     . btn_b btn_b ."
            ". dp_ul dp_u dp_ur  . canv .     . btn_b btn_b ."
            ". dp_ul dp_u dp_ur  .    . .     . btn_b btn_b ."
            ".  dp_l dp_c  dp_r  .    . . btn_a btn_a     . ."
            ". dp_dl dp_d dp_dr  .    . . btn_a btn_a     . ."
            ".     .    .     .  .    . .     .     .     . .";
          grid-template-columns: 1fr 10vh 10vh 10vh 1fr 72vh 1fr 10vh 10vh 10vh 1fr;
          grid-template-rows: 4vh 10vh 10vh 10vh 20vh 10vh 8vh 2vh 10vh 10vh 1fr;
        }

        #game_canvas {
          border-width: 1vh;
        }
      }

      /*
       * TOUCH GUI for a SLIGHTLY HORIZONTAL screen
       */
      @media (pointer: coarse) and (min-aspect-ratio: 480/250) {
        :root {
          --spr_cell_size: 10vh;
        }

        #screen_unsupported_aspect_ratio {
          display: none;
        }

        #game_display {
          display: grid;

          border-width: 1vh;
          border-bottom-width: 2vh;
          padding: 1vh;

          grid-template-areas:
            ".     .    .     . . . canv .      .     .     .     . ."
            ".  b_mu    .    fs . . canv .      .     .  menu  menu ."
            ".  i_mu    .     . . . canv .      .     .     .     . ."
            ".     .    .     . . . canv .      .     .     .     . ."
            ".     .    .     . . . canv .      .     . btn_b btn_b ."
            ". dp_ul dp_u dp_ur . . canv .      .     . btn_b btn_b ."
            ".  dp_l dp_c  dp_r . . canv . btn_a btn_a      .     . ."
            ". dp_dl dp_d dp_dr . . canv . btn_a btn_a      .     . ."
            ".     .    .     . . . canv .     .     .      .     . .";
          grid-template-columns: 1fr 10vh 10vh 10vh 10vh 1fr 95vh 1fr 10vh 10vh 10vh 10vh 1fr;
          grid-template-rows: 10vh 10vh 10vh 10vh 10vh 10vh 10vh 10vh 15vh;
        }

        #game_canvas {
          border-width: 1vh;
        }
      }

      /*
       * TOUCH GUI for a REALLY HORIZONTAL screen
       */
      @media (pointer: coarse) and (min-aspect-ratio: 610/250) {
        :root {
          --spr_cell_size: 10vh;
        }

        #screen_unsupported_aspect_ratio {
          display: none;
        }

        #game_display {
          display: grid;

          border-width: 1vh;
          border-bottom-width: 2vh;
          padding: 1vh;

          grid-template-areas:
            ".     .    .     . . . canv .      .     .     .     . ."
            ".  b_mu    .    fs . . canv .      .     .  menu  menu ."
            ".  i_mu    .     . . . canv .      .     .     .     . ."
            ".     .    .     . . . canv .      .     .     .     . ."
            ".     .    .     . . . canv .      .     . btn_b btn_b ."
            ". dp_ul dp_u dp_ur . . canv .      .     . btn_b btn_b ."
            ".  dp_l dp_c  dp_r . . canv . btn_a btn_a      .     . ."
            ". dp_dl dp_d dp_dr . . canv . btn_a btn_a      .     . ."
            ".     .    .     . . . canv .     .     .      .     . .";
          grid-template-columns: 15vh 10vh 10vh 10vh 10vh 1fr 95vh 1fr 10vh 10vh 10vh 10vh 15vh;
          grid-template-rows: 10vh 10vh 10vh 10vh 10vh 10vh 10vh 10vh 15vh;
        }

        #game_canvas {
          border-width: 1vh;
        }
      }

      /*
       * TOUCH GUI for a SUPER WIDE screen
       */
      @media (pointer: coarse) and (min-aspect-ratio: 800/250) {
        #screen_unsupported_aspect_ratio {
          display: flex;
        }

        #game_display {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <main id="game_display">
      <canvas id="game_canvas" width="256" height="256"></canvas>

      <div id="dpad_u" class="gui_sprite touch_control"></div>
      <div id="dpad_d" class="gui_sprite touch_control"></div>
      <div id="dpad_l" class="gui_sprite touch_control"></div>
      <div id="dpad_r" class="gui_sprite touch_control"></div>
      <div id="dpad_center" class="gui_sprite touch_control"></div>
      <div id="dpad_ul" class="gui_sprite touch_control"></div>
      <div id="dpad_ur" class="gui_sprite touch_control"></div>
      <div id="dpad_dl" class="gui_sprite touch_control"></div>
      <div id="dpad_dr" class="gui_sprite touch_control"></div>

      <div id="button_a" class="gui_sprite touch_control"></div>
      <div id="button_b" class="gui_sprite touch_control"></div>

      <div id="button_menu" class="gui_sprite touch_control"></div>

      <div id="button_mute" class="gui_sprite touch_control"></div>
      <div id="indicator_mute" class="gui_sprite"></div>
      <div id="button_fullscreen" class="gui_sprite touch_control"></div>
    </main>

    <div id="screen_unsupported_aspect_ratio">
      <div>unsupported aspect ratio</div>
    </div>

    <div id="screen_start_game">
      <button id="screen_start_game__button">start</button>
    </div>

    <!-- TODO: polish this screen   -->
    <div id="screen_loading">
      <div>loadingâ€¦</div>
    </div>
  </body>

  <script type="module" src="src/beetpx_entrypoint.ts"></script>
</html>
