<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--
    BASE64 content generated with:
      base64 -i logo/BeetPx\ logo\ \(x5\).png
    -->
    <link
      rel="icon"
      type="image/png"
      sizes="80x80"
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAAAXNSR0IArs4c6QAAAVdJREFUeJzt3MFNw0AQQFFAdMCRymiCrjlSQyiAPVh5o7Uh/x2jCIevlQd7Y55vnx+3pwfy9vX7te/3+9/34h/psRUQFRAVEL2uXlydQP8z+X1bgaiAqICogKiAqICogKiAqIBoeSXyF61uNR3VlciJCogKiAqItgyR6RP80T2M6c+y0gpEBUQFRAVE40Pk6gNj+hitQFRAVEBUQERDZPqveiGDQLQCUQFRAVEB0eEhsmNgHD2GXGGstCdyogKiAqICosNDZMctpOnPMn3clVYgKiAqICogGt8T2TEw5NZVeyIXU0BUQFRAtOXbWdN7E2dd2ay0AlEBUQFRAdGWPZHpfzWyet9ZT9m3AlEBUQFRAdFpDxtO31Y6SysQFRAVEBUQ0RCRE/yOZzh2aAWiAqICogKi8W9nTf+8Kw2MlVYgKiAqICogWg6RKz1EeHWtQFRAVEBUQPQDHRdHQWx83G0AAAAASUVORK5CYII="
    />

    <!-- TODO: mouse GUI (mute/unmute, full screen)   -->

    <!-- TODO: a bit of a border around the canvas   -->

    <!-- TODO: Allow a game title injection as build script params -->
    <title>BeetPx game</title>

    <!--
    Keep styles embedded in HTML here, because external CSS file is loaded by Vite in a way which can make GUI flicker.
    -->
    <style>
      :root {
        /* TODO: re-implement loading, again */
        /* TODO: use another color */
        --loading-bg-color: #ff00ff;

        --gui-bg-color: #5f574f;
      }

      * {
        margin: 0;
        box-sizing: border-box;
        image-rendering: pixelated;
      }

      html {
        width: 100vw;
        height: 100vh;
      }

      body {
        width: 100vw;
        height: 100vh;
        overflow: hidden;

        background-color: var(--gui-bg-color);
      }

      * {
        /*
        This prevents panning on touch-drag:
          https://developer.mozilla.org/en-US/docs/Web/API/Pointer_events#touch-action_css_property
        */
        touch-action: none;
      }

      #unsupported_aspect_ratio {
        position: absolute;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;

        padding: 0.2em;

        color: #c2c3c7;
        font-size: 24px;
      }

      #game_display {
        width: 100vw;
        height: 100vh;

        /*
        We need this bg color to be set on the element which is zoomed in when in a full
          screen and we cannot do this for the entire <body>, because Safari ignores
          body's bg color on full screen, and includes only the zoomed in element.
        */
        background-color: var(--gui-bg-color);

        border-color: #c2c3c7;
        border-style: solid;
        border-width: 0;

        gap: 0 0;
      }

      #game_canvas {
        width: 100%;
        height: 100%;

        background-color: #000000;
        border: 1px solid #000000;
        box-sizing: border-box;
      }

      .debug #game_canvas {
        border-color: red;
      }

      #game_canvas {
        grid-area: canv;
      }

      .gui_sprite {
        background-image: url(.beetpx/gui.png);
        background-size: calc(var(--spr_cell_size) * 10);
      }

      #dpad_up {
        grid-area: dp_u;
        background-position: calc(var(--spr_cell_size) * -1) 0;
      }

      #dpad_down {
        grid-area: dp_d;
        background-position: calc(var(--spr_cell_size) * -1)
          calc(var(--spr_cell_size) * -2);
      }

      #dpad_left {
        grid-area: dp_l;
        background-position: 0 calc(var(--spr_cell_size) * -1);
      }

      #dpad_right {
        grid-area: dp_r;
        background-position: calc(var(--spr_cell_size) * -2)
          calc(var(--spr_cell_size) * -1);
      }

      #dpad_center {
        grid-area: dp_c;
        background-position: calc(var(--spr_cell_size) * -1)
          calc(var(--spr_cell_size) * -1);
      }

      #button_a {
        grid-area: btn_a;
        background-position: calc(var(--spr_cell_size) * -4) 0;
      }

      #button_b {
        grid-area: btn_b;
        background-position: calc(var(--spr_cell_size) * -7) 0;
      }

      #button_menu {
        grid-area: menu;
        background-position: calc(var(--spr_cell_size) * -3)
          calc(var(--spr_cell_size) * -3);
      }

      #button_mute {
        grid-area: mute;
        background-position: calc(var(--spr_cell_size) * -6)
          calc(var(--spr_cell_size) * -3);
      }

      #button_fullscreen {
        grid-area: fs;
        background-position: calc(var(--spr_cell_size) * -8)
          calc(var(--spr_cell_size) * -3);
      }

      /* TODO: polish mute + (optional)fs layout on desktop both variants */
      /* TODO: pressed button state */

      /*
       * REGULAR GUI for a DESKTOP (portrait)
       */
      :root {
        --spr_cell_size: 10vh;
      }

      #unsupported_aspect_ratio {
        display: none;
      }

      #game_display {
        display: grid;

        border-width: 1vw;
        border-bottom-width: 2vw;

        grid-template-areas:
          "."
          "canv"
          ".";
        grid-template-columns: 98vw;
        grid-template-rows: 1fr 98vw 1fr;
      }

      #game_canvas {
        border-width: 1vw;
      }

      /*
       * REGULAR GUI for a DESKTOP (landscape)
       */
      @media (min-aspect-ratio: 1/1) {
        :root {
          --spr_cell_size: 10vh;
        }

        #unsupported_aspect_ratio {
          display: none;
        }

        #game_display {
          display: grid;

          border-width: 1vh;
          border-bottom-width: 2vh;

          grid-template-areas:
            ".    . . canv .  . ."
            ". mute . canv . fs ."
            ".    . . canv .  . .";
          grid-template-columns: 1fr 10vh 4vh 97vh 4vh 10vh 1fr;
          grid-template-rows: 4vh 10vh 83vh;
        }

        #game_canvas {
          border-width: 1vh;
        }
      }

      /*
       * TOUCH GUI for a SUPER THIN screen
       */
      @media (pointer: coarse) {
        #unsupported_aspect_ratio {
          display: block;

          text-align: center;
          line-height: 1em;
          overflow-wrap: break-word;
        }

        #game_display {
          display: none;
        }
      }

      /*
       * TOUCH GUI for a REALLY VERTICAL screen
       */
      @media (pointer: coarse) and (min-aspect-ratio: 310/600) {
        :root {
          --spr_cell_size: 8vw;
        }

        #unsupported_aspect_ratio {
          display: none;
        }

        #game_display {
          display: grid;

          border-width: 1vw;
          border-bottom-width: 2vw;

          grid-template-areas:
            "canv canv canv canv canv canv canv canv   canv  canv  canv  canv canv"
            "   .    .    .    .    .    .    .    .      .     .     .     .    ."
            "   .    . dp_u    .    . menu menu    .      .     . btn_b btn_b    ."
            "   . dp_l dp_c dp_r    .    .    .    .      .     . btn_b btn_b    ."
            "   . dp_l dp_c dp_r    . mute    .    .      .     . btn_b btn_b    ."
            "   .    . dp_d   .     . mute    .    .  btn_a btn_a     .     .    ."
            "   .    . dp_d   .     .    .    .    .  btn_a btn_a     .     .    ."
            "   .    .    .   .     .   fs    .    .  btn_a btn_a     .     .    ."
            "   .    .    .   .     .    .    .    .      .     .     .     .    .";
          grid-template-columns: 4vw 8vw 8vw 8vw 13vw 8vw 8vw 5vw 8vw 8vw 8vw 8vw 4vw;
          grid-template-rows: 98vw 1fr 8vw 4vw 4vw 4vw 4vw 8vw 1fr;
        }

        #game_canvas {
          border-width: 1vw;
        }
      }

      /*
       * TOUCH GUI for a SLIGHTLY VERTICAL screen
       */
      @media (pointer: coarse) and (min-aspect-ratio: 310/450) {
        :root {
          --spr_cell_size: 8vw;
        }

        #unsupported_aspect_ratio {
          display: none;
        }

        #game_display {
          display: grid;

          border-width: 1vw;
          border-bottom-width: 2vw;

          grid-template-areas:
            "canv canv canv canv canv canv canv canv  canv  canv  canv  canv canv"
            "   .    .    .    .    .    .    .    .     .     .     .     .    ."
            "   .    . dp_u    .    . mute    . menu     .     . btn_b btn_b    ."
            "   . dp_l dp_c dp_r    .    .    .    . btn_a btn_a btn_b btn_b    ."
            "   .    . dp_d   .     .   fs    .    . btn_a btn_a     .     .    ."
            "   .    .    .   .     .    .    .    .     .     .     .     .    .";
          grid-template-columns: 2vw 8vw 8vw 8vw 8vw 8vw 6vw 16vw 8vw 8vw 8vw 8vw 2vw;
          grid-template-rows: 98vw 2vw 8vw 8vw 8vw 1fr;
        }

        #game_canvas {
          border-width: 1vw;
        }
      }

      /*
       * TOUCH GUI for a TALLER SQUARE screen
       */
      @media (pointer: coarse) and (min-aspect-ratio: 310/400) {
        :root {
          --spr_cell_size: 6vh;
        }

        #unsupported_aspect_ratio {
          display: none;
        }

        #game_display {
          display: grid;

          border-width: 1vh;
          border-bottom-width: 2vh;

          grid-template-areas:
            ". canv canv canv canv canv canv canv canv  canv  canv  canv  canv canv ."
            ".    .    .    .    .    .    .    .    .     .     .     .     .    . ."
            ".    .    . dp_u    .    . mute    . menu     .     . btn_b btn_b    . ."
            ".    . dp_l dp_c dp_r    .    .    .    . btn_a btn_a btn_b btn_b    . ."
            ".    .    . dp_d   .     .   fs    .    . btn_a btn_a     .     .    . ."
            ".    .    .    .   .     .    .    .    .     .     .     .     .    . .";
          grid-template-columns: 1fr 2vh 6vh 6vh 6vh 6vh 6vh 5vh 12vh 6vh 6vh 6vh 6vh 2vh 1fr;
          grid-template-rows: 75vh 2vh 6vh 6vh 6vh 1fr;
        }

        #game_canvas {
          border-width: 1vh;
        }
      }

      /*
       * TOUCH GUI for a KINDA SQUARE screen
       */
      @media (pointer: coarse) and (min-aspect-ratio: 310/310) {
        :root {
          --spr_cell_size: 7vh;
        }

        #unsupported_aspect_ratio {
          display: none;
        }

        #game_display {
          display: grid;

          border-width: 1vh;
          border-bottom-width: 2vh;

          grid-template-areas:
            ".    .    . canv canv canv canv  canv  canv  canv     .     . ."
            ". mute    . canv canv canv canv  canv  canv  canv     .     . ."
            ".    .    . canv canv canv canv  canv  canv  canv     .     . ."
            ".   fs    . canv canv canv canv  canv  canv  canv     .     . ."
            ".    .    . canv canv canv canv  canv  canv  canv     .     . ."
            ".    .    .    .    .    .    .     .     .     .     .     . ."
            ".    . dp_u dp_u    .    . menu  menu     . btn_b btn_b btn_b ."
            ". dp_l dp_c dp_c dp_r    .    . btn_a btn_a btn_b btn_b btn_b ."
            ".    . dp_d dp_d   .     .    . btn_a btn_a     .     .     . ."
            ".    .    .    .   .     .    .     .     .     .     .     . .";
          grid-template-columns: 1fr 7vh 2vh 5vh 7vh 31vh 11vh 3vh 11vh 5vh 2vh 7vh 1fr;
          grid-template-rows: 4vh 7vh 7vh 7vh 48vh 2vh 7vh 7vh 7vh 1fr;
        }

        #game_canvas {
          border-width: 1vh;
        }
      }

      /*
       * TOUCH GUI for a WIDER SQUARE screen
       */
      @media (pointer: coarse) and (min-aspect-ratio: 310/250) {
        :root {
          --spr_cell_size: 10vh;
        }

        #unsupported_aspect_ratio {
          display: none;
        }

        #game_display {
          display: grid;

          border-width: 1vh;
          border-bottom-width: 2vh;

          grid-template-areas:
            ".    .    .    . canv canv  canv     .     .     . ."
            ".    . mute    . canv canv  canv     .     .     . ."
            ".    .    .    . canv canv  canv     .  menu  menu ."
            ".    .   fs    . canv canv  canv     .     .     . ."
            ".    .    .    . canv canv  canv     .     .     . ."
            ".    .    .    . canv canv  canv     . btn_b btn_b ."
            ".    . dp_u    . canv canv  canv     . btn_b btn_b ."
            ".    . dp_u    .    .    .     .     . btn_b btn_b ."
            ". dp_l dp_c dp_r dp_r    . btn_a btn_a btn_a     . ."
            ".    . dp_d    .   .     . btn_a btn_a btn_a     . ."
            ".    .    .    .   .     .     .     .     .     . .";
          grid-template-columns: 1fr 10vh 10vh 2vh 8vh 58vh 8vh 2vh 10vh 10vh 1fr;
          grid-template-rows: 4vh 10vh 10vh 10vh 22vh 10vh 8vh 2vh 10vh 10vh 1fr;
        }

        #game_canvas {
          border-width: 1vh;
        }
      }

      /*
       * TOUCH GUI for a SLIGHTLY HORIZONTAL screen
       */
      @media (pointer: coarse) and (min-aspect-ratio: 480/250) {
        :root {
          --spr_cell_size: 10vh;
        }

        #unsupported_aspect_ratio {
          display: none;
        }

        #game_display {
          display: grid;

          border-width: 1vh;
          border-bottom-width: 2vh;

          grid-template-areas:
            ".    .    .    . . . canv .      .     .     .     . ."
            ". mute    .   fs . . canv .      .     .  menu  menu ."
            ".    .    .    . . . canv .      .     .     .     . ."
            ".    .    .    . . . canv .      .     . btn_b btn_b ."
            ".    . dp_u    . . . canv .      .     . btn_b btn_b ."
            ". dp_l dp_c dp_r . . canv . btn_a btn_a      .     . ."
            ".    . dp_d    . . . canv . btn_a btn_a      .     . ."
            ".    .    .    . . . canv .     .     .      .     . .";
          grid-template-columns: 1fr 10vh 10vh 10vh 10vh 1fr 97vh 1fr 10vh 10vh 10vh 10vh 1fr;
          grid-template-rows: 10vh 10vh 1fr 10vh 10vh 10vh 10vh 15vh;
        }

        #game_canvas {
          border-width: 1vh;
        }
      }

      /*
       * TOUCH GUI for a REALLY HORIZONTAL screen
       */
      @media (pointer: coarse) and (min-aspect-ratio: 610/250) {
        :root {
          --spr_cell_size: 10vh;
        }

        #unsupported_aspect_ratio {
          display: none;
        }

        #game_display {
          display: grid;

          border-width: 1vh;
          border-bottom-width: 2vh;

          grid-template-areas:
            ".    .    .    . . . canv .      .     .     .     . ."
            ". mute    .   fs . . canv .      .     .  menu  menu ."
            ".    .    .    . . . canv .      .     .     .     . ."
            ".    .    .    . . . canv .      .     . btn_b btn_b ."
            ".    . dp_u    . . . canv .      .     . btn_b btn_b ."
            ". dp_l dp_c dp_r . . canv . btn_a btn_a      .     . ."
            ".    . dp_d    . . . canv . btn_a btn_a      .     . ."
            ".    .    .    . . . canv .     .     .      .     . .";
          grid-template-columns: 15vh 10vh 10vh 10vh 10vh 1fr 97vh 1fr 10vh 10vh 10vh 10vh 15vh;
          grid-template-rows: 10vh 10vh 1fr 10vh 10vh 10vh 10vh 15vh;
        }

        #game_canvas {
          border-width: 1vh;
        }
      }

      /*
       * TOUCH GUI for a SUPER WIDE screen
       */
      @media (pointer: coarse) and (min-aspect-ratio: 800/250) {
        #unsupported_aspect_ratio {
          display: block;

          text-align: center;
          line-height: 100vh;
        }

        #game_display {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div id="unsupported_aspect_ratio">unsupported aspect ratio</div>
    <main id="game_display">
      <canvas id="game_canvas" width="256" height="256"></canvas>
      <div id="dpad_up" class="gui_sprite touch_control"></div>
      <div id="dpad_down" class="gui_sprite touch_control"></div>
      <div id="dpad_left" class="gui_sprite touch_control"></div>
      <div id="dpad_right" class="gui_sprite touch_control"></div>
      <div id="dpad_center" class="gui_sprite touch_control"></div>
      <div id="button_a" class="gui_sprite touch_control"></div>
      <div id="button_b" class="gui_sprite touch_control"></div>
      <div id="button_menu" class="gui_sprite touch_control"></div>
      <div id="button_mute" class="gui_sprite touch_control"></div>
      <div id="button_fullscreen" class="gui_sprite touch_control"></div>
    </main>
  </body>

  <script type="module" src="src/beetpx_entrypoint.ts"></script>
</html>
