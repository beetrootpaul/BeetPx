var Lu=Object.defineProperty;var $u=(i,t,e)=>t in i?Lu(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var b=(i,t,e)=>($u(i,typeof t!="symbol"?t+"":t,e),e),Lr=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var a=(i,t,e)=>(Lr(i,t,"read from private field"),e?e.call(i):t.get(i)),d=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)},m=(i,t,e,n)=>(Lr(i,t,"write to private field"),n?n.call(i,e):t.set(i,e),e);var u=(i,t,e)=>(Lr(i,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();var Fs;const co=class co{constructor(t){b(this,"type","canvas_snapshot_mapping");d(this,Fs,void 0);m(this,Fs,t)}static of(t){return new co(t)}getMappedColor(t,e,n){return t?a(this,Fs).call(this,t.getColorAt(e,n),e,n):null}};Fs=new WeakMap;let al=co;class Q{constructor(t,e,n){b(this,"type","rgb");b(this,"r");b(this,"g");b(this,"b");b(this,"cssHex");this.r=Math.min(Math.max(0,Math.round(t)),255),this.g=Math.min(Math.max(0,Math.round(e)),255),this.b=Math.min(Math.max(0,Math.round(n)),255),this.cssHex="#"+t.toString(16).padStart(2,"0")+e.toString(16).padStart(2,"0")+n.toString(16).padStart(2,"0")}static of(t,e,n){return new Q(t,e,n)}static fromCssHex(t){if(!/^#[0-9a-fA-F]{6}$/.test(t))throw Error("Hexadecimal representation of the color doesn't contain exactly 6 hexadecimal digits, preceded by a single '#'");return new Q(parseInt(t.slice(1,3),16),parseInt(t.slice(3,5),16),parseInt(t.slice(5,7),16))}isSameAs(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}asArray(){return[this.r,this.g,this.b]}}class nt{}b(nt,"black",Q.fromCssHex("#000000")),b(nt,"storm",Q.fromCssHex("#1D2B53")),b(nt,"wine",Q.fromCssHex("#7E2553")),b(nt,"moss",Q.fromCssHex("#008751")),b(nt,"tan",Q.fromCssHex("#AB5236")),b(nt,"slate",Q.fromCssHex("#5F574F")),b(nt,"silver",Q.fromCssHex("#C2C3C7")),b(nt,"white",Q.fromCssHex("#FFF1E8")),b(nt,"ember",Q.fromCssHex("#FF004D")),b(nt,"orange",Q.fromCssHex("#FFA300")),b(nt,"lemon",Q.fromCssHex("#FFEC27")),b(nt,"lime",Q.fromCssHex("#00E436")),b(nt,"sky",Q.fromCssHex("#29ADFF")),b(nt,"dusk",Q.fromCssHex("#83769C")),b(nt,"pink",Q.fromCssHex("#FF77A8")),b(nt,"peach",Q.fromCssHex("#FFCCAA"));var Ms;const cn=class cn{constructor(t){b(this,"type","sprite_mapping");d(this,Ms,void 0);m(this,Ms,t)}static from(t){const e=new Map(t.map(([n,s])=>[n.cssHex,s]));return new cn((n,s,r)=>{if(!n)return n;const o=e.get(n.cssHex);return typeof o>"u"?n:o})}static of(t){return new cn(t)}getMappedColor(t,e,n){return a(this,Ms).call(this,t,e,n)}};Ms=new WeakMap,b(cn,"noMapping",new cn((t,e,n)=>t));let ir=cn;var Os;const Fe=class Fe{constructor(t){d(this,Os,void 0);if(t<0||t>65535)throw Error("BpxPatter: bits representation of the pattern is out of range of valid values. The value should be in range of 0b0000_0000_0000_0000 to 0b1111_1111_1111_1111.");m(this,Os,t)}static from(t){t=t.replace(/\s/g,"");const e=t.search(/[^#-]/);if(e>=0)throw Error(`BpxPattern.from: Unexpected character found: "${t[e]}"`);if(t.length!==16)throw Error(`BpxPattern.from: Unexpected amount of # and - symbols. There should be 16 of them (4 rows x 4 columns), but instead there is: ${t.length}`);let n=0;for(let s=0;s<16;++s)t[s]==="#"&&(n|=1<<15-s);return new Fe(n)}static of(t){return new Fe(t)}hasPrimaryColorAt(t,e){const n=t%4,s=e%4,r=4*4-(s*4+n)-1;return!!(a(this,Os)&1<<r)}};Os=new WeakMap,b(Fe,"primaryOnly",Fe.of(65535)),b(Fe,"secondaryOnly",Fe.of(0));let gs=Fe;function Kn(i,t,e){return i<t?t<e?t:i<e?e:i:t>e?t:i>e?e:i}function rl(i,t,e,n){const s=i+(t-i)*e;return n!=null&&n.clamp?Kn(i,s,t):s}function gi(i,t){return t===0?0:(i%t+t)%t}function yh(i,t){return(Math.atan2(t,i)/Math.PI/2+1)%1}function vh(i){return Math.cos(i*Math.PI*2)}function xh(i){return Math.sin(i*Math.PI*2)}class P{constructor(t,e){this.x=t,this.y=e}static unitFromAngle(t){return new P(vh(t),xh(t))}static of(t,e){return new P(t,e??t)}static min(t,e){return new P(Math.min(t.x,e.x),Math.min(t.y,e.y))}static max(t,e){return new P(Math.max(t.x,e.x),Math.max(t.y,e.y))}static minMax(t,e){return[P.min(t,e),P.max(t,e)]}static lerp(t,e,n,s){return new P(rl(t.x,e.x,n,s),rl(t.y,e.y,n,s))}asArray(){return[this.x,this.y]}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.magnitude();return new P(this.x/t,this.y/t)}sign(){return new P(Math.sign(this.x),Math.sign(this.y))}abs(){return new P(Math.abs(this.x),Math.abs(this.y))}floor(){return new P(Math.floor(this.x),Math.floor(this.y))}ceil(){return new P(Math.ceil(this.x),Math.ceil(this.y))}round(){return new P(Math.round(this.x),Math.round(this.y))}toAngle(){return yh(this.x,this.y)}eq(t){return typeof t!="number"?this.x===t.x&&this.y===t.y:this.x===t&&this.y===t}gt(t){return typeof t!="number"?this.x>t.x&&this.y>t.y:this.x>t&&this.y>t}gte(t){return typeof t!="number"?this.x>=t.x&&this.y>=t.y:this.x>=t&&this.y>=t}lt(t){return typeof t!="number"?this.x<t.x&&this.y<t.y:this.x<t&&this.y<t}lte(t){return typeof t!="number"?this.x<=t.x&&this.y<=t.y:this.x<=t&&this.y<=t}clamp(t,e){return new P(Kn(t.x,this.x,e.x),Kn(t.y,this.y,e.y))}mod(t,e){return typeof t!="number"?new P(gi(this.x,t.x),gi(this.y,t.y)):new P(gi(this.x,t),gi(this.y,e??t))}add(t,e){return typeof t!="number"?new P(this.x+t.x,this.y+t.y):new P(this.x+t,this.y+(e??t))}sub(t,e){return typeof t!="number"?new P(this.x-t.x,this.y-t.y):new P(this.x-t,this.y-(e??t))}mul(t,e){return typeof t!="number"?new P(this.x*t.x,this.y*t.y):new P(this.x*t,this.y*(e??t))}div(t,e){return typeof t!="number"?new P(this.x/t.x,this.y/t.y):new P(this.x/t,this.y/(e??t))}*[Symbol.iterator](){yield this.x,yield this.y}[Symbol.toPrimitive](t){switch(t){case"default":case"string":return`(${this.x},${this.y})`;case"number":return NaN}}get[Symbol.toStringTag](){return"BpxVector2d"}__printDebug(){return`(${this.x},${this.y})`}}class Pr{constructor(t){b(this,"asciiRows");b(this,"size");this.asciiRows=t.split(`
`).map(n=>n.replace(/\s/g,"")).filter(n=>n.length>0);let e=0;for(const n of this.asciiRows){const s=n.search(/[^#-]/);if(s>=0)throw Error(`DrawPixels.draw: Unexpected character found: "${n[s]}"`);e=Math.max(e,n.length)}this.size=P.of(e,this.asciiRows.length)}static from(t){return new Pr(t)}}function Kl(i){throw Error("Somehow reached the unreachable code ¯\\_(ツ)_/¯")}function Xl(i){return i}function nr(i){return Array.from({length:i},(t,e)=>e)}var Ps,gt,Ds;const ai=class ai{constructor(t){d(this,gt,void 0);d(this,Ds,void 0);m(this,gt,t),m(this,Ds,[...new Set(Array.from(t.glyphs.values()).filter(e=>e.type==="sprite").map(e=>e.sprite.imageUrl))])}static of(t){return new ai({ascent:t.ascent??8,descent:t.descent??8,lineGap:t.lineGap??1,mapGrapheme:t.mapGrapheme??Xl,glyphs:t.glyphs??new Map})}static basedOn(t,e){const n=e(a(t,gt));return new ai(n)}get spriteSheetUrls(){return a(this,Ds)}get ascent(){return a(this,gt).ascent}get descent(){return a(this,gt).descent}get lineGap(){return a(this,gt).lineGap}arrangeGlyphsFor(t,e,n){var l;n??(n={});const s=[];let r=P.of(0,0),o=0,h=`
`;const f=a(ai,Ps).segment(t)[Symbol.iterator]();for(let c=f.next();!c.done;c=f.next()){const _=a(this,gt).mapGrapheme(c.value.segment),g=c.value.index;if(_===`
`){s.push({type:"line_break",lineNumber:o}),h=`
`,r=P.of(0,r.y+a(this,gt).ascent+a(this,gt).descent+a(this,gt).lineGap),o+=1;continue}if(_==="["){let M;for(const[C,D]of Object.entries(n)){const I=`[${C}]`;if(t.slice(g,g+I.length)===I){M=D;const x=[...a(ai,Ps).segment(I)].length-1;nr(x).forEach(()=>{f.next()});break}}if(M){e=M;continue}}const p=a(this,gt).glyphs.get(_);if(!p)continue;const y=((l=p.kerning)==null?void 0:l[h])??0,U=e;if(p.type==="sprite"){s.push({type:"sprite",char:_,sprite:p.sprite,spriteColorMapping:ir.of(M=>p.isTextColor(M)?U:null),lineNumber:o,leftTop:r.add(0,a(this,gt).ascent).sub(0,p.sprite.size.y).add(p.offset??P.of(0,0)).add(y,0)}),h=_,r=r.add(p.advance+y,0);continue}if(p.type==="pixels"){s.push({type:"pixels",char:_,pixels:p.pixels,color:U,lineNumber:o,leftTop:r.add(0,this.ascent).sub(0,p.pixels.size.y).add(p.offset??P.of(0,0)).add(y,0)}),h=_,r=r.add(p.advance+y,0);continue}if(p.type==="whitespace"){h=_,r=r.add(p.advance+y,0);continue}Kl()}return s}};Ps=new WeakMap,gt=new WeakMap,Ds=new WeakMap,d(ai,Ps,new Intl.Segmenter("en",{granularity:"grapheme",localeMatcher:"best fit"}));let os=ai;class _s{constructor(t,e,n,s,r){b(this,"type","static");b(this,"imageUrl");b(this,"size");b(this,"xy");e<0&&(e=-e,s-=e),n<0&&(n=-n,r-=n),this.imageUrl=t,this.xy=P.of(s,r).round(),this.size=P.of(s+e,r+n).round().sub(this.xy)}static from(t,e,n,s,r){return new _s(t,e,n,s,r)}clipBy(t,e){const n=this.xy.clamp(t,e),s=this.xy.add(this.size).clamp(t,e).sub(n);return new _s(this.imageUrl,s.x,s.y,n.x,n.y)}}var S,E;const hr=class hr{constructor(){d(this,S);b(this,"ascent",5);b(this,"descent",0);b(this,"lineGap",1);b(this,"glyphs",new Map([[" ",{type:"whitespace",advance:4}],["0",u(this,S,E).call(this,0,3)],["1",u(this,S,E).call(this,1,3)],["2",u(this,S,E).call(this,2,3)],["3",u(this,S,E).call(this,3,3)],["4",u(this,S,E).call(this,4,3)],["5",u(this,S,E).call(this,5,3)],["6",u(this,S,E).call(this,6,3)],["7",u(this,S,E).call(this,7,3)],["8",u(this,S,E).call(this,8,3)],["9",u(this,S,E).call(this,9,3)],["-",u(this,S,E).call(this,13,2)],["+",u(this,S,E).call(this,11,2)],["=",u(this,S,E).call(this,13,3)],["(",u(this,S,E).call(this,8,2)],[")",u(this,S,E).call(this,9,2)],["[",u(this,S,E).call(this,11,5)],["]",u(this,S,E).call(this,13,5)],["{",u(this,S,E).call(this,11,7)],["}",u(this,S,E).call(this,13,7)],["<",u(this,S,E).call(this,12,3)],[">",u(this,S,E).call(this,14,3)],["~",u(this,S,E).call(this,14,7)],["!",u(this,S,E).call(this,1,2)],["?",u(this,S,E).call(this,15,3)],["@",u(this,S,E).call(this,0,4)],["#",u(this,S,E).call(this,3,2)],["$",u(this,S,E).call(this,4,2)],["%",u(this,S,E).call(this,5,2)],["^",u(this,S,E).call(this,14,5)],["&",u(this,S,E).call(this,6,2)],["*",u(this,S,E).call(this,10,2)],["_",u(this,S,E).call(this,15,5)],[".",u(this,S,E).call(this,14,2)],[",",u(this,S,E).call(this,12,2)],[":",u(this,S,E).call(this,10,3)],[";",u(this,S,E).call(this,11,3)],["`",u(this,S,E).call(this,0,6)],["'",u(this,S,E).call(this,7,2)],['"',u(this,S,E).call(this,2,2)],["/",u(this,S,E).call(this,15,2)],["|",u(this,S,E).call(this,12,7)],["\\",u(this,S,E).call(this,12,5)],["a",u(this,S,E).call(this,1,6)],["b",u(this,S,E).call(this,2,6)],["c",u(this,S,E).call(this,3,6)],["d",u(this,S,E).call(this,4,6)],["e",u(this,S,E).call(this,5,6)],["f",u(this,S,E).call(this,6,6)],["g",u(this,S,E).call(this,7,6)],["h",u(this,S,E).call(this,8,6)],["i",u(this,S,E).call(this,9,6)],["j",u(this,S,E).call(this,10,6)],["k",u(this,S,E).call(this,11,6)],["l",u(this,S,E).call(this,12,6)],["m",u(this,S,E).call(this,13,6)],["n",u(this,S,E).call(this,14,6)],["o",u(this,S,E).call(this,15,6)],["p",u(this,S,E).call(this,0,7)],["q",u(this,S,E).call(this,1,7)],["r",u(this,S,E).call(this,2,7)],["s",u(this,S,E).call(this,3,7)],["t",u(this,S,E).call(this,4,7)],["u",u(this,S,E).call(this,5,7)],["v",u(this,S,E).call(this,6,7)],["w",u(this,S,E).call(this,7,7)],["x",u(this,S,E).call(this,8,7)],["y",u(this,S,E).call(this,9,7)],["z",u(this,S,E).call(this,10,7)],["⬅",u(this,S,E).call(this,11,8,7)],["➡",u(this,S,E).call(this,1,9,7)],["⬆",u(this,S,E).call(this,4,9,7)],["⬇",u(this,S,E).call(this,3,8,7)],["⭐",u(this,S,E).call(this,2,9,7)],["❤️",u(this,S,E).call(this,7,8,7)],["❎",u(this,S,E).call(this,7,9,7)],["⭕",u(this,S,E).call(this,14,8,7)],["♪",u(this,S,E).call(this,13,8,7)]]))}mapGrapheme(t){return t.toLowerCase()}};S=new WeakSet,E=function(t,e,n=3){const s=_s.from(hr.spriteSheetUrl,n,5,t*8,e*8);return{type:"sprite",sprite:s,isTextColor:r=>(r==null?void 0:r.cssHex)===nt.white.cssHex,advance:s.size.x+1}},b(hr,"spriteSheetUrl",".beetpx/pico-8-font.png");let ll=hr;var F,O;class Bu{constructor(){d(this,F);b(this,"ascent",4);b(this,"descent",0);b(this,"lineGap",2);b(this,"glyphs",new Map([[" ",u(this,F,O).call(this,`
        ----
        ----
        ----
        ----
      `)],[".",u(this,F,O).call(this,`
        -
        -
        -
        #
      `)],[":",u(this,F,O).call(this,`
        #
        -
        -
        #
      `)],["!",u(this,F,O).call(this,`
        #
        #
        #
        -
        #
      `)],["?",u(this,F,O).call(this,`
        -#-
        #-#
        --#
        -#-
        -#-
      `)],["'",u(this,F,O).call(this,`
        #
        #
        -
        -
        -
      `)],['"',u(this,F,O).call(this,`
        #-#
        #-#
        ---
        ---
        ---
      `)],["*",u(this,F,O).call(this,`
        #-#
        -#-
        #-#
        ---
      `)],["/",u(this,F,O).call(this,`
        --#
        -#-
        -#-
        #--
      `)],["+",u(this,F,O).call(this,`
        ---
        -#-
        ###
        -#-
      `)],["-",u(this,F,O).call(this,`
        ---
        ---
        ###
        ---
      `)],["0",u(this,F,O).call(this,`
        -#-
        #-#
        #-#
        -#-
      `)],["1",u(this,F,O).call(this,`
        -#-
        ##-
        -#-
        -#-
      `)],["2",u(this,F,O).call(this,`
        ##-
        -##
        #--
        ###
      `)],["3",u(this,F,O).call(this,`
        ###
        -##
        --#
        ###
      `)],["4",u(this,F,O).call(this,`
        #-#
        #-#
        ###
        --#
      `)],["5",u(this,F,O).call(this,`
        ###
        ##-
        --#
        ##-
      `)],["6",u(this,F,O).call(this,`
        -#-
        #--
        ###
        -#-
      `)],["7",u(this,F,O).call(this,`
        ###
        --#
        -#-
        #--
      `)],["8",u(this,F,O).call(this,`
        ###
        -#-
        #-#
        -#-
      `)],["9",u(this,F,O).call(this,`
        ###
        ###
        --#
        ##-
      `)],["%",u(this,F,O).call(this,`
        #--#
        --#-
        -#--
        #--#
      `)],["$",u(this,F,O).call(this,`
        -##
        ##-
        -##
        ##-
      `)],["(",u(this,F,O).call(this,`
        -#
        #-
        #-
        -#
      `)],[")",u(this,F,O).call(this,`
        #-
        -#
        -#
        #-
      `)],["[",u(this,F,O).call(this,`
        ##
        #-
        #-
        ##
      `)],["]",u(this,F,O).call(this,`
        ##
        -#
        -#
        ##
      `)],["{",u(this,F,O).call(this,`
        -#
        ##
        ##
        -#
      `)],["}",u(this,F,O).call(this,`
        #-
        ##
        ##
        #-
      `)],["<",u(this,F,O).call(this,`
        ---
        -##
        #--
        -##
      `)],[">",u(this,F,O).call(this,`
        ##-
        --#
        ##-
        ---
      `)],["a",u(this,F,O).call(this,`
        ##-
        #-#
        ###
        #-#
      `)],["b",u(this,F,O).call(this,`
        #--
        ##-
        #-#
        ###
      `)],["c",u(this,F,O).call(this,`
        -##
        #--
        #--
        -##
      `)],["d",u(this,F,O).call(this,`
        ##-
        #-#
        #-#
        ##-
      `)],["e",u(this,F,O).call(this,`
        ###
        ##-
        #--
        ###
      `)],["f",u(this,F,O).call(this,`
        ###
        #--
        ##-
        #--
      `)],["g",u(this,F,O).call(this,`
        -##
        #--
        #-#
        -##
      `)],["h",u(this,F,O).call(this,`
        #--
        ##-
        #-#
        #-#
      `)],["i",u(this,F,O).call(this,`
        #
        #
        #
        #
      `)],["j",u(this,F,O).call(this,`
        ##
        -#
        -#
        #-
      `)],["k",u(this,F,O).call(this,`
        #-#
        ##-
        #-#
        #-#
      `)],["l",u(this,F,O).call(this,`
        #-
        #-
        #-
        ##
      `)],["m",u(this,F,O).call(this,`
        #-#
        ###
        #-#
        #-#
      `)],["n",u(this,F,O).call(this,`
        ##-
        #-#
        #-#
        #-#
      `)],["o",u(this,F,O).call(this,`
        -##
        #-#
        #-#
        ##-
      `)],["p",u(this,F,O).call(this,`
        ###
        #-#
        ##-
        #--
      `)],["q",u(this,F,O).call(this,`
        -#-
        #-#
        ###
        -#-
      `)],["r",u(this,F,O).call(this,`
        ##-
        #-#
        ##-
        #-#
      `)],["s",u(this,F,O).call(this,`
        -##
        ##-
        --#
        ##-
      `)],["t",u(this,F,O).call(this,`
        ###
        -#-
        -#-
        -#-
      `)],["u",u(this,F,O).call(this,`
        #-#
        #-#
        #-#
        ##-
      `)],["v",u(this,F,O).call(this,`
        #-#
        #-#
        #-#
        -#-
      `)],["w",u(this,F,O).call(this,`
        #-#
        #-#
        ###
        #-#
      `)],["x",u(this,F,O).call(this,`
        #-#
        -#-
        #-#
        #-#
      `)],["y",u(this,F,O).call(this,`
        #-#
        #-#
        -#-
        -#-
      `)],["z",u(this,F,O).call(this,`
        ###
        -#-
        #--
        ###
      `)]]))}mapGrapheme(t){return t.toLowerCase()}}F=new WeakSet,O=function(t){const e=Pr.from(t);return{type:"pixels",pixels:e,advance:e.size.x+1}};var v,A;class Gu{constructor(){d(this,v);b(this,"ascent",5);b(this,"descent",0);b(this,"lineGap",2);b(this,"glyphs",new Map([[" ",u(this,v,A).call(this,`
        ----
        ----
        ----
        ----
        ----
      `)],[".",u(this,v,A).call(this,`
        --
        --
        --
        ##
        ##
      `)],[":",u(this,v,A).call(this,`
        #
        -
        -
        #
        -
      `)],["!",u(this,v,A).call(this,`
        ###
        ###
        -#-
        ---
        -#-
      `)],["?",u(this,v,A).call(this,`
        ###
        --#
        -#-
        ---
        -#-
      `)],["'",u(this,v,A).call(this,`
        -
        #
        #
        -
        -
      `)],['"',u(this,v,A).call(this,`
        #-#
        #-#
        ---
        ---
        ---
      `)],["*",u(this,v,A).call(this,`
        --
        ##
        ##
        --
        --
      `)],["/",u(this,v,A).call(this,`
        --#
        --#
        -#-
        #--
        #--
      `)],["+",u(this,v,A).call(this,`
        ---
        -#-
        ###
        -#-
        ---
      `)],["-",u(this,v,A).call(this,`
        ---
        ---
        ###
        ---
        ---
      `)],["0",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        #-#
        -#-
      `)],["1",u(this,v,A).call(this,`
        -#-
        ##-
        -#-
        -#-
        ###
      `)],["2",u(this,v,A).call(this,`
        -#-
        #-#
        --#
        -#-
        ###
      `)],["3",u(this,v,A).call(this,`
        ###
        --#
        -##
        --#
        ##-
      `)],["4",u(this,v,A).call(this,`
        --#
        -##
        #-#
        ###
        --#
      `)],["5",u(this,v,A).call(this,`
        ###
        #--
        ###
        --#
        ##-
      `)],["6",u(this,v,A).call(this,`
        ###
        #--
        ###
        #-#
        ###
      `)],["7",u(this,v,A).call(this,`
        ###
        --#
        -#-
        -#-
        -#-
      `)],["8",u(this,v,A).call(this,`
        ###
        #-#
        -#-
        #-#
        ###
      `)],["9",u(this,v,A).call(this,`
        ###
        #-#
        ###
        --#
        ###
      `)],["%",u(this,v,A).call(this,`
        #-#
        --#
        -#-
        #--
        #-#
      `)],["$",u(this,v,A).call(this,`
        ###
        ##-
        -##
        ###
        -#-
      `)],["(",u(this,v,A).call(this,`
        -#
        #-
        #-
        #-
        -#
      `)],[")",u(this,v,A).call(this,`
        #-
        -#
        -#
        -#
        #-
      `)],["[",u(this,v,A).call(this,`
        ##
        #-
        #-
        #-
        ##
      `)],["]",u(this,v,A).call(this,`
        ##
        -#
        -#
        -#
        ##
      `)],["{",u(this,v,A).call(this,`
        -##
        -#-
        #--
        -#-
        -##
      `)],["}",u(this,v,A).call(this,`
        ##-
        -#-
        --#
        -#-
        ##-
      `)],["<",u(this,v,A).call(this,`
        --#
        -#-
        #--
        -#-
        --#
      `)],[">",u(this,v,A).call(this,`
        #--
        -#-
        --#
        -#-
        #--
      `)],["A",u(this,v,A).call(this,`
        -#-
        #-#
        ###
        #-#
        #-#
      `)],["B",u(this,v,A).call(this,`
        ##-
        #-#
        ##-
        #-#
        ###
      `)],["C",u(this,v,A).call(this,`
        -#-
        #-#
        #--
        #-#
        -#-
      `)],["D",u(this,v,A).call(this,`
        ##-
        #-#
        #-#
        #-#
        ##-
      `)],["E",u(this,v,A).call(this,`
        ###
        #--
        ##-
        #--
        ###
      `)],["F",u(this,v,A).call(this,`
        ###
        #--
        ##-
        #--
        #--
      `)],["G",u(this,v,A).call(this,`
        -#-
        #-#
        #--
        #-#
        -##
      `)],["H",u(this,v,A).call(this,`
        #-#
        #-#
        ###
        #-#
        #-#
      `)],["I",u(this,v,A).call(this,`
        ###
        -#-
        -#-
        -#-
        ###
      `)],["J",u(this,v,A).call(this,`
        --#
        --#
        --#
        #-#
        -#-
      `)],["K",u(this,v,A).call(this,`
        #-#
        #-#
        ##-
        #-#
        #-#
      `)],["L",u(this,v,A).call(this,`
        #--
        #--
        #--
        #--
        ###
      `)],["M",u(this,v,A).call(this,`
        #-#
        ###
        ###
        #-#
        #-#
      `)],["N",u(this,v,A).call(this,`
        ##-
        ###
        #-#
        #-#
        #-#
      `)],["O",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        #-#
        -#-
      `)],["P",u(this,v,A).call(this,`
        ##-
        #-#
        ###
        #--
        #--
      `)],["Q",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        ###
        -##
      `)],["R",u(this,v,A).call(this,`
        ##-
        #-#
        ##-
        #-#
        #-#
      `)],["S",u(this,v,A).call(this,`
        ###
        #--
        -#-
        --#
        ##-
      `)],["T",u(this,v,A).call(this,`
        ###
        -#-
        -#-
        -#-
        -#-
      `)],["U",u(this,v,A).call(this,`
        #-#
        #-#
        #-#
        #-#
        ###
      `)],["V",u(this,v,A).call(this,`
        #-#
        #-#
        #-#
        -#-
        -#-
      `)],["W",u(this,v,A).call(this,`
        #-#
        #-#
        ###
        ###
        #-#
      `)],["X",u(this,v,A).call(this,`
        #-#
        #-#
        -#-
        #-#
        #-#
      `)],["Y",u(this,v,A).call(this,`
        #-#
        #-#
        -#-
        -#-
        -#-
      `)],["Z",u(this,v,A).call(this,`
        ###
        --#
        -#-
        #--
        ###
      `)],["a",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        ###
        #-#
      `)],["b",u(this,v,A).call(this,`
        #--
        #--
        ##-
        #-#
        ##-
      `)],["c",u(this,v,A).call(this,`
        -##
        #--
        #--
        #--
        -##
      `)],["d",u(this,v,A).call(this,`
        --#
        --#
        -##
        #-#
        ###
      `)],["e",u(this,v,A).call(this,`
        -#-
        #-#
        ###
        #--
        -##
      `)],["f",u(this,v,A).call(this,`
        -##
        -#-
        ###
        -#-
        -#-
      `)],["g",u(this,v,A).call(this,`
        -#-
        #-#
        #--
        #-#
        -##
      `)],["h",u(this,v,A).call(this,`
        #--
        #--
        ##-
        #-#
        #-#
      `)],["i",u(this,v,A).call(this,`
        -#
        --
        -#
        -#
        -#
      `)],["j",u(this,v,A).call(this,`
        -##
        --#
        --#
        #-#
        -#-
      `)],["k",u(this,v,A).call(this,`
        #-#
        #-#
        ##-
        #-#
        #-#
      `)],["l",u(this,v,A).call(this,`
        #
        #
        #
        #
        #
      `)],["m",u(this,v,A).call(this,`
        #-#
        ###
        ###
        #-#
        #-#
      `)],["n",u(this,v,A).call(this,`
        ##-
        #-#
        #-#
        #-#
        #-#
      `)],["o",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        #-#
        -#-
      `)],["p",u(this,v,A).call(this,`
        ##-
        #-#
        ###
        #--
        #--
      `)],["q",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        ###
        -##
      `)],["r",u(this,v,A).call(this,`
        -#-
        #-#
        #--
        #--
        #--
      `)],["s",u(this,v,A).call(this,`
        -##
        #--
        -#-
        --#
        ##-
      `)],["t",u(this,v,A).call(this,`
        -#-
        ###
        -#-
        -#-
        -##
      `)],["u",u(this,v,A).call(this,`
        #-#
        #-#
        #-#
        #-#
        -#-
      `)],["v",u(this,v,A).call(this,`
        #-#
        #-#
        #-#
        -#-
        -#-
      `)],["w",u(this,v,A).call(this,`
        #-#
        #-#
        ###
        ###
        #-#
      `)],["x",u(this,v,A).call(this,`
        #-#
        #-#
        -#-
        #-#
        #-#
      `)],["y",u(this,v,A).call(this,`
        #-#
        #-#
        -#-
        -#-
        -#-
      `)],["z",u(this,v,A).call(this,`
        ###
        --#
        -#-
        #--
        ###
      `)]]))}mapGrapheme(t){return t}}v=new WeakSet,A=function(t){const e=Pr.from(t);return{type:"pixels",pixels:e,advance:e.size.x+1}};class _o{static detect(t){const e=t.id.toLowerCase();return e.includes("dualsense")?"dualsense":e.includes("8bitdo")||e.includes("2dc8")?"8bitdo":e.includes("054c")?"dualsense":e.includes("xbox")||e.includes("045e")?"xbox":(e.includes("xinput"),"other")}}class hn{}b(hn,"linear",t=>t),b(hn,"inQuadratic",t=>t**2),b(hn,"outQuadratic",t=>1-(t-1)**2),b(hn,"inQuartic",t=>t**4),b(hn,"outQuartic",t=>1-(t-1)**4);class N{static addLoadedClass(){document.body.classList.add("loaded")}static addStartedClass(){document.body.classList.add("started")}static showError(t){document.body.classList.add("error"),document.getElementById("screen_error__message").innerText=String(t)}static updateMutedClass(t){document.body.classList[t?"add":"remove"]("muted")}static updateDebugClass(t){document.body.classList[t?"add":"remove"]("debug")}static updatePressedClasses(t){document.body.classList[t.up?"add":"remove"]("pressed_u"),document.body.classList[t.down?"add":"remove"]("pressed_d"),document.body.classList[t.left?"add":"remove"]("pressed_l"),document.body.classList[t.right?"add":"remove"]("pressed_r"),document.body.classList[t.a?"add":"remove"]("pressed_a"),document.body.classList[t.b?"add":"remove"]("pressed_b"),document.body.classList[t.menu?"add":"remove"]("pressed_menu"),document.body.classList[t.mute?"add":"remove"]("pressed_mute"),document.body.classList[t.fullscreen?"add":"remove"]("pressed_fullscreen")}}b(N,"selectors",{fullScreenSubject:"body",canvas:"#game_canvas",startButton:"#screen_start_game__button",controlsLeft:"#dpad_l",controlsRight:"#dpad_r",controlsUp:"#dpad_u",controlsDown:"#dpad_d",controlsUpLeft:"#dpad_ul",controlsUpRight:"#dpad_ur",controlsDownLeft:"#dpad_dl",controlsDownRight:"#dpad_dr",controlsA:"#button_a",controlsB:"#button_b",controlsMenu:"#button_menu",controlsFullScreen:"#button_fullscreen",controlsMuteToggle:"#button_mute"});(function(i){if(i.TextEncoder&&i.TextDecoder)return!1;function t(n="utf-8"){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${n}') is invalid.`)}Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),t.prototype.encode=function(n,s={stream:!1}){if(s.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let r=0;const o=n.length;let h=0,f=Math.max(32,o+(o>>1)+7),l=new Uint8Array(f>>3<<3);for(;r<o;){let c=n.charCodeAt(r++);if(c>=55296&&c<=56319){if(r<o){const _=n.charCodeAt(r);(_&64512)===56320&&(++r,c=((c&1023)<<10)+(_&1023)+65536)}if(c>=55296&&c<=56319)continue}if(h+4>l.length){f+=8,f*=1+r/n.length*2,f=f>>3<<3;const _=new Uint8Array(f);_.set(l),l=_}if(c&4294967168)if(!(c&4294965248))l[h++]=c>>6&31|192;else if(!(c&4294901760))l[h++]=c>>12&15|224,l[h++]=c>>6&63|128;else if(!(c&4292870144))l[h++]=c>>18&7|240,l[h++]=c>>12&63|128,l[h++]=c>>6&63|128;else continue;else{l[h++]=c;continue}l[h++]=c&63|128}return l.slice(0,h)};function e(n="utf-8",s={fatal:!1}){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${n}') is invalid.`);if(s.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(e.prototype,"fatal",{value:!1}),Object.defineProperty(e.prototype,"ignoreBOM",{value:!1}),e.prototype.decode=function(n,s={stream:!1}){if(s.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const r=new Uint8Array(n);let o=0;const h=r.length,f=[];for(;o<h;){const l=r[o++];if(l===0)break;if(!(l&128))f.push(l);else if((l&224)===192){const c=r[o++]&63;f.push((l&31)<<6|c)}else if((l&240)===224){const c=r[o++]&63,_=r[o++]&63;f.push((l&31)<<12|c<<6|_)}else if((l&248)===240){const c=r[o++]&63,_=r[o++]&63,g=r[o++]&63;let p=(l&7)<<18|c<<12|_<<6|g;p>65535&&(p-=65536,f.push(p>>>10&1023|55296),p=56320|p&1023),f.push(p)}}return String.fromCharCode.apply(null,f)},i.TextEncoder=t,i.TextDecoder=e})(typeof window<"u"?window:typeof self<"u"?self:void 0);function bo(i,t="utf8"){return new TextDecoder(t).decode(i)}const Zu=new TextEncoder;function Hu(i){return Zu.encode(i)}const Ju=1024*8,Wu=(()=>{const i=new Uint8Array(4),t=new Uint32Array(i.buffer);return!((t[0]=1)&i[0])})(),$r={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class Yl{constructor(t=Ju,e={}){let n=!1;typeof t=="number"?t=new ArrayBuffer(t):(n=!0,this.lastWrittenByte=t.byteLength);const s=e.offset?e.offset>>>0:0,r=t.byteLength-s;let o=s;(ArrayBuffer.isView(t)||t instanceof Yl)&&(t.byteLength!==t.buffer.byteLength&&(o=t.byteOffset+s),t=t.buffer),n?this.lastWrittenByte=r:this.lastWrittenByte=0,this.buffer=t,this.length=r,this.byteLength=r,this.byteOffset=o,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,o,r),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}back(t=1){return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const n=(this.offset+t)*2,s=new Uint8Array(n);s.set(new Uint8Array(this.buffer)),this.buffer=s.buffer,this.length=this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){return this.readArray(t,"uint8")}readArray(t,e){const n=$r[e].BYTES_PER_ELEMENT*t,s=this.byteOffset+this.offset,r=this.buffer.slice(s,s+n);if(this.littleEndian===Wu&&e!=="uint8"&&e!=="int8"){const h=new Uint8Array(this.buffer.slice(s,s+n));h.reverse();const f=new $r[e](h.buffer);return this.offset+=n,f.reverse(),f}const o=new $r[e](r);return this.offset+=n,o}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){const t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){const t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let e="";for(let n=0;n<t;n++)e+=this.readChar();return e}readUtf8(t=1){return bo(this.readBytes(t))}decodeText(t=1,e="utf-8"){return bo(this.readBytes(t),e)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){return this.writeBytes(Hu(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const qu=4,wo=0,yo=1,Ku=2;function ts(i){let t=i.length;for(;--t>=0;)i[t]=0}const Xu=0,Ah=1,Yu=2,ju=3,Qu=258,jl=29,Ua=256,bs=Ua+1+jl,dn=30,Ql=19,Sh=2*bs+1,_i=15,Br=16,Vu=7,Vl=256,Eh=16,kh=17,Ch=18,ol=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ja=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),tc=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Rh=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ec=512,de=new Array((bs+2)*2);ts(de);const hs=new Array(dn*2);ts(hs);const ws=new Array(ec);ts(ws);const ys=new Array(Qu-ju+1);ts(ys);const to=new Array(jl);ts(to);const sr=new Array(dn);ts(sr);function Gr(i,t,e,n,s){this.static_tree=i,this.extra_bits=t,this.extra_base=e,this.elems=n,this.max_length=s,this.has_stree=i&&i.length}let Th,Fh,Mh;function Zr(i,t){this.dyn_tree=i,this.max_code=0,this.stat_desc=t}const Oh=i=>i<256?ws[i]:ws[256+(i>>>7)],vs=(i,t)=>{i.pending_buf[i.pending++]=t&255,i.pending_buf[i.pending++]=t>>>8&255},At=(i,t,e)=>{i.bi_valid>Br-e?(i.bi_buf|=t<<i.bi_valid&65535,vs(i,i.bi_buf),i.bi_buf=t>>Br-i.bi_valid,i.bi_valid+=e-Br):(i.bi_buf|=t<<i.bi_valid&65535,i.bi_valid+=e)},oe=(i,t,e)=>{At(i,e[t*2],e[t*2+1])},Ph=(i,t)=>{let e=0;do e|=i&1,i>>>=1,e<<=1;while(--t>0);return e>>>1},ic=i=>{i.bi_valid===16?(vs(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=i.bi_buf&255,i.bi_buf>>=8,i.bi_valid-=8)},nc=(i,t)=>{const e=t.dyn_tree,n=t.max_code,s=t.stat_desc.static_tree,r=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,h=t.stat_desc.extra_base,f=t.stat_desc.max_length;let l,c,_,g,p,y,U=0;for(g=0;g<=_i;g++)i.bl_count[g]=0;for(e[i.heap[i.heap_max]*2+1]=0,l=i.heap_max+1;l<Sh;l++)c=i.heap[l],g=e[e[c*2+1]*2+1]+1,g>f&&(g=f,U++),e[c*2+1]=g,!(c>n)&&(i.bl_count[g]++,p=0,c>=h&&(p=o[c-h]),y=e[c*2],i.opt_len+=y*(g+p),r&&(i.static_len+=y*(s[c*2+1]+p)));if(U!==0){do{for(g=f-1;i.bl_count[g]===0;)g--;i.bl_count[g]--,i.bl_count[g+1]+=2,i.bl_count[f]--,U-=2}while(U>0);for(g=f;g!==0;g--)for(c=i.bl_count[g];c!==0;)_=i.heap[--l],!(_>n)&&(e[_*2+1]!==g&&(i.opt_len+=(g-e[_*2+1])*e[_*2],e[_*2+1]=g),c--)}},Dh=(i,t,e)=>{const n=new Array(_i+1);let s=0,r,o;for(r=1;r<=_i;r++)s=s+e[r-1]<<1,n[r]=s;for(o=0;o<=t;o++){let h=i[o*2+1];h!==0&&(i[o*2]=Ph(n[h]++,h))}},sc=()=>{let i,t,e,n,s;const r=new Array(_i+1);for(e=0,n=0;n<jl-1;n++)for(to[n]=e,i=0;i<1<<ol[n];i++)ys[e++]=n;for(ys[e-1]=n,s=0,n=0;n<16;n++)for(sr[n]=s,i=0;i<1<<ja[n];i++)ws[s++]=n;for(s>>=7;n<dn;n++)for(sr[n]=s<<7,i=0;i<1<<ja[n]-7;i++)ws[256+s++]=n;for(t=0;t<=_i;t++)r[t]=0;for(i=0;i<=143;)de[i*2+1]=8,i++,r[8]++;for(;i<=255;)de[i*2+1]=9,i++,r[9]++;for(;i<=279;)de[i*2+1]=7,i++,r[7]++;for(;i<=287;)de[i*2+1]=8,i++,r[8]++;for(Dh(de,bs+1,r),i=0;i<dn;i++)hs[i*2+1]=5,hs[i*2]=Ph(i,5);Th=new Gr(de,ol,Ua+1,bs,_i),Fh=new Gr(hs,ja,0,dn,_i),Mh=new Gr(new Array(0),tc,0,Ql,Vu)},Uh=i=>{let t;for(t=0;t<bs;t++)i.dyn_ltree[t*2]=0;for(t=0;t<dn;t++)i.dyn_dtree[t*2]=0;for(t=0;t<Ql;t++)i.bl_tree[t*2]=0;i.dyn_ltree[Vl*2]=1,i.opt_len=i.static_len=0,i.sym_next=i.matches=0},Ih=i=>{i.bi_valid>8?vs(i,i.bi_buf):i.bi_valid>0&&(i.pending_buf[i.pending++]=i.bi_buf),i.bi_buf=0,i.bi_valid=0},vo=(i,t,e,n)=>{const s=t*2,r=e*2;return i[s]<i[r]||i[s]===i[r]&&n[t]<=n[e]},Hr=(i,t,e)=>{const n=i.heap[e];let s=e<<1;for(;s<=i.heap_len&&(s<i.heap_len&&vo(t,i.heap[s+1],i.heap[s],i.depth)&&s++,!vo(t,n,i.heap[s],i.depth));)i.heap[e]=i.heap[s],e=s,s<<=1;i.heap[e]=n},xo=(i,t,e)=>{let n,s,r=0,o,h;if(i.sym_next!==0)do n=i.pending_buf[i.sym_buf+r++]&255,n+=(i.pending_buf[i.sym_buf+r++]&255)<<8,s=i.pending_buf[i.sym_buf+r++],n===0?oe(i,s,t):(o=ys[s],oe(i,o+Ua+1,t),h=ol[o],h!==0&&(s-=to[o],At(i,s,h)),n--,o=Oh(n),oe(i,o,e),h=ja[o],h!==0&&(n-=sr[o],At(i,n,h)));while(r<i.sym_next);oe(i,Vl,t)},hl=(i,t)=>{const e=t.dyn_tree,n=t.stat_desc.static_tree,s=t.stat_desc.has_stree,r=t.stat_desc.elems;let o,h,f=-1,l;for(i.heap_len=0,i.heap_max=Sh,o=0;o<r;o++)e[o*2]!==0?(i.heap[++i.heap_len]=f=o,i.depth[o]=0):e[o*2+1]=0;for(;i.heap_len<2;)l=i.heap[++i.heap_len]=f<2?++f:0,e[l*2]=1,i.depth[l]=0,i.opt_len--,s&&(i.static_len-=n[l*2+1]);for(t.max_code=f,o=i.heap_len>>1;o>=1;o--)Hr(i,e,o);l=r;do o=i.heap[1],i.heap[1]=i.heap[i.heap_len--],Hr(i,e,1),h=i.heap[1],i.heap[--i.heap_max]=o,i.heap[--i.heap_max]=h,e[l*2]=e[o*2]+e[h*2],i.depth[l]=(i.depth[o]>=i.depth[h]?i.depth[o]:i.depth[h])+1,e[o*2+1]=e[h*2+1]=l,i.heap[1]=l++,Hr(i,e,1);while(i.heap_len>=2);i.heap[--i.heap_max]=i.heap[1],nc(i,t),Dh(e,f,i.bl_count)},Ao=(i,t,e)=>{let n,s=-1,r,o=t[0*2+1],h=0,f=7,l=4;for(o===0&&(f=138,l=3),t[(e+1)*2+1]=65535,n=0;n<=e;n++)r=o,o=t[(n+1)*2+1],!(++h<f&&r===o)&&(h<l?i.bl_tree[r*2]+=h:r!==0?(r!==s&&i.bl_tree[r*2]++,i.bl_tree[Eh*2]++):h<=10?i.bl_tree[kh*2]++:i.bl_tree[Ch*2]++,h=0,s=r,o===0?(f=138,l=3):r===o?(f=6,l=3):(f=7,l=4))},So=(i,t,e)=>{let n,s=-1,r,o=t[0*2+1],h=0,f=7,l=4;for(o===0&&(f=138,l=3),n=0;n<=e;n++)if(r=o,o=t[(n+1)*2+1],!(++h<f&&r===o)){if(h<l)do oe(i,r,i.bl_tree);while(--h!==0);else r!==0?(r!==s&&(oe(i,r,i.bl_tree),h--),oe(i,Eh,i.bl_tree),At(i,h-3,2)):h<=10?(oe(i,kh,i.bl_tree),At(i,h-3,3)):(oe(i,Ch,i.bl_tree),At(i,h-11,7));h=0,s=r,o===0?(f=138,l=3):r===o?(f=6,l=3):(f=7,l=4)}},ac=i=>{let t;for(Ao(i,i.dyn_ltree,i.l_desc.max_code),Ao(i,i.dyn_dtree,i.d_desc.max_code),hl(i,i.bl_desc),t=Ql-1;t>=3&&i.bl_tree[Rh[t]*2+1]===0;t--);return i.opt_len+=3*(t+1)+5+5+4,t},rc=(i,t,e,n)=>{let s;for(At(i,t-257,5),At(i,e-1,5),At(i,n-4,4),s=0;s<n;s++)At(i,i.bl_tree[Rh[s]*2+1],3);So(i,i.dyn_ltree,t-1),So(i,i.dyn_dtree,e-1)},lc=i=>{let t=4093624447,e;for(e=0;e<=31;e++,t>>>=1)if(t&1&&i.dyn_ltree[e*2]!==0)return wo;if(i.dyn_ltree[9*2]!==0||i.dyn_ltree[10*2]!==0||i.dyn_ltree[13*2]!==0)return yo;for(e=32;e<Ua;e++)if(i.dyn_ltree[e*2]!==0)return yo;return wo};let Eo=!1;const oc=i=>{Eo||(sc(),Eo=!0),i.l_desc=new Zr(i.dyn_ltree,Th),i.d_desc=new Zr(i.dyn_dtree,Fh),i.bl_desc=new Zr(i.bl_tree,Mh),i.bi_buf=0,i.bi_valid=0,Uh(i)},zh=(i,t,e,n)=>{At(i,(Xu<<1)+(n?1:0),3),Ih(i),vs(i,e),vs(i,~e),e&&i.pending_buf.set(i.window.subarray(t,t+e),i.pending),i.pending+=e},hc=i=>{At(i,Ah<<1,3),oe(i,Vl,de),ic(i)},uc=(i,t,e,n)=>{let s,r,o=0;i.level>0?(i.strm.data_type===Ku&&(i.strm.data_type=lc(i)),hl(i,i.l_desc),hl(i,i.d_desc),o=ac(i),s=i.opt_len+3+7>>>3,r=i.static_len+3+7>>>3,r<=s&&(s=r)):s=r=e+5,e+4<=s&&t!==-1?zh(i,t,e,n):i.strategy===qu||r===s?(At(i,(Ah<<1)+(n?1:0),3),xo(i,de,hs)):(At(i,(Yu<<1)+(n?1:0),3),rc(i,i.l_desc.max_code+1,i.d_desc.max_code+1,o+1),xo(i,i.dyn_ltree,i.dyn_dtree)),Uh(i),n&&Ih(i)},cc=(i,t,e)=>(i.pending_buf[i.sym_buf+i.sym_next++]=t,i.pending_buf[i.sym_buf+i.sym_next++]=t>>8,i.pending_buf[i.sym_buf+i.sym_next++]=e,t===0?i.dyn_ltree[e*2]++:(i.matches++,t--,i.dyn_ltree[(ys[e]+Ua+1)*2]++,i.dyn_dtree[Oh(t)*2]++),i.sym_next===i.sym_end);var fc=oc,dc=zh,pc=uc,mc=cc,gc=hc,_c={_tr_init:fc,_tr_stored_block:dc,_tr_flush_block:pc,_tr_tally:mc,_tr_align:gc};const bc=(i,t,e,n)=>{let s=i&65535|0,r=i>>>16&65535|0,o=0;for(;e!==0;){o=e>2e3?2e3:e,e-=o;do s=s+t[n++]|0,r=r+s|0;while(--o);s%=65521,r%=65521}return s|r<<16|0};var xs=bc;const wc=()=>{let i,t=[];for(var e=0;e<256;e++){i=e;for(var n=0;n<8;n++)i=i&1?3988292384^i>>>1:i>>>1;t[e]=i}return t},yc=new Uint32Array(wc()),vc=(i,t,e,n)=>{const s=yc,r=n+e;i^=-1;for(let o=n;o<r;o++)i=i>>>8^s[(i^t[o])&255];return i^-1};var st=vc,Xn={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ia={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:xc,_tr_stored_block:ul,_tr_flush_block:Ac,_tr_tally:Qe,_tr_align:Sc}=_c,{Z_NO_FLUSH:Ve,Z_PARTIAL_FLUSH:Ec,Z_FULL_FLUSH:kc,Z_FINISH:It,Z_BLOCK:ko,Z_OK:at,Z_STREAM_END:Co,Z_STREAM_ERROR:he,Z_DATA_ERROR:Cc,Z_BUF_ERROR:Jr,Z_DEFAULT_COMPRESSION:Rc,Z_FILTERED:Tc,Z_HUFFMAN_ONLY:Ga,Z_RLE:Fc,Z_FIXED:Mc,Z_DEFAULT_STRATEGY:Oc,Z_UNKNOWN:Pc,Z_DEFLATED:Dr}=Ia,Dc=9,Uc=15,Ic=8,zc=29,Nc=256,cl=Nc+1+zc,Lc=30,$c=19,Bc=2*cl+1,Gc=15,H=3,je=258,ue=je+H+1,Zc=32,Yn=42,eo=57,fl=69,dl=73,pl=91,ml=103,bi=113,as=666,pt=1,es=2,sn=3,is=4,Hc=3,wi=(i,t)=>(i.msg=Xn[t],t),Ro=i=>i*2-(i>4?9:0),Me=i=>{let t=i.length;for(;--t>=0;)i[t]=0},Jc=i=>{let t,e,n,s=i.w_size;t=i.hash_size,n=t;do e=i.head[--n],i.head[n]=e>=s?e-s:0;while(--t);t=s,n=t;do e=i.prev[--n],i.prev[n]=e>=s?e-s:0;while(--t)};let Wc=(i,t,e)=>(t<<i.hash_shift^e)&i.hash_mask,ti=Wc;const Et=i=>{const t=i.state;let e=t.pending;e>i.avail_out&&(e=i.avail_out),e!==0&&(i.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+e),i.next_out),i.next_out+=e,t.pending_out+=e,i.total_out+=e,i.avail_out-=e,t.pending-=e,t.pending===0&&(t.pending_out=0))},Ct=(i,t)=>{Ac(i,i.block_start>=0?i.block_start:-1,i.strstart-i.block_start,t),i.block_start=i.strstart,Et(i.strm)},J=(i,t)=>{i.pending_buf[i.pending++]=t},ns=(i,t)=>{i.pending_buf[i.pending++]=t>>>8&255,i.pending_buf[i.pending++]=t&255},gl=(i,t,e,n)=>{let s=i.avail_in;return s>n&&(s=n),s===0?0:(i.avail_in-=s,t.set(i.input.subarray(i.next_in,i.next_in+s),e),i.state.wrap===1?i.adler=xs(i.adler,t,s,e):i.state.wrap===2&&(i.adler=st(i.adler,t,s,e)),i.next_in+=s,i.total_in+=s,s)},Nh=(i,t)=>{let e=i.max_chain_length,n=i.strstart,s,r,o=i.prev_length,h=i.nice_match;const f=i.strstart>i.w_size-ue?i.strstart-(i.w_size-ue):0,l=i.window,c=i.w_mask,_=i.prev,g=i.strstart+je;let p=l[n+o-1],y=l[n+o];i.prev_length>=i.good_match&&(e>>=2),h>i.lookahead&&(h=i.lookahead);do if(s=t,!(l[s+o]!==y||l[s+o-1]!==p||l[s]!==l[n]||l[++s]!==l[n+1])){n+=2,s++;do;while(l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&n<g);if(r=je-(g-n),n=g-je,r>o){if(i.match_start=t,o=r,r>=h)break;p=l[n+o-1],y=l[n+o]}}while((t=_[t&c])>f&&--e!==0);return o<=i.lookahead?o:i.lookahead},jn=i=>{const t=i.w_size;let e,n,s;do{if(n=i.window_size-i.lookahead-i.strstart,i.strstart>=t+(t-ue)&&(i.window.set(i.window.subarray(t,t+t-n),0),i.match_start-=t,i.strstart-=t,i.block_start-=t,i.insert>i.strstart&&(i.insert=i.strstart),Jc(i),n+=t),i.strm.avail_in===0)break;if(e=gl(i.strm,i.window,i.strstart+i.lookahead,n),i.lookahead+=e,i.lookahead+i.insert>=H)for(s=i.strstart-i.insert,i.ins_h=i.window[s],i.ins_h=ti(i,i.ins_h,i.window[s+1]);i.insert&&(i.ins_h=ti(i,i.ins_h,i.window[s+H-1]),i.prev[s&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=s,s++,i.insert--,!(i.lookahead+i.insert<H)););}while(i.lookahead<ue&&i.strm.avail_in!==0)},Lh=(i,t)=>{let e=i.pending_buf_size-5>i.w_size?i.w_size:i.pending_buf_size-5,n,s,r,o=0,h=i.strm.avail_in;do{if(n=65535,r=i.bi_valid+42>>3,i.strm.avail_out<r||(r=i.strm.avail_out-r,s=i.strstart-i.block_start,n>s+i.strm.avail_in&&(n=s+i.strm.avail_in),n>r&&(n=r),n<e&&(n===0&&t!==It||t===Ve||n!==s+i.strm.avail_in)))break;o=t===It&&n===s+i.strm.avail_in?1:0,ul(i,0,0,o),i.pending_buf[i.pending-4]=n,i.pending_buf[i.pending-3]=n>>8,i.pending_buf[i.pending-2]=~n,i.pending_buf[i.pending-1]=~n>>8,Et(i.strm),s&&(s>n&&(s=n),i.strm.output.set(i.window.subarray(i.block_start,i.block_start+s),i.strm.next_out),i.strm.next_out+=s,i.strm.avail_out-=s,i.strm.total_out+=s,i.block_start+=s,n-=s),n&&(gl(i.strm,i.strm.output,i.strm.next_out,n),i.strm.next_out+=n,i.strm.avail_out-=n,i.strm.total_out+=n)}while(o===0);return h-=i.strm.avail_in,h&&(h>=i.w_size?(i.matches=2,i.window.set(i.strm.input.subarray(i.strm.next_in-i.w_size,i.strm.next_in),0),i.strstart=i.w_size,i.insert=i.strstart):(i.window_size-i.strstart<=h&&(i.strstart-=i.w_size,i.window.set(i.window.subarray(i.w_size,i.w_size+i.strstart),0),i.matches<2&&i.matches++,i.insert>i.strstart&&(i.insert=i.strstart)),i.window.set(i.strm.input.subarray(i.strm.next_in-h,i.strm.next_in),i.strstart),i.strstart+=h,i.insert+=h>i.w_size-i.insert?i.w_size-i.insert:h),i.block_start=i.strstart),i.high_water<i.strstart&&(i.high_water=i.strstart),o?is:t!==Ve&&t!==It&&i.strm.avail_in===0&&i.strstart===i.block_start?es:(r=i.window_size-i.strstart,i.strm.avail_in>r&&i.block_start>=i.w_size&&(i.block_start-=i.w_size,i.strstart-=i.w_size,i.window.set(i.window.subarray(i.w_size,i.w_size+i.strstart),0),i.matches<2&&i.matches++,r+=i.w_size,i.insert>i.strstart&&(i.insert=i.strstart)),r>i.strm.avail_in&&(r=i.strm.avail_in),r&&(gl(i.strm,i.window,i.strstart,r),i.strstart+=r,i.insert+=r>i.w_size-i.insert?i.w_size-i.insert:r),i.high_water<i.strstart&&(i.high_water=i.strstart),r=i.bi_valid+42>>3,r=i.pending_buf_size-r>65535?65535:i.pending_buf_size-r,e=r>i.w_size?i.w_size:r,s=i.strstart-i.block_start,(s>=e||(s||t===It)&&t!==Ve&&i.strm.avail_in===0&&s<=r)&&(n=s>r?r:s,o=t===It&&i.strm.avail_in===0&&n===s?1:0,ul(i,i.block_start,n,o),i.block_start+=n,Et(i.strm)),o?sn:pt)},Wr=(i,t)=>{let e,n;for(;;){if(i.lookahead<ue){if(jn(i),i.lookahead<ue&&t===Ve)return pt;if(i.lookahead===0)break}if(e=0,i.lookahead>=H&&(i.ins_h=ti(i,i.ins_h,i.window[i.strstart+H-1]),e=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),e!==0&&i.strstart-e<=i.w_size-ue&&(i.match_length=Nh(i,e)),i.match_length>=H)if(n=Qe(i,i.strstart-i.match_start,i.match_length-H),i.lookahead-=i.match_length,i.match_length<=i.max_lazy_match&&i.lookahead>=H){i.match_length--;do i.strstart++,i.ins_h=ti(i,i.ins_h,i.window[i.strstart+H-1]),e=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart;while(--i.match_length!==0);i.strstart++}else i.strstart+=i.match_length,i.match_length=0,i.ins_h=i.window[i.strstart],i.ins_h=ti(i,i.ins_h,i.window[i.strstart+1]);else n=Qe(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++;if(n&&(Ct(i,!1),i.strm.avail_out===0))return pt}return i.insert=i.strstart<H-1?i.strstart:H-1,t===It?(Ct(i,!0),i.strm.avail_out===0?sn:is):i.sym_next&&(Ct(i,!1),i.strm.avail_out===0)?pt:es},ln=(i,t)=>{let e,n,s;for(;;){if(i.lookahead<ue){if(jn(i),i.lookahead<ue&&t===Ve)return pt;if(i.lookahead===0)break}if(e=0,i.lookahead>=H&&(i.ins_h=ti(i,i.ins_h,i.window[i.strstart+H-1]),e=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),i.prev_length=i.match_length,i.prev_match=i.match_start,i.match_length=H-1,e!==0&&i.prev_length<i.max_lazy_match&&i.strstart-e<=i.w_size-ue&&(i.match_length=Nh(i,e),i.match_length<=5&&(i.strategy===Tc||i.match_length===H&&i.strstart-i.match_start>4096)&&(i.match_length=H-1)),i.prev_length>=H&&i.match_length<=i.prev_length){s=i.strstart+i.lookahead-H,n=Qe(i,i.strstart-1-i.prev_match,i.prev_length-H),i.lookahead-=i.prev_length-1,i.prev_length-=2;do++i.strstart<=s&&(i.ins_h=ti(i,i.ins_h,i.window[i.strstart+H-1]),e=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart);while(--i.prev_length!==0);if(i.match_available=0,i.match_length=H-1,i.strstart++,n&&(Ct(i,!1),i.strm.avail_out===0))return pt}else if(i.match_available){if(n=Qe(i,0,i.window[i.strstart-1]),n&&Ct(i,!1),i.strstart++,i.lookahead--,i.strm.avail_out===0)return pt}else i.match_available=1,i.strstart++,i.lookahead--}return i.match_available&&(n=Qe(i,0,i.window[i.strstart-1]),i.match_available=0),i.insert=i.strstart<H-1?i.strstart:H-1,t===It?(Ct(i,!0),i.strm.avail_out===0?sn:is):i.sym_next&&(Ct(i,!1),i.strm.avail_out===0)?pt:es},qc=(i,t)=>{let e,n,s,r;const o=i.window;for(;;){if(i.lookahead<=je){if(jn(i),i.lookahead<=je&&t===Ve)return pt;if(i.lookahead===0)break}if(i.match_length=0,i.lookahead>=H&&i.strstart>0&&(s=i.strstart-1,n=o[s],n===o[++s]&&n===o[++s]&&n===o[++s])){r=i.strstart+je;do;while(n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&s<r);i.match_length=je-(r-s),i.match_length>i.lookahead&&(i.match_length=i.lookahead)}if(i.match_length>=H?(e=Qe(i,1,i.match_length-H),i.lookahead-=i.match_length,i.strstart+=i.match_length,i.match_length=0):(e=Qe(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++),e&&(Ct(i,!1),i.strm.avail_out===0))return pt}return i.insert=0,t===It?(Ct(i,!0),i.strm.avail_out===0?sn:is):i.sym_next&&(Ct(i,!1),i.strm.avail_out===0)?pt:es},Kc=(i,t)=>{let e;for(;;){if(i.lookahead===0&&(jn(i),i.lookahead===0)){if(t===Ve)return pt;break}if(i.match_length=0,e=Qe(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++,e&&(Ct(i,!1),i.strm.avail_out===0))return pt}return i.insert=0,t===It?(Ct(i,!0),i.strm.avail_out===0?sn:is):i.sym_next&&(Ct(i,!1),i.strm.avail_out===0)?pt:es};function Qt(i,t,e,n,s){this.good_length=i,this.max_lazy=t,this.nice_length=e,this.max_chain=n,this.func=s}const rs=[new Qt(0,0,0,0,Lh),new Qt(4,4,8,4,Wr),new Qt(4,5,16,8,Wr),new Qt(4,6,32,32,Wr),new Qt(4,4,16,16,ln),new Qt(8,16,32,32,ln),new Qt(8,16,128,128,ln),new Qt(8,32,128,256,ln),new Qt(32,128,258,1024,ln),new Qt(32,258,258,4096,ln)],Xc=i=>{i.window_size=2*i.w_size,Me(i.head),i.max_lazy_match=rs[i.level].max_lazy,i.good_match=rs[i.level].good_length,i.nice_match=rs[i.level].nice_length,i.max_chain_length=rs[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=H-1,i.match_available=0,i.ins_h=0};function Yc(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Dr,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(Bc*2),this.dyn_dtree=new Uint16Array((2*Lc+1)*2),this.bl_tree=new Uint16Array((2*$c+1)*2),Me(this.dyn_ltree),Me(this.dyn_dtree),Me(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Gc+1),this.heap=new Uint16Array(2*cl+1),Me(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*cl+1),Me(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const za=i=>{if(!i)return 1;const t=i.state;return!t||t.strm!==i||t.status!==Yn&&t.status!==eo&&t.status!==fl&&t.status!==dl&&t.status!==pl&&t.status!==ml&&t.status!==bi&&t.status!==as?1:0},$h=i=>{if(za(i))return wi(i,he);i.total_in=i.total_out=0,i.data_type=Pc;const t=i.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?eo:t.wrap?Yn:bi,i.adler=t.wrap===2?0:1,t.last_flush=-2,xc(t),at},Bh=i=>{const t=$h(i);return t===at&&Xc(i.state),t},jc=(i,t)=>za(i)||i.state.wrap!==2?he:(i.state.gzhead=t,at),Gh=(i,t,e,n,s,r)=>{if(!i)return he;let o=1;if(t===Rc&&(t=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),s<1||s>Dc||e!==Dr||n<8||n>15||t<0||t>9||r<0||r>Mc||n===8&&o!==1)return wi(i,he);n===8&&(n=9);const h=new Yc;return i.state=h,h.strm=i,h.status=Yn,h.wrap=o,h.gzhead=null,h.w_bits=n,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=s+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+H-1)/H),h.window=new Uint8Array(h.w_size*2),h.head=new Uint16Array(h.hash_size),h.prev=new Uint16Array(h.w_size),h.lit_bufsize=1<<s+6,h.pending_buf_size=h.lit_bufsize*4,h.pending_buf=new Uint8Array(h.pending_buf_size),h.sym_buf=h.lit_bufsize,h.sym_end=(h.lit_bufsize-1)*3,h.level=t,h.strategy=r,h.method=e,Bh(i)},Qc=(i,t)=>Gh(i,t,Dr,Uc,Ic,Oc),Vc=(i,t)=>{if(za(i)||t>ko||t<0)return i?wi(i,he):he;const e=i.state;if(!i.output||i.avail_in!==0&&!i.input||e.status===as&&t!==It)return wi(i,i.avail_out===0?Jr:he);const n=e.last_flush;if(e.last_flush=t,e.pending!==0){if(Et(i),i.avail_out===0)return e.last_flush=-1,at}else if(i.avail_in===0&&Ro(t)<=Ro(n)&&t!==It)return wi(i,Jr);if(e.status===as&&i.avail_in!==0)return wi(i,Jr);if(e.status===Yn&&e.wrap===0&&(e.status=bi),e.status===Yn){let s=Dr+(e.w_bits-8<<4)<<8,r=-1;if(e.strategy>=Ga||e.level<2?r=0:e.level<6?r=1:e.level===6?r=2:r=3,s|=r<<6,e.strstart!==0&&(s|=Zc),s+=31-s%31,ns(e,s),e.strstart!==0&&(ns(e,i.adler>>>16),ns(e,i.adler&65535)),i.adler=1,e.status=bi,Et(i),e.pending!==0)return e.last_flush=-1,at}if(e.status===eo){if(i.adler=0,J(e,31),J(e,139),J(e,8),e.gzhead)J(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),J(e,e.gzhead.time&255),J(e,e.gzhead.time>>8&255),J(e,e.gzhead.time>>16&255),J(e,e.gzhead.time>>24&255),J(e,e.level===9?2:e.strategy>=Ga||e.level<2?4:0),J(e,e.gzhead.os&255),e.gzhead.extra&&e.gzhead.extra.length&&(J(e,e.gzhead.extra.length&255),J(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(i.adler=st(i.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=fl;else if(J(e,0),J(e,0),J(e,0),J(e,0),J(e,0),J(e,e.level===9?2:e.strategy>=Ga||e.level<2?4:0),J(e,Hc),e.status=bi,Et(i),e.pending!==0)return e.last_flush=-1,at}if(e.status===fl){if(e.gzhead.extra){let s=e.pending,r=(e.gzhead.extra.length&65535)-e.gzindex;for(;e.pending+r>e.pending_buf_size;){let h=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+h),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>s&&(i.adler=st(i.adler,e.pending_buf,e.pending-s,s)),e.gzindex+=h,Et(i),e.pending!==0)return e.last_flush=-1,at;s=0,r-=h}let o=new Uint8Array(e.gzhead.extra);e.pending_buf.set(o.subarray(e.gzindex,e.gzindex+r),e.pending),e.pending+=r,e.gzhead.hcrc&&e.pending>s&&(i.adler=st(i.adler,e.pending_buf,e.pending-s,s)),e.gzindex=0}e.status=dl}if(e.status===dl){if(e.gzhead.name){let s=e.pending,r;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(i.adler=st(i.adler,e.pending_buf,e.pending-s,s)),Et(i),e.pending!==0)return e.last_flush=-1,at;s=0}e.gzindex<e.gzhead.name.length?r=e.gzhead.name.charCodeAt(e.gzindex++)&255:r=0,J(e,r)}while(r!==0);e.gzhead.hcrc&&e.pending>s&&(i.adler=st(i.adler,e.pending_buf,e.pending-s,s)),e.gzindex=0}e.status=pl}if(e.status===pl){if(e.gzhead.comment){let s=e.pending,r;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(i.adler=st(i.adler,e.pending_buf,e.pending-s,s)),Et(i),e.pending!==0)return e.last_flush=-1,at;s=0}e.gzindex<e.gzhead.comment.length?r=e.gzhead.comment.charCodeAt(e.gzindex++)&255:r=0,J(e,r)}while(r!==0);e.gzhead.hcrc&&e.pending>s&&(i.adler=st(i.adler,e.pending_buf,e.pending-s,s))}e.status=ml}if(e.status===ml){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(Et(i),e.pending!==0))return e.last_flush=-1,at;J(e,i.adler&255),J(e,i.adler>>8&255),i.adler=0}if(e.status=bi,Et(i),e.pending!==0)return e.last_flush=-1,at}if(i.avail_in!==0||e.lookahead!==0||t!==Ve&&e.status!==as){let s=e.level===0?Lh(e,t):e.strategy===Ga?Kc(e,t):e.strategy===Fc?qc(e,t):rs[e.level].func(e,t);if((s===sn||s===is)&&(e.status=as),s===pt||s===sn)return i.avail_out===0&&(e.last_flush=-1),at;if(s===es&&(t===Ec?Sc(e):t!==ko&&(ul(e,0,0,!1),t===kc&&(Me(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),Et(i),i.avail_out===0))return e.last_flush=-1,at}return t!==It?at:e.wrap<=0?Co:(e.wrap===2?(J(e,i.adler&255),J(e,i.adler>>8&255),J(e,i.adler>>16&255),J(e,i.adler>>24&255),J(e,i.total_in&255),J(e,i.total_in>>8&255),J(e,i.total_in>>16&255),J(e,i.total_in>>24&255)):(ns(e,i.adler>>>16),ns(e,i.adler&65535)),Et(i),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?at:Co)},tf=i=>{if(za(i))return he;const t=i.state.status;return i.state=null,t===bi?wi(i,Cc):at},ef=(i,t)=>{let e=t.length;if(za(i))return he;const n=i.state,s=n.wrap;if(s===2||s===1&&n.status!==Yn||n.lookahead)return he;if(s===1&&(i.adler=xs(i.adler,t,e,0)),n.wrap=0,e>=n.w_size){s===0&&(Me(n.head),n.strstart=0,n.block_start=0,n.insert=0);let f=new Uint8Array(n.w_size);f.set(t.subarray(e-n.w_size,e),0),t=f,e=n.w_size}const r=i.avail_in,o=i.next_in,h=i.input;for(i.avail_in=e,i.next_in=0,i.input=t,jn(n);n.lookahead>=H;){let f=n.strstart,l=n.lookahead-(H-1);do n.ins_h=ti(n,n.ins_h,n.window[f+H-1]),n.prev[f&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=f,f++;while(--l);n.strstart=f,n.lookahead=H-1,jn(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=H-1,n.match_available=0,i.next_in=o,i.input=h,i.avail_in=r,n.wrap=s,at};var nf=Qc,sf=Gh,af=Bh,rf=$h,lf=jc,of=Vc,hf=tf,uf=ef,cf="pako deflate (from Nodeca project)",us={deflateInit:nf,deflateInit2:sf,deflateReset:af,deflateResetKeep:rf,deflateSetHeader:lf,deflate:of,deflateEnd:hf,deflateSetDictionary:uf,deflateInfo:cf};const ff=(i,t)=>Object.prototype.hasOwnProperty.call(i,t);var df=function(i){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const n in e)ff(e,n)&&(i[n]=e[n])}}return i},pf=i=>{let t=0;for(let n=0,s=i.length;n<s;n++)t+=i[n].length;const e=new Uint8Array(t);for(let n=0,s=0,r=i.length;n<r;n++){let o=i[n];e.set(o,s),s+=o.length}return e},Ur={assign:df,flattenChunks:pf};let Zh=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Zh=!1}const As=new Uint8Array(256);for(let i=0;i<256;i++)As[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;As[254]=As[254]=1;var mf=i=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(i);let t,e,n,s,r,o=i.length,h=0;for(s=0;s<o;s++)e=i.charCodeAt(s),(e&64512)===55296&&s+1<o&&(n=i.charCodeAt(s+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),s++)),h+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(h),r=0,s=0;r<h;s++)e=i.charCodeAt(s),(e&64512)===55296&&s+1<o&&(n=i.charCodeAt(s+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),s++)),e<128?t[r++]=e:e<2048?(t[r++]=192|e>>>6,t[r++]=128|e&63):e<65536?(t[r++]=224|e>>>12,t[r++]=128|e>>>6&63,t[r++]=128|e&63):(t[r++]=240|e>>>18,t[r++]=128|e>>>12&63,t[r++]=128|e>>>6&63,t[r++]=128|e&63);return t};const gf=(i,t)=>{if(t<65534&&i.subarray&&Zh)return String.fromCharCode.apply(null,i.length===t?i:i.subarray(0,t));let e="";for(let n=0;n<t;n++)e+=String.fromCharCode(i[n]);return e};var _f=(i,t)=>{const e=t||i.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(i.subarray(0,t));let n,s;const r=new Array(e*2);for(s=0,n=0;n<e;){let o=i[n++];if(o<128){r[s++]=o;continue}let h=As[o];if(h>4){r[s++]=65533,n+=h-1;continue}for(o&=h===2?31:h===3?15:7;h>1&&n<e;)o=o<<6|i[n++]&63,h--;if(h>1){r[s++]=65533;continue}o<65536?r[s++]=o:(o-=65536,r[s++]=55296|o>>10&1023,r[s++]=56320|o&1023)}return gf(r,s)},bf=(i,t)=>{t=t||i.length,t>i.length&&(t=i.length);let e=t-1;for(;e>=0&&(i[e]&192)===128;)e--;return e<0||e===0?t:e+As[i[e]]>t?e:t},Ss={string2buf:mf,buf2string:_f,utf8border:bf};function wf(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Hh=wf;const Jh=Object.prototype.toString,{Z_NO_FLUSH:yf,Z_SYNC_FLUSH:vf,Z_FULL_FLUSH:xf,Z_FINISH:Af,Z_OK:ar,Z_STREAM_END:Sf,Z_DEFAULT_COMPRESSION:Ef,Z_DEFAULT_STRATEGY:kf,Z_DEFLATED:Cf}=Ia;function io(i){this.options=Ur.assign({level:Ef,method:Cf,chunkSize:16384,windowBits:15,memLevel:8,strategy:kf},i||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Hh,this.strm.avail_out=0;let e=us.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(e!==ar)throw new Error(Xn[e]);if(t.header&&us.deflateSetHeader(this.strm,t.header),t.dictionary){let n;if(typeof t.dictionary=="string"?n=Ss.string2buf(t.dictionary):Jh.call(t.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(t.dictionary):n=t.dictionary,e=us.deflateSetDictionary(this.strm,n),e!==ar)throw new Error(Xn[e]);this._dict_set=!0}}io.prototype.push=function(i,t){const e=this.strm,n=this.options.chunkSize;let s,r;if(this.ended)return!1;for(t===~~t?r=t:r=t===!0?Af:yf,typeof i=="string"?e.input=Ss.string2buf(i):Jh.call(i)==="[object ArrayBuffer]"?e.input=new Uint8Array(i):e.input=i,e.next_in=0,e.avail_in=e.input.length;;){if(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),(r===vf||r===xf)&&e.avail_out<=6){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(s=us.deflate(e,r),s===Sf)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),s=us.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===ar;if(e.avail_out===0){this.onData(e.output);continue}if(r>0&&e.next_out>0){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(e.avail_in===0)break}return!0};io.prototype.onData=function(i){this.chunks.push(i)};io.prototype.onEnd=function(i){i===ar&&(this.result=Ur.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};const Za=16209,Rf=16191;var Tf=function(t,e){let n,s,r,o,h,f,l,c,_,g,p,y,U,M,C,D,I,x,B,L,k,W,G,$;const Z=t.state;n=t.next_in,G=t.input,s=n+(t.avail_in-5),r=t.next_out,$=t.output,o=r-(e-t.avail_out),h=r+(t.avail_out-257),f=Z.dmax,l=Z.wsize,c=Z.whave,_=Z.wnext,g=Z.window,p=Z.hold,y=Z.bits,U=Z.lencode,M=Z.distcode,C=(1<<Z.lenbits)-1,D=(1<<Z.distbits)-1;t:do{y<15&&(p+=G[n++]<<y,y+=8,p+=G[n++]<<y,y+=8),I=U[p&C];e:for(;;){if(x=I>>>24,p>>>=x,y-=x,x=I>>>16&255,x===0)$[r++]=I&65535;else if(x&16){B=I&65535,x&=15,x&&(y<x&&(p+=G[n++]<<y,y+=8),B+=p&(1<<x)-1,p>>>=x,y-=x),y<15&&(p+=G[n++]<<y,y+=8,p+=G[n++]<<y,y+=8),I=M[p&D];i:for(;;){if(x=I>>>24,p>>>=x,y-=x,x=I>>>16&255,x&16){if(L=I&65535,x&=15,y<x&&(p+=G[n++]<<y,y+=8,y<x&&(p+=G[n++]<<y,y+=8)),L+=p&(1<<x)-1,L>f){t.msg="invalid distance too far back",Z.mode=Za;break t}if(p>>>=x,y-=x,x=r-o,L>x){if(x=L-x,x>c&&Z.sane){t.msg="invalid distance too far back",Z.mode=Za;break t}if(k=0,W=g,_===0){if(k+=l-x,x<B){B-=x;do $[r++]=g[k++];while(--x);k=r-L,W=$}}else if(_<x){if(k+=l+_-x,x-=_,x<B){B-=x;do $[r++]=g[k++];while(--x);if(k=0,_<B){x=_,B-=x;do $[r++]=g[k++];while(--x);k=r-L,W=$}}}else if(k+=_-x,x<B){B-=x;do $[r++]=g[k++];while(--x);k=r-L,W=$}for(;B>2;)$[r++]=W[k++],$[r++]=W[k++],$[r++]=W[k++],B-=3;B&&($[r++]=W[k++],B>1&&($[r++]=W[k++]))}else{k=r-L;do $[r++]=$[k++],$[r++]=$[k++],$[r++]=$[k++],B-=3;while(B>2);B&&($[r++]=$[k++],B>1&&($[r++]=$[k++]))}}else if(x&64){t.msg="invalid distance code",Z.mode=Za;break t}else{I=M[(I&65535)+(p&(1<<x)-1)];continue i}break}}else if(x&64)if(x&32){Z.mode=Rf;break t}else{t.msg="invalid literal/length code",Z.mode=Za;break t}else{I=U[(I&65535)+(p&(1<<x)-1)];continue e}break}}while(n<s&&r<h);B=y>>3,n-=B,y-=B<<3,p&=(1<<y)-1,t.next_in=n,t.next_out=r,t.avail_in=n<s?5+(s-n):5-(n-s),t.avail_out=r<h?257+(h-r):257-(r-h),Z.hold=p,Z.bits=y};const on=15,To=852,Fo=592,Mo=0,qr=1,Oo=2,Ff=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Mf=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Of=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Pf=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Df=(i,t,e,n,s,r,o,h)=>{const f=h.bits;let l=0,c=0,_=0,g=0,p=0,y=0,U=0,M=0,C=0,D=0,I,x,B,L,k,W=null,G;const $=new Uint16Array(on+1),Z=new Uint16Array(on+1);let Lt=null,go,$a,Ba;for(l=0;l<=on;l++)$[l]=0;for(c=0;c<n;c++)$[t[e+c]]++;for(p=f,g=on;g>=1&&$[g]===0;g--);if(p>g&&(p=g),g===0)return s[r++]=1<<24|64<<16|0,s[r++]=1<<24|64<<16|0,h.bits=1,0;for(_=1;_<g&&$[_]===0;_++);for(p<_&&(p=_),M=1,l=1;l<=on;l++)if(M<<=1,M-=$[l],M<0)return-1;if(M>0&&(i===Mo||g!==1))return-1;for(Z[1]=0,l=1;l<on;l++)Z[l+1]=Z[l]+$[l];for(c=0;c<n;c++)t[e+c]!==0&&(o[Z[t[e+c]]++]=c);if(i===Mo?(W=Lt=o,G=20):i===qr?(W=Ff,Lt=Mf,G=257):(W=Of,Lt=Pf,G=0),D=0,c=0,l=_,k=r,y=p,U=0,B=-1,C=1<<p,L=C-1,i===qr&&C>To||i===Oo&&C>Fo)return 1;for(;;){go=l-U,o[c]+1<G?($a=0,Ba=o[c]):o[c]>=G?($a=Lt[o[c]-G],Ba=W[o[c]-G]):($a=96,Ba=0),I=1<<l-U,x=1<<y,_=x;do x-=I,s[k+(D>>U)+x]=go<<24|$a<<16|Ba|0;while(x!==0);for(I=1<<l-1;D&I;)I>>=1;if(I!==0?(D&=I-1,D+=I):D=0,c++,--$[l]===0){if(l===g)break;l=t[e+o[c]]}if(l>p&&(D&L)!==B){for(U===0&&(U=p),k+=_,y=l-U,M=1<<y;y+U<g&&(M-=$[y+U],!(M<=0));)y++,M<<=1;if(C+=1<<y,i===qr&&C>To||i===Oo&&C>Fo)return 1;B=D&L,s[B]=p<<24|y<<16|k-r|0}}return D!==0&&(s[k+D]=l-U<<24|64<<16|0),h.bits=p,0};var cs=Df;const Uf=0,Wh=1,qh=2,{Z_FINISH:Po,Z_BLOCK:If,Z_TREES:Ha,Z_OK:an,Z_STREAM_END:zf,Z_NEED_DICT:Nf,Z_STREAM_ERROR:zt,Z_DATA_ERROR:Kh,Z_MEM_ERROR:Xh,Z_BUF_ERROR:Lf,Z_DEFLATED:Do}=Ia,Ir=16180,Uo=16181,Io=16182,zo=16183,No=16184,Lo=16185,$o=16186,Bo=16187,Go=16188,Zo=16189,rr=16190,ce=16191,Kr=16192,Ho=16193,Xr=16194,Jo=16195,Wo=16196,qo=16197,Ko=16198,Ja=16199,Wa=16200,Xo=16201,Yo=16202,jo=16203,Qo=16204,Vo=16205,Yr=16206,th=16207,eh=16208,Y=16209,Yh=16210,jh=16211,$f=852,Bf=592,Gf=15,Zf=Gf,ih=i=>(i>>>24&255)+(i>>>8&65280)+((i&65280)<<8)+((i&255)<<24);function Hf(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const rn=i=>{if(!i)return 1;const t=i.state;return!t||t.strm!==i||t.mode<Ir||t.mode>jh?1:0},Qh=i=>{if(rn(i))return zt;const t=i.state;return i.total_in=i.total_out=t.total=0,i.msg="",t.wrap&&(i.adler=t.wrap&1),t.mode=Ir,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array($f),t.distcode=t.distdyn=new Int32Array(Bf),t.sane=1,t.back=-1,an},Vh=i=>{if(rn(i))return zt;const t=i.state;return t.wsize=0,t.whave=0,t.wnext=0,Qh(i)},tu=(i,t)=>{let e;if(rn(i))return zt;const n=i.state;return t<0?(e=0,t=-t):(e=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?zt:(n.window!==null&&n.wbits!==t&&(n.window=null),n.wrap=e,n.wbits=t,Vh(i))},eu=(i,t)=>{if(!i)return zt;const e=new Hf;i.state=e,e.strm=i,e.window=null,e.mode=Ir;const n=tu(i,t);return n!==an&&(i.state=null),n},Jf=i=>eu(i,Zf);let nh=!0,jr,Qr;const Wf=i=>{if(nh){jr=new Int32Array(512),Qr=new Int32Array(32);let t=0;for(;t<144;)i.lens[t++]=8;for(;t<256;)i.lens[t++]=9;for(;t<280;)i.lens[t++]=7;for(;t<288;)i.lens[t++]=8;for(cs(Wh,i.lens,0,288,jr,0,i.work,{bits:9}),t=0;t<32;)i.lens[t++]=5;cs(qh,i.lens,0,32,Qr,0,i.work,{bits:5}),nh=!1}i.lencode=jr,i.lenbits=9,i.distcode=Qr,i.distbits=5},iu=(i,t,e,n)=>{let s;const r=i.state;return r.window===null&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),n>=r.wsize?(r.window.set(t.subarray(e-r.wsize,e),0),r.wnext=0,r.whave=r.wsize):(s=r.wsize-r.wnext,s>n&&(s=n),r.window.set(t.subarray(e-n,e-n+s),r.wnext),n-=s,n?(r.window.set(t.subarray(e-n,e),0),r.wnext=n,r.whave=r.wsize):(r.wnext+=s,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=s))),0},qf=(i,t)=>{let e,n,s,r,o,h,f,l,c,_,g,p,y,U,M=0,C,D,I,x,B,L,k,W;const G=new Uint8Array(4);let $,Z;const Lt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(rn(i)||!i.output||!i.input&&i.avail_in!==0)return zt;e=i.state,e.mode===ce&&(e.mode=Kr),o=i.next_out,s=i.output,f=i.avail_out,r=i.next_in,n=i.input,h=i.avail_in,l=e.hold,c=e.bits,_=h,g=f,W=an;t:for(;;)switch(e.mode){case Ir:if(e.wrap===0){e.mode=Kr;break}for(;c<16;){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}if(e.wrap&2&&l===35615){e.wbits===0&&(e.wbits=15),e.check=0,G[0]=l&255,G[1]=l>>>8&255,e.check=st(e.check,G,2,0),l=0,c=0,e.mode=Uo;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((l&255)<<8)+(l>>8))%31){i.msg="incorrect header check",e.mode=Y;break}if((l&15)!==Do){i.msg="unknown compression method",e.mode=Y;break}if(l>>>=4,c-=4,k=(l&15)+8,e.wbits===0&&(e.wbits=k),k>15||k>e.wbits){i.msg="invalid window size",e.mode=Y;break}e.dmax=1<<e.wbits,e.flags=0,i.adler=e.check=1,e.mode=l&512?Zo:ce,l=0,c=0;break;case Uo:for(;c<16;){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}if(e.flags=l,(e.flags&255)!==Do){i.msg="unknown compression method",e.mode=Y;break}if(e.flags&57344){i.msg="unknown header flags set",e.mode=Y;break}e.head&&(e.head.text=l>>8&1),e.flags&512&&e.wrap&4&&(G[0]=l&255,G[1]=l>>>8&255,e.check=st(e.check,G,2,0)),l=0,c=0,e.mode=Io;case Io:for(;c<32;){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}e.head&&(e.head.time=l),e.flags&512&&e.wrap&4&&(G[0]=l&255,G[1]=l>>>8&255,G[2]=l>>>16&255,G[3]=l>>>24&255,e.check=st(e.check,G,4,0)),l=0,c=0,e.mode=zo;case zo:for(;c<16;){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}e.head&&(e.head.xflags=l&255,e.head.os=l>>8),e.flags&512&&e.wrap&4&&(G[0]=l&255,G[1]=l>>>8&255,e.check=st(e.check,G,2,0)),l=0,c=0,e.mode=No;case No:if(e.flags&1024){for(;c<16;){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}e.length=l,e.head&&(e.head.extra_len=l),e.flags&512&&e.wrap&4&&(G[0]=l&255,G[1]=l>>>8&255,e.check=st(e.check,G,2,0)),l=0,c=0}else e.head&&(e.head.extra=null);e.mode=Lo;case Lo:if(e.flags&1024&&(p=e.length,p>h&&(p=h),p&&(e.head&&(k=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(n.subarray(r,r+p),k)),e.flags&512&&e.wrap&4&&(e.check=st(e.check,n,p,r)),h-=p,r+=p,e.length-=p),e.length))break t;e.length=0,e.mode=$o;case $o:if(e.flags&2048){if(h===0)break t;p=0;do k=n[r+p++],e.head&&k&&e.length<65536&&(e.head.name+=String.fromCharCode(k));while(k&&p<h);if(e.flags&512&&e.wrap&4&&(e.check=st(e.check,n,p,r)),h-=p,r+=p,k)break t}else e.head&&(e.head.name=null);e.length=0,e.mode=Bo;case Bo:if(e.flags&4096){if(h===0)break t;p=0;do k=n[r+p++],e.head&&k&&e.length<65536&&(e.head.comment+=String.fromCharCode(k));while(k&&p<h);if(e.flags&512&&e.wrap&4&&(e.check=st(e.check,n,p,r)),h-=p,r+=p,k)break t}else e.head&&(e.head.comment=null);e.mode=Go;case Go:if(e.flags&512){for(;c<16;){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}if(e.wrap&4&&l!==(e.check&65535)){i.msg="header crc mismatch",e.mode=Y;break}l=0,c=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),i.adler=e.check=0,e.mode=ce;break;case Zo:for(;c<32;){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}i.adler=e.check=ih(l),l=0,c=0,e.mode=rr;case rr:if(e.havedict===0)return i.next_out=o,i.avail_out=f,i.next_in=r,i.avail_in=h,e.hold=l,e.bits=c,Nf;i.adler=e.check=1,e.mode=ce;case ce:if(t===If||t===Ha)break t;case Kr:if(e.last){l>>>=c&7,c-=c&7,e.mode=Yr;break}for(;c<3;){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}switch(e.last=l&1,l>>>=1,c-=1,l&3){case 0:e.mode=Ho;break;case 1:if(Wf(e),e.mode=Ja,t===Ha){l>>>=2,c-=2;break t}break;case 2:e.mode=Wo;break;case 3:i.msg="invalid block type",e.mode=Y}l>>>=2,c-=2;break;case Ho:for(l>>>=c&7,c-=c&7;c<32;){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}if((l&65535)!==(l>>>16^65535)){i.msg="invalid stored block lengths",e.mode=Y;break}if(e.length=l&65535,l=0,c=0,e.mode=Xr,t===Ha)break t;case Xr:e.mode=Jo;case Jo:if(p=e.length,p){if(p>h&&(p=h),p>f&&(p=f),p===0)break t;s.set(n.subarray(r,r+p),o),h-=p,r+=p,f-=p,o+=p,e.length-=p;break}e.mode=ce;break;case Wo:for(;c<14;){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}if(e.nlen=(l&31)+257,l>>>=5,c-=5,e.ndist=(l&31)+1,l>>>=5,c-=5,e.ncode=(l&15)+4,l>>>=4,c-=4,e.nlen>286||e.ndist>30){i.msg="too many length or distance symbols",e.mode=Y;break}e.have=0,e.mode=qo;case qo:for(;e.have<e.ncode;){for(;c<3;){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}e.lens[Lt[e.have++]]=l&7,l>>>=3,c-=3}for(;e.have<19;)e.lens[Lt[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,$={bits:e.lenbits},W=cs(Uf,e.lens,0,19,e.lencode,0,e.work,$),e.lenbits=$.bits,W){i.msg="invalid code lengths set",e.mode=Y;break}e.have=0,e.mode=Ko;case Ko:for(;e.have<e.nlen+e.ndist;){for(;M=e.lencode[l&(1<<e.lenbits)-1],C=M>>>24,D=M>>>16&255,I=M&65535,!(C<=c);){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}if(I<16)l>>>=C,c-=C,e.lens[e.have++]=I;else{if(I===16){for(Z=C+2;c<Z;){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}if(l>>>=C,c-=C,e.have===0){i.msg="invalid bit length repeat",e.mode=Y;break}k=e.lens[e.have-1],p=3+(l&3),l>>>=2,c-=2}else if(I===17){for(Z=C+3;c<Z;){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}l>>>=C,c-=C,k=0,p=3+(l&7),l>>>=3,c-=3}else{for(Z=C+7;c<Z;){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}l>>>=C,c-=C,k=0,p=11+(l&127),l>>>=7,c-=7}if(e.have+p>e.nlen+e.ndist){i.msg="invalid bit length repeat",e.mode=Y;break}for(;p--;)e.lens[e.have++]=k}}if(e.mode===Y)break;if(e.lens[256]===0){i.msg="invalid code -- missing end-of-block",e.mode=Y;break}if(e.lenbits=9,$={bits:e.lenbits},W=cs(Wh,e.lens,0,e.nlen,e.lencode,0,e.work,$),e.lenbits=$.bits,W){i.msg="invalid literal/lengths set",e.mode=Y;break}if(e.distbits=6,e.distcode=e.distdyn,$={bits:e.distbits},W=cs(qh,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,$),e.distbits=$.bits,W){i.msg="invalid distances set",e.mode=Y;break}if(e.mode=Ja,t===Ha)break t;case Ja:e.mode=Wa;case Wa:if(h>=6&&f>=258){i.next_out=o,i.avail_out=f,i.next_in=r,i.avail_in=h,e.hold=l,e.bits=c,Tf(i,g),o=i.next_out,s=i.output,f=i.avail_out,r=i.next_in,n=i.input,h=i.avail_in,l=e.hold,c=e.bits,e.mode===ce&&(e.back=-1);break}for(e.back=0;M=e.lencode[l&(1<<e.lenbits)-1],C=M>>>24,D=M>>>16&255,I=M&65535,!(C<=c);){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}if(D&&!(D&240)){for(x=C,B=D,L=I;M=e.lencode[L+((l&(1<<x+B)-1)>>x)],C=M>>>24,D=M>>>16&255,I=M&65535,!(x+C<=c);){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}l>>>=x,c-=x,e.back+=x}if(l>>>=C,c-=C,e.back+=C,e.length=I,D===0){e.mode=Vo;break}if(D&32){e.back=-1,e.mode=ce;break}if(D&64){i.msg="invalid literal/length code",e.mode=Y;break}e.extra=D&15,e.mode=Xo;case Xo:if(e.extra){for(Z=e.extra;c<Z;){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}e.length+=l&(1<<e.extra)-1,l>>>=e.extra,c-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=Yo;case Yo:for(;M=e.distcode[l&(1<<e.distbits)-1],C=M>>>24,D=M>>>16&255,I=M&65535,!(C<=c);){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}if(!(D&240)){for(x=C,B=D,L=I;M=e.distcode[L+((l&(1<<x+B)-1)>>x)],C=M>>>24,D=M>>>16&255,I=M&65535,!(x+C<=c);){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}l>>>=x,c-=x,e.back+=x}if(l>>>=C,c-=C,e.back+=C,D&64){i.msg="invalid distance code",e.mode=Y;break}e.offset=I,e.extra=D&15,e.mode=jo;case jo:if(e.extra){for(Z=e.extra;c<Z;){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}e.offset+=l&(1<<e.extra)-1,l>>>=e.extra,c-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){i.msg="invalid distance too far back",e.mode=Y;break}e.mode=Qo;case Qo:if(f===0)break t;if(p=g-f,e.offset>p){if(p=e.offset-p,p>e.whave&&e.sane){i.msg="invalid distance too far back",e.mode=Y;break}p>e.wnext?(p-=e.wnext,y=e.wsize-p):y=e.wnext-p,p>e.length&&(p=e.length),U=e.window}else U=s,y=o-e.offset,p=e.length;p>f&&(p=f),f-=p,e.length-=p;do s[o++]=U[y++];while(--p);e.length===0&&(e.mode=Wa);break;case Vo:if(f===0)break t;s[o++]=e.length,f--,e.mode=Wa;break;case Yr:if(e.wrap){for(;c<32;){if(h===0)break t;h--,l|=n[r++]<<c,c+=8}if(g-=f,i.total_out+=g,e.total+=g,e.wrap&4&&g&&(i.adler=e.check=e.flags?st(e.check,s,g,o-g):xs(e.check,s,g,o-g)),g=f,e.wrap&4&&(e.flags?l:ih(l))!==e.check){i.msg="incorrect data check",e.mode=Y;break}l=0,c=0}e.mode=th;case th:if(e.wrap&&e.flags){for(;c<32;){if(h===0)break t;h--,l+=n[r++]<<c,c+=8}if(e.wrap&4&&l!==(e.total&4294967295)){i.msg="incorrect length check",e.mode=Y;break}l=0,c=0}e.mode=eh;case eh:W=zf;break t;case Y:W=Kh;break t;case Yh:return Xh;case jh:default:return zt}return i.next_out=o,i.avail_out=f,i.next_in=r,i.avail_in=h,e.hold=l,e.bits=c,(e.wsize||g!==i.avail_out&&e.mode<Y&&(e.mode<Yr||t!==Po))&&iu(i,i.output,i.next_out,g-i.avail_out),_-=i.avail_in,g-=i.avail_out,i.total_in+=_,i.total_out+=g,e.total+=g,e.wrap&4&&g&&(i.adler=e.check=e.flags?st(e.check,s,g,i.next_out-g):xs(e.check,s,g,i.next_out-g)),i.data_type=e.bits+(e.last?64:0)+(e.mode===ce?128:0)+(e.mode===Ja||e.mode===Xr?256:0),(_===0&&g===0||t===Po)&&W===an&&(W=Lf),W},Kf=i=>{if(rn(i))return zt;let t=i.state;return t.window&&(t.window=null),i.state=null,an},Xf=(i,t)=>{if(rn(i))return zt;const e=i.state;return e.wrap&2?(e.head=t,t.done=!1,an):zt},Yf=(i,t)=>{const e=t.length;let n,s,r;return rn(i)||(n=i.state,n.wrap!==0&&n.mode!==rr)?zt:n.mode===rr&&(s=1,s=xs(s,t,e,0),s!==n.check)?Kh:(r=iu(i,t,e,e),r?(n.mode=Yh,Xh):(n.havedict=1,an))};var jf=Vh,Qf=tu,Vf=Qh,td=Jf,ed=eu,id=qf,nd=Kf,sd=Xf,ad=Yf,rd="pako inflate (from Nodeca project)",pe={inflateReset:jf,inflateReset2:Qf,inflateResetKeep:Vf,inflateInit:td,inflateInit2:ed,inflate:id,inflateEnd:nd,inflateGetHeader:sd,inflateSetDictionary:ad,inflateInfo:rd};function ld(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var od=ld;const nu=Object.prototype.toString,{Z_NO_FLUSH:hd,Z_FINISH:ud,Z_OK:Es,Z_STREAM_END:Vr,Z_NEED_DICT:tl,Z_STREAM_ERROR:cd,Z_DATA_ERROR:sh,Z_MEM_ERROR:fd}=Ia;function Na(i){this.options=Ur.assign({chunkSize:1024*64,windowBits:15,to:""},i||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(i&&i.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Hh,this.strm.avail_out=0;let e=pe.inflateInit2(this.strm,t.windowBits);if(e!==Es)throw new Error(Xn[e]);if(this.header=new od,pe.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=Ss.string2buf(t.dictionary):nu.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=pe.inflateSetDictionary(this.strm,t.dictionary),e!==Es)))throw new Error(Xn[e])}Na.prototype.push=function(i,t){const e=this.strm,n=this.options.chunkSize,s=this.options.dictionary;let r,o,h;if(this.ended)return!1;for(t===~~t?o=t:o=t===!0?ud:hd,nu.call(i)==="[object ArrayBuffer]"?e.input=new Uint8Array(i):e.input=i,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),r=pe.inflate(e,o),r===tl&&s&&(r=pe.inflateSetDictionary(e,s),r===Es?r=pe.inflate(e,o):r===sh&&(r=tl));e.avail_in>0&&r===Vr&&e.state.wrap>0&&i[e.next_in]!==0;)pe.inflateReset(e),r=pe.inflate(e,o);switch(r){case cd:case sh:case tl:case fd:return this.onEnd(r),this.ended=!0,!1}if(h=e.avail_out,e.next_out&&(e.avail_out===0||r===Vr))if(this.options.to==="string"){let f=Ss.utf8border(e.output,e.next_out),l=e.next_out-f,c=Ss.buf2string(e.output,f);e.next_out=l,e.avail_out=n-l,l&&e.output.set(e.output.subarray(f,f+l),0),this.onData(c)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(r===Es&&h===0)){if(r===Vr)return r=pe.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};Na.prototype.onData=function(i){this.chunks.push(i)};Na.prototype.onEnd=function(i){i===Es&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Ur.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};function no(i,t){const e=new Na(t);if(e.push(i),e.err)throw e.msg||Xn[e.err];return e.result}function dd(i,t){return t=t||{},t.raw=!0,no(i,t)}var pd=Na,md=no,gd=dd,_d=no,bd=Ia,wd={Inflate:pd,inflate:md,inflateRaw:gd,ungzip:_d,constants:bd};const{Inflate:yd,inflate:vd,inflateRaw:Ip,ungzip:zp}=wd;var xd=yd,Ad=vd;const el=[137,80,78,71,13,10,26,10],su=[];for(let i=0;i<256;i++){let t=i;for(let e=0;e<8;e++)t&1?t=3988292384^t>>>1:t=t>>>1;su[i]=t}const ah=4294967295;function Sd(i,t,e){let n=i;for(let s=0;s<e;s++)n=su[(n^t[s])&255]^n>>>8;return n}function Ed(i,t){return(Sd(ah,i,t)^ah)>>>0}var $t;(function(i){i[i.UNKNOWN=-1]="UNKNOWN",i[i.GREYSCALE=0]="GREYSCALE",i[i.TRUECOLOUR=2]="TRUECOLOUR",i[i.INDEXED_COLOUR=3]="INDEXED_COLOUR",i[i.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",i[i.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"})($t||($t={}));var fs;(function(i){i[i.UNKNOWN=-1]="UNKNOWN",i[i.DEFLATE=0]="DEFLATE"})(fs||(fs={}));var lr;(function(i){i[i.UNKNOWN=-1]="UNKNOWN",i[i.ADAPTIVE=0]="ADAPTIVE"})(lr||(lr={}));var or;(function(i){i[i.UNKNOWN=-1]="UNKNOWN",i[i.NO_INTERLACE=0]="NO_INTERLACE",i[i.ADAM7=1]="ADAM7"})(or||(or={}));const kd=new Uint8Array(0),rh="\0",Cd=new Uint16Array([255]),Rd=new Uint8Array(Cd.buffer),Td=Rd[0]===255;class Fd extends Yl{constructor(t,e={}){super(t);const{checkCrc:n=!1}=e;this._checkCrc=n,this._inflator=new xd,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=fs.UNKNOWN,this._filterMethod=lr.UNKNOWN,this._interlaceMethod=or.UNKNOWN,this._colorType=$t.UNKNOWN,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let t=0;t<el.length;t++)if(this.readUint8()!==el[t])throw new Error(`wrong PNG signature. Byte at ${t} should be ${el[t]}.`)}decodeChunk(){const t=this.readUint32(),e=this.readChars(4),n=this.offset;switch(e){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(t);break;case"IDAT":this.decodeIDAT(t);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(t);break;case"iCCP":this.decodeiCCP(t);break;case"tEXt":this.decodetEXt(t);break;case"pHYs":this.decodepHYs();break;default:this.skip(t);break}if(this.offset-n!==t)throw new Error(`Length mismatch while decoding chunk ${e}`);if(this._checkCrc){const s=this.readUint32(),r=t+4,o=Ed(new Uint8Array(this.buffer,this.byteOffset+this.offset-r-4,r),r);if(o!==s)throw new Error(`CRC mismatch for chunk ${e}. Expected ${s}, found ${o}`)}else this.skip(4)}decodeIHDR(){const t=this._png;t.width=this.readUint32(),t.height=this.readUint32(),t.depth=Nd(this.readUint8());const e=this.readUint8();this._colorType=e;let n;switch(e){case $t.GREYSCALE:n=1;break;case $t.TRUECOLOUR:n=3;break;case $t.INDEXED_COLOUR:n=1;break;case $t.GREYSCALE_ALPHA:n=2;break;case $t.TRUECOLOUR_ALPHA:n=4;break;default:throw new Error(`Unknown color type: ${e}`)}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==fs.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(t){if(t%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${t}`);const e=t/3;this._hasPalette=!0;const n=[];this._palette=n;for(let s=0;s<e;s++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(t){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,t)),this.skip(t)}decodetRNS(t){switch(this._colorType){case $t.GREYSCALE:case $t.TRUECOLOUR:{if(t%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${t}`);if(t/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${t/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(t/2);for(let e=0;e<t/2;e++)this._transparency[e]=this.readUint16();break}case $t.INDEXED_COLOUR:{if(t>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${t} vs ${this._palette.length})`);let e=0;for(;e<t;e++){const n=this.readByte();this._palette[e].push(n)}for(;e<this._palette.length;e++)this._palette[e].push(255);break}default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(t){let e="",n;for(;(n=this.readChar())!==rh;)e+=n;const s=this.readUint8();if(s!==fs.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${s}`);const r=this.readBytes(t-e.length-2);this._png.iccEmbeddedProfile={name:e,profile:Ad(r)}}decodetEXt(t){let e="",n;for(;(n=this.readChar())!==rh;)e+=n;this._png.text[e]=this.readChars(t-e.length-1)}decodepHYs(){const t=this.readUint32(),e=this.readUint32(),n=this.readByte();this._png.resolution={x:t,y:e,unit:n}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const t=this._inflator.result;if(this._filterMethod!==lr.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===or.NO_INTERLACE)this.decodeInterlaceNull(t);else throw new Error(`Interlace method ${this._interlaceMethod} not supported`)}decodeInterlaceNull(t){const e=this._png.height,n=this._png.channels*this._png.depth/8,s=this._png.width*n,r=new Uint8Array(this._png.height*s);let o=kd,h=0,f,l;for(let c=0;c<e;c++){switch(f=t.subarray(h+1,h+1+s),l=r.subarray(c*s,(c+1)*s),t[h]){case 0:Md(f,l,s);break;case 1:Od(f,l,s,n);break;case 2:Pd(f,l,o,s);break;case 3:Dd(f,l,o,s,n);break;case 4:Ud(f,l,o,s,n);break;default:throw new Error(`Unsupported filter: ${t[h]}`)}o=l,h+=s+1}if(this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency),this._png.depth===16){const c=new Uint16Array(r.buffer);if(Td)for(let _=0;_<c.length;_++)c[_]=zd(c[_]);this._png.data=c}else this._png.data=r}}function Md(i,t,e){for(let n=0;n<e;n++)t[n]=i[n]}function Od(i,t,e,n){let s=0;for(;s<n;s++)t[s]=i[s];for(;s<e;s++)t[s]=i[s]+t[s-n]&255}function Pd(i,t,e,n){let s=0;if(e.length===0)for(;s<n;s++)t[s]=i[s];else for(;s<n;s++)t[s]=i[s]+e[s]&255}function Dd(i,t,e,n,s){let r=0;if(e.length===0){for(;r<s;r++)t[r]=i[r];for(;r<n;r++)t[r]=i[r]+(t[r-s]>>1)&255}else{for(;r<s;r++)t[r]=i[r]+(e[r]>>1)&255;for(;r<n;r++)t[r]=i[r]+(t[r-s]+e[r]>>1)&255}}function Ud(i,t,e,n,s){let r=0;if(e.length===0){for(;r<s;r++)t[r]=i[r];for(;r<n;r++)t[r]=i[r]+t[r-s]&255}else{for(;r<s;r++)t[r]=i[r]+e[r]&255;for(;r<n;r++)t[r]=i[r]+Id(t[r-s],e[r],e[r-s])&255}}function Id(i,t,e){const n=i+t-e,s=Math.abs(n-i),r=Math.abs(n-t),o=Math.abs(n-e);return s<=r&&s<=o?i:r<=o?t:e}function zd(i){return(i&255)<<8|i>>8&255}function Nd(i){if(i!==1&&i!==2&&i!==4&&i!==8&&i!==16)throw new Error(`invalid bit depth: ${i}`);return i}var lh;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.METRE=1]="METRE"})(lh||(lh={}));function Ld(i,t){return new Fd(i,t).decode()}var pn,Us,Oe;class Xt{static loadFromStorage(){m(this,Oe,window.localStorage.getItem(a(this,pn))!==a(this,Us)),N.updateDebugClass(this.enabled)}static get enabled(){return a(this,Oe)}static set enabled(t){m(this,Oe,t),z.infoBeetPx(`Debug flag set to: ${a(this,Oe)}`),N.updateDebugClass(this.enabled),a(this,Oe)?window.localStorage.removeItem(a(this,pn)):window.localStorage.setItem(a(this,pn),a(this,Us))}}pn=new WeakMap,Us=new WeakMap,Oe=new WeakMap,d(Xt,pn,"beetpx__debug_disabled"),d(Xt,Us,"yes"),d(Xt,Oe,!1);var vi;const Bt=class Bt{static debugBeetPx(...t){Bt.debug(a(Bt,vi),...t)}static debug(...t){Xt.enabled&&console.debug(...t.map(e=>e.__printDebug?e.__printDebug():e))}static infoBeetPx(...t){Bt.info(a(Bt,vi),...t)}static info(...t){console.info(...t.map(e=>e.__printDebug?e.__printDebug():e))}static warnBeetPx(...t){Bt.warn(a(Bt,vi),...t)}static warn(...t){console.warn(...t.map(e=>e.__printDebug?e.__printDebug():e))}static errorBeetPx(...t){Bt.error(a(Bt,vi),...t)}static error(...t){console.error(...t.map(e=>e.__printDebug?e.__printDebug():e))}};vi=new WeakMap,d(Bt,vi,"[BeetPx]");let z=Bt;var xi,Is,zs,_l,Ns,bl,Ls,wl,ur,au,cr,ru,fr,lu,mn,Qa;class $d{constructor(t,e){d(this,zs);d(this,Ns);d(this,Ls);d(this,ur);d(this,cr);d(this,fr);d(this,mn);d(this,xi,void 0);d(this,Is,void 0);m(this,xi,t),m(this,Is,e.decodeAudioData)}async loadAssets(t){const e=t.map(s=>s.trim()).filter(s=>s.length>0),n=e.filter(s=>!u(this,zs,_l).call(this,s)&&!u(this,Ns,bl).call(this,s)&&!u(this,Ls,wl).call(this,s));if(n.length>0)throw Error("Assets: following URLs don't look like any of supported formats: "+n.map(s=>`"${s}"`).join(", ")+'. Supported formats are: ".png", ".wav", ".flac", ".json", ".ldtk"');await Promise.all([...e.filter(s=>u(this,zs,_l).call(this,s)).map(s=>u(this,ur,au).call(this,s)),...e.filter(s=>u(this,Ns,bl).call(this,s)).map(s=>u(this,cr,ru).call(this,s)),...e.filter(s=>u(this,Ls,wl).call(this,s)).map(s=>u(this,fr,lu).call(this,s))])}}xi=new WeakMap,Is=new WeakMap,zs=new WeakSet,_l=function(t){return t.toLowerCase().endsWith(".png")},Ns=new WeakSet,bl=function(t){return t.toLowerCase().endsWith(".wav")||t.toLowerCase().endsWith(".flac")},Ls=new WeakSet,wl=function(t){return t.toLowerCase().endsWith(".json")||t.toLowerCase().endsWith(".ldtk")},ur=new WeakSet,au=async function(t){z.infoBeetPx(`Assets: loading image "${t}"`);const e=await fetch(t);if(!u(this,mn,Qa).call(this,e.status))throw Error(`Assets: could not fetch PNG file: "${t}"`);const n=await e.arrayBuffer(),s=Ld(n);if(s.channels!==3&&s.channels!==4)throw Error(`Assets: only PNG image files with 3 or 4 channels are supported. The file which seems to have ${s.channels} channels instead: "${t}"`);a(this,xi).addImageAsset(t,{width:s.width,height:s.height,channels:s.channels,rgba8bitData:s.data})},cr=new WeakSet,ru=async function(t){z.infoBeetPx(`Assets: loading sound "${t}"`);const e=await fetch(t);if(!u(this,mn,Qa).call(this,e.status))throw Error(`Assets: could not fetch sound file: "${t}"`);const n=await e.arrayBuffer(),s=await a(this,Is).call(this,n);a(this,xi).addSoundAsset(t,{audioBuffer:s})},fr=new WeakSet,lu=async function(t){z.infoBeetPx(`Assets: loading JSON "${t}"`);const e=await fetch(t);if(!u(this,mn,Qa).call(this,e.status))throw Error(`Assets: could not fetch JSON file: "${t}"`);const n=await e.json();a(this,xi).addJsonAsset(t,{json:n})},mn=new WeakSet,Qa=function(t){return t>=200&&t<300};var $s,Bs,Gs;class Bd{constructor(){d(this,$s,new Map);d(this,Bs,new Map);d(this,Gs,new Map)}addImageAsset(t,e){a(this,$s).set(t,e)}addSoundAsset(t,e){a(this,Bs).set(t,e)}addJsonAsset(t,e){a(this,Gs).set(t,e)}getImageAsset(t){const e=a(this,$s).get(t);if(!e)throw Error(`Assets: There is no image loaded for: ${t}`);return e}getSoundAsset(t){const e=a(this,Bs).get(t);if(!e)throw Error(`Assets: There is no sound loaded for: ${t}`);return e}getJsonAsset(t){const e=a(this,Gs).get(t);if(!e)throw Error(`Assets: There is no JSON loaded for: ${t}`);return e}}$s=new WeakMap,Bs=new WeakMap,Gs=new WeakMap;function yl(){}var gn,Va;const ps=class ps{static muteGain(t,e,n,s=yl){var r;n=Math.max(0,n),z.debugBeetPx(`AudioHelpers.muteGain (audioContextCurrentTime: ${e}, fadeOutMillis: ${n})`),u(r=ps,gn,Va).call(r,15,100,()=>{n>0?t.gain.setValueCurveAtTime([t.gain.value,0],e,n/1e3):t.gain.setValueAtTime(0,e)}).catch(()=>{}),setTimeout(()=>{s()},n)}static unmuteGain(t,e,n,s=yl){var r;n=Math.max(0,n),z.debugBeetPx(`AudioHelpers.unmuteGain (audioContextCurrentTime: ${e}, fadeInMillis: ${n})`),u(r=ps,gn,Va).call(r,15,100,()=>{n>0?t.gain.setValueCurveAtTime([t.gain.value,1],e,n/1e3):t.gain.setValueAtTime(1,e)}).catch(o=>{}),setTimeout(()=>{s()},n)}};gn=new WeakSet,Va=async function(t,e,n){if(t<=0)return z.warnBeetPx("AudioHelpers.#tryNTimes: Failed to perform the action in N trials."),Promise.reject();try{n()}catch(s){return z.debugBeetPx("AudioHelpers.#tryNTimes: err:",s),new Promise((r,o)=>{z.debugBeetPx(`AudioHelpers.#tryNTimes: Failed to perform the action, trying ${t} more times…`),setTimeout(()=>{u(this,gn,Va).call(this,t-1,e,n).then(r,o)},e)})}},d(ps,gn);let Ce=ps;var Vt,Ft,ct,_n,lt,Zs,vl,Hs,xl,Js,Al,Ws,Sl;const fe=class fe{constructor(t,e,n,s,r){d(this,Zs);d(this,Hs);d(this,Js);d(this,Ws);b(this,"onEnded");b(this,"startedAtMs");b(this,"pausedAtMs");b(this,"accumulatedPauseMs");b(this,"isPausedByEngine");b(this,"isPausedByGame");d(this,Vt,void 0);d(this,Ft,void 0);d(this,ct,void 0);d(this,_n,void 0);d(this,lt,void 0);s==="pause"?fe.playbacksToPauseOnGamePause.add(this):s==="mute"&&fe.playbacksToMuteOnGamePause.add(this),this.onEnded=()=>{r(),fe.playbacksToPauseOnGamePause.delete(this),fe.playbacksToMuteOnGamePause.delete(this)},m(this,ct,t),m(this,_n,e),m(this,lt,a(this,ct).createGain()),a(this,lt).gain.value=n?0:1,a(this,lt).connect(a(this,_n)),this.isPausedByGame=!1,this.isPausedByEngine=!1,m(this,Ft,n),m(this,Vt,!1),this.startedAtMs=a(this,ct).currentTime*1e3,this.pausedAtMs=null,this.accumulatedPauseMs=0}mute(t){z.debugBeetPx(`AudioPlayback.mute (id: ${this.id}, type: ${this.type}, fadeOutMillis: ${t})`),!a(this,Ft)&&(m(this,Ft,!0),!a(this,Vt)&&(this.isPausedByGame||this.isPausedByEngine||u(this,Zs,vl).call(this,t)))}muteByEngine(){z.debugBeetPx(`AudioPlayback.muteByEngine (id: ${this.id}, type: ${this.type})`),!a(this,Vt)&&(m(this,Vt,!0),!a(this,Ft)&&(this.isPausedByGame||this.isPausedByEngine||u(this,Zs,vl).call(this,yi.muteUnmuteDefaultFadeMillis)))}unmute(t){z.debugBeetPx(`AudioPlayback.unmute (id: ${this.id}, type: ${this.type}, fadeInMillis: ${t})`),a(this,Ft)&&(m(this,Ft,!1),!a(this,Vt)&&(this.isPausedByGame||this.isPausedByEngine||u(this,Hs,xl).call(this,t)))}unmuteByEngine(){z.debugBeetPx(`AudioPlayback.unmuteByEngine (id: ${this.id}, type: ${this.type})`),a(this,Vt)&&(m(this,Vt,!1),!a(this,Ft)&&(this.isPausedByGame||this.isPausedByEngine||u(this,Hs,xl).call(this,yi.muteUnmuteDefaultFadeMillis)))}stop(t){if(z.debugBeetPx(`AudioPlayback.stop (id: ${this.id}, type: ${this.type}, fadeOutMillis: ${t})`),this.isPausedByGame||this.isPausedByEngine){this.onEnded();return}Ce.muteGain(a(this,lt),a(this,ct).currentTime,t,()=>{this.stopAllNodes(),!this.isPausedByGame&&!this.isPausedByEngine&&this.onEnded()})}pause(){z.debugBeetPx(`AudioPlayback.pause (id: ${this.id}, type: ${this.type}})`),!this.isPausedByGame&&(this.isPausedByGame=!0,!this.isPausedByEngine&&u(this,Js,Al).call(this))}pauseByEngine(){z.debugBeetPx(`AudioPlayback.pauseByEngine (id: ${this.id}, type: ${this.type}})`),!this.isPausedByEngine&&(this.isPausedByEngine=!0,!this.isPausedByGame&&u(this,Js,Al).call(this))}resume(){z.debugBeetPx(`AudioPlayback.resume (id: ${this.id}, type: ${this.type})`),this.isPausedByGame&&(this.isPausedByGame=!1,!this.isPausedByEngine&&u(this,Ws,Sl).call(this))}resumeByEngine(){z.debugBeetPx(`AudioPlayback.resumeByEngine (id: ${this.id}, type: ${this.type})`),this.isPausedByEngine&&(this.isPausedByEngine=!1,!this.isPausedByGame&&u(this,Ws,Sl).call(this))}createSourceNode(){return a(this,ct).createBufferSource()}connectToMainGainNode(t){t.connect(a(this,lt))}disconnectFromOutput(){a(this,lt).disconnect()}};Vt=new WeakMap,Ft=new WeakMap,ct=new WeakMap,_n=new WeakMap,lt=new WeakMap,Zs=new WeakSet,vl=function(t){Ce.muteGain(a(this,lt),a(this,ct).currentTime,t)},Hs=new WeakSet,xl=function(t){Ce.unmuteGain(a(this,lt),a(this,ct).currentTime,t)},Js=new WeakSet,Al=function(){this.pausedAtMs=a(this,ct).currentTime*1e3,Ce.muteGain(a(this,lt),a(this,ct).currentTime,yi.muteUnmuteDefaultFadeMillis,()=>{this.stopAllNodes()})},Ws=new WeakSet,Sl=function(){m(this,lt,a(this,ct).createGain()),a(this,lt).gain.value=a(this,Ft)||this.isPausedByEngine?0:1,a(this,lt).connect(a(this,_n)),this.setupAndStartNodes(),this.pausedAtMs!=null&&(this.accumulatedPauseMs+=a(this,ct).currentTime*1e3-this.pausedAtMs,this.pausedAtMs=null),!a(this,Ft)&&!this.isPausedByEngine&&Ce.unmuteGain(a(this,lt),a(this,ct).currentTime,yi.muteUnmuteDefaultFadeMillis,()=>{})},b(fe,"playbacksToPauseOnGamePause",new Set),b(fe,"playbacksToMuteOnGamePause",new Set),b(fe,"nextPlaybackId",1);let St=fe;var bn,Mt,qs;class Gd extends St{constructor(e,n){super(n.audioContext,n.target,n.muteOnStart,n.onGamePause,n.onEnded);b(this,"id",St.nextPlaybackId++);b(this,"type","looped");d(this,bn,void 0);d(this,Mt,void 0);d(this,qs,void 0);m(this,bn,n.assets.getSoundAsset(e)),m(this,qs,a(this,bn).audioBuffer.duration*1e3),m(this,Mt,this.createSourceNode()),this.setupAndStartNodes()}stopAllNodes(){a(this,Mt).stop()}setupAndStartNodes(){this.pausedAtMs!=null&&m(this,Mt,this.createSourceNode()),a(this,Mt).buffer=a(this,bn).audioBuffer,a(this,Mt).loop=!0,this.connectToMainGainNode(a(this,Mt)),a(this,Mt).addEventListener("ended",()=>{a(this,Mt).disconnect(),this.disconnectFromOutput(),!this.isPausedByGame&&!this.isPausedByEngine&&this.onEnded()});const e=this.pausedAtMs?(this.pausedAtMs-this.startedAtMs-this.accumulatedPauseMs)%a(this,qs):0;a(this,Mt).start(0,e/1e3)}}bn=new WeakMap,Mt=new WeakMap,qs=new WeakMap;var Ks,Gt;class Zd extends St{constructor(e,n){super(n.audioContext,n.target,n.muteOnStart,n.onGamePause,n.onEnded);b(this,"id",St.nextPlaybackId++);b(this,"type","once");d(this,Ks,void 0);d(this,Gt,void 0);m(this,Ks,n.assets.getSoundAsset(e)),m(this,Gt,this.createSourceNode()),this.setupAndStartNodes()}stopAllNodes(){a(this,Gt).stop()}setupAndStartNodes(){this.pausedAtMs!=null&&m(this,Gt,this.createSourceNode()),a(this,Gt).buffer=a(this,Ks).audioBuffer,this.connectToMainGainNode(a(this,Gt)),a(this,Gt).addEventListener("ended",()=>{a(this,Gt).disconnect(),this.disconnectFromOutput(),!this.isPausedByGame&&!this.isPausedByEngine&&this.onEnded()});const e=this.pausedAtMs?this.pausedAtMs-this.startedAtMs-this.accumulatedPauseMs:0;a(this,Gt).start(0,e/1e3)}}Ks=new WeakMap,Gt=new WeakMap;function Hd(i){if(i.__esModule)return i;var t=i.default;if(typeof t=="function"){var e=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var s=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(e,n,s.get?s:{enumerable:!0,get:function(){return i[n]}})}),e}var il={},so=function(t){if(typeof window>"u")return null;var e=window.OfflineAudioContext||window.webkitOfflineAudioContext,n=window.AudioContext||window.webkitAudioContext;if(!n)return null;typeof t=="number"&&(t={sampleRate:t});var s=t&&t.sampleRate;if(t&&t.offline)return e?new e(t.channels||2,t.length,s||44100):null;var r=il[s];if(r)return r;try{r=new n(t)}catch{r=new n}return il[r.sampleRate]=il[s]=r,r},Jd=so,ou=ei;function ei(i,t){if(!(this instanceof ei))return new ei(i,t);if(t||(t=i,i=t&&t.context),t||(t={}),i===void 0&&(i=Jd()),t.numberOfChannels==null&&(t.numberOfChannels=1),t.sampleRate==null&&(t.sampleRate=i&&i.sampleRate||this.sampleRate),t.length==null&&(t.duration!=null?t.length=t.duration*t.sampleRate:t.length=1),i&&i.createBuffer)return i.createBuffer(t.numberOfChannels,Math.ceil(t.length),t.sampleRate);this.length=Math.ceil(t.length),this.numberOfChannels=t.numberOfChannels,this.sampleRate=t.sampleRate,this.duration=this.length/this.sampleRate,this._data=new Float32Array(this.length*this.numberOfChannels),this._channelData=[];for(var e=0;e<this.numberOfChannels;e++)this._channelData.push(this._data.subarray(e*this.length,(e+1)*this.length))}ei.prototype.numberOfChannels=1;ei.prototype.sampleRate=44100;ei.prototype.getChannelData=function(i){if(i>=this.numberOfChannels||i<0||i==null)throw Error("Cannot getChannelData: channel number ("+i+") exceeds number of channels ("+this.numberOfChannels+")");return this._channelData[i]};ei.prototype.copyFromChannel=function(i,t,e){e==null&&(e=0);for(var n=this._channelData[t],s=e,r=0;s<this.length&&r<i.length;s++,r++)i[r]=n[s]};ei.prototype.copyToChannel=function(i,t,e){var n=this._channelData[t];e||(e=0);for(var s=e,r=0;s<this.length&&r<i.length;s++,r++)n[s]=i[r]};var zr=function(t){return t!=null&&typeof t.length=="number"&&typeof t.sampleRate=="number"&&typeof t.getChannelData=="function"&&typeof t.duration=="number"},Wd=qd;function qd(i,t,e){return t<e?i<t?t:i>e?e:i:i<e?e:i>t?t:i}var Kd=Object.prototype.toString,hu=function(i){var t;return Kd.call(i)==="[object Object]"&&(t=Object.getPrototypeOf(i),t===null||t===Object.getPrototypeOf({}))};const Xd={},Yd=Object.freeze(Object.defineProperty({__proto__:null,default:Xd},Symbol.toStringTag,{value:"Module"})),uu=Hd(Yd);/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var jd=function(i){return i!=null&&(cu(i)||Qd(i)||!!i._isBuffer)};function cu(i){return!!i.constructor&&typeof i.constructor.isBuffer=="function"&&i.constructor.isBuffer(i)}function Qd(i){return typeof i.readFloatLE=="function"&&typeof i.slice=="function"&&cu(i.slice(0,0))}const Vd={8e3:8e3,11025:11025,16e3:16e3,22050:22050,44100:44100,48e3:48e3,88200:88200,96e3:96e3,176400:176400,192e3:192e3,352800:352800,384e3:384e3};/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var t0=function(i){return i!=null&&(fu(i)||e0(i)||!!i._isBuffer)};function fu(i){return!!i.constructor&&typeof i.constructor.isBuffer=="function"&&i.constructor.isBuffer(i)}function e0(i){return typeof i.readFloatLE=="function"&&typeof i.slice=="function"&&fu(i.slice(0,0))}var du=function(t,e,n){var s={},r,o;if(typeof e=="string"&&(e=oh(e)),Array.isArray(e)){var h={};for(o=0;o<e.length;o++)h[e[o]]=!0;e=h}for(r in e)e[r]=oh(e[r]);var f={};for(r in e){var l=e[r];if(Array.isArray(l))for(o=0;o<l.length;o++){var c=l[o];if(n&&(f[c]=!0),c in t){if(s[r]=t[c],n)for(var _=o;_<l.length;_++)f[l[_]]=!0;break}}else r in t&&(e[r]&&(s[r]=t[r]),n&&(f[r]=!0))}if(n)for(r in t)f[r]||(s[r]=t[r]);return s},nl={};function oh(i){return nl[i]?nl[i]:(typeof i=="string"&&(i=nl[i]=i.split(/\s*,\s*|\s+/)),i)}var hh=Vd,uh=uu,i0=zr,n0=t0,s0=hu,a0=du,pu={parse:_u,stringify:l0,detect:El,type:bu},mu=uh.endianness instanceof Function?uh.endianness().toLowerCase():"le",ch={uint:"uint32",uint8:"uint8",uint8_clamped:"uint8",uint16:"uint16",uint32:"uint32",int:"int32",int8:"int8",int16:"int16",int32:"int32",float:"float32",float32:"float32",float64:"float64",array:"array",arraybuffer:"arraybuffer",buffer:"buffer",audiobuffer:"audiobuffer",ndarray:"ndarray",ndsamples:"ndsamples"},ks={mono:1,stereo:2,quad:4,"5.1":6,"2.1":3,"3-channel":3,"5-channel":5},r0=32;for(var qa=6;qa<r0;qa++)ks[qa+"-channel"]=qa;var gu={};for(var fh in ks)gu[ks[fh]]=fh;function _u(i){for(var t={},e=i.split(/\s*[,;_]\s*|\s+/),n=0;n<e.length;n++){var s=e[n].toLowerCase();if(s==="planar"&&t.interleaved==null)t.interleaved=!1,t.channels==null&&(t.channels=2);else if((s==="interleave"||s==="interleaved")&&t.interleaved==null)t.interleaved=!0,t.channels==null&&(t.channels=2);else if(ks[s])t.channels=ks[s];else if(s==="le"||s==="LE"||s==="littleendian"||s==="bigEndian")t.endianness="le";else if(s==="be"||s==="BE"||s==="bigendian"||s==="bigEndian")t.endianness="be";else if(ch[s])t.type=ch[s],s==="audiobuffer"&&(t.endianness=mu,t.interleaved=!1);else if(hh[s])t.sampleRate=hh[s];else if(/^\d+$/.test(s))t.sampleRate=parseInt(s);else throw Error("Cannot identify part `"+s+"`")}return t}function El(i){if(!i)return{};var t=a0(i,{channels:"channel channels numberOfChannels channelCount",sampleRate:"sampleRate rate",interleaved:"interleave interleaved",type:"type dtype",endianness:"endianness"});if(i.format&&(t.type="ndsamples"),t.sampleRate==null&&i.format&&i.format.sampleRate&&(t.sampleRate=i.format.sampleRate),i.planar&&(t.interleaved=!1),t.interleaved!=null&&t.channels==null&&(t.channels=2),t.type==null){var e=bu(i);e&&(t.type=e)}return t.type==="audiobuffer"&&(t.endianness=mu,t.interleaved=!1),t}function l0(i,t){t===void 0?t={endianness:"le"}:t==null?t={}:typeof t=="string"?t=_u(t):t=El(t),s0(i)||(i=El(i));var e=[];return i.type!=null&&i.type!==t.type&&e.push(i.type||"float32"),i.channels!=null&&i.channels!==t.channels&&e.push(gu[i.channels]),i.endianness!=null&&i.endianness!==t.endianness&&e.push(i.endianness||"le"),i.interleaved!=null&&i.interleaved!==t.interleaved&&i.type!=="audiobuffer"&&e.push(i.interleaved?"interleaved":"planar"),i.sampleRate!=null&&i.sampleRate!==t.sampleRate&&e.push(i.sampleRate),e.join(" ")}function bu(i){if(i0(i))return"audiobuffer";if(n0(i))return"buffer";if(Array.isArray(i))return"array";if(i instanceof ArrayBuffer)return"arraybuffer";if(i.shape&&i.dtype)return i.format?"ndsamples":"ndarray";if(i instanceof Float32Array)return"float32";if(i instanceof Float64Array)return"float64";if(i instanceof Uint8Array)return"uint8";if(i instanceof Uint8ClampedArray)return"uint8_clamped";if(i instanceof Int8Array)return"int8";if(i instanceof Int16Array)return"int16";if(i instanceof Uint16Array)return"uint16";if(i instanceof Int32Array)return"int32";if(i instanceof Uint32Array)return"uint32"}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var dh=Object.getOwnPropertySymbols,o0=Object.prototype.hasOwnProperty,h0=Object.prototype.propertyIsEnumerable;function u0(i){if(i==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(i)}function c0(){try{if(!Object.assign)return!1;var i=new String("abc");if(i[5]="de",Object.getOwnPropertyNames(i)[0]==="5")return!1;for(var t={},e=0;e<10;e++)t["_"+String.fromCharCode(e)]=e;var n=Object.getOwnPropertyNames(t).map(function(r){return t[r]});if(n.join("")!=="0123456789")return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach(function(r){s[r]=r}),Object.keys(Object.assign({},s)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var f0=c0()?Object.assign:function(i,t){for(var e,n=u0(i),s,r=1;r<arguments.length;r++){e=Object(arguments[r]);for(var o in e)o0.call(e,o)&&(n[o]=e[o]);if(dh){s=dh(e);for(var h=0;h<s.length;h++)h0.call(e,s[h])&&(n[s[h]]=e[s[h]])}}return n},ph=uu,d0=jd,Te=pu,mh=f0,p0=zr,m0=g0;function g0(i,t,e,n){if(ph(i,"First argument should be data"),ph(t,"Second argument should be format string or object"),t===e)return i;if(gh(t))n=t,e=Te.detect(n),t=Te.detect(i);else if(e===void 0&&n===void 0)e=Ka(t),t=Te.detect(i);else if(gh(e))n=e,e=Ka(t),t=Te.detect(i);else{var s=Ka(t),r=Te.detect(i);r.dtype=s.type==="arraybuffer"?r.type:s.type,t=mh(s,r);var o=Ka(e),h=Te.detect(n);o.type&&(h.dtype=o.type==="arraybuffer"?h.type||t.dtype:o.type),e=mh(o,h)}if(e.channels==null&&t.channels!=null&&(e.channels=t.channels),e.type==null&&(e.type=t.type,e.dtype=t.dtype),e.interleaved!=null&&t.channels==null&&(t.channels=2),t.type===e.type&&t.interleaved===e.interleaved&&t.endianness===e.endianness)return i;_h(t),_h(e),(i.buffers||i.buffer&&i.buffer.buffers)&&(i.buffer&&(i=i.buffer),i.buffers&&(i=i.join()));var f;if(p0(i))if(i._data)f=i._data;else{f=new Float32Array(i.length*i.numberOfChannels);for(var l=0,c=i.numberOfChannels;l<c;l++)f.set(i.getChannelData(l),i.length*l)}else i instanceof ArrayBuffer?f=new Xa[t.dtype](i):d0(i)?(i.byteOffset!=null?f=i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength):f=i.buffer,f=new Xa[t.dtype](f)):f=i;var _=e.type==="array"?Array.from(f):new Xa[e.dtype](f);if(t.max!==e.max)for(var g=t.max-t.min,p=e.max-e.min,y=0,c=f.length;y<c;y++){var U=f[y],M=(U-t.min)/g;U=M*p+e.min,_[y]=Math.max(e.min,Math.min(e.max,U))}if(t.interleaved!=e.interleaved){var C=t.channels,D=Math.floor(f.length/C);t.interleaved&&!e.interleaved?_=_.map(function(W,G,$){var Z=G%D,Lt=~~(G/D);return $[Z*C+Lt]}):!t.interleaved&&e.interleaved&&(_=_.map(function(W,G,$){var Z=~~(G/C),Lt=G%C;return $[Lt*D+Z]}))}if(e.dtype!="array"&&e.dtype!="int8"&&e.dtype!="uint8"&&t.endianness&&e.endianness&&t.endianness!==e.endianness)for(var I=e.endianness==="le",x=new DataView(_.buffer),B=_.BYTES_PER_ELEMENT,L="set"+e.dtype[0].toUpperCase()+e.dtype.slice(1),y=0,c=_.length;y<c;y++)x[L](y*B,_[y],I);if(e.type,n){if(Array.isArray(n))for(var y=0;y<_.length;y++)n[y]=_[y];else if(n instanceof ArrayBuffer){var k=new Xa[e.dtype](n);k.set(_),n=k}else n.set(_);_=n}return(e.type==="arraybuffer"||e.type==="buffer")&&(_=_.buffer),_}function Ka(i){return typeof i=="string"?Te.parse(i):Te.detect(i)}function gh(i){return typeof i!="string"&&(Array.isArray(i)||ArrayBuffer.isView(i)||i instanceof ArrayBuffer)}var Xa={uint8:Uint8Array,uint8_clamped:Uint8ClampedArray,uint16:Uint16Array,uint32:Uint32Array,int8:Int8Array,int16:Int16Array,int32:Int32Array,float32:Float32Array,float64:Float64Array,array:Array,arraybuffer:Uint8Array,buffer:Uint8Array},_0={float32:"float32",audiobuffer:"float32",ndsamples:"float32",ndarray:"float32",float64:"float64",buffer:"uint8",arraybuffer:"uint8",uint8:"uint8",uint8_clamped:"uint8",uint16:"uint16",uint32:"uint32",int8:"int8",int16:"int16",int32:"int32",array:"array"};function _h(i){switch(i.dtype||(i.dtype=_0[i.type]||"array"),i.dtype){case"float32":case"float64":case"audiobuffer":case"ndsamples":case"ndarray":i.min=-1,i.max=1;break;case"uint8":i.min=0,i.max=255;break;case"uint16":i.min=0,i.max=65535;break;case"uint32":i.min=0,i.max=4294967295;break;case"int8":i.min=-128,i.max=127;break;case"int16":i.min=-32768,i.max=32767;break;case"int32":i.min=-2147483648,i.max=2147483647;break;default:i.min=-1,i.max=1;break}return i}var b0=function(t){return atob(t)},kl={exports:{}};(function(i,t){(function(e){function n(s,r){if(s instanceof Boolean||typeof s=="boolean"||(r instanceof Object||(r={}),r.hasOwnProperty("allowBlank")&&!r.allowBlank&&s===""))return!1;var o="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+/]{3}=)?";return r.mime&&(o="(data:\\w+\\/[a-zA-Z\\+\\-\\.]+;base64,)?"+o),r.paddingRequired===!1&&(o="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}(==)?|[A-Za-z0-9+\\/]{3}=?)?"),new RegExp("^"+o+"$","gi").test(s)}i.exports&&(t=i.exports=n),t.isBase64=n})()})(kl,kl.exports);var w0=kl.exports,wu=b0,y0=w0,v0=function(t){if(typeof t!="string")throw Error("Argument should be a string");return/^data\:/i.test(t)?x0(t):(y0(t)&&(t=wu(t)),yu(t))};function yu(i){for(var t=new Uint8Array(i.length),e=0;e<i.length;e++)t[e]=i.charCodeAt(e);return t.buffer}function x0(i){i=i.replace(/\r?\n/g,"");var t=i.indexOf(",");if(t===-1||t<=4)throw new TypeError("malformed data-URI");for(var e=i.substring(5,t).split(";"),n=!1,s="US-ASCII",r=0;r<e.length;r++)e[r]=="base64"?n=!0:e[r].indexOf("charset=")==0&&(s=e[r].substring(8));var o=unescape(i.substring(t+1));n&&(o=wu(o));var h=yu(o);return h.type=e[0]||"text/plain",h.charset=s,h}var A0=ou,S0=zr,E0=hu,k0=so,C0=m0,bh=pu,R0=v0,T0=du,F0=function i(t,e){var n,s,r,o,h,f,l;if(typeof e=="number"?e={channels:e}:typeof e=="string"?e={format:e}:e===void 0&&(E0(t)?(e=t,t=void 0):e={}),e=T0(e,{format:"format type dtype dataType",channels:"channel channels numberOfChannels channelCount",sampleRate:"sampleRate rate",length:"length size",duration:"duration time"}),r=e.channels,o=e.sampleRate,e.format&&(h=wh(e.format)),h&&(r&&!h.channels?h.channels=r:h.channels&&!r&&(r=h.channels),!o&&h.sampleRate&&(o=h.sampleRate)),t==null)e.duration!=null?(o||(o=44100),n=o*e.duration):n=e.length;else if(S0(t))if(n=t.length,r==null&&(r=t.numberOfChannels),o==null&&(o=t.sampleRate),t._channelData)s=t._channelData.slice(0,r);else for(s=[],f=0,l=r;f<l;f++)s[f]=t.getChannelData(f);else if(typeof t=="number")n=t;else if(Array.isArray(t)&&(Array.isArray(t[0])||ArrayBuffer.isView(t[0])))for(n=t[0].length,s=[],r||(r=t.length),f=0;f<r;f++)s[f]=t[f]instanceof Float32Array?t[f]:new Float32Array(t[f]);else{if(t.shape&&t.data)return t.shape&&(r=t.shape[1]),!o&&t.format&&(o=t.format.sampleRate),i(t.data,{channels:r,sampleRate:o});for(typeof t=="string"&&(t=R0(t)),h||(h=wh(t)),r||(r=h.channels||1),t=C0(t,h,"float32 planar"),n=Math.floor(t.length/r),s=[],f=0;f<r;f++)s[f]=t.subarray(f*n,(f+1)*n)}var c=new A0(e.context===null||n===0?null:e.context||k0(),{length:n??1,numberOfChannels:r||1,sampleRate:o||44100});if(s)for(f=0,l=s.length;f<l;f++)c.getChannelData(f).set(s[f]);return c};function wh(i){return typeof i=="string"?bh.parse(i):bh.detect(i)}var vu=ou,La=zr,M0=Wd,O0=so,P0=F0,D0=function(i){return i===0&&1/i===-1/0},Nt=function(t,e){return t==null?0:D0(t)?e:t<=-e?0:t<0?e+t%e:Math.min(e,t)},sl,Nr={create:Qn,copy:ao,shallow:xu,clone:U0,reverse:I0,invert:z0,zero:N0,noise:L0,equal:Au,fill:ii,slice:ro,concat:Cs,resize:G0,pad:lo,padLeft:Z0,padRight:H0,rotate:J0,shift:W0,normalize:q0,removeStatic:K0,trim:Y0,trimLeft:j0,trimRight:Q0,mix:V0,size:tp,data:ep,subbuffer:B0,repeat:$0};Object.defineProperty(Nr,"context",{get:function(){return sl||(sl=O0()),sl}});var ss=Nr;function Qn(i,t,e){return typeof t=="number"?t={channels:t}:typeof t=="string"?t={format:t}:t||(t={}),e&&(t.sampleRate=e),t.context=Nr.context,P0(i,t)}function ao(i,t,e){V(i),V(t),e=e||0;for(var n=0,s=Math.min(i.numberOfChannels,t.numberOfChannels);n<s;n++)t.getChannelData(n).set(i.getChannelData(n),e);return t}function V(i){if(!La(i))throw new Error("Argument should be an AudioBuffer instance.")}function xu(i){return V(i),Nr.context.createBuffer(i.numberOfChannels,i.length,i.sampleRate)}function U0(i){return ao(i,xu(i))}function I0(i,t,e,n){V(i),!La(t)&&t!=null&&(n=e,e=t,t=null),t?(V(t),ao(i,t)):t=i,e=e==null?0:Nt(e,i.length),n=n==null?i.length:Nt(n,i.length);for(var s=0,r=t.numberOfChannels;s<r;++s)t.getChannelData(s).subarray(e,n).reverse();return t}function z0(i,t,e,n){return!La(t)&&t!=null&&(n=e,e=t,t=null),ii(i,t,function(s){return-s},e,n)}function N0(i,t,e,n){return ii(i,t,0,e,n)}function L0(i,t,e,n){return ii(i,t,function(s){return Math.random()*2-1},e,n)}function Au(i,t){if(arguments.length>2){for(var e=0,n=arguments.length-1;e<n;e++)if(!Au(arguments[e],arguments[e+1]))return!1;return!0}if(V(i),V(t),i.length!==t.length||i.numberOfChannels!==t.numberOfChannels)return!1;for(var s=0;s<i.numberOfChannels;s++)for(var r=i.getChannelData(s),o=t.getChannelData(s),e=0;e<r.length;e++)if(r[e]!==o[e])return!1;return!0}function ii(i,t,e,n,s){if(V(i),!La(t)&&t!=null&&(typeof e=="function"||(s=n,n=e,e=t),t=null),t?V(t):t=i,n=n==null?0:Nt(n,i.length),s=s==null?i.length:Nt(s,i.length),e instanceof Function)for(var r=0,o=i.numberOfChannels;r<o;r++)for(var l=i.getChannelData(r),h=t.getChannelData(r),f=n;f<s;f++)h[f]=e.call(i,l[f],f,r,l);else for(var r=0,o=i.numberOfChannels;r<o;r++)for(var h=t.getChannelData(r),f=n;f<s;f++)h[f]=e;return t}function $0(i,t){if(V(i),!t||t<0)return new vu(null,{length:0,numberOfChannels:i.numberOfChannels,sampleRate:i.sampleRate});if(t===1)return i;for(var e=[],n=0;n<t;n++)e.push(i);return Cs(e)}function ro(i,t,e){V(i),t=t==null?0:Nt(t,i.length),e=e==null?i.length:Nt(e,i.length);for(var n=[],s=0;s<i.numberOfChannels;s++){var r=i.getChannelData(s);n.push(r.slice(t,e))}return Qn(n,i.numberOfChannels,i.sampleRate)}function B0(i,t,e,n){if(V(i),Array.isArray(t)?(n=t,t=0,e=-0):Array.isArray(e)&&(n=e,e=-0),!Array.isArray(n)){n=Array(i.numberOfChannels);for(var s=0;s<i.numberOfChannels;s++)n[s]=s}t=t==null?0:Nt(t,i.length),e=e==null?i.length:Nt(e,i.length);for(var r=[],o=0;o<n.length;o++){var h=n[o],f=i.getChannelData(h);r.push(f.subarray(t,e))}var l=new vu(null,{length:0,sampleRate:i.sampleRate,numberOfChannels:i.numberOfChannels});return l.length=r[0].length,l._data=null,l._channelData=r,l.duration=l.length/l.sampleRate,l}function Cs(){for(var i=[],t=0,e=arguments.length;t<e;t++){var n=arguments[t];if(Array.isArray(n))for(var s=0;s<n.length;s++)i.push(n[s]);else i.push(n)}for(var r=1,o=0,h=0,t=0;t<i.length;t++){var f=i[t];V(f),o+=f.length,r=Math.max(f.numberOfChannels,r),h=Math.max(f.sampleRate,h)}for(var l=[],c=0;c<r;c++){for(var _=new Float32Array(o),g=0,t=0;t<i.length;t++){var f=i[t];c<f.numberOfChannels&&_.set(f.getChannelData(c),g),g+=f.length}l.push(_)}return Qn(l,r,h)}function G0(i,t){return V(i),t<i.length?ro(i,0,t):Cs(i,Qn(t-i.length,i.numberOfChannels))}function lo(i,t,e){var n,s;return typeof i=="number"?(n=t,s=i):(n=i,s=t),e=e||0,V(n),s<n.length?n:n===t?Cs(ii(Qn(s-n.length,n.numberOfChannels),e),n):Cs(n,ii(Qn(s-n.length,n.numberOfChannels),e))}function Z0(i,t,e){return lo(t,i,e)}function H0(i,t,e){return lo(i,t,e)}function J0(i,t){V(i);for(var e=0;e<i.numberOfChannels;e++)for(var n=i.getChannelData(e),s=n.slice(),r=0,o=n.length,h;r<o;r++)h=(t+(t+r<0?o+r:r))%o,n[h]=s[r];return i}function W0(i,t){V(i);for(var e=0;e<i.numberOfChannels;e++){var n=i.getChannelData(e);if(t>0)for(var s=n.length-t;s--;)n[s+t]=n[s];else for(var s=-t,r=n.length-t;s<r;s++)n[s+t]=n[s]||0}return i}function q0(i,t,e,n){La(t)||(n=e,e=t,t=null),e=e==null?0:Nt(e,i.length),n=n==null?i.length:Nt(n,i.length);for(var s=0,r=0;r<i.numberOfChannels;r++)for(var o=i.getChannelData(r),h=e;h<n;h++)s=Math.max(Math.abs(o[h]),s);var f=Math.max(1/s,1);return ii(i,t,function(l,c,_){return M0(l*f,-1,1)},e,n)}function K0(i,t,e,n){var s=X0(i,e,n);return ii(i,t,function(r,o,h){return r-s[h]},e,n)}function X0(i,t,e){if(V(i),t=t==null?0:Nt(t,i.length),e=e==null?i.length:Nt(e,i.length),e-t<1)return[];for(var n=[],s=0;s<i.numberOfChannels;s++){for(var r=0,o=i.getChannelData(s),h=t;h<e;h++)r+=o[h];n.push(r/(e-t))}return n}function Y0(i,t){return oo(i,t,!0,!0)}function j0(i,t){return oo(i,t,!0,!1)}function Q0(i,t){return oo(i,t,!1,!0)}function oo(i,t,e,n){V(i),t=t==null?0:Math.abs(t);var s,r;if(e){s=i.length;for(var o=0,h=i.numberOfChannels;o<h;o++)for(var f=i.getChannelData(o),l=0;l<f.length&&!(l>s);l++)if(Math.abs(f[l])>t){s=l;break}}else s=0;if(n){r=0;for(var o=0,h=i.numberOfChannels;o<h;o++)for(var f=i.getChannelData(o),l=f.length-1;l>=0&&!(l<r);l--)if(Math.abs(f[l])>t){r=l+1;break}}else r=i.length;return ro(i,s,r)}function V0(i,t,e,n){V(i),V(t),e==null&&(e=.5);var s=e instanceof Function?e:function(c,_){return c*(1-e)+_*e};n==null?n=0:n<0&&(n+=i.length);for(var r=0;r<i.numberOfChannels;r++)for(var o=i.getChannelData(r),h=t.getChannelData(r),f=n,l=0;f<i.length&&l<t.length;f++,l++)o[f]=s.call(i,o[f],h[l],l,r);return i}function tp(i){return V(i),i.numberOfChannels*i.getChannelData(0).byteLength}function ep(i,t){V(i),t=t||[];for(var e=0;e<i.numberOfChannels;e++)ArrayBuffer.isView(t[e])?t[e].set(i.getChannelData(e)):t[e]=i.getChannelData(e);return t}var wn,Pe,yn,_t,Xs,Cl,dr,Su;class ip extends St{constructor(e,n){super(n.audioContext,n.target,n.muteOnStart,n.onGamePause,n.onEnded);d(this,Xs);d(this,dr);b(this,"id",St.nextPlaybackId++);b(this,"type","sequence");d(this,wn,void 0);d(this,Pe,void 0);d(this,yn,void 0);d(this,_t,void 0);const s=e.intro??[],r=e.loop??[];if(s.length+r.length<=0)throw Error("Cannot play an empty sound sequence");const o=s.map(f=>u(this,Xs,Cl).call(this,f,n.assets)),h=r.map(f=>u(this,Xs,Cl).call(this,f,n.assets));m(this,wn,u(this,dr,Su).call(this,[...o,...h])),m(this,Pe,o.reduce((f,l)=>f+l.durationMs,0)),m(this,yn,h.reduce((f,l)=>f+l.durationMs,0)),m(this,_t,this.createSourceNode()),this.setupAndStartNodes()}stopAllNodes(){a(this,_t).stop()}setupAndStartNodes(){this.pausedAtMs!=null&&m(this,_t,this.createSourceNode()),a(this,_t).buffer=a(this,wn),a(this,yn)>0&&(a(this,_t).loop=!0,a(this,_t).loopStart=a(this,Pe)/1e3,a(this,_t).loopEnd=a(this,wn).duration),this.connectToMainGainNode(a(this,_t)),a(this,_t).addEventListener("ended",()=>{a(this,_t).disconnect(),this.disconnectFromOutput(),!this.isPausedByGame&&!this.isPausedByEngine&&this.onEnded()});let e=this.pausedAtMs?this.pausedAtMs-this.startedAtMs-this.accumulatedPauseMs:0;e>a(this,Pe)&&(e=(e-a(this,Pe))%a(this,yn)+a(this,Pe)),a(this,_t).start(0,e/1e3)}}wn=new WeakMap,Pe=new WeakMap,yn=new WeakMap,_t=new WeakMap,Xs=new WeakSet,Cl=function(e,n){if(e.length<1)throw Error("Each intro sequence entry needs at least 1 sound");const[s,...r]=e,o=typeof s!="string"?s.url:s,h=n.getSoundAsset(o).audioBuffer,f=h.duration*1e3,l=typeof s!="string"&&s.durationMs?s.durationMs(f):f,c=ss.resize(h,l/1e3*h.sampleRate),_=r.map(g=>typeof g=="string"?{url:g}:g).map(({url:g})=>n.getSoundAsset(g).audioBuffer).map(g=>ss.resize(g,l/1e3*g.sampleRate));return{firstBuffer:c,otherBuffers:_,durationMs:l}},dr=new WeakSet,Su=function(e){const n=(r,o)=>Kn(-1,r+o,1),s=e.map(r=>r.otherBuffers.reduce((o,h)=>ss.mix(o,h,n),ss.clone(r.firstBuffer)));return ss.concat(...s)};var vn,Ys,Ai,bt,Ot,ot,ft,pr,Eu,mr,ku,js,Rl;const rt=class rt{constructor(t,e){d(this,pr);d(this,mr);d(this,js);d(this,Ai,void 0);d(this,bt,void 0);d(this,Ot,void 0);d(this,ot,new Map);d(this,ft,void 0);m(this,Ai,t),m(this,bt,e),m(this,ft,u(this,mr,ku).call(this)),N.updateMutedClass(a(this,ft)),m(this,Ot,a(this,bt).createGain()),a(this,Ot).gain.value=a(this,ft)?0:1,a(this,Ot).connect(a(this,bt).destination)}restart(){u(this,pr,Eu).call(this),a(this,ot).clear()}async tryToResumeAudioContextSuspendedByBrowserForSecurityReasons(){return z.debugBeetPx("AudioApi.tryToResumeAudioContextSuspendedByBrowserForSecurityReasons"),a(this,bt).state==="running"?(z.debugBeetPx("Audio Context is already running"),Promise.resolve(!0)):a(this,bt).resume().then(()=>(z.debugBeetPx("Audio Context got resumed"),!0)).catch(t=>(z.errorBeetPx(t),!1))}startPlayback(t,e){e??(e={}),e.muteOnStart??(e.muteOnStart=!1),e.onGamePause??(e.onGamePause="pause"),z.debugBeetPx(`AudioApi.startPlayback (muteOnStart: ${e.muteOnStart}, onGamePause: ${e.onGamePause})`);const n=new Zd(t,{assets:a(this,Ai),audioContext:a(this,bt),target:a(this,Ot),muteOnStart:e.muteOnStart,onGamePause:e.onGamePause,onEnded:()=>{z.debugBeetPx(`AudioApi: deleting playback ${n.id}`),a(this,ot).delete(n.id)}});return a(this,ot).set(n.id,n),n.id}startPlaybackLooped(t,e){e??(e={}),e.muteOnStart??(e.muteOnStart=!1),e.onGamePause??(e.onGamePause="pause"),z.debugBeetPx(`AudioApi.startPlaybackLooped (muteOnStart: ${e.muteOnStart}, onGamePause: ${e.onGamePause})`);const n=new Gd(t,{assets:a(this,Ai),audioContext:a(this,bt),target:a(this,Ot),muteOnStart:e.muteOnStart,onGamePause:e.onGamePause,onEnded:()=>{z.debugBeetPx(`AudioApi: deleting playback ${n.id}`),a(this,ot).delete(n.id)}});return a(this,ot).set(n.id,n),n.id}startPlaybackSequence(t,e){e??(e={}),e.muteOnStart??(e.muteOnStart=!1),e.onGamePause??(e.onGamePause="pause"),z.debugBeetPx(`AudioApi.startPlaybackSequence (muteOnStart: ${e.muteOnStart}, onGamePause: ${e.onGamePause})`);const n=new ip(t,{assets:a(this,Ai),audioContext:a(this,bt),target:a(this,Ot),muteOnStart:e.muteOnStart,onGamePause:e.onGamePause,onEnded:()=>{z.debugBeetPx(`AudioApi: deleting playback ${n.id}`),a(this,ot).delete(n.id)}});return a(this,ot).set(n.id,n),n.id}isAudioMuted(){return a(this,ft)}muteAudio(t={}){z.debugBeetPx(`AudioApi.muteAudio (fadeOutMillis: ${t.fadeOutMillis})`),!a(this,ft)&&(u(this,js,Rl).call(this,!0),m(this,ft,!0),N.updateMutedClass(a(this,ft)),Ce.muteGain(a(this,Ot),a(this,bt).currentTime,t.fadeOutMillis??rt.muteUnmuteDefaultFadeMillis))}unmuteAudio(t={}){z.debugBeetPx(`AudioApi.unmuteAudio (fadeInMillis: ${t.fadeInMillis})`),a(this,ft)&&(u(this,js,Rl).call(this,!1),m(this,ft,!1),N.updateMutedClass(a(this,ft)),Ce.unmuteGain(a(this,Ot),a(this,bt).currentTime,t.fadeInMillis??rt.muteUnmuteDefaultFadeMillis))}mutePlayback(t,e={}){var n;z.debugBeetPx(`AudioApi.mutePlayback (fadeOutMillis: ${e.fadeOutMillis})`),(n=a(this,ot).get(t))==null||n.mute(e.fadeOutMillis??rt.muteUnmuteDefaultFadeMillis)}unmutePlayback(t,e={}){var n;z.debugBeetPx(`AudioApi.unmutePlayback (fadeInMillis: ${e.fadeInMillis})`),(n=a(this,ot).get(t))==null||n.unmute(e.fadeInMillis??rt.muteUnmuteDefaultFadeMillis)}stopPlayback(t,e={}){var n;z.debugBeetPx(`AudioApi.stopPlayback (fadeOutMillis: ${e.fadeOutMillis})`),(n=a(this,ot).get(t))==null||n.stop(a(this,ft)?0:e.fadeOutMillis??rt.muteUnmuteDefaultFadeMillis)}pausePlayback(t){var e;z.debugBeetPx("AudioApi.pausePlayback"),(e=a(this,ot).get(t))==null||e.pause()}resumePlayback(t){var e;z.debugBeetPx("AudioApi.resumePlayback"),(e=a(this,ot).get(t))==null||e.resume()}getAudioContext(){return a(this,bt)}getGlobalGainNode(){return a(this,Ot)}};vn=new WeakMap,Ys=new WeakMap,Ai=new WeakMap,bt=new WeakMap,Ot=new WeakMap,ot=new WeakMap,ft=new WeakMap,pr=new WeakSet,Eu=function(t={}){z.debugBeetPx(`AudioApi.#stopAllPlaybacks (fadeOutMillis: ${t.fadeOutMillis})`);for(const e of a(this,ot).values())e.stop(a(this,ft)?0:t.fadeOutMillis??rt.muteUnmuteDefaultFadeMillis)},mr=new WeakSet,ku=function(){return window.localStorage.getItem(a(rt,vn))===a(rt,Ys)},js=new WeakSet,Rl=function(t){t?window.localStorage.setItem(a(rt,vn),a(rt,Ys)):window.localStorage.removeItem(a(rt,vn))},d(rt,vn,"audio_api__muted"),d(rt,Ys,"yes"),b(rt,"muteUnmuteDefaultFadeMillis",100);let yi=rt;class np{static detect(t){const e=(t==null?void 0:t.toLowerCase())??"";return e.includes("firefox")?e.includes("win64")?"firefox_windows":"firefox_other":e.includes("chrome")?"chromium":e.includes("safari")?"safari":"other"}}function en(i){throw Error(i)}var me,ge,De,Ue,xn;class sp{constructor(t){b(this,"canvasSize");d(this,me,void 0);d(this,ge,void 0);d(this,De,void 0);d(this,Ue,void 0);d(this,xn,null);this.canvasSize=t.round(),m(this,me,0),m(this,ge,0),m(this,De,this.canvasSize.x-1),m(this,Ue,this.canvasSize.y-1)}setClippingRegion(t,e){const n=[P.of(a(this,me),a(this,ge)),P.of(a(this,De)-a(this,me)+1,a(this,Ue)-a(this,ge)+1)],[s,r]=P.minMax(t.round(),t.add(e).round());return m(this,me,s.x),m(this,ge,s.y),m(this,De,r.x-1),m(this,Ue,r.y-1),n}removeClippingRegion(){return this.setClippingRegion(P.of(0,0),this.canvasSize)}canSetAny(t,e,n,s){return n>=a(this,me)&&s>=a(this,ge)&&t<=a(this,De)&&e<=a(this,Ue)}canSetAt(t,e){return t>=a(this,me)&&e>=a(this,ge)&&t<=a(this,De)&&e<=a(this,Ue)}takeSnapshot(){m(this,xn,this.newSnapshot())}getMostRecentSnapshot(){return a(this,xn)}render(){m(this,xn,null),this.doRender()}}me=new WeakMap,ge=new WeakMap,De=new WeakMap,Ue=new WeakMap,xn=new WeakMap;var _e,Qs;class ap{constructor(t,e){d(this,_e,void 0);d(this,Qs,void 0);m(this,_e,t),m(this,Qs,e)}getColorAt(t,e){const n=e*a(this,Qs)+t;if(n>=a(this,_e).length/4)throw Error(`index out of bounds: index = ${n}, max allowed index = ${a(this,_e).length/4-1}`);const s=n*4;return Q.of(a(this,_e)[s],a(this,_e)[s+1],a(this,_e)[s+2])}}_e=new WeakMap,Qs=new WeakMap;var An,Ie,Sn,Zt,Ht,gr,Cu;class rp extends sp{constructor(e,n,s){super(e);d(this,gr);d(this,An,void 0);d(this,Ie,void 0);d(this,Sn,void 0);d(this,Zt,void 0);d(this,Ht,void 0);m(this,An,e.x*e.y),m(this,Ie,n),a(this,Ie).style.backgroundColor=s.cssHex,m(this,Sn,a(this,Ie).getContext("2d",{colorSpace:"srgb",alpha:!0})??en("Was unable to obtain '2d' context from <canvas>")),a(this,Sn).imageSmoothingEnabled=!1;const r=document.createElement("canvas").transferControlToOffscreen();r.width=e.x,r.height=e.y,m(this,Zt,r.getContext("2d",{colorSpace:"srgb",alpha:!1})??en("Was unable to obtain '2d' context from OffscreenCanvas")),m(this,Ht,a(this,Zt).createImageData(a(this,Zt).canvas.width,a(this,Zt).canvas.height,{colorSpace:"srgb"})),u(this,gr,Cu).call(this)}set(e,n,s){if(n<0||s<0||n>=this.canvasSize.x||s>=this.canvasSize.y)throw Error(`(x,y) index out of bounds: (x,y) = (${n},${s}), bottom bound = (0,0), upper bound = (${this.canvasSize.x-1},${this.canvasSize.y-1})`);const r=s*this.canvasSize.x+n;if(r>=a(this,An))throw Error(`index out of bounds: index = ${r}, max allowed index = ${a(this,An)-1}`);const o=r*4;a(this,Ht).data[o]=e.r,a(this,Ht).data[o+1]=e.g,a(this,Ht).data[o+2]=e.b}newSnapshot(){return new ap(a(this,Ht).data.slice(),this.canvasSize.x)}doRender(){a(this,Zt).putImageData(a(this,Ht),0,0);const e=P.of(a(this,Ie).width,a(this,Ie).height),n=Math.max(1,Math.min(e.div(this.canvasSize).floor().x,e.div(this.canvasSize).floor().y)),s=e.sub(this.canvasSize.mul(n)).div(2).floor();a(this,Sn).drawImage(a(this,Zt).canvas,0,0,a(this,Zt).canvas.width,a(this,Zt).canvas.height,s.x,s.y,n*this.canvasSize.x,n*this.canvasSize.y)}}An=new WeakMap,Ie=new WeakMap,Sn=new WeakMap,Zt=new WeakMap,Ht=new WeakMap,gr=new WeakSet,Cu=function(){for(let e=3;e<a(this,Ht).data.length;e+=4)a(this,Ht).data[e]=255};var te,be,ze,En,Si,Vs,Ei,we,ee,it,wt,ta,yt,Tt,ye,ni;const fo=class fo{constructor(t,e){d(this,yt);d(this,ye);d(this,te,void 0);d(this,be,void 0);d(this,ze,void 0);d(this,En,void 0);d(this,Si,void 0);d(this,Vs,void 0);d(this,Ei,void 0);d(this,we,void 0);d(this,ee,void 0);d(this,it,void 0);d(this,wt,void 0);d(this,ta,void 0);m(this,Vs,e.onGamePause==="ignore"),m(this,Ei,e.onGamePause),m(this,te,[...t.intro,...t.loop].map(n=>({name:n[0],frames:Math.max(0,Math.round(n[1]))}))),m(this,be,t.loop.map(n=>({name:n[0],frames:Math.max(0,Math.round(n[1]))}))),m(this,ze,a(this,te).reduce((n,s)=>n+s.frames,0)),m(this,En,a(this,be).reduce((n,s)=>n+s.frames,0)),m(this,Si,a(this,ye,ni)+e.delayFrames),m(this,it,nn.for({frames:a(this,ze),loop:!1,pause:e.pause,delayFrames:e.delayFrames,onGamePause:a(this,Ei)})),m(this,wt,a(this,be).length>0?nn.for({frames:a(this,En),loop:!0,pause:e.pause,delayFrames:e.delayFrames+a(this,ze),onGamePause:a(this,Ei)}):null),m(this,we,!1),m(this,ee,null),e.pause&&this.pause()}static of(t,e){return new fo(t,e)}get justFinishedPhase(){return this.hasJustFinishedOverall||a(this,yt,Tt).t===0?a(this,yt,Tt).recentlyFinishedPhase:null}get currentPhase(){var t;return((t=a(this,yt,Tt).phase)==null?void 0:t.name)??null}get t(){return a(this,yt,Tt).t}get progress(){return a(this,yt,Tt).phase&&a(this,yt,Tt).phase.frames>0?a(this,yt,Tt).t/a(this,yt,Tt).phase.frames:1}get framesLeft(){return a(this,yt,Tt).phase?a(this,yt,Tt).phase.frames-a(this,yt,Tt).t:0}get tOverall(){var t;return a(this,it).hasFinished?((t=a(this,wt))==null?void 0:t.t)??a(this,it).t:a(this,it).t}get framesLeftOverall(){var t;return a(this,it).hasFinished?((t=a(this,wt))==null?void 0:t.framesLeft)??a(this,it).framesLeft:a(this,it).framesLeft}get progressOverall(){var t;return a(this,it).hasFinished?((t=a(this,wt))==null?void 0:t.progress)??a(this,it).progress:a(this,it).progress}get hasFinishedOverall(){return a(this,it).hasFinished}get hasJustFinishedOverall(){var t;return((t=a(this,wt))==null?void 0:t.hasJustFinished)||a(this,it).hasJustFinished}pause(){var t;a(this,we)||(m(this,we,!0),m(this,ee,a(this,ye,ni)),a(this,it).pause(),(t=a(this,wt))==null||t.pause())}resume(){var t;a(this,we)&&(m(this,we,!1),m(this,Si,a(this,Si)+(a(this,ye,ni)-(a(this,ee)??0))),m(this,ee,null),a(this,it).resume(),(t=a(this,wt))==null||t.resume())}restart(){m(this,Si,a(this,ye,ni)),m(this,we,!1),m(this,ee,null),a(this,it).restart(),a(this,wt)&&m(this,wt,nn.for({frames:a(this,En),loop:!0,pause:!1,delayFrames:a(this,ze),onGamePause:a(this,Ei)}))}};te=new WeakMap,be=new WeakMap,ze=new WeakMap,En=new WeakMap,Si=new WeakMap,Vs=new WeakMap,Ei=new WeakMap,we=new WeakMap,ee=new WeakMap,it=new WeakMap,wt=new WeakMap,ta=new WeakMap,yt=new WeakSet,Tt=function(){var o;if(((o=a(this,ta))==null?void 0:o.frameNumber)===(a(this,ee)??a(this,ye,ni)))return a(this,ta).value;if(!a(this,wt)||(a(this,ee)??a(this,ye,ni))<a(this,Si)+a(this,ze)){const h=a(this,it).t;let f=0,l=null,c=0;for(;c<a(this,te).length-1;){let g=a(this,te)[c];if(h<f+g.frames)return{recentlyFinishedPhase:(l==null?void 0:l.name)??null,phase:g,t:h-f};f+=g.frames,l=g,c+=1}let _=a(this,te)[c]??null;return{recentlyFinishedPhase:a(this,it).hasJustFinished?(_==null?void 0:_.name)??null:(l==null?void 0:l.name)??null,phase:_,t:h-f}}const t=a(this,wt).t;let e=0,n=a(this,te)[a(this,te).length-1]??null,s=0;for(;s<a(this,be).length-1;){let h=a(this,be)[s];if(t<e+h.frames)return{recentlyFinishedPhase:(n==null?void 0:n.name)??null,phase:h,t:t-e};e+=h.frames,n=h,s+=1}let r=a(this,be)[s]??null;return{recentlyFinishedPhase:(n==null?void 0:n.name)??null,phase:r,t:t-e}},ye=new WeakSet,ni=function(){return a(this,Vs)?Rt.frameNumber:Rt.frameNumberOutsidePause};let Tl=fo;function lp(i){return(t,e,n,s)=>Hl.from(i,t,e,n,s)}function ho(i,t){return i instanceof os?os.basedOn(i,t??Xl):os.of(i)}const uo=ho(new ll),op=ho(new Bu),hp=ho(new Gu);function jt(i,t,e){return typeof i=="string"?Q.fromCssHex(i):Q.of(i,t??0,e??0)}const up=jt("#000000"),cp=jt("#ffffff");jt("#ff0000");jt("#00ff00");jt("#0000ff");jt("#00ffff");jt("#ff00ff");jt("#ffff00");const Vn=nt;function fp(i,t){return nn.for({frames:i,loop:(t==null?void 0:t.loop)??!1,pause:(t==null?void 0:t.pause)??!1,delayFrames:(t==null?void 0:t.delayFrames)??0,onGamePause:(t==null?void 0:t.onGamePause)??"pause"})}function Ru(i,t){return Tl.of({intro:i.intro??[],loop:i.loop??[]},{pause:(t==null?void 0:t.pause)??!1,delayFrames:(t==null?void 0:t.delayFrames)??0,onGamePause:(t==null?void 0:t.onGamePause)??"pause"})}function et(i,t){return P.of(i,t??i)}const Rs=et(0,0),Ya=et(1,1);var Ne,ea,kn,ia,na,Le,$e,Be;class dp{constructor(t,e,n){d(this,Ne,void 0);d(this,ea,void 0);d(this,kn,void 0);d(this,ia,void 0);d(this,na,void 0);d(this,Le,void 0);d(this,$e,void 0);d(this,Be,void 0);m(this,Ne,t),m(this,ea,n.color??Vn.orange),m(this,kn,e);const s=n.placement??"top-right";m(this,na,s.endsWith("-left")),m(this,ia,s.startsWith("top-")),m(this,Le,Array.from({length:15},()=>0)),m(this,$e,0),m(this,Be,0)}drawRenderingFps(t){if(a(this,Le)[a(this,$e)]=t,m(this,$e,gi(a(this,$e)+1,a(this,Le).length)),a(this,$e)===0){m(this,Be,0);for(const r of a(this,Le))m(this,Be,a(this,Be)+r);m(this,Be,a(this,Be)/a(this,Le).length)}const e=a(this,Ne).useFont(uo),n=a(this,Be).toFixed(),s=Yt.measureText(n).wh;a(this,Ne).drawText(n,a(this,Ne).cameraXy.add(a(this,na)?1:a(this,kn).x-s.x-1,a(this,ia)?1:a(this,kn).y-s.y-1),a(this,ea)),a(this,Ne).useFont(e)}}Ne=new WeakMap,ea=new WeakMap,kn=new WeakMap,ia=new WeakMap,na=new WeakMap,Le=new WeakMap,$e=new WeakMap,Be=new WeakMap;var Cn;const _r=class _r{static get active(){return a(_r,Cn)}static set active(t){m(this,Cn,t),z.infoBeetPx(`FrameByFrame flag set to: ${a(this,Cn)}`)}};Cn=new WeakMap,d(_r,Cn,!1);let si=_r;var ki;class pp{constructor(t){d(this,ki,void 0);m(this,ki,t)}draw(t){for(let e=0;e<a(this,ki).canvasSize.x;++e)for(let n=0;n<a(this,ki).canvasSize.y;++n)a(this,ki).set(t,e,n)}}ki=new WeakMap;var dt,j,tt;class mp{constructor(t){d(this,j);d(this,dt,void 0);m(this,dt,t)}draw(t,e,n,s,r){const[o,h]=P.minMax(t.round(),t.add(e).round());if(h.x-o.x<=0||h.y-o.y<=0||!a(this,dt).canSetAny(o.x,o.y,h.x-1,h.y-1))return;const f=n.type==="pattern"?n.primary:n,l=n.type==="pattern"?n.secondary:null,c=(f==null?void 0:f.type)==="canvas_snapshot_mapping"?a(this,dt).getMostRecentSnapshot():null,_=r;let g=h.x-o.x-1,p=h.y-o.y-1,y=p&1,U=o.x,M=h.x-1,C=o.y+Math.floor((p+1)/2),D=C-y,I=4*(1-g)*p*p,x=4*(y+1)*g*g,B=I+x+y*g*g;g=8*g*g,y=8*p*p;do{if(u(this,j,tt).call(this,U,D,f,l,_,c),u(this,j,tt).call(this,M,D,f,l,_,c),u(this,j,tt).call(this,M,C,f,l,_,c),u(this,j,tt).call(this,U,C,f,l,_,c),s==="inside")for(let k=U+1;k<M;++k)u(this,j,tt).call(this,k,D,f,l,_,c),u(this,j,tt).call(this,k,C,f,l,_,c);else if(s==="outside"){for(let k=0;k<U;++k)u(this,j,tt).call(this,k,D,f,l,_,c),u(this,j,tt).call(this,k,C,f,l,_,c);for(let k=M+1;k<a(this,dt).canvasSize.x;++k)u(this,j,tt).call(this,k,D,f,l,_,c),u(this,j,tt).call(this,k,C,f,l,_,c)}const L=B;2*L<=x&&(C+=1,D-=1,x+=g,B+=x),(2*L>=I||2*B>x)&&(U+=1,M-=1,I+=y,B+=I)}while(U<=M);for(;C-D<=p;){if(u(this,j,tt).call(this,U-1,C,f,l,_,c),u(this,j,tt).call(this,M+1,C,f,l,_,c),s==="outside"){for(let L=0;L<U-1;++L)u(this,j,tt).call(this,L,C,f,l,_,c);for(let L=M+2;L<a(this,dt).canvasSize.x;++L)u(this,j,tt).call(this,L,C,f,l,_,c)}if(C+=1,u(this,j,tt).call(this,U-1,D,f,l,_,c),u(this,j,tt).call(this,M+1,D,f,l,_,c),s==="outside"){for(let L=0;L<U-1;++L)u(this,j,tt).call(this,L,D,f,l,_,c);for(let L=M+2;L<a(this,dt).canvasSize.x;++L)u(this,j,tt).call(this,L,D,f,l,_,c)}D-=1}if(s==="outside")for(let L=0;L<a(this,dt).canvasSize.x;++L){for(let k=0;k<D+1;++k)u(this,j,tt).call(this,L,k,f,l,_,c);for(let k=C;k<a(this,dt).canvasSize.y;++k)u(this,j,tt).call(this,L,k,f,l,_,c)}}}dt=new WeakMap,j=new WeakSet,tt=function(t,e,n,s,r,o){if(a(this,dt).canSetAt(t,e))if(r.hasPrimaryColorAt(t,e)){if(n)if(n.type==="rgb")a(this,dt).set(n,t,e);else{const h=n.getMappedColor(o,t,e);h&&a(this,dt).set(h,t,e)}}else s!=null&&a(this,dt).set(s,t,e)};var ve,br,Tu;class gp{constructor(t){d(this,br);d(this,ve,void 0);m(this,ve,t)}draw(t,e,n,s){const r=t.round(),o=t.add(e).round();if(o.x-r.x===0||o.y-r.y===0)return;e=o.sub(r);const h=e.sub(e.sign()),f=n.type==="pattern"?n.primary:n,l=n.type==="pattern"?n.secondary:null,c=(f==null?void 0:f.type)==="canvas_snapshot_mapping"?a(this,ve).getMostRecentSnapshot():null,_=s;let g=h.abs().mul(et(1,-1)),p=r;const y=r.add(h),U=h.sign();let M=g.x+g.y;for(;u(this,br,Tu).call(this,p.x,p.y,f,l,_,c),!p.eq(y);){const C=M;2*C>=g.y&&(p=p.add(et(U.x,0)),M+=g.y),2*C<=g.x&&(p=p.add(et(0,U.y)),M+=g.x)}}}ve=new WeakMap,br=new WeakSet,Tu=function(t,e,n,s,r,o){if(a(this,ve).canSetAt(t,e))if(r.hasPrimaryColorAt(t,e)){if(n)if(n.type==="rgb")a(this,ve).set(n,t,e);else{const h=n.getMappedColor(o,t,e);h&&a(this,ve).set(h,t,e)}}else s!=null&&a(this,ve).set(s,t,e)};var Rn;class _p{constructor(t){d(this,Rn,void 0);m(this,Rn,t)}draw(t,e,n){t=t.round(),a(this,Rn).canSetAt(t.x,t.y)&&n.hasPrimaryColorAt(t.x,t.y)&&a(this,Rn).set(e,t.x,t.y)}}Rn=new WeakMap;var Tn,sa;class Fu{constructor(t,e={}){d(this,Tn,void 0);d(this,sa,void 0);m(this,Tn,t),m(this,sa,e)}draw(t,e,n,s,r,o){e=a(this,sa).disableRounding?e:e.round(),s=P.max(s.floor(),Rs);for(let h=0;h<t.asciiRows.length;h+=1){const f=e.y+(r[1]?t.size.y-1-h:h)*s.y;for(let l=0;l<t.asciiRows[h].length;l+=1){const c=e.x+(r[0]?t.size.x-1-l:l)*s.x;if(t.asciiRows[h][l]==="#")for(let _=0;_<s.y;++_)for(let g=0;g<s.x;++g){const p=f+_,y=c+g;o.hasPrimaryColorAt(y,p)&&a(this,Tn).canSetAt(y,p)&&a(this,Tn).set(n,y,p)}}}}}Tn=new WeakMap,sa=new WeakMap;var vt,ht,mt;class bp{constructor(t){d(this,ht);d(this,vt,void 0);m(this,vt,t)}draw(t,e,n,s,r){const[o,h]=P.minMax(t.round(),t.add(e).round());if(!a(this,vt).canSetAny(o.x,o.y,h.x-1,h.y-1))return;const f=n.type==="pattern"?n.primary:n,l=n.type==="pattern"?n.secondary:null,c=(f==null?void 0:f.type)==="canvas_snapshot_mapping"?a(this,vt).getMostRecentSnapshot():null,_=r;for(let g=o.x;g<h.x;g+=1)u(this,ht,mt).call(this,g,o.y,f,l,_,c),u(this,ht,mt).call(this,g,h.y-1,f,l,_,c);for(let g=o.y+1;g<h.y-1;g+=1)u(this,ht,mt).call(this,o.x,g,f,l,_,c),u(this,ht,mt).call(this,h.x-1,g,f,l,_,c);if(s==="inside")for(let g=o.x;g<h.x;g+=1)for(let p=o.y+1;p<h.y-1;p+=1)u(this,ht,mt).call(this,g,p,f,l,_,c);else if(s==="outside"){for(let g=0;g<o.x;g+=1){for(let p=0;p<o.y;p+=1)u(this,ht,mt).call(this,g,p,f,l,_,c);for(let p=o.y;p<h.y;p+=1)u(this,ht,mt).call(this,g,p,f,l,_,c);for(let p=h.y;p<a(this,vt).canvasSize.y;p+=1)u(this,ht,mt).call(this,g,p,f,l,_,c)}for(let g=o.x;g<h.x;g+=1)for(let p=0;p<o.y;p+=1)u(this,ht,mt).call(this,g,p,f,l,_,c);for(let g=o.x;g<h.x;g+=1)for(let p=h.y;p<a(this,vt).canvasSize.y;p+=1)u(this,ht,mt).call(this,g,p,f,l,_,c);for(let g=h.x;g<a(this,vt).canvasSize.x;g+=1){for(let p=0;p<o.y;p+=1)u(this,ht,mt).call(this,g,p,f,l,_,c);for(let p=o.y;p<h.y;p+=1)u(this,ht,mt).call(this,g,p,f,l,_,c);for(let p=h.y;p<a(this,vt).canvasSize.y;p+=1)u(this,ht,mt).call(this,g,p,f,l,_,c)}}}}vt=new WeakMap,ht=new WeakSet,mt=function(t,e,n,s,r,o){if(a(this,vt).canSetAt(t,e))if(r.hasPrimaryColorAt(t,e)){if(n)if(n.type==="rgb")a(this,vt).set(n,t,e);else{const h=n.getMappedColor(o,t,e);h&&a(this,vt).set(h,t,e)}}else s!=null&&a(this,vt).set(s,t,e)};var Fn;class wp{constructor(){d(this,Fn,new Map)}prepareOrGetFromCache(t,e,n,s){const r=t.imageUrl+"::"+t.xy.x.toString()+":"+t.xy.y.toString()+":"+t.size.x.toString()+":"+t.size.y.toString();if(a(this,Fn).has(r))return a(this,Fn).get(r);const o=t.size.x,h=t.size.y,f=nr(o).map(()=>nr(h).map(()=>null));for(let c=0;c<h;++c){const _=t.xy.y+c;for(let g=0;g<o;++g){const p=t.xy.x+g,y=(_*n+p)*s;f[g][c]=s===3||e[y+3]>=255/2?jt(e[y],e[y+1],e[y+2]):null}}const l={w:t.size.x,h:t.size.y,colors:f,cacheHit:!0};return a(this,Fn).set(r,l),{...l,cacheHit:!1}}}Fn=new WeakMap;var wr,Ci,aa;class Mu{constructor(t,e={}){d(this,wr,new wp);d(this,Ci,void 0);d(this,aa,void 0);m(this,Ci,t),m(this,aa,e)}draw(t,e,n,s,r,o,h){n=a(this,aa).disableRounding?n:n.round(),s=P.max(s.floor(),Rs);const{width:f,height:l,channels:c,rgba8bitData:_}=e;if(t=t.clipBy(Rs,et(f,l)),!a(this,Ci).canSetAny(n.x,n.y,n.x+t.size.x*s.x-1,n.y+t.size.y*s.y-1))return;const g=a(this,wr).prepareOrGetFromCache(t,_,f,c);for(let p=0;p<g.h;p+=1){const y=n.y+(r[1]?t.size.y-1-p:p)*s.y;for(let U=0;U<g.w;U+=1){const M=n.x+(r[0]?t.size.x-1-U:U)*s.x;for(let C=0;C<s.y;++C)for(let D=0;D<s.x;++D){const I=M+D,x=y+C;if(a(this,Ci).canSetAt(I,x)&&h.hasPrimaryColorAt(I,x)){const B=g.colors[U][p];if(B){const L=o.getMappedColor(B,U,p);L&&a(this,Ci).set(L,I,x)}}}}}}}wr=new WeakMap,Ci=new WeakMap,aa=new WeakMap;var Mn,ra,la,oa;class yp{constructor(t,e){d(this,Mn,void 0);d(this,ra,void 0);d(this,la,void 0);d(this,oa,void 0);m(this,Mn,t),m(this,ra,e),m(this,la,new Mu(a(this,Mn),{disableRounding:!0})),m(this,oa,new Fu(a(this,Mn),{disableRounding:!0}))}draw(t,e,n,s,r,o,h){n=n.round(),o=P.max(o.floor(),Rs);for(const f of e.arrangeGlyphsFor(t,s,r)){if(f.type==="line_break")continue;const l=n.add(f.leftTop.mul(o));f.type==="sprite"?a(this,la).draw(f.sprite,a(this,ra).getImageAsset(f.sprite.imageUrl),l,o,[!1,!1],f.spriteColorMapping,h):f.type==="pixels"?a(this,oa).draw(f.pixels,l,f.color,o,[!1,!1],h):Kl()}}}Mn=new WeakMap,ra=new WeakMap,la=new WeakMap,oa=new WeakMap;var ha,Ri,ua,ca,fa,da,Ti,Fi,pa,ma,ut,On,ie,Mi;class vp{constructor(t){d(this,ha,void 0);d(this,Ri,void 0);d(this,ua,void 0);d(this,ca,void 0);d(this,fa,void 0);d(this,da,void 0);d(this,Ti,void 0);d(this,Fi,void 0);d(this,pa,void 0);d(this,ma,void 0);b(this,"cameraXy",et(0,0));d(this,ut,gs.primaryOnly);d(this,On,ir.noMapping);d(this,ie,uo);d(this,Mi,{});m(this,ha,t.assets),m(this,Ri,t.canvas),m(this,ua,new pp(t.canvas)),m(this,ca,new _p(t.canvas)),m(this,fa,new Fu(t.canvas)),m(this,da,new gp(t.canvas)),m(this,Ti,new bp(t.canvas)),m(this,Fi,new mp(t.canvas)),m(this,pa,new Mu(t.canvas)),m(this,ma,new yp(t.canvas,t.assets))}clearCanvas(t){a(this,ua).draw(t)}setClippingRegion(t,e){return a(this,Ri).setClippingRegion(t,e)}removeClippingRegion(){return a(this,Ri).removeClippingRegion()}setCameraXy(t){const e=this.cameraXy;return this.cameraXy=t,e}setDrawingPattern(t){const e=a(this,ut);return m(this,ut,t),e}drawPixel(t,e){a(this,ca).draw(t.sub(this.cameraXy),e,a(this,ut))}drawPixels(t,e,n,s){var o,h;const r=(s==null?void 0:s.centerXy)??[!1,!1];(r[0]||r[1])&&(e=e.sub(r[0]?t.size.x*(((o=s==null?void 0:s.scaleXy)==null?void 0:o.x)??1)/2:0,r[1]?t.size.y*(((h=s==null?void 0:s.scaleXy)==null?void 0:h.y)??1)/2:0)),a(this,fa).draw(t,e.sub(this.cameraXy),n,(s==null?void 0:s.scaleXy)??Ya,(s==null?void 0:s.flipXy)??[!1,!1],a(this,ut))}drawLine(t,e,n){a(this,da).draw(t.sub(this.cameraXy),e,n,a(this,ut))}drawRect(t,e,n){a(this,Ti).draw(t.sub(this.cameraXy),e,n,"none",a(this,ut))}drawRectFilled(t,e,n){a(this,Ti).draw(t.sub(this.cameraXy),e,n,"inside",a(this,ut))}drawRectOutsideFilled(t,e,n){a(this,Ti).draw(t.sub(this.cameraXy),e,n,"outside",a(this,ut))}drawEllipse(t,e,n){a(this,Fi).draw(t.sub(this.cameraXy),e,n,"none",a(this,ut))}drawEllipseFilled(t,e,n){a(this,Fi).draw(t.sub(this.cameraXy),e,n,"inside",a(this,ut))}drawEllipseOutsideFilled(t,e,n){a(this,Fi).draw(t.sub(this.cameraXy),e,n,"outside",a(this,ut))}setSpriteColorMapping(t){const e=a(this,On);return m(this,On,t),e}drawSprite(t,e,n){var o,h;const s=(n==null?void 0:n.centerXy)??[!1,!1];(s[0]||s[1])&&(e=e.sub(s[0]?t.size.x*(((o=n==null?void 0:n.scaleXy)==null?void 0:o.x)??1)/2:0,s[1]?t.size.y*(((h=n==null?void 0:n.scaleXy)==null?void 0:h.y)??1)/2:0));const r=a(this,ha).getImageAsset(t.imageUrl);a(this,pa).draw(t.type==="static"?t:t.current,r,e.sub(this.cameraXy),(n==null?void 0:n.scaleXy)??Ya,(n==null?void 0:n.flipXy)??[!1,!1],a(this,On),a(this,ut))}useFont(t){const e=a(this,ie);return m(this,ie,t),e}setTextColorMarkers(t){const e=a(this,Mi);return m(this,Mi,t),e}measureText(t,e){var h,f;let n=0,s=0;for(const l of a(this,ie).arrangeGlyphsFor(t,cp,a(this,Mi)))l.type==="line_break"?n=Math.max(n,l.lineNumber+1):(n=Math.max(n,l.lineNumber),s=Math.max(s,l.leftTop.x+(l.type==="sprite"?l.sprite.size.x:l.pixels.size.x)));const r=et(s,(n+1)*(a(this,ie).ascent+a(this,ie).descent)+n*a(this,ie).lineGap).mul((e==null?void 0:e.scaleXy)??Ya),o=et((h=e==null?void 0:e.centerXy)!=null&&h[0]?-r.x/2:0,(f=e==null?void 0:e.centerXy)!=null&&f[1]?-r.y/2:0);return{wh:r,offset:o}}drawText(t,e,n,s){const r=(s==null?void 0:s.centerXy)??[!1,!1];if(r[0]||r[1]){const{offset:o}=this.measureText(t,{scaleXy:s==null?void 0:s.scaleXy,centerXy:s==null?void 0:s.centerXy});e=e.add(o)}a(this,ma).draw(t,a(this,ie),e.sub(this.cameraXy),n,a(this,Mi),(s==null?void 0:s.scaleXy)??Ya,a(this,ut))}takeCanvasSnapshot(){return a(this,Ri).takeSnapshot()}}ha=new WeakMap,Ri=new WeakMap,ua=new WeakMap,ca=new WeakMap,fa=new WeakMap,da=new WeakMap,Ti=new WeakMap,Fi=new WeakMap,pa=new WeakMap,ma=new WeakMap,ut=new WeakMap,On=new WeakMap,ie=new WeakMap,Mi=new WeakMap;var Ge,Oi,Pi,Di,Ui,Pn,tr;class Ut{constructor(){d(this,Pn);d(this,Ge,!1);d(this,Oi,!1);d(this,Pi,null);d(this,Di,null);d(this,Ui,null)}setRepeating(t){m(this,Pi,t.firstRepeatFrames),m(this,Di,t.loopedRepeatFrames)}get isPressed(){return a(this,Ge)}get wasJustPressed(){var t;return a(this,Oi)&&a(this,Ge)||a(this,Pn,tr)&&((t=a(this,Ui))==null?void 0:t.justFinishedPhase)!=null}get wasJustReleased(){var t;return a(this,Oi)&&!a(this,Ge)||a(this,Pn,tr)&&((t=a(this,Ui))==null?void 0:t.justFinishedPhase)!=null}update(t){t?a(this,Oi)&&a(this,Pn,tr)&&m(this,Ui,Ru({intro:a(this,Pi)?[["first",a(this,Pi)]]:void 0,loop:a(this,Di)?[["looped",a(this,Di)]]:void 0},{onGamePause:"ignore"})):m(this,Ui,null),m(this,Oi,a(this,Ge)!==t),m(this,Ge,t)}}Ge=new WeakMap,Oi=new WeakMap,Pi=new WeakMap,Di=new WeakMap,Ui=new WeakMap,Pn=new WeakSet,tr=function(){return a(this,Pi)!=null||a(this,Di)!=null};var Jt,Wt,qt,Kt,ne,se,ae;class xp{constructor(){d(this,Jt,new Ut);d(this,Wt,new Ut);d(this,qt,new Ut);d(this,Kt,new Ut);d(this,ne,new Ut);d(this,se,new Ut);d(this,ae,new Ut)}update(t){a(this,Jt).update(t.has("button_left")),a(this,Wt).update(t.has("button_right")),a(this,qt).update(t.has("button_up")),a(this,Kt).update(t.has("button_down")),a(this,ne).update(t.has("button_a")),a(this,se).update(t.has("button_b")),a(this,ae).update(t.has("button_menu"))}isAnyPressed(){return a(this,Jt).isPressed||a(this,Wt).isPressed||a(this,qt).isPressed||a(this,Kt).isPressed||a(this,ne).isPressed||a(this,se).isPressed||a(this,ae).isPressed}isPressed(t){switch(t){case"left":return a(this,Jt).isPressed;case"right":return a(this,Wt).isPressed;case"up":return a(this,qt).isPressed;case"down":return a(this,Kt).isPressed;case"a":return a(this,ne).isPressed;case"b":return a(this,se).isPressed;case"menu":return a(this,ae).isPressed}}getPressedDirection(){return et((a(this,Jt).isPressed?-1:0)+(a(this,Wt).isPressed?1:0),(a(this,qt).isPressed?-1:0)+(a(this,Kt).isPressed?1:0))}setButtonRepeating(t,e){switch(t){case"left":a(this,Jt).setRepeating(e);return;case"right":a(this,Wt).setRepeating(e);return;case"up":a(this,qt).setRepeating(e);return;case"down":a(this,Kt).setRepeating(e);return;case"a":a(this,ne).setRepeating(e);return;case"b":a(this,se).setRepeating(e);return;case"menu":a(this,ae).setRepeating(e);return}}wasAnyJustPressed(){return a(this,Jt).wasJustPressed||a(this,Wt).wasJustPressed||a(this,qt).wasJustPressed||a(this,Kt).wasJustPressed||a(this,ne).wasJustPressed||a(this,se).wasJustPressed||a(this,ae).wasJustPressed}wasJustPressed(t){switch(t){case"left":return a(this,Jt).wasJustPressed;case"right":return a(this,Wt).wasJustPressed;case"up":return a(this,qt).wasJustPressed;case"down":return a(this,Kt).wasJustPressed;case"a":return a(this,ne).wasJustPressed;case"b":return a(this,se).wasJustPressed;case"menu":return a(this,ae).wasJustPressed}}wasJustReleased(t){switch(t){case"left":return a(this,Jt).wasJustReleased;case"right":return a(this,Wt).wasJustReleased;case"up":return a(this,qt).wasJustReleased;case"down":return a(this,Kt).wasJustReleased;case"a":return a(this,ne).wasJustReleased;case"b":return a(this,se).wasJustReleased;case"menu":return a(this,ae).wasJustReleased}}}Jt=new WeakMap,Wt=new WeakMap,qt=new WeakMap,Kt=new WeakMap,ne=new WeakMap,se=new WeakMap,ae=new WeakMap;function Ou(i){return i!=null}var Ii;const ri=class ri{eventForButton(t,e){if(!e.pressed)return null;switch(t){case 0:case 4:return"button_a";case 1:case 3:return"button_b";case 10:case 11:return"button_menu"}return null}eventsForAxisValue(t,e){if(t===9){const n=e*7+8;if(n<.5||n>15.5||n>7.5&&n<8.5)return[];switch(Math.round(n)){case 1:return["button_up"];case 3:return["button_up","button_right"];case 5:return["button_right"];case 7:return["button_down","button_right"];case 9:return["button_down"];case 11:return["button_down","button_left"];case 13:return["button_left"];case 15:return["button_up","button_left"];default:return[]}}switch(t){case 0:case 2:return e>a(ri,Ii)?["button_right"]:e<-a(ri,Ii)?["button_left"]:[];case 1:case 5:return e>a(ri,Ii)?["button_down"]:e<-a(ri,Ii)?["button_up"]:[];default:return[]}}};Ii=new WeakMap,d(ri,Ii,.6);let Fl=ri;var zi;const li=class li{eventForButton(t,e){if(!e.pressed)return null;switch(t){case 0:case 3:case 4:case 7:return"button_a";case 1:case 2:case 5:case 6:return"button_b";case 12:return"button_up";case 13:return"button_down";case 14:return"button_left";case 15:return"button_right";case 8:case 9:case 10:case 11:case 16:case 17:return"button_menu"}return null}eventsForAxisValue(t,e){switch(t){case 0:case 2:return e>a(li,zi)?["button_right"]:e<-a(li,zi)?["button_left"]:[];case 1:case 3:return e>a(li,zi)?["button_down"]:e<-a(li,zi)?["button_up"]:[];default:return[]}}};zi=new WeakMap,d(li,zi,.6);let Ml=li;var Ni;const oi=class oi{eventForButton(t,e){if(!e.pressed)return null;switch(t){case 0:case 4:return"button_a";case 1:case 3:return"button_b";case 10:case 11:return"button_menu"}return null}eventsForAxisValue(t,e){if(t===0){const n=e*7+8;if(n<.5||n>15.5||n>7.5&&n<8.5)return[];switch(Math.round(n)){case 1:return["button_up"];case 3:return["button_up","button_right"];case 5:return["button_right"];case 7:return["button_down","button_right"];case 9:return["button_down"];case 11:return["button_down","button_left"];case 13:return["button_left"];case 15:return["button_up","button_left"];default:return[]}}switch(t){case 1:case 3:return e>a(oi,Ni)?["button_right"]:e<-a(oi,Ni)?["button_left"]:[];case 2:case 4:return e>a(oi,Ni)?["button_down"]:e<-a(oi,Ni)?["button_up"]:[];default:return[]}}};Ni=new WeakMap,d(oi,Ni,.6);let Ol=oi;var Li;const hi=class hi{eventForButton(t,e){if(!e.pressed)return null;switch(t){case 0:case 4:return"button_a";case 1:case 3:return"button_b";case 10:case 11:return"button_menu"}return null}eventsForAxisValue(t,e){if(t===9){const n=e*7+8;if(n<.5||n>15.5||n>7.5&&n<8.5)return[];switch(Math.round(n)){case 1:return["button_up"];case 3:return["button_up","button_right"];case 5:return["button_right"];case 7:return["button_down","button_right"];case 9:return["button_down"];case 11:return["button_down","button_left"];case 13:return["button_left"];case 15:return["button_up","button_left"];default:return[]}}switch(t){case 0:case 2:return e>a(hi,Li)?["button_right"]:e<-a(hi,Li)?["button_left"]:[];case 1:case 5:return e>a(hi,Li)?["button_down"]:e<-a(hi,Li)?["button_up"]:[];default:return[]}}};Li=new WeakMap,d(hi,Li,.6);let Pl=hi;var $i;const ui=class ui{eventForButton(t,e){if(!e.pressed)return null;switch(t){case 1:case 3:return"button_a";case 0:case 2:return"button_b";case 9:return"button_menu"}return null}eventsForAxisValue(t,e){if(t===4){const n=e*7+8;if(n<.5||n>15.5||n>7.5&&n<8.5)return[];switch(Math.round(n)){case 1:return["button_up"];case 3:return["button_up","button_right"];case 5:return["button_right"];case 7:return["button_down","button_right"];case 9:return["button_down"];case 11:return["button_down","button_left"];case 13:return["button_left"];case 15:return["button_up","button_left"];default:return[]}}switch(t){case 0:case 2:return e>a(ui,$i)?["button_right"]:e<-a(ui,$i)?["button_left"]:[];case 1:case 3:return e>a(ui,$i)?["button_down"]:e<-a(ui,$i)?["button_up"]:[];default:return[]}}};$i=new WeakMap,d(ui,$i,.6);let Dl=ui;var Bi;const ci=class ci{eventForButton(t,e){if(!e.pressed)return null;switch(t){case 1:case 3:return"button_a";case 0:case 2:return"button_b";case 9:return"button_menu"}return null}eventsForAxisValue(t,e){switch(t){case 0:case 2:return e>a(ci,Bi)?["button_right"]:e<-a(ci,Bi)?["button_left"]:[];case 1:case 5:return e>a(ci,Bi)?["button_down"]:e<-a(ci,Bi)?["button_up"]:[];default:return[]}}};Bi=new WeakMap,d(ci,Bi,.6);let Ul=ci;var Gi;const fi=class fi{eventForButton(t,e){if(!e.pressed)return null;switch(t){case 1:case 5:case 4:case 7:return"button_a";case 2:case 3:case 0:case 6:return"button_b";case 12:return"button_up";case 13:return"button_down";case 14:return"button_left";case 15:return"button_right";case 16:case 8:case 9:case 10:case 11:case 17:return"button_menu"}return null}eventsForAxisValue(t,e){switch(t){case 0:case 2:return e>a(fi,Gi)?["button_right"]:e<-a(fi,Gi)?["button_left"]:[];case 1:case 3:return e>a(fi,Gi)?["button_down"]:e<-a(fi,Gi)?["button_up"]:[];default:return[]}}};Gi=new WeakMap,d(fi,Gi,.6);let Il=fi;var Zi;const di=class di{eventForButton(t,e){if(!e.pressed)return null;switch(t){case 0:case 3:return"button_a";case 1:case 2:return"button_b";case 12:return"button_up";case 13:return"button_down";case 14:return"button_left";case 15:return"button_right";case 8:case 9:return"button_menu"}return null}eventsForAxisValue(t,e){switch(t){case 0:case 2:return e>a(di,Zi)?["button_right"]:e<-a(di,Zi)?["button_left"]:[];case 1:case 3:return e>a(di,Zi)?["button_down"]:e<-a(di,Zi)?["button_up"]:[];default:return[]}}};Zi=new WeakMap,d(di,Zi,.6);let zl=di;var Hi;const pi=class pi{eventForButton(t,e){if(!e.pressed)return null;switch(t){case 0:case 3:return"button_a";case 1:case 2:return"button_b";case 12:return"button_up";case 13:return"button_down";case 14:return"button_left";case 15:return"button_right";case 9:return"button_menu"}return null}eventsForAxisValue(t,e){switch(t){case 0:case 2:return e>a(pi,Hi)?["button_right"]:e<-a(pi,Hi)?["button_left"]:[];case 1:case 3:return e>a(pi,Hi)?["button_down"]:e<-a(pi,Hi)?["button_up"]:[];default:return[]}}};Hi=new WeakMap,d(pi,Hi,.6);let Nl=pi;var xe,Pt,yr,Pu;class Ap{constructor(t){d(this,yr);b(this,"inputMethod","gamepad");d(this,xe,void 0);d(this,Pt,{standard:new Nl,firefoxDualSenseWindows:new Ul,firefoxDualSenseOther:new Dl,firefox8bitdoWindows:new Pl,firefox8bitdoOther:new Ol,firefoxOther:new Il,safari8bitdo:new zl,"8bitdo":new Fl,other:new Ml});m(this,xe,t.browserType)}startListening(){}update(t){let e=!1;for(const n of navigator.getGamepads()){if(!n)continue;const s=u(this,yr,Pu).call(this,n);for(let r=0;r<n.buttons.length;++r){const o=s.eventForButton(r,n.buttons[r]);o&&(t.add(o),e=!0)}for(let r=0;r<n.axes.length;++r)s.eventsForAxisValue(r,n.axes[r]).forEach(o=>{t.add(o),e=!0})}return e}connectedGamepadTypes(){return new Set(navigator.getGamepads().filter(Ou).map(t=>_o.detect(t)))}}xe=new WeakMap,Pt=new WeakMap,yr=new WeakSet,Pu=function(t){const e=_o.detect(t);return a(this,xe)==="firefox_windows"||a(this,xe)==="firefox_other"?e==="dualsense"?a(this,xe)==="firefox_windows"?a(this,Pt).firefoxDualSenseWindows:a(this,Pt).firefoxDualSenseOther:e==="8bitdo"?a(this,xe)==="firefox_windows"?a(this,Pt).firefox8bitdoWindows:a(this,Pt).firefox8bitdoOther:a(this,Pt).firefoxOther:e==="8bitdo"?a(this,xe)==="safari"?a(this,Pt).safari8bitdo:a(this,Pt)["8bitdo"]:t.mapping==="standard"?a(this,Pt).standard:a(this,Pt).other};var Ze,Ji;class Sp{constructor(t){b(this,"inputMethod","keyboard");d(this,Ze,new Map([["ArrowLeft","button_left"],["ArrowRight","button_right"],["ArrowUp","button_up"],["ArrowDown","button_down"],["w","button_up"],["W","button_up"],["s","button_down"],["S","button_down"],["a","button_left"],["A","button_left"],["d","button_right"],["D","button_right"],["j","button_a"],["J","button_a"],["k","button_b"],["K","button_b"],["c","button_a"],["C","button_a"],["x","button_b"],["x","button_b"],["p","button_menu"],["P","button_menu"],["Escape","button_menu"],["Enter","button_menu"],["m","mute_unmute_toggle"],["M","mute_unmute_toggle"],["f","full_screen"],["F","full_screen"]]));d(this,Ji,new Set);t.enableDebugToggle&&a(this,Ze).set(";","debug_toggle"),t.enableFrameByFrameControls&&(a(this,Ze).set(",","frame_by_frame_toggle"),a(this,Ze).set(".","frame_by_frame_step"))}startListening(){document.addEventListener("keydown",t=>{const e=a(this,Ze).get(t.key);e&&(t.preventDefault(),a(this,Ji).add(e))}),document.addEventListener("keyup",t=>{const e=a(this,Ze).get(t.key);e&&(t.preventDefault(),a(this,Ji).delete(e))})}update(t){let e=!1;for(const n of a(this,Ji))t.add(n),e=!0;return a(this,Ji).delete("full_screen"),e}}Ze=new WeakMap,Ji=new WeakMap;var Wi;const vr=class vr{constructor(){b(this,"inputMethod","mouse");d(this,Wi,new Set)}startListening(){vr.mapping.forEach(({event:t,selector:e})=>{document.querySelectorAll(e).forEach(n=>{n.addEventListener("mousedown",()=>{a(this,Wi).add(t)}),n.addEventListener("mouseup",()=>{a(this,Wi).delete(t)})})})}update(t){let e=!1;for(const n of a(this,Wi))t.add(n),e=!0;return a(this,Wi).delete("full_screen"),e}};Wi=new WeakMap,b(vr,"mapping",[{event:"button_left",selector:N.selectors.controlsLeft},{event:"button_left",selector:N.selectors.controlsUpLeft},{event:"button_left",selector:N.selectors.controlsDownLeft},{event:"button_right",selector:N.selectors.controlsRight},{event:"button_right",selector:N.selectors.controlsUpRight},{event:"button_right",selector:N.selectors.controlsDownRight},{event:"button_up",selector:N.selectors.controlsUp},{event:"button_up",selector:N.selectors.controlsUpLeft},{event:"button_up",selector:N.selectors.controlsUpRight},{event:"button_down",selector:N.selectors.controlsDown},{event:"button_down",selector:N.selectors.controlsDownLeft},{event:"button_down",selector:N.selectors.controlsDownRight},{event:"button_a",selector:N.selectors.controlsA},{event:"button_b",selector:N.selectors.controlsB},{event:"button_menu",selector:N.selectors.controlsMenu},{event:"mute_unmute_toggle",selector:N.selectors.controlsMuteToggle},{event:"full_screen",selector:N.selectors.controlsFullScreen}]);let Ll=vr;var X,qi,He,Ki,ls,ga,Bl;const K=class K{constructor(){d(this,Ki);d(this,ga);b(this,"inputMethod","touch");d(this,qi,[{bitMask:a(K,X).up|a(K,X).left,events:["button_up","button_left"],requiresStart:!1,selector:N.selectors.controlsUpLeft,elements:[]},{bitMask:a(K,X).up,events:["button_up"],requiresStart:!1,selector:N.selectors.controlsUp,elements:[]},{bitMask:a(K,X).up|a(K,X).right,events:["button_up","button_right"],requiresStart:!1,selector:N.selectors.controlsUpRight,elements:[]},{bitMask:a(K,X).left,events:["button_left"],requiresStart:!1,selector:N.selectors.controlsLeft,elements:[]},{bitMask:a(K,X).right,events:["button_right"],requiresStart:!1,selector:N.selectors.controlsRight,elements:[]},{bitMask:a(K,X).down|a(K,X).left,events:["button_down","button_left"],requiresStart:!1,selector:N.selectors.controlsDownLeft,elements:[]},{bitMask:a(K,X).down,events:["button_down"],requiresStart:!1,selector:N.selectors.controlsDown,elements:[]},{bitMask:a(K,X).down|a(K,X).right,events:["button_down","button_right"],requiresStart:!1,selector:N.selectors.controlsDownRight,elements:[]},{bitMask:a(K,X).a,events:["button_a"],requiresStart:!1,selector:N.selectors.controlsA,elements:[]},{bitMask:a(K,X).b,events:["button_b"],requiresStart:!1,selector:N.selectors.controlsB,elements:[]},{bitMask:a(K,X).menu,events:["button_menu"],requiresStart:!0,selector:N.selectors.controlsMenu,elements:[]},{bitMask:a(K,X).muteUnmute,events:["mute_unmute_toggle"],requiresStart:!0,selector:N.selectors.controlsMuteToggle,elements:[]},{bitMask:a(K,X).fullScreen,events:["full_screen"],requiresStart:!0,selector:N.selectors.controlsFullScreen,elements:[]}]);d(this,He,new Map);a(this,qi).forEach(({selector:t,elements:e})=>{e.push(...document.querySelectorAll(t))})}startListening(){document.addEventListener("touchstart",u(this,Ki,ls).bind(this)),document.addEventListener("touchmove",u(this,Ki,ls).bind(this)),document.addEventListener("touchcancel",u(this,Ki,ls).bind(this)),document.addEventListener("touchend",u(this,Ki,ls).bind(this))}update(t){let e=!1;for(const[n,s]of a(this,He).entries()){for(const{bitMask:r,events:o}of a(this,qi))if((s&r)===r)for(const h of o)t.add(h);s&a(K,X).fullScreen&&a(this,He).set(n,s&~a(K,X).fullScreen)}return e}};X=new WeakMap,qi=new WeakMap,He=new WeakMap,Ki=new WeakSet,ls=function(t){t.preventDefault();for(const e of t.changedTouches)if(t.type==="touchmove"){let n=0;for(const{elements:s,bitMask:r,requiresStart:o}of a(this,qi))!o&&u(this,ga,Bl).call(this,s,e,r)&&(n|=r);a(this,He).set(e.identifier,n)}else if(t.type==="touchstart"){let n=0;for(const{elements:s,bitMask:r,events:o}of a(this,qi))u(this,ga,Bl).call(this,s,e,r)&&(n|=r);a(this,He).set(e.identifier,n)}else(t.type==="touchend"||t.type==="touchcancel")&&a(this,He).delete(e.identifier)},ga=new WeakSet,Bl=function(t,e,n){for(const s of t){const r=s.getBoundingClientRect();if(e.clientX>=r.left-(n&a(K,X).left?r.width:0)&&e.clientX<=r.right+(n&a(K,X).right?r.width:0)&&e.clientY>=r.top-(n&a(K,X).up?r.height:0)&&e.clientY<=r.bottom+(n&a(K,X).down?r.height:0))return!0}return!1},d(K,X,{up:256,down:128,left:64,right:32,a:16,b:8,menu:4,muteUnmute:2,fullScreen:1});let $l=K;var _a,Dn;class Ep{constructor(t){b(this,"gameInputsSpecialized");b(this,"gameInputGamepad");b(this,"gameButtons");b(this,"buttonFullScreen");b(this,"buttonMuteUnmute");b(this,"buttonDebugToggle");b(this,"buttonFrameByFrameToggle");b(this,"buttonFrameByFrameStep");d(this,_a,new Set);d(this,Dn,new Set);this.gameInputGamepad=new Ap({browserType:t.browserType}),this.gameInputsSpecialized=[new Ll,new Sp({enableDebugToggle:t.enableDebugToggle,enableFrameByFrameControls:t.enableFrameByFrameControls}),new $l,this.gameInputGamepad],this.gameButtons=new xp,this.buttonFullScreen=new Ut,this.buttonMuteUnmute=new Ut,this.buttonDebugToggle=new Ut,this.buttonFrameByFrameToggle=new Ut,this.buttonFrameByFrameStep=new Ut}startListening(){for(const t of this.gameInputsSpecialized)t.startListening()}update(t){a(this,Dn).clear();const e=new Set;for(const n of this.gameInputsSpecialized)n.update(e)&&a(this,Dn).add(n.inputMethod);return m(this,_a,e),t.skipGameButtons||this.gameButtons.update(e),this.buttonFullScreen.update(e.has("full_screen")),this.buttonMuteUnmute.update(e.has("mute_unmute_toggle")),this.buttonDebugToggle.update(e.has("debug_toggle")),this.buttonFrameByFrameToggle.update(e.has("frame_by_frame_toggle")),this.buttonFrameByFrameStep.update(e.has("frame_by_frame_step")),N.updatePressedClasses({up:this.gameButtons.isPressed("up"),down:this.gameButtons.isPressed("down"),left:this.gameButtons.isPressed("left"),right:this.gameButtons.isPressed("right"),a:this.gameButtons.isPressed("a"),b:this.gameButtons.isPressed("b"),menu:this.gameButtons.isPressed("menu"),mute:this.buttonMuteUnmute.isPressed,fullscreen:this.buttonFullScreen.isPressed}),e.size>0}getRecentInputMethods(){return a(this,Dn)}getConnectedGamepadTypes(){return this.gameInputGamepad.connectedGamepadTypes()}getEventsCapturedInLastUpdate(){return a(this,_a)}}_a=new WeakMap,Dn=new WeakMap;var Xi,ba,Yi,Un,ji,Je,In,wa,zn;const xr=class xr{constructor(t){d(this,Xi,void 0);d(this,ba,void 0);d(this,Yi,{updateFn:()=>{},renderFn:()=>{}});d(this,Un,void 0);d(this,ji,void 0);d(this,Je,0);d(this,In,0);d(this,wa,5);d(this,zn,t=>{if(a(this,ba).visibilityState==="hidden"){m(this,ji,t),a(this,Xi).call(this,a(this,zn));return}const e=t-(a(this,ji)??t);for(m(this,Je,a(this,Je)+e),m(this,ji,t),m(this,In,0);a(this,Je)>=a(this,Un);)m(this,In,a(this,In)+1),a(this,In)<=a(this,wa)?(a(this,Yi).updateFn(),m(this,Je,a(this,Je)-a(this,Un))):(m(this,Je,0),z.warnBeetPx(`Reached the safety limit of ${a(this,wa)} update calls`));const n=Math.floor(Math.min(1e3/e,xr.renderFpsResultCap));a(this,Yi).renderFn(n),a(this,Xi).call(this,a(this,zn))});m(this,Xi,t.rafFn),m(this,ba,t.documentVisibilityStateProvider),m(this,Un,1e3/t.fixedTimestepFps)}start(t){a(this,Yi).updateFn=t.updateFn,a(this,Yi).renderFn=t.renderFn,m(this,ji,void 0),m(this,Je,0),a(this,Xi).call(this,a(this,zn))}};Xi=new WeakMap,ba=new WeakMap,Yi=new WeakMap,Un=new WeakMap,ji=new WeakMap,Je=new WeakMap,In=new WeakMap,wa=new WeakMap,zn=new WeakMap,b(xr,"renderFpsResultCap",999);let Gl=xr;var ya;const ms=class ms{isFullScreenSupported(){return a(ms,ya)}static create(){return a(ms,ya)?new Cp:new kp}};ya=new WeakMap,d(ms,ya,!!(!(typeof document>"u")&&(document.fullscreenEnabled||document.webkitFullscreenEnabled)));let Ts=ms;class kp extends Ts{constructor(){super(),document.querySelectorAll(N.selectors.controlsFullScreen).forEach(t=>{t.style.display="none"})}isInFullScreen(){return!1}toggleFullScreen(){}}var Qi,va,xa,Ar,Du,Sr,Uu;class Cp extends Ts{constructor(){super();d(this,Ar);d(this,Sr);d(this,Qi,void 0);d(this,va,void 0);d(this,xa,void 0);const e=document.querySelector(N.selectors.fullScreenSubject);if(!e)throw Error(`Was unable to find a full screen subject by selector '${N.selectors.fullScreenSubject}'`);m(this,Qi,e);const n=a(this,Qi).requestFullscreen??a(this,Qi).webkitRequestFullscreen??(()=>{});m(this,va,n.bind(a(this,Qi)));const s=document.exitFullscreen??document.webkitExitFullscreen??(()=>{});m(this,xa,s.bind(document))}isInFullScreen(){return!!(document.fullscreenElement||document.webkitFullscreenElement)}toggleFullScreen(){this.isInFullScreen()?u(this,Sr,Uu).call(this):u(this,Ar,Du).call(this)}}Qi=new WeakMap,va=new WeakMap,xa=new WeakMap,Ar=new WeakSet,Du=function(){const e=a(this,va).call(this);typeof e=="object"&&e.catch(n=>{z.errorBeetPx(n)})},Sr=new WeakSet,Uu=function(){const e=a(this,xa).call(this);typeof e=="object"&&e.catch(n=>{z.errorBeetPx(n)})};function Iu(i){return new Promise(t=>{setTimeout(()=>t(),i)})}var Er,Nn,Aa;class Rp{constructor(t){d(this,Er,Iu(750));d(this,Nn,void 0);d(this,Aa,void 0);m(this,Nn,document.querySelector(N.selectors.startButton)??en(`Unable to find a start button under a selector "${N.selectors.startButton}"`)),m(this,Aa,new Promise(e=>{a(this,Nn).addEventListener("click",()=>{t.onStartClicked(),e()})}))}async showStartScreen(){await a(this,Er),N.addLoadedClass(),a(this,Nn).focus(),await a(this,Aa),N.addStartedClass()}}Er=new WeakMap,Nn=new WeakMap,Aa=new WeakMap;var We,Ln,Ae;const mi=class mi{static enable(){m(this,We,!0)}static get isActive(){return a(this,We)?a(this,Ae):!1}static get wasJustActivated(){return a(this,We)?a(this,Ae)&&!a(this,Ln):!1}static get wasJustDeactivated(){return a(this,We)?!a(this,Ae)&&a(this,Ln):!1}static update(){if(a(this,We)){if(mi.wasJustActivated){for(const t of St.playbacksToPauseOnGamePause)t.pauseByEngine();for(const t of St.playbacksToMuteOnGamePause)t.muteByEngine()}else if(mi.wasJustDeactivated){for(const t of St.playbacksToPauseOnGamePause)t.resumeByEngine();for(const t of St.playbacksToMuteOnGamePause)t.unmuteByEngine()}m(this,Ln,a(this,Ae))}}static activate(){m(this,Ae,!0)}static deactivate(){m(this,Ae,!1)}};We=new WeakMap,Ln=new WeakMap,Ae=new WeakMap,d(mi,We,!1),d(mi,Ln,!1),d(mi,Ae,!1);let xt=mi;var $n;const fn=class fn{savePersistedState(t){window.localStorage.setItem(a(fn,$n),JSON.stringify(t,null,2))}loadPersistedState(){const t=window.localStorage.getItem(a(fn,$n));return t?JSON.parse(t):null}clearPersistedState(){window.localStorage.removeItem(a(fn,$n))}};$n=new WeakMap,d(fn,$n,"game_stored_state");let Zl=fn;var qe,Bn,kr,Sa,Ea,ka,Gn,Ca,Ra,Zn,Ta,Fa,re,Se,Ma,Oa,Hn,Cr,zu;class Tp{constructor(t={}){d(this,Cr);d(this,qe,void 0);d(this,Bn,void 0);b(this,"canvasSize");d(this,kr,Q.fromCssHex("#000000"));d(this,Sa,void 0);b(this,"gameInput");d(this,Ea,void 0);b(this,"audioApi");b(this,"fullScreen");b(this,"storageApi");d(this,ka,void 0);b(this,"assets");d(this,Gn,void 0);b(this,"drawApi");d(this,Ca,void 0);d(this,Ra,!1);b(this,"isInsideDrawOrStartedCallback",!1);d(this,Zn,void 0);d(this,Ta,void 0);d(this,Fa,void 0);d(this,re,0);d(this,Se,0);d(this,Ma,1);d(this,Oa,!1);d(this,Hn,!1);var r,o,h,f,l,c,_,g;t.canvasSize??(t.canvasSize="128x128"),t.fixedTimestep??(t.fixedTimestep="60fps"),window.addEventListener("error",p=>{var y;return N.showError(p.message),(y=this.audioApi)==null||y.getAudioContext().suspend().then(()=>{}),!0}),window.addEventListener("unhandledrejection",p=>{var y;N.showError(p.reason),(y=this.audioApi)==null||y.getAudioContext().suspend().then(()=>{})}),(r=t.globalPause)!=null&&r.available&&xt.enable(),Xt.loadFromStorage(),(o=t.debugMode)!=null&&o.available?t.debugMode.forceEnabledOnStart&&(Xt.enabled=!0):Xt.enabled=!1,(h=t.frameByFrame)!=null&&h.available&&((f=t.frameByFrame)!=null&&f.activateOnStart)&&(si.active=!0),z.debugBeetPx("Engine init params:",t),m(this,qe,t.assets??[]),a(this,qe).push(...uo.spriteSheetUrls),a(this,qe).push(...op.spriteSheetUrls),a(this,qe).push(...hp.spriteSheetUrls);const e=t.fixedTimestep==="60fps"?60:t.fixedTimestep==="30fps"?30:en(`Unsupported fixedTimestep: "${t.fixedTimestep}"`);m(this,Bn,np.detect(navigator.userAgent)),this.canvasSize=t.canvasSize==="64x64"?et(64,64):t.canvasSize==="128x128"?et(128,128):t.canvasSize==="256x256"?et(256,256):en(`Unsupported canvasSize: "${t.canvasSize}"`),this.gameInput=new Ep({enableDebugToggle:((l=t.debugMode)==null?void 0:l.available)??!1,enableFrameByFrameControls:((c=t.frameByFrame)==null?void 0:c.available)??!1,browserType:a(this,Bn)}),m(this,Ea,new Gl({fixedTimestepFps:e,rafFn:window.requestAnimationFrame.bind(window),documentVisibilityStateProvider:document})),this.storageApi=new Zl;const n=new AudioContext;this.assets=new Bd,m(this,ka,new $d(this.assets,{decodeAudioData:p=>n.decodeAudioData(p)})),this.audioApi=new yi(this.assets,n),m(this,Sa,new Rp({onStartClicked:()=>{this.audioApi.tryToResumeAudioContextSuspendedByBrowserForSecurityReasons().then(p=>{p&&m(this,Hn,!0)})}})),this.fullScreen=Ts.create();const s=document.querySelector(N.selectors.canvas)??en(`Was unable to find <canvas> by selector '${N.selectors.canvas}'`);m(this,Gn,new rp(this.canvasSize,s,a(this,kr))),this.drawApi=new vp({canvas:a(this,Gn),assets:this.assets}),(g=(_=t.debugMode)==null?void 0:_.fpsDisplay)!=null&&g.enabled&&m(this,Ca,new dp(this.drawApi,this.canvasSize,{color:t.debugMode.fpsDisplay.color,placement:t.debugMode.fpsDisplay.placement}))}get frameNumber(){return a(this,re)}get frameNumberOutsidePause(){return a(this,Se)}get renderingFps(){return a(this,Ma)}get detectedBrowserType(){return a(this,Bn)}async init(){return await a(this,ka).loadAssets(a(this,qe)),{startGame:u(this,Cr,zu).bind(this)}}setOnStarted(t){m(this,Zn,t)}setOnUpdate(t){m(this,Ta,t)}setOnDraw(t){m(this,Fa,t)}restart(){var t;m(this,re,0),m(this,Se,0),this.audioApi.restart(),this.drawApi.clearCanvas(up),St.playbacksToPauseOnGamePause.clear(),St.playbacksToMuteOnGamePause.clear(),xt.deactivate(),this.isInsideDrawOrStartedCallback=!0,(t=a(this,Zn))==null||t.call(this),this.isInsideDrawOrStartedCallback=!1}}qe=new WeakMap,Bn=new WeakMap,kr=new WeakMap,Sa=new WeakMap,Ea=new WeakMap,ka=new WeakMap,Gn=new WeakMap,Ca=new WeakMap,Ra=new WeakMap,Zn=new WeakMap,Ta=new WeakMap,Fa=new WeakMap,re=new WeakMap,Se=new WeakMap,Ma=new WeakMap,Oa=new WeakMap,Hn=new WeakMap,Cr=new WeakSet,zu=async function(){var t;if(a(this,Ra))throw Error("Tried to start a game, but it is already started");m(this,Ra,!0),window.BEETPX__IS_PROD&&window.addEventListener("beforeunload",e=>(e.preventDefault(),e.returnValue="","")),m(this,re,0),m(this,Se,0),await a(this,Sa).showStartScreen(),this.isInsideDrawOrStartedCallback=!0,(t=a(this,Zn))==null||t.call(this),this.isInsideDrawOrStartedCallback=!1,this.gameInput.startListening(),a(this,Ea).start({updateFn:()=>{var s;this.gameInput.buttonFullScreen.wasJustPressed&&this.fullScreen.toggleFullScreen(),this.gameInput.buttonMuteUnmute.wasJustPressed&&(this.audioApi.isAudioMuted()?this.audioApi.unmuteAudio():this.audioApi.muteAudio()),this.gameInput.gameButtons.wasJustPressed("menu")&&(xt.isActive?xt.deactivate():xt.activate()),xt.update(),this.gameInput.buttonDebugToggle.wasJustPressed&&(Xt.enabled=!Xt.enabled),this.gameInput.buttonFrameByFrameToggle.wasJustPressed&&(si.active=!si.active);const e=!si.active||this.gameInput.buttonFrameByFrameStep.wasJustPressed;this.gameInput.update({skipGameButtons:!e})&&!a(this,Hn)&&this.audioApi.tryToResumeAudioContextSuspendedByBrowserForSecurityReasons().then(r=>{r&&m(this,Hn,!0)}),e&&(si.active&&z.infoBeetPx(`Running onUpdate for frame: ${a(this,re)}`),(s=a(this,Ta))==null||s.call(this),m(this,Oa,!0),m(this,re,a(this,re)>=Number.MAX_SAFE_INTEGER?0:a(this,re)+1),xt.isActive||m(this,Se,a(this,Se)>=Number.MAX_SAFE_INTEGER?0:a(this,Se)+1))},renderFn:e=>{var n,s;m(this,Ma,e),this.isInsideDrawOrStartedCallback=!0,a(this,Oa)&&((n=a(this,Fa))==null||n.call(this),Xt.enabled&&((s=a(this,Ca))==null||s.drawRenderingFps(e))),this.isInsideDrawOrStartedCallback=!1,a(this,Gn).render()}})};function Fp(i,t){return i>0?((t==null?void 0:t.onGamePause)==="ignore"?Rt.frameNumber:Rt.frameNumberOutsidePause)%(i*2)<i:!0}function Nu(){return[P.of(-1,-1),P.of(0,-1),P.of(1,-1),P.of(1,0),P.of(1,1),P.of(0,1),P.of(-1,1),P.of(-1,0)]}function Mp(i,t,e,n,s){for(const r of Nu())Rt.draw.text(i,t.add(r),n,{centerXy:s==null?void 0:s.centerXy,scaleXy:s==null?void 0:s.scaleXy});Rt.draw.text(i,t,e,{centerXy:s==null?void 0:s.centerXy,scaleXy:s==null?void 0:s.scaleXy})}function Op(){return[P.of(-1,-1),P.of(1,-1),P.of(1,1),P.of(-1,1)]}function Pp(i){if(!(i.length<=0))return i[Math.floor(Math.random()*i.length)]}function Dp(i,t){i=i>0?Math.round(i):0;const e=new Array(i*t.length);for(let n=0;n<e.length;n++)e[n]=t[Math.floor(n/i)];return e}var Ke,R,T;const w=class w{static async init(t){z.infoBeetPx(`BeetPx ${window.BEETPX__VERSION} : Initializing…`),m(this,Ke,new Tp(t));const{startGame:e}=await a(this,Ke).init();return z.infoBeetPx(`BeetPx ${window.BEETPX__VERSION} : Initialized`),{startGame:e}}static get debug(){return Xt.enabled}static get canvasSize(){return u(this,R,T).call(this).canvasSize}static get frameNumber(){return u(this,R,T).call(this).frameNumber}static get frameNumberOutsidePause(){return u(this,R,T).call(this).frameNumberOutsidePause}static get renderingFps(){return u(this,R,T).call(this).renderingFps}static get detectedBrowserType(){return u(this,R,T).call(this).detectedBrowserType}static get isPaused(){return xt.isActive}static get wasJustPaused(){return xt.wasJustActivated}static get wasJustResumed(){return xt.wasJustDeactivated}static pause(){xt.activate()}static resume(){xt.deactivate()}};Ke=new WeakMap,R=new WeakSet,T=function(t){if(!a(this,Ke))throw Error("Tried to access BeetPx API without calling BeetPx.init(…) first.");return t&&!a(this,Ke).isInsideDrawOrStartedCallback&&z.warnBeetPx(`Used "${t}" outside of either "setOnDraw" or "setOnStarted" callback.`),a(this,Ke)},d(w,R),d(w,Ke,void 0),b(w,"setOnStarted",(...t)=>{var e;return u(e=w,R,T).call(e).setOnStarted(...t)}),b(w,"setOnUpdate",(...t)=>{var e;return u(e=w,R,T).call(e).setOnUpdate(...t)}),b(w,"setOnDraw",(...t)=>{var e;return u(e=w,R,T).call(e).setOnDraw(...t)}),b(w,"restart",(...t)=>{var e;return u(e=w,R,T).call(e).restart(...t)}),b(w,"logDebug",(...t)=>z.debug(...t)),b(w,"logInfo",(...t)=>z.info(...t)),b(w,"logWarn",(...t)=>z.warn(...t)),b(w,"logError",(...t)=>z.error(...t)),b(w,"wasAnyButtonJustPressed",(...t)=>{var e;return u(e=w,R,T).call(e).gameInput.gameButtons.wasAnyJustPressed(...t)}),b(w,"wasButtonJustPressed",(...t)=>{var e;return u(e=w,R,T).call(e).gameInput.gameButtons.wasJustPressed(...t)}),b(w,"wasButtonJustReleased",(...t)=>{var e;return u(e=w,R,T).call(e).gameInput.gameButtons.wasJustReleased(...t)}),b(w,"isAnyButtonPressed",(...t)=>{var e;return u(e=w,R,T).call(e).gameInput.gameButtons.isAnyPressed(...t)}),b(w,"isButtonPressed",(...t)=>{var e;return u(e=w,R,T).call(e).gameInput.gameButtons.isPressed(...t)}),b(w,"getPressedDirection",(...t)=>{var e;return u(e=w,R,T).call(e).gameInput.gameButtons.getPressedDirection(...t)}),b(w,"setButtonRepeating",(...t)=>{var e;return u(e=w,R,T).call(e).gameInput.gameButtons.setButtonRepeating(...t)}),b(w,"getRecentInputMethods",(...t)=>{var e;return u(e=w,R,T).call(e).gameInput.getRecentInputMethods(...t)}),b(w,"getConnectedGamepadTypes",(...t)=>{var e;return u(e=w,R,T).call(e).gameInput.getConnectedGamepadTypes(...t)}),b(w,"getEventsCapturedInLastUpdate",(...t)=>{var e;return u(e=w,R,T).call(e).gameInput.getEventsCapturedInLastUpdate(...t)}),b(w,"isAudioMuted",(...t)=>{var e;return u(e=w,R,T).call(e).audioApi.isAudioMuted(...t)}),b(w,"muteAudio",(...t)=>{var e;return u(e=w,R,T).call(e).audioApi.muteAudio(...t)}),b(w,"unmuteAudio",(...t)=>{var e;return u(e=w,R,T).call(e).audioApi.unmuteAudio(...t)}),b(w,"startPlayback",(...t)=>{var e;return u(e=w,R,T).call(e).audioApi.startPlayback(...t)}),b(w,"startPlaybackLooped",(...t)=>{var e;return u(e=w,R,T).call(e).audioApi.startPlaybackLooped(...t)}),b(w,"startPlaybackSequence",(...t)=>{var e;return u(e=w,R,T).call(e).audioApi.startPlaybackSequence(...t)}),b(w,"mutePlayback",(...t)=>{var e;return u(e=w,R,T).call(e).audioApi.mutePlayback(...t)}),b(w,"unmutePlayback",(...t)=>{var e;return u(e=w,R,T).call(e).audioApi.unmutePlayback(...t)}),b(w,"stopPlayback",(...t)=>{var e;return u(e=w,R,T).call(e).audioApi.stopPlayback(...t)}),b(w,"pausePlayback",(...t)=>{var e;return u(e=w,R,T).call(e).audioApi.pausePlayback(...t)}),b(w,"resumePlayback",(...t)=>{var e;return u(e=w,R,T).call(e).audioApi.resumePlayback(...t)}),b(w,"getAudioContext",(...t)=>{var e;return u(e=w,R,T).call(e).audioApi.getAudioContext(...t)}),b(w,"isFullScreenSupported",(...t)=>{var e;return u(e=w,R,T).call(e).fullScreen.isFullScreenSupported(...t)}),b(w,"isInFullScreen",(...t)=>{var e;return u(e=w,R,T).call(e).fullScreen.isInFullScreen(...t)}),b(w,"toggleFullScreen",(...t)=>{var e;return u(e=w,R,T).call(e).fullScreen.toggleFullScreen(...t)}),b(w,"savePersistedState",(...t)=>{var e;return u(e=w,R,T).call(e).storageApi.savePersistedState(...t)}),b(w,"loadPersistedState",(...t)=>{var e;return u(e=w,R,T).call(e).storageApi.loadPersistedState(...t)}),b(w,"clearPersistedState",(...t)=>{var e;return u(e=w,R,T).call(e).storageApi.clearPersistedState(...t)}),b(w,"getImageAsset",(...t)=>{var e;return u(e=w,R,T).call(e).assets.getImageAsset(...t)}),b(w,"getSoundAsset",(...t)=>{var e;return u(e=w,R,T).call(e).assets.getSoundAsset(...t)}),b(w,"getJsonAsset",(...t)=>{var e;return u(e=w,R,T).call(e).assets.getJsonAsset(...t)}),b(w,"draw",{clearCanvas(t){var e;u(e=w,R,T).call(e,"clearCanvas").drawApi.clearCanvas(t)},setClippingRegion(t,e){var n;return u(n=w,R,T).call(n,"setClippingRegion").drawApi.setClippingRegion(t,e)},removeClippingRegion(){var t;return u(t=w,R,T).call(t,"removeClippingRegion").drawApi.removeClippingRegion()},setCameraXy(t){var e;return u(e=w,R,T).call(e,"setCameraXy").drawApi.setCameraXy(t)},setDrawingPattern(t){var e;return u(e=w,R,T).call(e,"setDrawingPattern").drawApi.setDrawingPattern(t)},pixel(t,e){var n;u(n=w,R,T).call(n,"pixel").drawApi.drawPixel(t,e)},pixels(t,e,n,s){var r;u(r=w,R,T).call(r,"pixels").drawApi.drawPixels(t,e,n,s)},line(t,e,n){var s;u(s=w,R,T).call(s,"line").drawApi.drawLine(t,e,n)},rect(t,e,n){var s;u(s=w,R,T).call(s,"rect").drawApi.drawRect(t,e,n)},rectFilled(t,e,n){var s;u(s=w,R,T).call(s,"rectFilled").drawApi.drawRectFilled(t,e,n)},rectOutsideFilled(t,e,n){var s;u(s=w,R,T).call(s,"rectOutsideFilled").drawApi.drawRectOutsideFilled(t,e,n)},ellipse(t,e,n){var s;u(s=w,R,T).call(s,"ellipse").drawApi.drawEllipse(t,e,n)},ellipseFilled(t,e,n){var s;u(s=w,R,T).call(s,"ellipseFilled").drawApi.drawEllipseFilled(t,e,n)},ellipseOutsideFilled(t,e,n){var s;u(s=w,R,T).call(s,"ellipseOutsideFilled").drawApi.drawEllipseOutsideFilled(t,e,n)},setSpriteColorMapping(t){var e;return u(e=w,R,T).call(e,"setSpriteColorMapping").drawApi.setSpriteColorMapping(t)},sprite(t,e,n){var s;u(s=w,R,T).call(s,"sprite").drawApi.drawSprite(t,e,n)},useFont(t){var e;return u(e=w,R,T).call(e,"useFont").drawApi.useFont(t)},setTextColorMarkers(t){var e;return u(e=w,R,T).call(e,"setTextColorMarkers").drawApi.setTextColorMarkers(t)},measureText(t,e){var n;return u(n=w,R,T).call(n,"measureText").drawApi.measureText(t,e)},text(t,e,n,s){var r;u(r=w,R,T).call(r,"text").drawApi.drawText(t,e,n,s)},takeCanvasSnapshot(){var t;u(t=w,R,T).call(t,"takeCanvasSnapshot").drawApi.takeCanvasSnapshot()}}),b(w,"utils",{assertUnreachable:Kl,booleanChangingEveryNthFrame:Fp,clamp:Kn,drawTextWithOutline:Mp,identity:Xl,isDefined:Ou,lerp:rl,mod:gi,noop:yl,offset4Directions:Op,offset8Directions:Nu,randomElementOf:Pp,range:nr,repeatEachElement:Dp,throwError:en,trigAtan2:yh,trigCos:vh,trigSin:xh,wait:Iu});let Rt=w;const q=Rt,Yt=Rt.draw,er=Rt.utils;var Dt,Vi,Pa,Ee,tn,ke,Xe,un,le,Re;const po=class po{constructor(t){d(this,Xe);d(this,le);d(this,Dt,void 0);d(this,Vi,void 0);d(this,Pa,void 0);d(this,Ee,void 0);d(this,tn,void 0);d(this,ke,void 0);m(this,Pa,t.onGamePause==="ignore"),m(this,Dt,Math.max(0,Math.round(t.frames))),m(this,Vi,t.loop),m(this,tn,a(this,Xe,un)+t.delayFrames),m(this,Ee,!1),m(this,ke,null),t.pause&&this.pause()}static for(t){return new po(t)}get t(){return a(this,Vi)?a(this,le,Re)>=0?gi(a(this,le,Re),a(this,Dt)):0:Kn(0,a(this,le,Re),a(this,Dt))}get framesLeft(){return a(this,Dt)-this.t}get progress(){return a(this,Dt)>0?this.t/a(this,Dt):1}get hasFinished(){return a(this,le,Re)>=a(this,Dt)}get hasJustFinished(){return a(this,Dt)>0?a(this,Vi)?a(this,le,Re)>0&&this.t===0:a(this,le,Re)===a(this,Dt):a(this,Vi)?!0:a(this,le,Re)===0}pause(){a(this,Ee)||(m(this,Ee,!0),m(this,ke,a(this,Xe,un)))}resume(){a(this,Ee)&&(m(this,Ee,!1),m(this,tn,a(this,tn)+(a(this,Xe,un)-(a(this,ke)??0))),m(this,ke,null))}restart(){m(this,tn,a(this,Xe,un)),m(this,ke,null),m(this,Ee,!1)}};Dt=new WeakMap,Vi=new WeakMap,Pa=new WeakMap,Ee=new WeakMap,tn=new WeakMap,ke=new WeakMap,Xe=new WeakSet,un=function(){return a(this,Pa)?Rt.frameNumber:Rt.frameNumberOutsidePause},le=new WeakSet,Re=function(){return(a(this,ke)??a(this,Xe,un))-a(this,tn)};let nn=po;var Jn,Ye;const mo=class mo{constructor(t,e){b(this,"type","animated");b(this,"imageUrl");b(this,"size");d(this,Jn,void 0);d(this,Ye,void 0);this.imageUrl=t.imageUrl,this.size=P.of(t.w,t.h).abs().round(),m(this,Jn,t.xys.map(([n,s])=>_s.from(t.imageUrl,t.w,t.h,n,s))),m(this,Ye,nn.for({frames:a(this,Jn).length,loop:!0,pause:e.pause??!1,delayFrames:0,onGamePause:e.onGamePause}))}static from(t,e,n,s,r){return new mo({imageUrl:t,w:e,h:n,xys:s},{pause:(r==null?void 0:r.pause)??!1,onGamePause:(r==null?void 0:r.onGamePause)??"pause"})}get current(){return a(this,Jn)[a(this,Ye).t]}pause(){a(this,Ye).pause()}resume(){a(this,Ye).resume()}restart(){a(this,Ye).restart()}};Jn=new WeakMap,Ye=new WeakMap;let Hl=mo;var Da,Rr;class Jl{constructor(){d(this,Da,fp(q.canvasSize.x,{loop:!0}));d(this,Rr,lp("animation.png")(48,48,er.repeatEachElement(4,er.range(12).map(t=>[48*t,0]))))}draw(){Yt.sprite(a(this,Rr).current,et(a(this,Da).t,q.canvasSize.y*(.5+.5*er.trigCos(a(this,Da).progress))),{centerXy:[!0,!0]})}}Da=new WeakMap,Rr=new WeakMap,b(Jl,"assetUrls",["animation.png"]);class ds{constructor(){q.startPlaybackLooped("music_base.flac",{onGamePause:"ignore"}),q.startPlaybackLooped("music_melody.flac",{onGamePause:"mute"})}}b(ds,"assetUrls",["music_base.flac","music_melody.flac"]),b(ds,"beatFrames",32);var Tr,kt;const Fr=class Fr{constructor(){d(this,kt,0)}update(){q.wasJustPaused&&m(this,kt,0),q.wasButtonJustPressed("a")&&(a(this,kt)===0?q.resume():a(this,kt)===1?q.isAudioMuted()?q.unmuteAudio():q.muteAudio():a(this,kt)===2&&q.restart()),q.wasButtonJustPressed("b")&&q.resume(),q.wasButtonJustPressed("down")&&m(this,kt,a(this,kt)+1),q.wasButtonJustPressed("up")&&m(this,kt,a(this,kt)-1),m(this,kt,er.mod(a(this,kt),3))}draw(){Yt.takeCanvasSnapshot(),Yt.rectFilled(Rs,q.canvasSize,al.of(a(Fr,Tr)));const t=s=>et(8+(a(this,kt)===s?4:0),8+s*20),e=s=>a(this,kt)===s?Vn.white:Vn.slate,n={scaleXy:et(3,3)};Yt.text("resume",t(0),e(0),n),Yt.text(q.isAudioMuted()?"unmute":"mute",t(1),e(1),n),Yt.text("restart",t(2),e(2),n)}};Tr=new WeakMap,kt=new WeakMap,d(Fr,Tr,(t,e,n)=>t?jt(t.r*.35,t.g*.35,t.b*.35):null);let Wl=Fr;var Mr,Wn,qn;const Or=class Or{constructor(t){d(this,Wn,void 0);d(this,qn,void 0);m(this,Wn,t.loopFrames),m(this,qn,Ru({intro:[["a",t.loopFrames-9],["b",2]],loop:[["a",t.loopFrames-2],["b",2]]},{onGamePause:"ignore"}))}draw(){Yt.setDrawingPattern(a(Or,Mr));const t=16;[et(2,2),et(2,q.canvasSize.y-t-2),et(q.canvasSize.x-t-2,2),et(q.canvasSize.x-t-2,q.canvasSize.y-t-2)].forEach(e=>{const n=(a(this,Wn)-a(this,qn).framesLeft)/a(this,Wn);Yt.rectFilled(e,et(t).mul(hn.outQuadratic(n)),a(this,qn).currentPhase==="a"?Vn.moss:Vn.orange)}),Yt.setDrawingPattern(gs.primaryOnly)}};Mr=new WeakMap,Wn=new WeakMap,qn=new WeakMap,d(Or,Mr,gs.from(`
    ##--
    ##--
    --##
    --##
  `));let ql=Or;q.init({canvasSize:"256x256",assets:[...Jl.assetUrls,...ds.assetUrls],globalPause:{available:!0}}).then(async({startGame:i})=>{const t=new Wl;let e,n;q.setOnStarted(()=>{new ds,e=new Jl,n=new ql({loopFrames:ds.beatFrames})}),q.setOnUpdate(()=>{q.isPaused&&t.update()}),q.setOnDraw(()=>{Yt.clearCanvas(Vn.storm),n.draw(),e.draw(),q.isPaused&&t.draw()}),await i()});
