var Ou=Object.defineProperty;var Fu=(i,e,t)=>e in i?Ou(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var b=(i,e,t)=>(Fu(i,typeof e!="symbol"?e+"":e,t),t),Or=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var a=(i,e,t)=>(Or(i,e,"read from private field"),t?t.call(i):e.get(i)),d=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},g=(i,e,t,n)=>(Or(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t);var u=(i,e,t)=>(Or(i,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();var Ss;const eo=class eo{constructor(e){b(this,"type","canvas_snapshot_mapping");d(this,Ss,void 0);g(this,Ss,e)}static of(e){return new eo(e)}getMappedColor(e,t,n){return e?a(this,Ss).call(this,e.getColorAt(t,n),t,n):null}};Ss=new WeakMap;let jr=eo;class j{constructor(e,t,n){b(this,"type","rgb");b(this,"r");b(this,"g");b(this,"b");b(this,"cssHex");this.r=Math.min(Math.max(0,Math.round(e)),255),this.g=Math.min(Math.max(0,Math.round(t)),255),this.b=Math.min(Math.max(0,Math.round(n)),255),this.cssHex="#"+e.toString(16).padStart(2,"0")+t.toString(16).padStart(2,"0")+n.toString(16).padStart(2,"0")}static of(e,t,n){return new j(e,t,n)}static fromCssHex(e){if(!/^#[0-9a-fA-F]{6}$/.test(e))throw Error("Hexadecimal representation of the color doesn't contain exactly 6 hexadecimal digits, preceded by a single '#'");return new j(parseInt(e.slice(1,3),16),parseInt(e.slice(3,5),16),parseInt(e.slice(5,7),16))}isSameAs(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}asArray(){return[this.r,this.g,this.b]}}class it{}b(it,"black",j.fromCssHex("#000000")),b(it,"storm",j.fromCssHex("#1D2B53")),b(it,"wine",j.fromCssHex("#7E2553")),b(it,"moss",j.fromCssHex("#008751")),b(it,"tan",j.fromCssHex("#AB5236")),b(it,"slate",j.fromCssHex("#5F574F")),b(it,"silver",j.fromCssHex("#C2C3C7")),b(it,"white",j.fromCssHex("#FFF1E8")),b(it,"ember",j.fromCssHex("#FF004D")),b(it,"orange",j.fromCssHex("#FFA300")),b(it,"lemon",j.fromCssHex("#FFEC27")),b(it,"lime",j.fromCssHex("#00E436")),b(it,"sky",j.fromCssHex("#29ADFF")),b(it,"dusk",j.fromCssHex("#83769C")),b(it,"pink",j.fromCssHex("#FF77A8")),b(it,"peach",j.fromCssHex("#FFCCAA"));var ks;const on=class on{constructor(e){b(this,"type","sprite_mapping");d(this,ks,void 0);g(this,ks,e)}static from(e){const t=new Map(e.map(([n,s])=>[n.cssHex,s]));return new on((n,s,r)=>{if(!n)return n;const o=t.get(n.cssHex);return typeof o>"u"?n:o})}static of(e){return new on(e)}getMappedColor(e,t,n){return a(this,ks).call(this,e,t,n)}};ks=new WeakMap,b(on,"noMapping",new on((e,t,n)=>e));let Xa=on;var Cs;const Ce=class Ce{constructor(e){d(this,Cs,void 0);if(e<0||e>65535)throw Error("BpxPatter: bits representation of the pattern is out of range of valid values. The value should be in range of 0b0000_0000_0000_0000 to 0b1111_1111_1111_1111.");g(this,Cs,e)}static from(e){e=e.replace(/\s/g,"");const t=e.search(/[^#-]/);if(t>=0)throw Error(`BpxPattern.from: Unexpected character found: "${e[t]}"`);if(e.length!==16)throw Error(`BpxPattern.from: Unexpected amount of # and - symbols. There should be 16 of them (4 rows x 4 columns), but instead there is: ${e.length}`);let n=0;for(let s=0;s<16;++s)e[s]==="#"&&(n|=1<<15-s);return new Ce(n)}static of(e){return new Ce(e)}hasPrimaryColorAt(e,t){const n=e%4,s=t%4,r=4*4-(s*4+n)-1;return!!(a(this,Cs)&1<<r)}};Cs=new WeakMap,b(Ce,"primaryOnly",Ce.of(65535)),b(Ce,"secondaryOnly",Ce.of(0));let Qr=Ce;function Hn(i,e,t){return i<e?e<t?e:i<t?t:i:e>t?e:i>t?t:i}function Vr(i,e,t,n){const s=i+(e-i)*t;return n!=null&&n.clamp?Hn(i,s,e):s}function di(i,e){return e===0?0:(i%e+e)%e}function ch(i,e){return(Math.atan2(e,i)/Math.PI/2+1)%1}function dh(i){return Math.cos(i*Math.PI*2)}function ph(i){return Math.sin(i*Math.PI*2)}class D{constructor(e,t){this.x=e,this.y=t}static unitFromAngle(e){return new D(dh(e),ph(e))}static of(e,t){return new D(e,t??e)}static min(e,t){return new D(Math.min(e.x,t.x),Math.min(e.y,t.y))}static max(e,t){return new D(Math.max(e.x,t.x),Math.max(e.y,t.y))}static minMax(e,t){return[D.min(e,t),D.max(e,t)]}static lerp(e,t,n,s){return new D(Vr(e.x,t.x,n,s),Vr(e.y,t.y,n,s))}asArray(){return[this.x,this.y]}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const e=this.magnitude();return new D(this.x/e,this.y/e)}sign(){return new D(Math.sign(this.x),Math.sign(this.y))}abs(){return new D(Math.abs(this.x),Math.abs(this.y))}floor(){return new D(Math.floor(this.x),Math.floor(this.y))}ceil(){return new D(Math.ceil(this.x),Math.ceil(this.y))}round(){return new D(Math.round(this.x),Math.round(this.y))}toAngle(){return ch(this.x,this.y)}eq(e){return typeof e!="number"?this.x===e.x&&this.y===e.y:this.x===e&&this.y===e}gt(e){return typeof e!="number"?this.x>e.x&&this.y>e.y:this.x>e&&this.y>e}gte(e){return typeof e!="number"?this.x>=e.x&&this.y>=e.y:this.x>=e&&this.y>=e}lt(e){return typeof e!="number"?this.x<e.x&&this.y<e.y:this.x<e&&this.y<e}lte(e){return typeof e!="number"?this.x<=e.x&&this.y<=e.y:this.x<=e&&this.y<=e}clamp(e,t){return new D(Hn(e.x,this.x,t.x),Hn(e.y,this.y,t.y))}mod(e,t){return typeof e!="number"?new D(di(this.x,e.x),di(this.y,e.y)):new D(di(this.x,e),di(this.y,t??e))}add(e,t){return typeof e!="number"?new D(this.x+e.x,this.y+e.y):new D(this.x+e,this.y+(t??e))}sub(e,t){return typeof e!="number"?new D(this.x-e.x,this.y-e.y):new D(this.x-e,this.y-(t??e))}mul(e,t){return typeof e!="number"?new D(this.x*e.x,this.y*e.y):new D(this.x*e,this.y*(t??e))}div(e,t){return typeof e!="number"?new D(this.x/e.x,this.y/e.y):new D(this.x/e,this.y/(t??e))}*[Symbol.iterator](){yield this.x,yield this.y}[Symbol.toPrimitive](e){switch(e){case"default":case"string":return`(${this.x},${this.y})`;case"number":return NaN}}get[Symbol.toStringTag](){return"BpxVector2d"}__printDebug(){return`(${this.x},${this.y})`}}class Sr{constructor(e){b(this,"asciiRows");b(this,"size");this.asciiRows=e.split(`
`).map(n=>n.replace(/\s/g,"")).filter(n=>n.length>0);let t=0;for(const n of this.asciiRows){const s=n.search(/[^#-]/);if(s>=0)throw Error(`DrawPixels.draw: Unexpected character found: "${n[s]}"`);t=Math.max(t,n.length)}this.size=D.of(t,this.asciiRows.length)}static from(e){return new Sr(e)}}function Nl(i){throw Error("Somehow reached the unreachable code ¯\\_(ツ)_/¯")}function Ll(i){return i}function ja(i){return Array.from({length:i},(e,t)=>t)}var Rs,gt,Ts;const ii=class ii{constructor(e){d(this,gt,void 0);d(this,Ts,void 0);g(this,gt,e),g(this,Ts,[...new Set(Array.from(e.glyphs.values()).filter(t=>t.type==="sprite").map(t=>t.sprite.imageUrl))])}static of(e){return new ii({ascent:e.ascent??8,descent:e.descent??8,lineGap:e.lineGap??1,mapGrapheme:e.mapGrapheme??Ll,glyphs:e.glyphs??new Map})}static basedOn(e,t){const n=t(a(e,gt));return new ii(n)}get spriteSheetUrls(){return a(this,Ts)}get ascent(){return a(this,gt).ascent}get descent(){return a(this,gt).descent}get lineGap(){return a(this,gt).lineGap}arrangeGlyphsFor(e,t,n){var l;n??(n={});const s=[];let r=D.of(0,0),o=0,h=`
`;const c=a(ii,Rs).segment(e)[Symbol.iterator]();for(let f=c.next();!f.done;f=c.next()){const _=a(this,gt).mapGrapheme(f.value.segment),m=f.value.index;if(_===`
`){s.push({type:"line_break",lineNumber:o}),h=`
`,r=D.of(0,r.y+a(this,gt).ascent+a(this,gt).descent+a(this,gt).lineGap),o+=1;continue}if(_==="["){let O;for(const[C,P]of Object.entries(n)){const I=`[${C}]`;if(e.slice(m,m+I.length)===I){O=P;const x=[...a(ii,Rs).segment(I)].length-1;ja(x).forEach(()=>{c.next()});break}}if(O){t=O;continue}}const p=a(this,gt).glyphs.get(_);if(!p)continue;const y=((l=p.kerning)==null?void 0:l[h])??0,U=t;if(p.type==="sprite"){s.push({type:"sprite",char:_,sprite:p.sprite,spriteColorMapping:Xa.of(O=>p.isTextColor(O)?U:null),lineNumber:o,leftTop:r.add(0,a(this,gt).ascent).sub(0,p.sprite.size.y).add(p.offset??D.of(0,0)).add(y,0)}),h=_,r=r.add(p.advance+y,0);continue}if(p.type==="pixels"){s.push({type:"pixels",char:_,pixels:p.pixels,color:U,lineNumber:o,leftTop:r.add(0,this.ascent).sub(0,p.pixels.size.y).add(p.offset??D.of(0,0)).add(y,0)}),h=_,r=r.add(p.advance+y,0);continue}if(p.type==="whitespace"){h=_,r=r.add(p.advance+y,0);continue}Nl()}return s}};Rs=new WeakMap,gt=new WeakMap,Ts=new WeakMap,d(ii,Rs,new Intl.Segmenter("en",{granularity:"grapheme",localeMatcher:"best fit"}));let as=ii;class Jn{constructor(e,t,n,s,r){b(this,"type","static");b(this,"imageUrl");b(this,"size");b(this,"xy");t<0&&(t=-t,s-=t),n<0&&(n=-n,r-=n),this.imageUrl=e,this.xy=D.of(s,r).round(),this.size=D.of(s+t,r+n).round().sub(this.xy)}static from(e,t,n,s,r){return new Jn(e,t,n,s,r)}clipBy(e,t){const n=this.xy.clamp(e,t),s=this.xy.add(this.size).clamp(e,t).sub(n);return new Jn(this.imageUrl,s.x,s.y,n.x,n.y)}}var E,S;const nr=class nr{constructor(){d(this,E);b(this,"ascent",5);b(this,"descent",0);b(this,"lineGap",1);b(this,"glyphs",new Map([[" ",{type:"whitespace",advance:4}],["0",u(this,E,S).call(this,0,3)],["1",u(this,E,S).call(this,1,3)],["2",u(this,E,S).call(this,2,3)],["3",u(this,E,S).call(this,3,3)],["4",u(this,E,S).call(this,4,3)],["5",u(this,E,S).call(this,5,3)],["6",u(this,E,S).call(this,6,3)],["7",u(this,E,S).call(this,7,3)],["8",u(this,E,S).call(this,8,3)],["9",u(this,E,S).call(this,9,3)],["-",u(this,E,S).call(this,13,2)],["+",u(this,E,S).call(this,11,2)],["=",u(this,E,S).call(this,13,3)],["(",u(this,E,S).call(this,8,2)],[")",u(this,E,S).call(this,9,2)],["[",u(this,E,S).call(this,11,5)],["]",u(this,E,S).call(this,13,5)],["{",u(this,E,S).call(this,11,7)],["}",u(this,E,S).call(this,13,7)],["<",u(this,E,S).call(this,12,3)],[">",u(this,E,S).call(this,14,3)],["~",u(this,E,S).call(this,14,7)],["!",u(this,E,S).call(this,1,2)],["?",u(this,E,S).call(this,15,3)],["@",u(this,E,S).call(this,0,4)],["#",u(this,E,S).call(this,3,2)],["$",u(this,E,S).call(this,4,2)],["%",u(this,E,S).call(this,5,2)],["^",u(this,E,S).call(this,14,5)],["&",u(this,E,S).call(this,6,2)],["*",u(this,E,S).call(this,10,2)],["_",u(this,E,S).call(this,15,5)],[".",u(this,E,S).call(this,14,2)],[",",u(this,E,S).call(this,12,2)],[":",u(this,E,S).call(this,10,3)],[";",u(this,E,S).call(this,11,3)],["`",u(this,E,S).call(this,0,6)],["'",u(this,E,S).call(this,7,2)],['"',u(this,E,S).call(this,2,2)],["/",u(this,E,S).call(this,15,2)],["|",u(this,E,S).call(this,12,7)],["\\",u(this,E,S).call(this,12,5)],["a",u(this,E,S).call(this,1,6)],["b",u(this,E,S).call(this,2,6)],["c",u(this,E,S).call(this,3,6)],["d",u(this,E,S).call(this,4,6)],["e",u(this,E,S).call(this,5,6)],["f",u(this,E,S).call(this,6,6)],["g",u(this,E,S).call(this,7,6)],["h",u(this,E,S).call(this,8,6)],["i",u(this,E,S).call(this,9,6)],["j",u(this,E,S).call(this,10,6)],["k",u(this,E,S).call(this,11,6)],["l",u(this,E,S).call(this,12,6)],["m",u(this,E,S).call(this,13,6)],["n",u(this,E,S).call(this,14,6)],["o",u(this,E,S).call(this,15,6)],["p",u(this,E,S).call(this,0,7)],["q",u(this,E,S).call(this,1,7)],["r",u(this,E,S).call(this,2,7)],["s",u(this,E,S).call(this,3,7)],["t",u(this,E,S).call(this,4,7)],["u",u(this,E,S).call(this,5,7)],["v",u(this,E,S).call(this,6,7)],["w",u(this,E,S).call(this,7,7)],["x",u(this,E,S).call(this,8,7)],["y",u(this,E,S).call(this,9,7)],["z",u(this,E,S).call(this,10,7)],["⬅",u(this,E,S).call(this,11,8,7)],["➡",u(this,E,S).call(this,1,9,7)],["⬆",u(this,E,S).call(this,4,9,7)],["⬇",u(this,E,S).call(this,3,8,7)],["⭐",u(this,E,S).call(this,2,9,7)],["❤️",u(this,E,S).call(this,7,8,7)],["❎",u(this,E,S).call(this,7,9,7)],["⭕",u(this,E,S).call(this,14,8,7)],["♪",u(this,E,S).call(this,13,8,7)]]))}mapGrapheme(e){return e.toLowerCase()}};E=new WeakSet,S=function(e,t,n=3){const s=Jn.from(nr.spriteSheetUrl,n,5,e*8,t*8);return{type:"sprite",sprite:s,isTextColor:r=>(r==null?void 0:r.cssHex)===it.white.cssHex,advance:s.size.x+1}},b(nr,"spriteSheetUrl",".beetpx/pico-8-font.png");let tl=nr;var M,F;class Du{constructor(){d(this,M);b(this,"ascent",4);b(this,"descent",0);b(this,"lineGap",2);b(this,"glyphs",new Map([[" ",u(this,M,F).call(this,`
        ----
        ----
        ----
        ----
      `)],[".",u(this,M,F).call(this,`
        -
        -
        -
        #
      `)],[":",u(this,M,F).call(this,`
        #
        -
        -
        #
      `)],["!",u(this,M,F).call(this,`
        #
        #
        #
        -
        #
      `)],["?",u(this,M,F).call(this,`
        -#-
        #-#
        --#
        -#-
        -#-
      `)],["'",u(this,M,F).call(this,`
        #
        #
        -
        -
        -
      `)],['"',u(this,M,F).call(this,`
        #-#
        #-#
        ---
        ---
        ---
      `)],["*",u(this,M,F).call(this,`
        #-#
        -#-
        #-#
        ---
      `)],["/",u(this,M,F).call(this,`
        --#
        -#-
        -#-
        #--
      `)],["+",u(this,M,F).call(this,`
        ---
        -#-
        ###
        -#-
      `)],["-",u(this,M,F).call(this,`
        ---
        ---
        ###
        ---
      `)],["0",u(this,M,F).call(this,`
        -#-
        #-#
        #-#
        -#-
      `)],["1",u(this,M,F).call(this,`
        -#-
        ##-
        -#-
        -#-
      `)],["2",u(this,M,F).call(this,`
        ##-
        -##
        #--
        ###
      `)],["3",u(this,M,F).call(this,`
        ###
        -##
        --#
        ###
      `)],["4",u(this,M,F).call(this,`
        #-#
        #-#
        ###
        --#
      `)],["5",u(this,M,F).call(this,`
        ###
        ##-
        --#
        ##-
      `)],["6",u(this,M,F).call(this,`
        -#-
        #--
        ###
        -#-
      `)],["7",u(this,M,F).call(this,`
        ###
        --#
        -#-
        #--
      `)],["8",u(this,M,F).call(this,`
        ###
        -#-
        #-#
        -#-
      `)],["9",u(this,M,F).call(this,`
        ###
        ###
        --#
        ##-
      `)],["%",u(this,M,F).call(this,`
        #--#
        --#-
        -#--
        #--#
      `)],["$",u(this,M,F).call(this,`
        -##
        ##-
        -##
        ##-
      `)],["(",u(this,M,F).call(this,`
        -#
        #-
        #-
        -#
      `)],[")",u(this,M,F).call(this,`
        #-
        -#
        -#
        #-
      `)],["[",u(this,M,F).call(this,`
        ##
        #-
        #-
        ##
      `)],["]",u(this,M,F).call(this,`
        ##
        -#
        -#
        ##
      `)],["{",u(this,M,F).call(this,`
        -#
        ##
        ##
        -#
      `)],["}",u(this,M,F).call(this,`
        #-
        ##
        ##
        #-
      `)],["<",u(this,M,F).call(this,`
        ---
        -##
        #--
        -##
      `)],[">",u(this,M,F).call(this,`
        ##-
        --#
        ##-
        ---
      `)],["a",u(this,M,F).call(this,`
        ##-
        #-#
        ###
        #-#
      `)],["b",u(this,M,F).call(this,`
        #--
        ##-
        #-#
        ###
      `)],["c",u(this,M,F).call(this,`
        -##
        #--
        #--
        -##
      `)],["d",u(this,M,F).call(this,`
        ##-
        #-#
        #-#
        ##-
      `)],["e",u(this,M,F).call(this,`
        ###
        ##-
        #--
        ###
      `)],["f",u(this,M,F).call(this,`
        ###
        #--
        ##-
        #--
      `)],["g",u(this,M,F).call(this,`
        -##
        #--
        #-#
        -##
      `)],["h",u(this,M,F).call(this,`
        #--
        ##-
        #-#
        #-#
      `)],["i",u(this,M,F).call(this,`
        #
        #
        #
        #
      `)],["j",u(this,M,F).call(this,`
        ##
        -#
        -#
        #-
      `)],["k",u(this,M,F).call(this,`
        #-#
        ##-
        #-#
        #-#
      `)],["l",u(this,M,F).call(this,`
        #-
        #-
        #-
        ##
      `)],["m",u(this,M,F).call(this,`
        #-#
        ###
        #-#
        #-#
      `)],["n",u(this,M,F).call(this,`
        ##-
        #-#
        #-#
        #-#
      `)],["o",u(this,M,F).call(this,`
        -##
        #-#
        #-#
        ##-
      `)],["p",u(this,M,F).call(this,`
        ###
        #-#
        ##-
        #--
      `)],["q",u(this,M,F).call(this,`
        -#-
        #-#
        ###
        -#-
      `)],["r",u(this,M,F).call(this,`
        ##-
        #-#
        ##-
        #-#
      `)],["s",u(this,M,F).call(this,`
        -##
        ##-
        --#
        ##-
      `)],["t",u(this,M,F).call(this,`
        ###
        -#-
        -#-
        -#-
      `)],["u",u(this,M,F).call(this,`
        #-#
        #-#
        #-#
        ##-
      `)],["v",u(this,M,F).call(this,`
        #-#
        #-#
        #-#
        -#-
      `)],["w",u(this,M,F).call(this,`
        #-#
        #-#
        ###
        #-#
      `)],["x",u(this,M,F).call(this,`
        #-#
        -#-
        #-#
        #-#
      `)],["y",u(this,M,F).call(this,`
        #-#
        #-#
        -#-
        -#-
      `)],["z",u(this,M,F).call(this,`
        ###
        -#-
        #--
        ###
      `)]]))}mapGrapheme(e){return e.toLowerCase()}}M=new WeakSet,F=function(e){const t=Sr.from(e);return{type:"pixels",pixels:t,advance:t.size.x+1}};var v,A;class Pu{constructor(){d(this,v);b(this,"ascent",5);b(this,"descent",0);b(this,"lineGap",2);b(this,"glyphs",new Map([[" ",u(this,v,A).call(this,`
        ----
        ----
        ----
        ----
        ----
      `)],[".",u(this,v,A).call(this,`
        --
        --
        --
        ##
        ##
      `)],[":",u(this,v,A).call(this,`
        #
        -
        -
        #
        -
      `)],["!",u(this,v,A).call(this,`
        ###
        ###
        -#-
        ---
        -#-
      `)],["?",u(this,v,A).call(this,`
        ###
        --#
        -#-
        ---
        -#-
      `)],["'",u(this,v,A).call(this,`
        -
        #
        #
        -
        -
      `)],['"',u(this,v,A).call(this,`
        #-#
        #-#
        ---
        ---
        ---
      `)],["*",u(this,v,A).call(this,`
        --
        ##
        ##
        --
        --
      `)],["/",u(this,v,A).call(this,`
        --#
        --#
        -#-
        #--
        #--
      `)],["+",u(this,v,A).call(this,`
        ---
        -#-
        ###
        -#-
        ---
      `)],["-",u(this,v,A).call(this,`
        ---
        ---
        ###
        ---
        ---
      `)],["0",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        #-#
        -#-
      `)],["1",u(this,v,A).call(this,`
        -#-
        ##-
        -#-
        -#-
        ###
      `)],["2",u(this,v,A).call(this,`
        -#-
        #-#
        --#
        -#-
        ###
      `)],["3",u(this,v,A).call(this,`
        ###
        --#
        -##
        --#
        ##-
      `)],["4",u(this,v,A).call(this,`
        --#
        -##
        #-#
        ###
        --#
      `)],["5",u(this,v,A).call(this,`
        ###
        #--
        ###
        --#
        ##-
      `)],["6",u(this,v,A).call(this,`
        ###
        #--
        ###
        #-#
        ###
      `)],["7",u(this,v,A).call(this,`
        ###
        --#
        -#-
        -#-
        -#-
      `)],["8",u(this,v,A).call(this,`
        ###
        #-#
        -#-
        #-#
        ###
      `)],["9",u(this,v,A).call(this,`
        ###
        #-#
        ###
        --#
        ###
      `)],["%",u(this,v,A).call(this,`
        #-#
        --#
        -#-
        #--
        #-#
      `)],["$",u(this,v,A).call(this,`
        ###
        ##-
        -##
        ###
        -#-
      `)],["(",u(this,v,A).call(this,`
        -#
        #-
        #-
        #-
        -#
      `)],[")",u(this,v,A).call(this,`
        #-
        -#
        -#
        -#
        #-
      `)],["[",u(this,v,A).call(this,`
        ##
        #-
        #-
        #-
        ##
      `)],["]",u(this,v,A).call(this,`
        ##
        -#
        -#
        -#
        ##
      `)],["{",u(this,v,A).call(this,`
        -##
        -#-
        #--
        -#-
        -##
      `)],["}",u(this,v,A).call(this,`
        ##-
        -#-
        --#
        -#-
        ##-
      `)],["<",u(this,v,A).call(this,`
        --#
        -#-
        #--
        -#-
        --#
      `)],[">",u(this,v,A).call(this,`
        #--
        -#-
        --#
        -#-
        #--
      `)],["A",u(this,v,A).call(this,`
        -#-
        #-#
        ###
        #-#
        #-#
      `)],["B",u(this,v,A).call(this,`
        ##-
        #-#
        ##-
        #-#
        ###
      `)],["C",u(this,v,A).call(this,`
        -#-
        #-#
        #--
        #-#
        -#-
      `)],["D",u(this,v,A).call(this,`
        ##-
        #-#
        #-#
        #-#
        ##-
      `)],["E",u(this,v,A).call(this,`
        ###
        #--
        ##-
        #--
        ###
      `)],["F",u(this,v,A).call(this,`
        ###
        #--
        ##-
        #--
        #--
      `)],["G",u(this,v,A).call(this,`
        -#-
        #-#
        #--
        #-#
        -##
      `)],["H",u(this,v,A).call(this,`
        #-#
        #-#
        ###
        #-#
        #-#
      `)],["I",u(this,v,A).call(this,`
        ###
        -#-
        -#-
        -#-
        ###
      `)],["J",u(this,v,A).call(this,`
        --#
        --#
        --#
        #-#
        -#-
      `)],["K",u(this,v,A).call(this,`
        #-#
        #-#
        ##-
        #-#
        #-#
      `)],["L",u(this,v,A).call(this,`
        #--
        #--
        #--
        #--
        ###
      `)],["M",u(this,v,A).call(this,`
        #-#
        ###
        ###
        #-#
        #-#
      `)],["N",u(this,v,A).call(this,`
        ##-
        ###
        #-#
        #-#
        #-#
      `)],["O",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        #-#
        -#-
      `)],["P",u(this,v,A).call(this,`
        ##-
        #-#
        ###
        #--
        #--
      `)],["Q",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        ###
        -##
      `)],["R",u(this,v,A).call(this,`
        ##-
        #-#
        ##-
        #-#
        #-#
      `)],["S",u(this,v,A).call(this,`
        ###
        #--
        -#-
        --#
        ##-
      `)],["T",u(this,v,A).call(this,`
        ###
        -#-
        -#-
        -#-
        -#-
      `)],["U",u(this,v,A).call(this,`
        #-#
        #-#
        #-#
        #-#
        ###
      `)],["V",u(this,v,A).call(this,`
        #-#
        #-#
        #-#
        -#-
        -#-
      `)],["W",u(this,v,A).call(this,`
        #-#
        #-#
        ###
        ###
        #-#
      `)],["X",u(this,v,A).call(this,`
        #-#
        #-#
        -#-
        #-#
        #-#
      `)],["Y",u(this,v,A).call(this,`
        #-#
        #-#
        -#-
        -#-
        -#-
      `)],["Z",u(this,v,A).call(this,`
        ###
        --#
        -#-
        #--
        ###
      `)],["a",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        ###
        #-#
      `)],["b",u(this,v,A).call(this,`
        #--
        #--
        ##-
        #-#
        ##-
      `)],["c",u(this,v,A).call(this,`
        -##
        #--
        #--
        #--
        -##
      `)],["d",u(this,v,A).call(this,`
        --#
        --#
        -##
        #-#
        ###
      `)],["e",u(this,v,A).call(this,`
        -#-
        #-#
        ###
        #--
        -##
      `)],["f",u(this,v,A).call(this,`
        -##
        -#-
        ###
        -#-
        -#-
      `)],["g",u(this,v,A).call(this,`
        -#-
        #-#
        #--
        #-#
        -##
      `)],["h",u(this,v,A).call(this,`
        #--
        #--
        ##-
        #-#
        #-#
      `)],["i",u(this,v,A).call(this,`
        -#
        --
        -#
        -#
        -#
      `)],["j",u(this,v,A).call(this,`
        -##
        --#
        --#
        #-#
        -#-
      `)],["k",u(this,v,A).call(this,`
        #-#
        #-#
        ##-
        #-#
        #-#
      `)],["l",u(this,v,A).call(this,`
        #
        #
        #
        #
        #
      `)],["m",u(this,v,A).call(this,`
        #-#
        ###
        ###
        #-#
        #-#
      `)],["n",u(this,v,A).call(this,`
        ##-
        #-#
        #-#
        #-#
        #-#
      `)],["o",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        #-#
        -#-
      `)],["p",u(this,v,A).call(this,`
        ##-
        #-#
        ###
        #--
        #--
      `)],["q",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        ###
        -##
      `)],["r",u(this,v,A).call(this,`
        -#-
        #-#
        #--
        #--
        #--
      `)],["s",u(this,v,A).call(this,`
        -##
        #--
        -#-
        --#
        ##-
      `)],["t",u(this,v,A).call(this,`
        -#-
        ###
        -#-
        -#-
        -##
      `)],["u",u(this,v,A).call(this,`
        #-#
        #-#
        #-#
        #-#
        -#-
      `)],["v",u(this,v,A).call(this,`
        #-#
        #-#
        #-#
        -#-
        -#-
      `)],["w",u(this,v,A).call(this,`
        #-#
        #-#
        ###
        ###
        #-#
      `)],["x",u(this,v,A).call(this,`
        #-#
        #-#
        -#-
        #-#
        #-#
      `)],["y",u(this,v,A).call(this,`
        #-#
        #-#
        -#-
        -#-
        -#-
      `)],["z",u(this,v,A).call(this,`
        ###
        --#
        -#-
        #--
        ###
      `)]]))}mapGrapheme(e){return e}}v=new WeakSet,A=function(e){const t=Sr.from(e);return{type:"pixels",pixels:t,advance:t.size.x+1}};class ro{static detect(e){const t=e.id.toLowerCase();return t.includes("dualsense")?"dualsense":t.includes("8bitdo")||t.includes("2dc8")?"8bitdo":t.includes("054c")?"dualsense":t.includes("xbox")||t.includes("045e")?"xbox":(t.includes("xinput"),"other")}}class N{static addLoadedClass(){document.body.classList.add("loaded")}static addStartedClass(){document.body.classList.add("started")}static showError(e){document.body.classList.add("error"),document.getElementById("screen_error__message").innerText=String(e)}static updateMutedClass(e){document.body.classList[e?"add":"remove"]("muted")}static updateDebugClass(e){document.body.classList[e?"add":"remove"]("debug")}static updatePressedClasses(e){document.body.classList[e.up?"add":"remove"]("pressed_u"),document.body.classList[e.down?"add":"remove"]("pressed_d"),document.body.classList[e.left?"add":"remove"]("pressed_l"),document.body.classList[e.right?"add":"remove"]("pressed_r"),document.body.classList[e.a?"add":"remove"]("pressed_a"),document.body.classList[e.b?"add":"remove"]("pressed_b"),document.body.classList[e.menu?"add":"remove"]("pressed_menu"),document.body.classList[e.mute?"add":"remove"]("pressed_mute"),document.body.classList[e.fullscreen?"add":"remove"]("pressed_fullscreen")}}b(N,"selectors",{fullScreenSubject:"body",canvas:"#game_canvas",startButton:"#screen_start_game__button",controlsLeft:"#dpad_l",controlsRight:"#dpad_r",controlsUp:"#dpad_u",controlsDown:"#dpad_d",controlsUpLeft:"#dpad_ul",controlsUpRight:"#dpad_ur",controlsDownLeft:"#dpad_dl",controlsDownRight:"#dpad_dr",controlsA:"#button_a",controlsB:"#button_b",controlsMenu:"#button_menu",controlsFullScreen:"#button_fullscreen",controlsMuteToggle:"#button_mute"});(function(i){if(i.TextEncoder&&i.TextDecoder)return!1;function e(n="utf-8"){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${n}') is invalid.`)}Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),e.prototype.encode=function(n,s={stream:!1}){if(s.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let r=0;const o=n.length;let h=0,c=Math.max(32,o+(o>>1)+7),l=new Uint8Array(c>>3<<3);for(;r<o;){let f=n.charCodeAt(r++);if(f>=55296&&f<=56319){if(r<o){const _=n.charCodeAt(r);(_&64512)===56320&&(++r,f=((f&1023)<<10)+(_&1023)+65536)}if(f>=55296&&f<=56319)continue}if(h+4>l.length){c+=8,c*=1+r/n.length*2,c=c>>3<<3;const _=new Uint8Array(c);_.set(l),l=_}if(f&4294967168)if(!(f&4294965248))l[h++]=f>>6&31|192;else if(!(f&4294901760))l[h++]=f>>12&15|224,l[h++]=f>>6&63|128;else if(!(f&4292870144))l[h++]=f>>18&7|240,l[h++]=f>>12&63|128,l[h++]=f>>6&63|128;else continue;else{l[h++]=f;continue}l[h++]=f&63|128}return l.slice(0,h)};function t(n="utf-8",s={fatal:!1}){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${n}') is invalid.`);if(s.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(t.prototype,"fatal",{value:!1}),Object.defineProperty(t.prototype,"ignoreBOM",{value:!1}),t.prototype.decode=function(n,s={stream:!1}){if(s.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const r=new Uint8Array(n);let o=0;const h=r.length,c=[];for(;o<h;){const l=r[o++];if(l===0)break;if(!(l&128))c.push(l);else if((l&224)===192){const f=r[o++]&63;c.push((l&31)<<6|f)}else if((l&240)===224){const f=r[o++]&63,_=r[o++]&63;c.push((l&31)<<12|f<<6|_)}else if((l&248)===240){const f=r[o++]&63,_=r[o++]&63,m=r[o++]&63;let p=(l&7)<<18|f<<12|_<<6|m;p>65535&&(p-=65536,c.push(p>>>10&1023|55296),p=56320|p&1023),c.push(p)}}return String.fromCharCode.apply(null,c)},i.TextEncoder=e,i.TextDecoder=t})(typeof window<"u"?window:typeof self<"u"?self:void 0);function lo(i,e="utf8"){return new TextDecoder(e).decode(i)}const Uu=new TextEncoder;function Iu(i){return Uu.encode(i)}const zu=1024*8,Nu=(()=>{const i=new Uint8Array(4),e=new Uint32Array(i.buffer);return!((e[0]=1)&i[0])})(),Fr={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class $l{constructor(e=zu,t={}){let n=!1;typeof e=="number"?e=new ArrayBuffer(e):(n=!0,this.lastWrittenByte=e.byteLength);const s=t.offset?t.offset>>>0:0,r=e.byteLength-s;let o=s;(ArrayBuffer.isView(e)||e instanceof $l)&&(e.byteLength!==e.buffer.byteLength&&(o=e.byteOffset+s),e=e.buffer),n?this.lastWrittenByte=r:this.lastWrittenByte=0,this.buffer=e,this.length=r,this.byteLength=r,this.byteOffset=o,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,o,r),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const n=(this.offset+e)*2,s=new Uint8Array(n);s.set(new Uint8Array(this.buffer)),this.buffer=s.buffer,this.length=this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,t){const n=Fr[t].BYTES_PER_ELEMENT*e,s=this.byteOffset+this.offset,r=this.buffer.slice(s,s+n);if(this.littleEndian===Nu&&t!=="uint8"&&t!=="int8"){const h=new Uint8Array(this.buffer.slice(s,s+n));h.reverse();const c=new Fr[t](h.buffer);return this.offset+=n,c.reverse(),c}const o=new Fr[t](r);return this.offset+=n,o}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let t="";for(let n=0;n<e;n++)t+=this.readChar();return t}readUtf8(e=1){return lo(this.readBytes(e))}decodeText(e=1,t="utf-8"){return lo(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(Iu(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Lu=4,oo=0,ho=1,$u=2;function jn(i){let e=i.length;for(;--e>=0;)i[e]=0}const Bu=0,gh=1,Gu=2,Zu=3,Hu=258,Bl=29,Ta=256,cs=Ta+1+Bl,un=30,Gl=19,mh=2*cs+1,pi=15,Dr=16,Ju=7,Zl=256,_h=16,bh=17,wh=18,el=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Wa=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Wu=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),yh=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),qu=512,ue=new Array((cs+2)*2);jn(ue);const rs=new Array(un*2);jn(rs);const ds=new Array(qu);jn(ds);const ps=new Array(Hu-Zu+1);jn(ps);const Hl=new Array(Bl);jn(Hl);const Qa=new Array(un);jn(Qa);function Pr(i,e,t,n,s){this.static_tree=i,this.extra_bits=e,this.extra_base=t,this.elems=n,this.max_length=s,this.has_stree=i&&i.length}let vh,xh,Ah;function Ur(i,e){this.dyn_tree=i,this.max_code=0,this.stat_desc=e}const Eh=i=>i<256?ds[i]:ds[256+(i>>>7)],gs=(i,e)=>{i.pending_buf[i.pending++]=e&255,i.pending_buf[i.pending++]=e>>>8&255},xt=(i,e,t)=>{i.bi_valid>Dr-t?(i.bi_buf|=e<<i.bi_valid&65535,gs(i,i.bi_buf),i.bi_buf=e>>Dr-i.bi_valid,i.bi_valid+=t-Dr):(i.bi_buf|=e<<i.bi_valid&65535,i.bi_valid+=t)},ae=(i,e,t)=>{xt(i,t[e*2],t[e*2+1])},Sh=(i,e)=>{let t=0;do t|=i&1,i>>>=1,t<<=1;while(--e>0);return t>>>1},Ku=i=>{i.bi_valid===16?(gs(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=i.bi_buf&255,i.bi_buf>>=8,i.bi_valid-=8)},Yu=(i,e)=>{const t=e.dyn_tree,n=e.max_code,s=e.stat_desc.static_tree,r=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,h=e.stat_desc.extra_base,c=e.stat_desc.max_length;let l,f,_,m,p,y,U=0;for(m=0;m<=pi;m++)i.bl_count[m]=0;for(t[i.heap[i.heap_max]*2+1]=0,l=i.heap_max+1;l<mh;l++)f=i.heap[l],m=t[t[f*2+1]*2+1]+1,m>c&&(m=c,U++),t[f*2+1]=m,!(f>n)&&(i.bl_count[m]++,p=0,f>=h&&(p=o[f-h]),y=t[f*2],i.opt_len+=y*(m+p),r&&(i.static_len+=y*(s[f*2+1]+p)));if(U!==0){do{for(m=c-1;i.bl_count[m]===0;)m--;i.bl_count[m]--,i.bl_count[m+1]+=2,i.bl_count[c]--,U-=2}while(U>0);for(m=c;m!==0;m--)for(f=i.bl_count[m];f!==0;)_=i.heap[--l],!(_>n)&&(t[_*2+1]!==m&&(i.opt_len+=(m-t[_*2+1])*t[_*2],t[_*2+1]=m),f--)}},kh=(i,e,t)=>{const n=new Array(pi+1);let s=0,r,o;for(r=1;r<=pi;r++)s=s+t[r-1]<<1,n[r]=s;for(o=0;o<=e;o++){let h=i[o*2+1];h!==0&&(i[o*2]=Sh(n[h]++,h))}},Xu=()=>{let i,e,t,n,s;const r=new Array(pi+1);for(t=0,n=0;n<Bl-1;n++)for(Hl[n]=t,i=0;i<1<<el[n];i++)ps[t++]=n;for(ps[t-1]=n,s=0,n=0;n<16;n++)for(Qa[n]=s,i=0;i<1<<Wa[n];i++)ds[s++]=n;for(s>>=7;n<un;n++)for(Qa[n]=s<<7,i=0;i<1<<Wa[n]-7;i++)ds[256+s++]=n;for(e=0;e<=pi;e++)r[e]=0;for(i=0;i<=143;)ue[i*2+1]=8,i++,r[8]++;for(;i<=255;)ue[i*2+1]=9,i++,r[9]++;for(;i<=279;)ue[i*2+1]=7,i++,r[7]++;for(;i<=287;)ue[i*2+1]=8,i++,r[8]++;for(kh(ue,cs+1,r),i=0;i<un;i++)rs[i*2+1]=5,rs[i*2]=Sh(i,5);vh=new Pr(ue,el,Ta+1,cs,pi),xh=new Pr(rs,Wa,0,un,pi),Ah=new Pr(new Array(0),Wu,0,Gl,Ju)},Ch=i=>{let e;for(e=0;e<cs;e++)i.dyn_ltree[e*2]=0;for(e=0;e<un;e++)i.dyn_dtree[e*2]=0;for(e=0;e<Gl;e++)i.bl_tree[e*2]=0;i.dyn_ltree[Zl*2]=1,i.opt_len=i.static_len=0,i.sym_next=i.matches=0},Rh=i=>{i.bi_valid>8?gs(i,i.bi_buf):i.bi_valid>0&&(i.pending_buf[i.pending++]=i.bi_buf),i.bi_buf=0,i.bi_valid=0},uo=(i,e,t,n)=>{const s=e*2,r=t*2;return i[s]<i[r]||i[s]===i[r]&&n[e]<=n[t]},Ir=(i,e,t)=>{const n=i.heap[t];let s=t<<1;for(;s<=i.heap_len&&(s<i.heap_len&&uo(e,i.heap[s+1],i.heap[s],i.depth)&&s++,!uo(e,n,i.heap[s],i.depth));)i.heap[t]=i.heap[s],t=s,s<<=1;i.heap[t]=n},fo=(i,e,t)=>{let n,s,r=0,o,h;if(i.sym_next!==0)do n=i.pending_buf[i.sym_buf+r++]&255,n+=(i.pending_buf[i.sym_buf+r++]&255)<<8,s=i.pending_buf[i.sym_buf+r++],n===0?ae(i,s,e):(o=ps[s],ae(i,o+Ta+1,e),h=el[o],h!==0&&(s-=Hl[o],xt(i,s,h)),n--,o=Eh(n),ae(i,o,t),h=Wa[o],h!==0&&(n-=Qa[o],xt(i,n,h)));while(r<i.sym_next);ae(i,Zl,e)},il=(i,e)=>{const t=e.dyn_tree,n=e.stat_desc.static_tree,s=e.stat_desc.has_stree,r=e.stat_desc.elems;let o,h,c=-1,l;for(i.heap_len=0,i.heap_max=mh,o=0;o<r;o++)t[o*2]!==0?(i.heap[++i.heap_len]=c=o,i.depth[o]=0):t[o*2+1]=0;for(;i.heap_len<2;)l=i.heap[++i.heap_len]=c<2?++c:0,t[l*2]=1,i.depth[l]=0,i.opt_len--,s&&(i.static_len-=n[l*2+1]);for(e.max_code=c,o=i.heap_len>>1;o>=1;o--)Ir(i,t,o);l=r;do o=i.heap[1],i.heap[1]=i.heap[i.heap_len--],Ir(i,t,1),h=i.heap[1],i.heap[--i.heap_max]=o,i.heap[--i.heap_max]=h,t[l*2]=t[o*2]+t[h*2],i.depth[l]=(i.depth[o]>=i.depth[h]?i.depth[o]:i.depth[h])+1,t[o*2+1]=t[h*2+1]=l,i.heap[1]=l++,Ir(i,t,1);while(i.heap_len>=2);i.heap[--i.heap_max]=i.heap[1],Yu(i,e),kh(t,c,i.bl_count)},co=(i,e,t)=>{let n,s=-1,r,o=e[0*2+1],h=0,c=7,l=4;for(o===0&&(c=138,l=3),e[(t+1)*2+1]=65535,n=0;n<=t;n++)r=o,o=e[(n+1)*2+1],!(++h<c&&r===o)&&(h<l?i.bl_tree[r*2]+=h:r!==0?(r!==s&&i.bl_tree[r*2]++,i.bl_tree[_h*2]++):h<=10?i.bl_tree[bh*2]++:i.bl_tree[wh*2]++,h=0,s=r,o===0?(c=138,l=3):r===o?(c=6,l=3):(c=7,l=4))},po=(i,e,t)=>{let n,s=-1,r,o=e[0*2+1],h=0,c=7,l=4;for(o===0&&(c=138,l=3),n=0;n<=t;n++)if(r=o,o=e[(n+1)*2+1],!(++h<c&&r===o)){if(h<l)do ae(i,r,i.bl_tree);while(--h!==0);else r!==0?(r!==s&&(ae(i,r,i.bl_tree),h--),ae(i,_h,i.bl_tree),xt(i,h-3,2)):h<=10?(ae(i,bh,i.bl_tree),xt(i,h-3,3)):(ae(i,wh,i.bl_tree),xt(i,h-11,7));h=0,s=r,o===0?(c=138,l=3):r===o?(c=6,l=3):(c=7,l=4)}},ju=i=>{let e;for(co(i,i.dyn_ltree,i.l_desc.max_code),co(i,i.dyn_dtree,i.d_desc.max_code),il(i,i.bl_desc),e=Gl-1;e>=3&&i.bl_tree[yh[e]*2+1]===0;e--);return i.opt_len+=3*(e+1)+5+5+4,e},Qu=(i,e,t,n)=>{let s;for(xt(i,e-257,5),xt(i,t-1,5),xt(i,n-4,4),s=0;s<n;s++)xt(i,i.bl_tree[yh[s]*2+1],3);po(i,i.dyn_ltree,e-1),po(i,i.dyn_dtree,t-1)},Vu=i=>{let e=4093624447,t;for(t=0;t<=31;t++,e>>>=1)if(e&1&&i.dyn_ltree[t*2]!==0)return oo;if(i.dyn_ltree[9*2]!==0||i.dyn_ltree[10*2]!==0||i.dyn_ltree[13*2]!==0)return ho;for(t=32;t<Ta;t++)if(i.dyn_ltree[t*2]!==0)return ho;return oo};let go=!1;const tf=i=>{go||(Xu(),go=!0),i.l_desc=new Ur(i.dyn_ltree,vh),i.d_desc=new Ur(i.dyn_dtree,xh),i.bl_desc=new Ur(i.bl_tree,Ah),i.bi_buf=0,i.bi_valid=0,Ch(i)},Th=(i,e,t,n)=>{xt(i,(Bu<<1)+(n?1:0),3),Rh(i),gs(i,t),gs(i,~t),t&&i.pending_buf.set(i.window.subarray(e,e+t),i.pending),i.pending+=t},ef=i=>{xt(i,gh<<1,3),ae(i,Zl,ue),Ku(i)},nf=(i,e,t,n)=>{let s,r,o=0;i.level>0?(i.strm.data_type===$u&&(i.strm.data_type=Vu(i)),il(i,i.l_desc),il(i,i.d_desc),o=ju(i),s=i.opt_len+3+7>>>3,r=i.static_len+3+7>>>3,r<=s&&(s=r)):s=r=t+5,t+4<=s&&e!==-1?Th(i,e,t,n):i.strategy===Lu||r===s?(xt(i,(gh<<1)+(n?1:0),3),fo(i,ue,rs)):(xt(i,(Gu<<1)+(n?1:0),3),Qu(i,i.l_desc.max_code+1,i.d_desc.max_code+1,o+1),fo(i,i.dyn_ltree,i.dyn_dtree)),Ch(i),n&&Rh(i)},sf=(i,e,t)=>(i.pending_buf[i.sym_buf+i.sym_next++]=e,i.pending_buf[i.sym_buf+i.sym_next++]=e>>8,i.pending_buf[i.sym_buf+i.sym_next++]=t,e===0?i.dyn_ltree[t*2]++:(i.matches++,e--,i.dyn_ltree[(ps[t]+Ta+1)*2]++,i.dyn_dtree[Eh(e)*2]++),i.sym_next===i.sym_end);var af=tf,rf=Th,lf=nf,of=sf,hf=ef,uf={_tr_init:af,_tr_stored_block:rf,_tr_flush_block:lf,_tr_tally:of,_tr_align:hf};const ff=(i,e,t,n)=>{let s=i&65535|0,r=i>>>16&65535|0,o=0;for(;t!==0;){o=t>2e3?2e3:t,t-=o;do s=s+e[n++]|0,r=r+s|0;while(--o);s%=65521,r%=65521}return s|r<<16|0};var ms=ff;const cf=()=>{let i,e=[];for(var t=0;t<256;t++){i=t;for(var n=0;n<8;n++)i=i&1?3988292384^i>>>1:i>>>1;e[t]=i}return e},df=new Uint32Array(cf()),pf=(i,e,t,n)=>{const s=df,r=n+t;i^=-1;for(let o=n;o<r;o++)i=i>>>8^s[(i^e[o])&255];return i^-1};var nt=pf,Wn={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ma={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:gf,_tr_stored_block:nl,_tr_flush_block:mf,_tr_tally:Ye,_tr_align:_f}=uf,{Z_NO_FLUSH:Xe,Z_PARTIAL_FLUSH:bf,Z_FULL_FLUSH:wf,Z_FINISH:Pt,Z_BLOCK:mo,Z_OK:st,Z_STREAM_END:_o,Z_STREAM_ERROR:re,Z_DATA_ERROR:yf,Z_BUF_ERROR:zr,Z_DEFAULT_COMPRESSION:vf,Z_FILTERED:xf,Z_HUFFMAN_ONLY:Ia,Z_RLE:Af,Z_FIXED:Ef,Z_DEFAULT_STRATEGY:Sf,Z_UNKNOWN:kf,Z_DEFLATED:kr}=Ma,Cf=9,Rf=15,Tf=8,Mf=29,Of=256,sl=Of+1+Mf,Ff=30,Df=19,Pf=2*sl+1,Uf=15,H=3,Ke=258,le=Ke+H+1,If=32,qn=42,Jl=57,al=69,rl=73,ll=91,ol=103,gi=113,is=666,dt=1,Qn=2,tn=3,Vn=4,zf=3,mi=(i,e)=>(i.msg=Wn[e],e),bo=i=>i*2-(i>4?9:0),Re=i=>{let e=i.length;for(;--e>=0;)i[e]=0},Nf=i=>{let e,t,n,s=i.w_size;e=i.hash_size,n=e;do t=i.head[--n],i.head[n]=t>=s?t-s:0;while(--e);e=s,n=e;do t=i.prev[--n],i.prev[n]=t>=s?t-s:0;while(--e)};let Lf=(i,e,t)=>(e<<i.hash_shift^t)&i.hash_mask,je=Lf;const Et=i=>{const e=i.state;let t=e.pending;t>i.avail_out&&(t=i.avail_out),t!==0&&(i.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),i.next_out),i.next_out+=t,e.pending_out+=t,i.total_out+=t,i.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},St=(i,e)=>{mf(i,i.block_start>=0?i.block_start:-1,i.strstart-i.block_start,e),i.block_start=i.strstart,Et(i.strm)},J=(i,e)=>{i.pending_buf[i.pending++]=e},ts=(i,e)=>{i.pending_buf[i.pending++]=e>>>8&255,i.pending_buf[i.pending++]=e&255},hl=(i,e,t,n)=>{let s=i.avail_in;return s>n&&(s=n),s===0?0:(i.avail_in-=s,e.set(i.input.subarray(i.next_in,i.next_in+s),t),i.state.wrap===1?i.adler=ms(i.adler,e,s,t):i.state.wrap===2&&(i.adler=nt(i.adler,e,s,t)),i.next_in+=s,i.total_in+=s,s)},Mh=(i,e)=>{let t=i.max_chain_length,n=i.strstart,s,r,o=i.prev_length,h=i.nice_match;const c=i.strstart>i.w_size-le?i.strstart-(i.w_size-le):0,l=i.window,f=i.w_mask,_=i.prev,m=i.strstart+Ke;let p=l[n+o-1],y=l[n+o];i.prev_length>=i.good_match&&(t>>=2),h>i.lookahead&&(h=i.lookahead);do if(s=e,!(l[s+o]!==y||l[s+o-1]!==p||l[s]!==l[n]||l[++s]!==l[n+1])){n+=2,s++;do;while(l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&n<m);if(r=Ke-(m-n),n=m-Ke,r>o){if(i.match_start=e,o=r,r>=h)break;p=l[n+o-1],y=l[n+o]}}while((e=_[e&f])>c&&--t!==0);return o<=i.lookahead?o:i.lookahead},Kn=i=>{const e=i.w_size;let t,n,s;do{if(n=i.window_size-i.lookahead-i.strstart,i.strstart>=e+(e-le)&&(i.window.set(i.window.subarray(e,e+e-n),0),i.match_start-=e,i.strstart-=e,i.block_start-=e,i.insert>i.strstart&&(i.insert=i.strstart),Nf(i),n+=e),i.strm.avail_in===0)break;if(t=hl(i.strm,i.window,i.strstart+i.lookahead,n),i.lookahead+=t,i.lookahead+i.insert>=H)for(s=i.strstart-i.insert,i.ins_h=i.window[s],i.ins_h=je(i,i.ins_h,i.window[s+1]);i.insert&&(i.ins_h=je(i,i.ins_h,i.window[s+H-1]),i.prev[s&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=s,s++,i.insert--,!(i.lookahead+i.insert<H)););}while(i.lookahead<le&&i.strm.avail_in!==0)},Oh=(i,e)=>{let t=i.pending_buf_size-5>i.w_size?i.w_size:i.pending_buf_size-5,n,s,r,o=0,h=i.strm.avail_in;do{if(n=65535,r=i.bi_valid+42>>3,i.strm.avail_out<r||(r=i.strm.avail_out-r,s=i.strstart-i.block_start,n>s+i.strm.avail_in&&(n=s+i.strm.avail_in),n>r&&(n=r),n<t&&(n===0&&e!==Pt||e===Xe||n!==s+i.strm.avail_in)))break;o=e===Pt&&n===s+i.strm.avail_in?1:0,nl(i,0,0,o),i.pending_buf[i.pending-4]=n,i.pending_buf[i.pending-3]=n>>8,i.pending_buf[i.pending-2]=~n,i.pending_buf[i.pending-1]=~n>>8,Et(i.strm),s&&(s>n&&(s=n),i.strm.output.set(i.window.subarray(i.block_start,i.block_start+s),i.strm.next_out),i.strm.next_out+=s,i.strm.avail_out-=s,i.strm.total_out+=s,i.block_start+=s,n-=s),n&&(hl(i.strm,i.strm.output,i.strm.next_out,n),i.strm.next_out+=n,i.strm.avail_out-=n,i.strm.total_out+=n)}while(o===0);return h-=i.strm.avail_in,h&&(h>=i.w_size?(i.matches=2,i.window.set(i.strm.input.subarray(i.strm.next_in-i.w_size,i.strm.next_in),0),i.strstart=i.w_size,i.insert=i.strstart):(i.window_size-i.strstart<=h&&(i.strstart-=i.w_size,i.window.set(i.window.subarray(i.w_size,i.w_size+i.strstart),0),i.matches<2&&i.matches++,i.insert>i.strstart&&(i.insert=i.strstart)),i.window.set(i.strm.input.subarray(i.strm.next_in-h,i.strm.next_in),i.strstart),i.strstart+=h,i.insert+=h>i.w_size-i.insert?i.w_size-i.insert:h),i.block_start=i.strstart),i.high_water<i.strstart&&(i.high_water=i.strstart),o?Vn:e!==Xe&&e!==Pt&&i.strm.avail_in===0&&i.strstart===i.block_start?Qn:(r=i.window_size-i.strstart,i.strm.avail_in>r&&i.block_start>=i.w_size&&(i.block_start-=i.w_size,i.strstart-=i.w_size,i.window.set(i.window.subarray(i.w_size,i.w_size+i.strstart),0),i.matches<2&&i.matches++,r+=i.w_size,i.insert>i.strstart&&(i.insert=i.strstart)),r>i.strm.avail_in&&(r=i.strm.avail_in),r&&(hl(i.strm,i.window,i.strstart,r),i.strstart+=r,i.insert+=r>i.w_size-i.insert?i.w_size-i.insert:r),i.high_water<i.strstart&&(i.high_water=i.strstart),r=i.bi_valid+42>>3,r=i.pending_buf_size-r>65535?65535:i.pending_buf_size-r,t=r>i.w_size?i.w_size:r,s=i.strstart-i.block_start,(s>=t||(s||e===Pt)&&e!==Xe&&i.strm.avail_in===0&&s<=r)&&(n=s>r?r:s,o=e===Pt&&i.strm.avail_in===0&&n===s?1:0,nl(i,i.block_start,n,o),i.block_start+=n,Et(i.strm)),o?tn:dt)},Nr=(i,e)=>{let t,n;for(;;){if(i.lookahead<le){if(Kn(i),i.lookahead<le&&e===Xe)return dt;if(i.lookahead===0)break}if(t=0,i.lookahead>=H&&(i.ins_h=je(i,i.ins_h,i.window[i.strstart+H-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),t!==0&&i.strstart-t<=i.w_size-le&&(i.match_length=Mh(i,t)),i.match_length>=H)if(n=Ye(i,i.strstart-i.match_start,i.match_length-H),i.lookahead-=i.match_length,i.match_length<=i.max_lazy_match&&i.lookahead>=H){i.match_length--;do i.strstart++,i.ins_h=je(i,i.ins_h,i.window[i.strstart+H-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart;while(--i.match_length!==0);i.strstart++}else i.strstart+=i.match_length,i.match_length=0,i.ins_h=i.window[i.strstart],i.ins_h=je(i,i.ins_h,i.window[i.strstart+1]);else n=Ye(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++;if(n&&(St(i,!1),i.strm.avail_out===0))return dt}return i.insert=i.strstart<H-1?i.strstart:H-1,e===Pt?(St(i,!0),i.strm.avail_out===0?tn:Vn):i.sym_next&&(St(i,!1),i.strm.avail_out===0)?dt:Qn},sn=(i,e)=>{let t,n,s;for(;;){if(i.lookahead<le){if(Kn(i),i.lookahead<le&&e===Xe)return dt;if(i.lookahead===0)break}if(t=0,i.lookahead>=H&&(i.ins_h=je(i,i.ins_h,i.window[i.strstart+H-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),i.prev_length=i.match_length,i.prev_match=i.match_start,i.match_length=H-1,t!==0&&i.prev_length<i.max_lazy_match&&i.strstart-t<=i.w_size-le&&(i.match_length=Mh(i,t),i.match_length<=5&&(i.strategy===xf||i.match_length===H&&i.strstart-i.match_start>4096)&&(i.match_length=H-1)),i.prev_length>=H&&i.match_length<=i.prev_length){s=i.strstart+i.lookahead-H,n=Ye(i,i.strstart-1-i.prev_match,i.prev_length-H),i.lookahead-=i.prev_length-1,i.prev_length-=2;do++i.strstart<=s&&(i.ins_h=je(i,i.ins_h,i.window[i.strstart+H-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart);while(--i.prev_length!==0);if(i.match_available=0,i.match_length=H-1,i.strstart++,n&&(St(i,!1),i.strm.avail_out===0))return dt}else if(i.match_available){if(n=Ye(i,0,i.window[i.strstart-1]),n&&St(i,!1),i.strstart++,i.lookahead--,i.strm.avail_out===0)return dt}else i.match_available=1,i.strstart++,i.lookahead--}return i.match_available&&(n=Ye(i,0,i.window[i.strstart-1]),i.match_available=0),i.insert=i.strstart<H-1?i.strstart:H-1,e===Pt?(St(i,!0),i.strm.avail_out===0?tn:Vn):i.sym_next&&(St(i,!1),i.strm.avail_out===0)?dt:Qn},$f=(i,e)=>{let t,n,s,r;const o=i.window;for(;;){if(i.lookahead<=Ke){if(Kn(i),i.lookahead<=Ke&&e===Xe)return dt;if(i.lookahead===0)break}if(i.match_length=0,i.lookahead>=H&&i.strstart>0&&(s=i.strstart-1,n=o[s],n===o[++s]&&n===o[++s]&&n===o[++s])){r=i.strstart+Ke;do;while(n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&s<r);i.match_length=Ke-(r-s),i.match_length>i.lookahead&&(i.match_length=i.lookahead)}if(i.match_length>=H?(t=Ye(i,1,i.match_length-H),i.lookahead-=i.match_length,i.strstart+=i.match_length,i.match_length=0):(t=Ye(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++),t&&(St(i,!1),i.strm.avail_out===0))return dt}return i.insert=0,e===Pt?(St(i,!0),i.strm.avail_out===0?tn:Vn):i.sym_next&&(St(i,!1),i.strm.avail_out===0)?dt:Qn},Bf=(i,e)=>{let t;for(;;){if(i.lookahead===0&&(Kn(i),i.lookahead===0)){if(e===Xe)return dt;break}if(i.match_length=0,t=Ye(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++,t&&(St(i,!1),i.strm.avail_out===0))return dt}return i.insert=0,e===Pt?(St(i,!0),i.strm.avail_out===0?tn:Vn):i.sym_next&&(St(i,!1),i.strm.avail_out===0)?dt:Qn};function Yt(i,e,t,n,s){this.good_length=i,this.max_lazy=e,this.nice_length=t,this.max_chain=n,this.func=s}const ns=[new Yt(0,0,0,0,Oh),new Yt(4,4,8,4,Nr),new Yt(4,5,16,8,Nr),new Yt(4,6,32,32,Nr),new Yt(4,4,16,16,sn),new Yt(8,16,32,32,sn),new Yt(8,16,128,128,sn),new Yt(8,32,128,256,sn),new Yt(32,128,258,1024,sn),new Yt(32,258,258,4096,sn)],Gf=i=>{i.window_size=2*i.w_size,Re(i.head),i.max_lazy_match=ns[i.level].max_lazy,i.good_match=ns[i.level].good_length,i.nice_match=ns[i.level].nice_length,i.max_chain_length=ns[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=H-1,i.match_available=0,i.ins_h=0};function Zf(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=kr,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(Pf*2),this.dyn_dtree=new Uint16Array((2*Ff+1)*2),this.bl_tree=new Uint16Array((2*Df+1)*2),Re(this.dyn_ltree),Re(this.dyn_dtree),Re(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Uf+1),this.heap=new Uint16Array(2*sl+1),Re(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*sl+1),Re(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Oa=i=>{if(!i)return 1;const e=i.state;return!e||e.strm!==i||e.status!==qn&&e.status!==Jl&&e.status!==al&&e.status!==rl&&e.status!==ll&&e.status!==ol&&e.status!==gi&&e.status!==is?1:0},Fh=i=>{if(Oa(i))return mi(i,re);i.total_in=i.total_out=0,i.data_type=kf;const e=i.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?Jl:e.wrap?qn:gi,i.adler=e.wrap===2?0:1,e.last_flush=-2,gf(e),st},Dh=i=>{const e=Fh(i);return e===st&&Gf(i.state),e},Hf=(i,e)=>Oa(i)||i.state.wrap!==2?re:(i.state.gzhead=e,st),Ph=(i,e,t,n,s,r)=>{if(!i)return re;let o=1;if(e===vf&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),s<1||s>Cf||t!==kr||n<8||n>15||e<0||e>9||r<0||r>Ef||n===8&&o!==1)return mi(i,re);n===8&&(n=9);const h=new Zf;return i.state=h,h.strm=i,h.status=qn,h.wrap=o,h.gzhead=null,h.w_bits=n,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=s+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+H-1)/H),h.window=new Uint8Array(h.w_size*2),h.head=new Uint16Array(h.hash_size),h.prev=new Uint16Array(h.w_size),h.lit_bufsize=1<<s+6,h.pending_buf_size=h.lit_bufsize*4,h.pending_buf=new Uint8Array(h.pending_buf_size),h.sym_buf=h.lit_bufsize,h.sym_end=(h.lit_bufsize-1)*3,h.level=e,h.strategy=r,h.method=t,Dh(i)},Jf=(i,e)=>Ph(i,e,kr,Rf,Tf,Sf),Wf=(i,e)=>{if(Oa(i)||e>mo||e<0)return i?mi(i,re):re;const t=i.state;if(!i.output||i.avail_in!==0&&!i.input||t.status===is&&e!==Pt)return mi(i,i.avail_out===0?zr:re);const n=t.last_flush;if(t.last_flush=e,t.pending!==0){if(Et(i),i.avail_out===0)return t.last_flush=-1,st}else if(i.avail_in===0&&bo(e)<=bo(n)&&e!==Pt)return mi(i,zr);if(t.status===is&&i.avail_in!==0)return mi(i,zr);if(t.status===qn&&t.wrap===0&&(t.status=gi),t.status===qn){let s=kr+(t.w_bits-8<<4)<<8,r=-1;if(t.strategy>=Ia||t.level<2?r=0:t.level<6?r=1:t.level===6?r=2:r=3,s|=r<<6,t.strstart!==0&&(s|=If),s+=31-s%31,ts(t,s),t.strstart!==0&&(ts(t,i.adler>>>16),ts(t,i.adler&65535)),i.adler=1,t.status=gi,Et(i),t.pending!==0)return t.last_flush=-1,st}if(t.status===Jl){if(i.adler=0,J(t,31),J(t,139),J(t,8),t.gzhead)J(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),J(t,t.gzhead.time&255),J(t,t.gzhead.time>>8&255),J(t,t.gzhead.time>>16&255),J(t,t.gzhead.time>>24&255),J(t,t.level===9?2:t.strategy>=Ia||t.level<2?4:0),J(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(J(t,t.gzhead.extra.length&255),J(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(i.adler=nt(i.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=al;else if(J(t,0),J(t,0),J(t,0),J(t,0),J(t,0),J(t,t.level===9?2:t.strategy>=Ia||t.level<2?4:0),J(t,zf),t.status=gi,Et(i),t.pending!==0)return t.last_flush=-1,st}if(t.status===al){if(t.gzhead.extra){let s=t.pending,r=(t.gzhead.extra.length&65535)-t.gzindex;for(;t.pending+r>t.pending_buf_size;){let h=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+h),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>s&&(i.adler=nt(i.adler,t.pending_buf,t.pending-s,s)),t.gzindex+=h,Et(i),t.pending!==0)return t.last_flush=-1,st;s=0,r-=h}let o=new Uint8Array(t.gzhead.extra);t.pending_buf.set(o.subarray(t.gzindex,t.gzindex+r),t.pending),t.pending+=r,t.gzhead.hcrc&&t.pending>s&&(i.adler=nt(i.adler,t.pending_buf,t.pending-s,s)),t.gzindex=0}t.status=rl}if(t.status===rl){if(t.gzhead.name){let s=t.pending,r;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>s&&(i.adler=nt(i.adler,t.pending_buf,t.pending-s,s)),Et(i),t.pending!==0)return t.last_flush=-1,st;s=0}t.gzindex<t.gzhead.name.length?r=t.gzhead.name.charCodeAt(t.gzindex++)&255:r=0,J(t,r)}while(r!==0);t.gzhead.hcrc&&t.pending>s&&(i.adler=nt(i.adler,t.pending_buf,t.pending-s,s)),t.gzindex=0}t.status=ll}if(t.status===ll){if(t.gzhead.comment){let s=t.pending,r;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>s&&(i.adler=nt(i.adler,t.pending_buf,t.pending-s,s)),Et(i),t.pending!==0)return t.last_flush=-1,st;s=0}t.gzindex<t.gzhead.comment.length?r=t.gzhead.comment.charCodeAt(t.gzindex++)&255:r=0,J(t,r)}while(r!==0);t.gzhead.hcrc&&t.pending>s&&(i.adler=nt(i.adler,t.pending_buf,t.pending-s,s))}t.status=ol}if(t.status===ol){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(Et(i),t.pending!==0))return t.last_flush=-1,st;J(t,i.adler&255),J(t,i.adler>>8&255),i.adler=0}if(t.status=gi,Et(i),t.pending!==0)return t.last_flush=-1,st}if(i.avail_in!==0||t.lookahead!==0||e!==Xe&&t.status!==is){let s=t.level===0?Oh(t,e):t.strategy===Ia?Bf(t,e):t.strategy===Af?$f(t,e):ns[t.level].func(t,e);if((s===tn||s===Vn)&&(t.status=is),s===dt||s===tn)return i.avail_out===0&&(t.last_flush=-1),st;if(s===Qn&&(e===bf?_f(t):e!==mo&&(nl(t,0,0,!1),e===wf&&(Re(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),Et(i),i.avail_out===0))return t.last_flush=-1,st}return e!==Pt?st:t.wrap<=0?_o:(t.wrap===2?(J(t,i.adler&255),J(t,i.adler>>8&255),J(t,i.adler>>16&255),J(t,i.adler>>24&255),J(t,i.total_in&255),J(t,i.total_in>>8&255),J(t,i.total_in>>16&255),J(t,i.total_in>>24&255)):(ts(t,i.adler>>>16),ts(t,i.adler&65535)),Et(i),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?st:_o)},qf=i=>{if(Oa(i))return re;const e=i.state.status;return i.state=null,e===gi?mi(i,yf):st},Kf=(i,e)=>{let t=e.length;if(Oa(i))return re;const n=i.state,s=n.wrap;if(s===2||s===1&&n.status!==qn||n.lookahead)return re;if(s===1&&(i.adler=ms(i.adler,e,t,0)),n.wrap=0,t>=n.w_size){s===0&&(Re(n.head),n.strstart=0,n.block_start=0,n.insert=0);let c=new Uint8Array(n.w_size);c.set(e.subarray(t-n.w_size,t),0),e=c,t=n.w_size}const r=i.avail_in,o=i.next_in,h=i.input;for(i.avail_in=t,i.next_in=0,i.input=e,Kn(n);n.lookahead>=H;){let c=n.strstart,l=n.lookahead-(H-1);do n.ins_h=je(n,n.ins_h,n.window[c+H-1]),n.prev[c&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=c,c++;while(--l);n.strstart=c,n.lookahead=H-1,Kn(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=H-1,n.match_available=0,i.next_in=o,i.input=h,i.avail_in=r,n.wrap=s,st};var Yf=Jf,Xf=Ph,jf=Dh,Qf=Fh,Vf=Hf,tc=Wf,ec=qf,ic=Kf,nc="pako deflate (from Nodeca project)",ls={deflateInit:Yf,deflateInit2:Xf,deflateReset:jf,deflateResetKeep:Qf,deflateSetHeader:Vf,deflate:tc,deflateEnd:ec,deflateSetDictionary:ic,deflateInfo:nc};const sc=(i,e)=>Object.prototype.hasOwnProperty.call(i,e);var ac=function(i){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const n in t)sc(t,n)&&(i[n]=t[n])}}return i},rc=i=>{let e=0;for(let n=0,s=i.length;n<s;n++)e+=i[n].length;const t=new Uint8Array(e);for(let n=0,s=0,r=i.length;n<r;n++){let o=i[n];t.set(o,s),s+=o.length}return t},Cr={assign:ac,flattenChunks:rc};let Uh=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Uh=!1}const _s=new Uint8Array(256);for(let i=0;i<256;i++)_s[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;_s[254]=_s[254]=1;var lc=i=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(i);let e,t,n,s,r,o=i.length,h=0;for(s=0;s<o;s++)t=i.charCodeAt(s),(t&64512)===55296&&s+1<o&&(n=i.charCodeAt(s+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),s++)),h+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(h),r=0,s=0;r<h;s++)t=i.charCodeAt(s),(t&64512)===55296&&s+1<o&&(n=i.charCodeAt(s+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),s++)),t<128?e[r++]=t:t<2048?(e[r++]=192|t>>>6,e[r++]=128|t&63):t<65536?(e[r++]=224|t>>>12,e[r++]=128|t>>>6&63,e[r++]=128|t&63):(e[r++]=240|t>>>18,e[r++]=128|t>>>12&63,e[r++]=128|t>>>6&63,e[r++]=128|t&63);return e};const oc=(i,e)=>{if(e<65534&&i.subarray&&Uh)return String.fromCharCode.apply(null,i.length===e?i:i.subarray(0,e));let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(i[n]);return t};var hc=(i,e)=>{const t=e||i.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(i.subarray(0,e));let n,s;const r=new Array(t*2);for(s=0,n=0;n<t;){let o=i[n++];if(o<128){r[s++]=o;continue}let h=_s[o];if(h>4){r[s++]=65533,n+=h-1;continue}for(o&=h===2?31:h===3?15:7;h>1&&n<t;)o=o<<6|i[n++]&63,h--;if(h>1){r[s++]=65533;continue}o<65536?r[s++]=o:(o-=65536,r[s++]=55296|o>>10&1023,r[s++]=56320|o&1023)}return oc(r,s)},uc=(i,e)=>{e=e||i.length,e>i.length&&(e=i.length);let t=e-1;for(;t>=0&&(i[t]&192)===128;)t--;return t<0||t===0?e:t+_s[i[t]]>e?t:e},bs={string2buf:lc,buf2string:hc,utf8border:uc};function fc(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Ih=fc;const zh=Object.prototype.toString,{Z_NO_FLUSH:cc,Z_SYNC_FLUSH:dc,Z_FULL_FLUSH:pc,Z_FINISH:gc,Z_OK:Va,Z_STREAM_END:mc,Z_DEFAULT_COMPRESSION:_c,Z_DEFAULT_STRATEGY:bc,Z_DEFLATED:wc}=Ma;function Wl(i){this.options=Cr.assign({level:_c,method:wc,chunkSize:16384,windowBits:15,memLevel:8,strategy:bc},i||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ih,this.strm.avail_out=0;let t=ls.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==Va)throw new Error(Wn[t]);if(e.header&&ls.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=bs.string2buf(e.dictionary):zh.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,t=ls.deflateSetDictionary(this.strm,n),t!==Va)throw new Error(Wn[t]);this._dict_set=!0}}Wl.prototype.push=function(i,e){const t=this.strm,n=this.options.chunkSize;let s,r;if(this.ended)return!1;for(e===~~e?r=e:r=e===!0?gc:cc,typeof i=="string"?t.input=bs.string2buf(i):zh.call(i)==="[object ArrayBuffer]"?t.input=new Uint8Array(i):t.input=i,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),(r===dc||r===pc)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(s=ls.deflate(t,r),s===mc)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),s=ls.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Va;if(t.avail_out===0){this.onData(t.output);continue}if(r>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};Wl.prototype.onData=function(i){this.chunks.push(i)};Wl.prototype.onEnd=function(i){i===Va&&(this.result=Cr.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};const za=16209,yc=16191;var vc=function(e,t){let n,s,r,o,h,c,l,f,_,m,p,y,U,O,C,P,I,x,B,L,k,W,G,$;const Z=e.state;n=e.next_in,G=e.input,s=n+(e.avail_in-5),r=e.next_out,$=e.output,o=r-(t-e.avail_out),h=r+(e.avail_out-257),c=Z.dmax,l=Z.wsize,f=Z.whave,_=Z.wnext,m=Z.window,p=Z.hold,y=Z.bits,U=Z.lencode,O=Z.distcode,C=(1<<Z.lenbits)-1,P=(1<<Z.distbits)-1;t:do{y<15&&(p+=G[n++]<<y,y+=8,p+=G[n++]<<y,y+=8),I=U[p&C];e:for(;;){if(x=I>>>24,p>>>=x,y-=x,x=I>>>16&255,x===0)$[r++]=I&65535;else if(x&16){B=I&65535,x&=15,x&&(y<x&&(p+=G[n++]<<y,y+=8),B+=p&(1<<x)-1,p>>>=x,y-=x),y<15&&(p+=G[n++]<<y,y+=8,p+=G[n++]<<y,y+=8),I=O[p&P];i:for(;;){if(x=I>>>24,p>>>=x,y-=x,x=I>>>16&255,x&16){if(L=I&65535,x&=15,y<x&&(p+=G[n++]<<y,y+=8,y<x&&(p+=G[n++]<<y,y+=8)),L+=p&(1<<x)-1,L>c){e.msg="invalid distance too far back",Z.mode=za;break t}if(p>>>=x,y-=x,x=r-o,L>x){if(x=L-x,x>f&&Z.sane){e.msg="invalid distance too far back",Z.mode=za;break t}if(k=0,W=m,_===0){if(k+=l-x,x<B){B-=x;do $[r++]=m[k++];while(--x);k=r-L,W=$}}else if(_<x){if(k+=l+_-x,x-=_,x<B){B-=x;do $[r++]=m[k++];while(--x);if(k=0,_<B){x=_,B-=x;do $[r++]=m[k++];while(--x);k=r-L,W=$}}}else if(k+=_-x,x<B){B-=x;do $[r++]=m[k++];while(--x);k=r-L,W=$}for(;B>2;)$[r++]=W[k++],$[r++]=W[k++],$[r++]=W[k++],B-=3;B&&($[r++]=W[k++],B>1&&($[r++]=W[k++]))}else{k=r-L;do $[r++]=$[k++],$[r++]=$[k++],$[r++]=$[k++],B-=3;while(B>2);B&&($[r++]=$[k++],B>1&&($[r++]=$[k++]))}}else if(x&64){e.msg="invalid distance code",Z.mode=za;break t}else{I=O[(I&65535)+(p&(1<<x)-1)];continue i}break}}else if(x&64)if(x&32){Z.mode=yc;break t}else{e.msg="invalid literal/length code",Z.mode=za;break t}else{I=U[(I&65535)+(p&(1<<x)-1)];continue e}break}}while(n<s&&r<h);B=y>>3,n-=B,y-=B<<3,p&=(1<<y)-1,e.next_in=n,e.next_out=r,e.avail_in=n<s?5+(s-n):5-(n-s),e.avail_out=r<h?257+(h-r):257-(r-h),Z.hold=p,Z.bits=y};const an=15,wo=852,yo=592,vo=0,Lr=1,xo=2,xc=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Ac=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Ec=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Sc=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),kc=(i,e,t,n,s,r,o,h)=>{const c=h.bits;let l=0,f=0,_=0,m=0,p=0,y=0,U=0,O=0,C=0,P=0,I,x,B,L,k,W=null,G;const $=new Uint16Array(an+1),Z=new Uint16Array(an+1);let zt=null,ao,Pa,Ua;for(l=0;l<=an;l++)$[l]=0;for(f=0;f<n;f++)$[e[t+f]]++;for(p=c,m=an;m>=1&&$[m]===0;m--);if(p>m&&(p=m),m===0)return s[r++]=1<<24|64<<16|0,s[r++]=1<<24|64<<16|0,h.bits=1,0;for(_=1;_<m&&$[_]===0;_++);for(p<_&&(p=_),O=1,l=1;l<=an;l++)if(O<<=1,O-=$[l],O<0)return-1;if(O>0&&(i===vo||m!==1))return-1;for(Z[1]=0,l=1;l<an;l++)Z[l+1]=Z[l]+$[l];for(f=0;f<n;f++)e[t+f]!==0&&(o[Z[e[t+f]]++]=f);if(i===vo?(W=zt=o,G=20):i===Lr?(W=xc,zt=Ac,G=257):(W=Ec,zt=Sc,G=0),P=0,f=0,l=_,k=r,y=p,U=0,B=-1,C=1<<p,L=C-1,i===Lr&&C>wo||i===xo&&C>yo)return 1;for(;;){ao=l-U,o[f]+1<G?(Pa=0,Ua=o[f]):o[f]>=G?(Pa=zt[o[f]-G],Ua=W[o[f]-G]):(Pa=96,Ua=0),I=1<<l-U,x=1<<y,_=x;do x-=I,s[k+(P>>U)+x]=ao<<24|Pa<<16|Ua|0;while(x!==0);for(I=1<<l-1;P&I;)I>>=1;if(I!==0?(P&=I-1,P+=I):P=0,f++,--$[l]===0){if(l===m)break;l=e[t+o[f]]}if(l>p&&(P&L)!==B){for(U===0&&(U=p),k+=_,y=l-U,O=1<<y;y+U<m&&(O-=$[y+U],!(O<=0));)y++,O<<=1;if(C+=1<<y,i===Lr&&C>wo||i===xo&&C>yo)return 1;B=P&L,s[B]=p<<24|y<<16|k-r|0}}return P!==0&&(s[k+P]=l-U<<24|64<<16|0),h.bits=p,0};var os=kc;const Cc=0,Nh=1,Lh=2,{Z_FINISH:Ao,Z_BLOCK:Rc,Z_TREES:Na,Z_OK:en,Z_STREAM_END:Tc,Z_NEED_DICT:Mc,Z_STREAM_ERROR:Ut,Z_DATA_ERROR:$h,Z_MEM_ERROR:Bh,Z_BUF_ERROR:Oc,Z_DEFLATED:Eo}=Ma,Rr=16180,So=16181,ko=16182,Co=16183,Ro=16184,To=16185,Mo=16186,Oo=16187,Fo=16188,Do=16189,tr=16190,oe=16191,$r=16192,Po=16193,Br=16194,Uo=16195,Io=16196,zo=16197,No=16198,La=16199,$a=16200,Lo=16201,$o=16202,Bo=16203,Go=16204,Zo=16205,Gr=16206,Ho=16207,Jo=16208,Y=16209,Gh=16210,Zh=16211,Fc=852,Dc=592,Pc=15,Uc=Pc,Wo=i=>(i>>>24&255)+(i>>>8&65280)+((i&65280)<<8)+((i&255)<<24);function Ic(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const nn=i=>{if(!i)return 1;const e=i.state;return!e||e.strm!==i||e.mode<Rr||e.mode>Zh?1:0},Hh=i=>{if(nn(i))return Ut;const e=i.state;return i.total_in=i.total_out=e.total=0,i.msg="",e.wrap&&(i.adler=e.wrap&1),e.mode=Rr,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(Fc),e.distcode=e.distdyn=new Int32Array(Dc),e.sane=1,e.back=-1,en},Jh=i=>{if(nn(i))return Ut;const e=i.state;return e.wsize=0,e.whave=0,e.wnext=0,Hh(i)},Wh=(i,e)=>{let t;if(nn(i))return Ut;const n=i.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?Ut:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,Jh(i))},qh=(i,e)=>{if(!i)return Ut;const t=new Ic;i.state=t,t.strm=i,t.window=null,t.mode=Rr;const n=Wh(i,e);return n!==en&&(i.state=null),n},zc=i=>qh(i,Uc);let qo=!0,Zr,Hr;const Nc=i=>{if(qo){Zr=new Int32Array(512),Hr=new Int32Array(32);let e=0;for(;e<144;)i.lens[e++]=8;for(;e<256;)i.lens[e++]=9;for(;e<280;)i.lens[e++]=7;for(;e<288;)i.lens[e++]=8;for(os(Nh,i.lens,0,288,Zr,0,i.work,{bits:9}),e=0;e<32;)i.lens[e++]=5;os(Lh,i.lens,0,32,Hr,0,i.work,{bits:5}),qo=!1}i.lencode=Zr,i.lenbits=9,i.distcode=Hr,i.distbits=5},Kh=(i,e,t,n)=>{let s;const r=i.state;return r.window===null&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),n>=r.wsize?(r.window.set(e.subarray(t-r.wsize,t),0),r.wnext=0,r.whave=r.wsize):(s=r.wsize-r.wnext,s>n&&(s=n),r.window.set(e.subarray(t-n,t-n+s),r.wnext),n-=s,n?(r.window.set(e.subarray(t-n,t),0),r.wnext=n,r.whave=r.wsize):(r.wnext+=s,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=s))),0},Lc=(i,e)=>{let t,n,s,r,o,h,c,l,f,_,m,p,y,U,O=0,C,P,I,x,B,L,k,W;const G=new Uint8Array(4);let $,Z;const zt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(nn(i)||!i.output||!i.input&&i.avail_in!==0)return Ut;t=i.state,t.mode===oe&&(t.mode=$r),o=i.next_out,s=i.output,c=i.avail_out,r=i.next_in,n=i.input,h=i.avail_in,l=t.hold,f=t.bits,_=h,m=c,W=en;t:for(;;)switch(t.mode){case Rr:if(t.wrap===0){t.mode=$r;break}for(;f<16;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}if(t.wrap&2&&l===35615){t.wbits===0&&(t.wbits=15),t.check=0,G[0]=l&255,G[1]=l>>>8&255,t.check=nt(t.check,G,2,0),l=0,f=0,t.mode=So;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((l&255)<<8)+(l>>8))%31){i.msg="incorrect header check",t.mode=Y;break}if((l&15)!==Eo){i.msg="unknown compression method",t.mode=Y;break}if(l>>>=4,f-=4,k=(l&15)+8,t.wbits===0&&(t.wbits=k),k>15||k>t.wbits){i.msg="invalid window size",t.mode=Y;break}t.dmax=1<<t.wbits,t.flags=0,i.adler=t.check=1,t.mode=l&512?Do:oe,l=0,f=0;break;case So:for(;f<16;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}if(t.flags=l,(t.flags&255)!==Eo){i.msg="unknown compression method",t.mode=Y;break}if(t.flags&57344){i.msg="unknown header flags set",t.mode=Y;break}t.head&&(t.head.text=l>>8&1),t.flags&512&&t.wrap&4&&(G[0]=l&255,G[1]=l>>>8&255,t.check=nt(t.check,G,2,0)),l=0,f=0,t.mode=ko;case ko:for(;f<32;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}t.head&&(t.head.time=l),t.flags&512&&t.wrap&4&&(G[0]=l&255,G[1]=l>>>8&255,G[2]=l>>>16&255,G[3]=l>>>24&255,t.check=nt(t.check,G,4,0)),l=0,f=0,t.mode=Co;case Co:for(;f<16;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}t.head&&(t.head.xflags=l&255,t.head.os=l>>8),t.flags&512&&t.wrap&4&&(G[0]=l&255,G[1]=l>>>8&255,t.check=nt(t.check,G,2,0)),l=0,f=0,t.mode=Ro;case Ro:if(t.flags&1024){for(;f<16;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}t.length=l,t.head&&(t.head.extra_len=l),t.flags&512&&t.wrap&4&&(G[0]=l&255,G[1]=l>>>8&255,t.check=nt(t.check,G,2,0)),l=0,f=0}else t.head&&(t.head.extra=null);t.mode=To;case To:if(t.flags&1024&&(p=t.length,p>h&&(p=h),p&&(t.head&&(k=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(r,r+p),k)),t.flags&512&&t.wrap&4&&(t.check=nt(t.check,n,p,r)),h-=p,r+=p,t.length-=p),t.length))break t;t.length=0,t.mode=Mo;case Mo:if(t.flags&2048){if(h===0)break t;p=0;do k=n[r+p++],t.head&&k&&t.length<65536&&(t.head.name+=String.fromCharCode(k));while(k&&p<h);if(t.flags&512&&t.wrap&4&&(t.check=nt(t.check,n,p,r)),h-=p,r+=p,k)break t}else t.head&&(t.head.name=null);t.length=0,t.mode=Oo;case Oo:if(t.flags&4096){if(h===0)break t;p=0;do k=n[r+p++],t.head&&k&&t.length<65536&&(t.head.comment+=String.fromCharCode(k));while(k&&p<h);if(t.flags&512&&t.wrap&4&&(t.check=nt(t.check,n,p,r)),h-=p,r+=p,k)break t}else t.head&&(t.head.comment=null);t.mode=Fo;case Fo:if(t.flags&512){for(;f<16;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}if(t.wrap&4&&l!==(t.check&65535)){i.msg="header crc mismatch",t.mode=Y;break}l=0,f=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),i.adler=t.check=0,t.mode=oe;break;case Do:for(;f<32;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}i.adler=t.check=Wo(l),l=0,f=0,t.mode=tr;case tr:if(t.havedict===0)return i.next_out=o,i.avail_out=c,i.next_in=r,i.avail_in=h,t.hold=l,t.bits=f,Mc;i.adler=t.check=1,t.mode=oe;case oe:if(e===Rc||e===Na)break t;case $r:if(t.last){l>>>=f&7,f-=f&7,t.mode=Gr;break}for(;f<3;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}switch(t.last=l&1,l>>>=1,f-=1,l&3){case 0:t.mode=Po;break;case 1:if(Nc(t),t.mode=La,e===Na){l>>>=2,f-=2;break t}break;case 2:t.mode=Io;break;case 3:i.msg="invalid block type",t.mode=Y}l>>>=2,f-=2;break;case Po:for(l>>>=f&7,f-=f&7;f<32;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}if((l&65535)!==(l>>>16^65535)){i.msg="invalid stored block lengths",t.mode=Y;break}if(t.length=l&65535,l=0,f=0,t.mode=Br,e===Na)break t;case Br:t.mode=Uo;case Uo:if(p=t.length,p){if(p>h&&(p=h),p>c&&(p=c),p===0)break t;s.set(n.subarray(r,r+p),o),h-=p,r+=p,c-=p,o+=p,t.length-=p;break}t.mode=oe;break;case Io:for(;f<14;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}if(t.nlen=(l&31)+257,l>>>=5,f-=5,t.ndist=(l&31)+1,l>>>=5,f-=5,t.ncode=(l&15)+4,l>>>=4,f-=4,t.nlen>286||t.ndist>30){i.msg="too many length or distance symbols",t.mode=Y;break}t.have=0,t.mode=zo;case zo:for(;t.have<t.ncode;){for(;f<3;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}t.lens[zt[t.have++]]=l&7,l>>>=3,f-=3}for(;t.have<19;)t.lens[zt[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,$={bits:t.lenbits},W=os(Cc,t.lens,0,19,t.lencode,0,t.work,$),t.lenbits=$.bits,W){i.msg="invalid code lengths set",t.mode=Y;break}t.have=0,t.mode=No;case No:for(;t.have<t.nlen+t.ndist;){for(;O=t.lencode[l&(1<<t.lenbits)-1],C=O>>>24,P=O>>>16&255,I=O&65535,!(C<=f);){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}if(I<16)l>>>=C,f-=C,t.lens[t.have++]=I;else{if(I===16){for(Z=C+2;f<Z;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}if(l>>>=C,f-=C,t.have===0){i.msg="invalid bit length repeat",t.mode=Y;break}k=t.lens[t.have-1],p=3+(l&3),l>>>=2,f-=2}else if(I===17){for(Z=C+3;f<Z;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}l>>>=C,f-=C,k=0,p=3+(l&7),l>>>=3,f-=3}else{for(Z=C+7;f<Z;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}l>>>=C,f-=C,k=0,p=11+(l&127),l>>>=7,f-=7}if(t.have+p>t.nlen+t.ndist){i.msg="invalid bit length repeat",t.mode=Y;break}for(;p--;)t.lens[t.have++]=k}}if(t.mode===Y)break;if(t.lens[256]===0){i.msg="invalid code -- missing end-of-block",t.mode=Y;break}if(t.lenbits=9,$={bits:t.lenbits},W=os(Nh,t.lens,0,t.nlen,t.lencode,0,t.work,$),t.lenbits=$.bits,W){i.msg="invalid literal/lengths set",t.mode=Y;break}if(t.distbits=6,t.distcode=t.distdyn,$={bits:t.distbits},W=os(Lh,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,$),t.distbits=$.bits,W){i.msg="invalid distances set",t.mode=Y;break}if(t.mode=La,e===Na)break t;case La:t.mode=$a;case $a:if(h>=6&&c>=258){i.next_out=o,i.avail_out=c,i.next_in=r,i.avail_in=h,t.hold=l,t.bits=f,vc(i,m),o=i.next_out,s=i.output,c=i.avail_out,r=i.next_in,n=i.input,h=i.avail_in,l=t.hold,f=t.bits,t.mode===oe&&(t.back=-1);break}for(t.back=0;O=t.lencode[l&(1<<t.lenbits)-1],C=O>>>24,P=O>>>16&255,I=O&65535,!(C<=f);){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}if(P&&!(P&240)){for(x=C,B=P,L=I;O=t.lencode[L+((l&(1<<x+B)-1)>>x)],C=O>>>24,P=O>>>16&255,I=O&65535,!(x+C<=f);){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}l>>>=x,f-=x,t.back+=x}if(l>>>=C,f-=C,t.back+=C,t.length=I,P===0){t.mode=Zo;break}if(P&32){t.back=-1,t.mode=oe;break}if(P&64){i.msg="invalid literal/length code",t.mode=Y;break}t.extra=P&15,t.mode=Lo;case Lo:if(t.extra){for(Z=t.extra;f<Z;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}t.length+=l&(1<<t.extra)-1,l>>>=t.extra,f-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=$o;case $o:for(;O=t.distcode[l&(1<<t.distbits)-1],C=O>>>24,P=O>>>16&255,I=O&65535,!(C<=f);){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}if(!(P&240)){for(x=C,B=P,L=I;O=t.distcode[L+((l&(1<<x+B)-1)>>x)],C=O>>>24,P=O>>>16&255,I=O&65535,!(x+C<=f);){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}l>>>=x,f-=x,t.back+=x}if(l>>>=C,f-=C,t.back+=C,P&64){i.msg="invalid distance code",t.mode=Y;break}t.offset=I,t.extra=P&15,t.mode=Bo;case Bo:if(t.extra){for(Z=t.extra;f<Z;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}t.offset+=l&(1<<t.extra)-1,l>>>=t.extra,f-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){i.msg="invalid distance too far back",t.mode=Y;break}t.mode=Go;case Go:if(c===0)break t;if(p=m-c,t.offset>p){if(p=t.offset-p,p>t.whave&&t.sane){i.msg="invalid distance too far back",t.mode=Y;break}p>t.wnext?(p-=t.wnext,y=t.wsize-p):y=t.wnext-p,p>t.length&&(p=t.length),U=t.window}else U=s,y=o-t.offset,p=t.length;p>c&&(p=c),c-=p,t.length-=p;do s[o++]=U[y++];while(--p);t.length===0&&(t.mode=$a);break;case Zo:if(c===0)break t;s[o++]=t.length,c--,t.mode=$a;break;case Gr:if(t.wrap){for(;f<32;){if(h===0)break t;h--,l|=n[r++]<<f,f+=8}if(m-=c,i.total_out+=m,t.total+=m,t.wrap&4&&m&&(i.adler=t.check=t.flags?nt(t.check,s,m,o-m):ms(t.check,s,m,o-m)),m=c,t.wrap&4&&(t.flags?l:Wo(l))!==t.check){i.msg="incorrect data check",t.mode=Y;break}l=0,f=0}t.mode=Ho;case Ho:if(t.wrap&&t.flags){for(;f<32;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}if(t.wrap&4&&l!==(t.total&4294967295)){i.msg="incorrect length check",t.mode=Y;break}l=0,f=0}t.mode=Jo;case Jo:W=Tc;break t;case Y:W=$h;break t;case Gh:return Bh;case Zh:default:return Ut}return i.next_out=o,i.avail_out=c,i.next_in=r,i.avail_in=h,t.hold=l,t.bits=f,(t.wsize||m!==i.avail_out&&t.mode<Y&&(t.mode<Gr||e!==Ao))&&Kh(i,i.output,i.next_out,m-i.avail_out),_-=i.avail_in,m-=i.avail_out,i.total_in+=_,i.total_out+=m,t.total+=m,t.wrap&4&&m&&(i.adler=t.check=t.flags?nt(t.check,s,m,i.next_out-m):ms(t.check,s,m,i.next_out-m)),i.data_type=t.bits+(t.last?64:0)+(t.mode===oe?128:0)+(t.mode===La||t.mode===Br?256:0),(_===0&&m===0||e===Ao)&&W===en&&(W=Oc),W},$c=i=>{if(nn(i))return Ut;let e=i.state;return e.window&&(e.window=null),i.state=null,en},Bc=(i,e)=>{if(nn(i))return Ut;const t=i.state;return t.wrap&2?(t.head=e,e.done=!1,en):Ut},Gc=(i,e)=>{const t=e.length;let n,s,r;return nn(i)||(n=i.state,n.wrap!==0&&n.mode!==tr)?Ut:n.mode===tr&&(s=1,s=ms(s,e,t,0),s!==n.check)?$h:(r=Kh(i,e,t,t),r?(n.mode=Gh,Bh):(n.havedict=1,en))};var Zc=Jh,Hc=Wh,Jc=Hh,Wc=zc,qc=qh,Kc=Lc,Yc=$c,Xc=Bc,jc=Gc,Qc="pako inflate (from Nodeca project)",fe={inflateReset:Zc,inflateReset2:Hc,inflateResetKeep:Jc,inflateInit:Wc,inflateInit2:qc,inflate:Kc,inflateEnd:Yc,inflateGetHeader:Xc,inflateSetDictionary:jc,inflateInfo:Qc};function Vc(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var td=Vc;const Yh=Object.prototype.toString,{Z_NO_FLUSH:ed,Z_FINISH:id,Z_OK:ws,Z_STREAM_END:Jr,Z_NEED_DICT:Wr,Z_STREAM_ERROR:nd,Z_DATA_ERROR:Ko,Z_MEM_ERROR:sd}=Ma;function Fa(i){this.options=Cr.assign({chunkSize:1024*64,windowBits:15,to:""},i||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(i&&i.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ih,this.strm.avail_out=0;let t=fe.inflateInit2(this.strm,e.windowBits);if(t!==ws)throw new Error(Wn[t]);if(this.header=new td,fe.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=bs.string2buf(e.dictionary):Yh.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=fe.inflateSetDictionary(this.strm,e.dictionary),t!==ws)))throw new Error(Wn[t])}Fa.prototype.push=function(i,e){const t=this.strm,n=this.options.chunkSize,s=this.options.dictionary;let r,o,h;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?id:ed,Yh.call(i)==="[object ArrayBuffer]"?t.input=new Uint8Array(i):t.input=i,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),r=fe.inflate(t,o),r===Wr&&s&&(r=fe.inflateSetDictionary(t,s),r===ws?r=fe.inflate(t,o):r===Ko&&(r=Wr));t.avail_in>0&&r===Jr&&t.state.wrap>0&&i[t.next_in]!==0;)fe.inflateReset(t),r=fe.inflate(t,o);switch(r){case nd:case Ko:case Wr:case sd:return this.onEnd(r),this.ended=!0,!1}if(h=t.avail_out,t.next_out&&(t.avail_out===0||r===Jr))if(this.options.to==="string"){let c=bs.utf8border(t.output,t.next_out),l=t.next_out-c,f=bs.buf2string(t.output,c);t.next_out=l,t.avail_out=n-l,l&&t.output.set(t.output.subarray(c,c+l),0),this.onData(f)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(r===ws&&h===0)){if(r===Jr)return r=fe.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};Fa.prototype.onData=function(i){this.chunks.push(i)};Fa.prototype.onEnd=function(i){i===ws&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Cr.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};function ql(i,e){const t=new Fa(e);if(t.push(i),t.err)throw t.msg||Wn[t.err];return t.result}function ad(i,e){return e=e||{},e.raw=!0,ql(i,e)}var rd=Fa,ld=ql,od=ad,hd=ql,ud=Ma,fd={Inflate:rd,inflate:ld,inflateRaw:od,ungzip:hd,constants:ud};const{Inflate:cd,inflate:dd,inflateRaw:Tp,ungzip:Mp}=fd;var pd=cd,gd=dd;const qr=[137,80,78,71,13,10,26,10],Xh=[];for(let i=0;i<256;i++){let e=i;for(let t=0;t<8;t++)e&1?e=3988292384^e>>>1:e=e>>>1;Xh[i]=e}const Yo=4294967295;function md(i,e,t){let n=i;for(let s=0;s<t;s++)n=Xh[(n^e[s])&255]^n>>>8;return n}function _d(i,e){return(md(Yo,i,e)^Yo)>>>0}var Nt;(function(i){i[i.UNKNOWN=-1]="UNKNOWN",i[i.GREYSCALE=0]="GREYSCALE",i[i.TRUECOLOUR=2]="TRUECOLOUR",i[i.INDEXED_COLOUR=3]="INDEXED_COLOUR",i[i.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",i[i.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"})(Nt||(Nt={}));var hs;(function(i){i[i.UNKNOWN=-1]="UNKNOWN",i[i.DEFLATE=0]="DEFLATE"})(hs||(hs={}));var er;(function(i){i[i.UNKNOWN=-1]="UNKNOWN",i[i.ADAPTIVE=0]="ADAPTIVE"})(er||(er={}));var ir;(function(i){i[i.UNKNOWN=-1]="UNKNOWN",i[i.NO_INTERLACE=0]="NO_INTERLACE",i[i.ADAM7=1]="ADAM7"})(ir||(ir={}));const bd=new Uint8Array(0),Xo="\0",wd=new Uint16Array([255]),yd=new Uint8Array(wd.buffer),vd=yd[0]===255;class xd extends $l{constructor(e,t={}){super(e);const{checkCrc:n=!1}=t;this._checkCrc=n,this._inflator=new pd,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=hs.UNKNOWN,this._filterMethod=er.UNKNOWN,this._interlaceMethod=ir.UNKNOWN,this._colorType=Nt.UNKNOWN,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let e=0;e<qr.length;e++)if(this.readUint8()!==qr[e])throw new Error(`wrong PNG signature. Byte at ${e} should be ${qr[e]}.`)}decodeChunk(){const e=this.readUint32(),t=this.readChars(4),n=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case"tEXt":this.decodetEXt(e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e);break}if(this.offset-n!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);if(this._checkCrc){const s=this.readUint32(),r=e+4,o=_d(new Uint8Array(this.buffer,this.byteOffset+this.offset-r-4,r),r);if(o!==s)throw new Error(`CRC mismatch for chunk ${t}. Expected ${s}, found ${o}`)}else this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=Md(this.readUint8());const t=this.readUint8();this._colorType=t;let n;switch(t){case Nt.GREYSCALE:n=1;break;case Nt.TRUECOLOUR:n=3;break;case Nt.INDEXED_COLOUR:n=1;break;case Nt.GREYSCALE_ALPHA:n=2;break;case Nt.TRUECOLOUR_ALPHA:n=4;break;default:throw new Error(`Unknown color type: ${t}`)}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==hs.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(e){if(e%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);const t=e/3;this._hasPalette=!0;const n=[];this._palette=n;for(let s=0;s<t;s++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,e)),this.skip(e)}decodetRNS(e){switch(this._colorType){case Nt.GREYSCALE:case Nt.TRUECOLOUR:{if(e%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${e}`);if(e/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${e/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let t=0;t<e/2;t++)this._transparency[t]=this.readUint16();break}case Nt.INDEXED_COLOUR:{if(e>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let t=0;for(;t<e;t++){const n=this.readByte();this._palette[t].push(n)}for(;t<this._palette.length;t++)this._palette[t].push(255);break}default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(e){let t="",n;for(;(n=this.readChar())!==Xo;)t+=n;const s=this.readUint8();if(s!==hs.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${s}`);const r=this.readBytes(e-t.length-2);this._png.iccEmbeddedProfile={name:t,profile:gd(r)}}decodetEXt(e){let t="",n;for(;(n=this.readChar())!==Xo;)t+=n;this._png.text[t]=this.readChars(e-t.length-1)}decodepHYs(){const e=this.readUint32(),t=this.readUint32(),n=this.readByte();this._png.resolution={x:e,y:t,unit:n}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const e=this._inflator.result;if(this._filterMethod!==er.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===ir.NO_INTERLACE)this.decodeInterlaceNull(e);else throw new Error(`Interlace method ${this._interlaceMethod} not supported`)}decodeInterlaceNull(e){const t=this._png.height,n=this._png.channels*this._png.depth/8,s=this._png.width*n,r=new Uint8Array(this._png.height*s);let o=bd,h=0,c,l;for(let f=0;f<t;f++){switch(c=e.subarray(h+1,h+1+s),l=r.subarray(f*s,(f+1)*s),e[h]){case 0:Ad(c,l,s);break;case 1:Ed(c,l,s,n);break;case 2:Sd(c,l,o,s);break;case 3:kd(c,l,o,s,n);break;case 4:Cd(c,l,o,s,n);break;default:throw new Error(`Unsupported filter: ${e[h]}`)}o=l,h+=s+1}if(this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency),this._png.depth===16){const f=new Uint16Array(r.buffer);if(vd)for(let _=0;_<f.length;_++)f[_]=Td(f[_]);this._png.data=f}else this._png.data=r}}function Ad(i,e,t){for(let n=0;n<t;n++)e[n]=i[n]}function Ed(i,e,t,n){let s=0;for(;s<n;s++)e[s]=i[s];for(;s<t;s++)e[s]=i[s]+e[s-n]&255}function Sd(i,e,t,n){let s=0;if(t.length===0)for(;s<n;s++)e[s]=i[s];else for(;s<n;s++)e[s]=i[s]+t[s]&255}function kd(i,e,t,n,s){let r=0;if(t.length===0){for(;r<s;r++)e[r]=i[r];for(;r<n;r++)e[r]=i[r]+(e[r-s]>>1)&255}else{for(;r<s;r++)e[r]=i[r]+(t[r]>>1)&255;for(;r<n;r++)e[r]=i[r]+(e[r-s]+t[r]>>1)&255}}function Cd(i,e,t,n,s){let r=0;if(t.length===0){for(;r<s;r++)e[r]=i[r];for(;r<n;r++)e[r]=i[r]+e[r-s]&255}else{for(;r<s;r++)e[r]=i[r]+t[r]&255;for(;r<n;r++)e[r]=i[r]+Rd(e[r-s],t[r],t[r-s])&255}}function Rd(i,e,t){const n=i+e-t,s=Math.abs(n-i),r=Math.abs(n-e),o=Math.abs(n-t);return s<=r&&s<=o?i:r<=o?e:t}function Td(i){return(i&255)<<8|i>>8&255}function Md(i){if(i!==1&&i!==2&&i!==4&&i!==8&&i!==16)throw new Error(`invalid bit depth: ${i}`);return i}var jo;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.METRE=1]="METRE"})(jo||(jo={}));function Od(i,e){return new xd(i,e).decode()}var cn,Ms,Te;class qt{static loadFromStorage(){g(this,Te,window.localStorage.getItem(a(this,cn))!==a(this,Ms)),N.updateDebugClass(this.enabled)}static get enabled(){return a(this,Te)}static set enabled(e){g(this,Te,e),z.infoBeetPx(`Debug flag set to: ${a(this,Te)}`),N.updateDebugClass(this.enabled),a(this,Te)?window.localStorage.removeItem(a(this,cn)):window.localStorage.setItem(a(this,cn),a(this,Ms))}}cn=new WeakMap,Ms=new WeakMap,Te=new WeakMap,d(qt,cn,"beetpx__debug_disabled"),d(qt,Ms,"yes"),d(qt,Te,!1);var bi;const Lt=class Lt{static debugBeetPx(...e){Lt.debug(a(Lt,bi),...e)}static debug(...e){qt.enabled&&console.debug(...e.map(t=>t.__printDebug?t.__printDebug():t))}static infoBeetPx(...e){Lt.info(a(Lt,bi),...e)}static info(...e){console.info(...e.map(t=>t.__printDebug?t.__printDebug():t))}static warnBeetPx(...e){Lt.warn(a(Lt,bi),...e)}static warn(...e){console.warn(...e.map(t=>t.__printDebug?t.__printDebug():t))}static errorBeetPx(...e){Lt.error(a(Lt,bi),...e)}static error(...e){console.error(...e.map(t=>t.__printDebug?t.__printDebug():t))}};bi=new WeakMap,d(Lt,bi,"[BeetPx]");let z=Lt;var wi,Os,Fs,ul,Ds,fl,Ps,cl,sr,jh,ar,Qh,rr,Vh,dn,qa;class Fd{constructor(e,t){d(this,Fs);d(this,Ds);d(this,Ps);d(this,sr);d(this,ar);d(this,rr);d(this,dn);d(this,wi,void 0);d(this,Os,void 0);g(this,wi,e),g(this,Os,t.decodeAudioData)}async loadAssets(e){const t=e.map(s=>s.trim()).filter(s=>s.length>0),n=t.filter(s=>!u(this,Fs,ul).call(this,s)&&!u(this,Ds,fl).call(this,s)&&!u(this,Ps,cl).call(this,s));if(n.length>0)throw Error("Assets: following URLs don't look like any of supported formats: "+n.map(s=>`"${s}"`).join(", ")+'. Supported formats are: ".png", ".wav", ".flac", ".json", ".ldtk"');await Promise.all([...t.filter(s=>u(this,Fs,ul).call(this,s)).map(s=>u(this,sr,jh).call(this,s)),...t.filter(s=>u(this,Ds,fl).call(this,s)).map(s=>u(this,ar,Qh).call(this,s)),...t.filter(s=>u(this,Ps,cl).call(this,s)).map(s=>u(this,rr,Vh).call(this,s))])}}wi=new WeakMap,Os=new WeakMap,Fs=new WeakSet,ul=function(e){return e.toLowerCase().endsWith(".png")},Ds=new WeakSet,fl=function(e){return e.toLowerCase().endsWith(".wav")||e.toLowerCase().endsWith(".flac")},Ps=new WeakSet,cl=function(e){return e.toLowerCase().endsWith(".json")||e.toLowerCase().endsWith(".ldtk")},sr=new WeakSet,jh=async function(e){z.infoBeetPx(`Assets: loading image "${e}"`);const t=await fetch(e);if(!u(this,dn,qa).call(this,t.status))throw Error(`Assets: could not fetch PNG file: "${e}"`);const n=await t.arrayBuffer(),s=Od(n);if(s.channels!==3&&s.channels!==4)throw Error(`Assets: only PNG image files with 3 or 4 channels are supported. The file which seems to have ${s.channels} channels instead: "${e}"`);a(this,wi).addImageAsset(e,{width:s.width,height:s.height,channels:s.channels,rgba8bitData:s.data})},ar=new WeakSet,Qh=async function(e){z.infoBeetPx(`Assets: loading sound "${e}"`);const t=await fetch(e);if(!u(this,dn,qa).call(this,t.status))throw Error(`Assets: could not fetch sound file: "${e}"`);const n=await t.arrayBuffer(),s=await a(this,Os).call(this,n);a(this,wi).addSoundAsset(e,{audioBuffer:s})},rr=new WeakSet,Vh=async function(e){z.infoBeetPx(`Assets: loading JSON "${e}"`);const t=await fetch(e);if(!u(this,dn,qa).call(this,t.status))throw Error(`Assets: could not fetch JSON file: "${e}"`);const n=await t.json();a(this,wi).addJsonAsset(e,{json:n})},dn=new WeakSet,qa=function(e){return e>=200&&e<300};var Us,Is,zs;class Dd{constructor(){d(this,Us,new Map);d(this,Is,new Map);d(this,zs,new Map)}addImageAsset(e,t){a(this,Us).set(e,t)}addSoundAsset(e,t){a(this,Is).set(e,t)}addJsonAsset(e,t){a(this,zs).set(e,t)}getImageAsset(e){const t=a(this,Us).get(e);if(!t)throw Error(`Assets: There is no image loaded for: ${e}`);return t}getSoundAsset(e){const t=a(this,Is).get(e);if(!t)throw Error(`Assets: There is no sound loaded for: ${e}`);return t}getJsonAsset(e){const t=a(this,zs).get(e);if(!t)throw Error(`Assets: There is no JSON loaded for: ${e}`);return t}}Us=new WeakMap,Is=new WeakMap,zs=new WeakMap;function dl(){}var pn,Ka;const us=class us{static muteGain(e,t,n,s=dl){var r;n=Math.max(0,n),z.debugBeetPx(`AudioHelpers.muteGain (audioContextCurrentTime: ${t}, fadeOutMillis: ${n})`),u(r=us,pn,Ka).call(r,15,100,()=>{n>0?e.gain.setValueCurveAtTime([e.gain.value,0],t,n/1e3):e.gain.setValueAtTime(0,t)}).catch(()=>{}),setTimeout(()=>{s()},n)}static unmuteGain(e,t,n,s=dl){var r;n=Math.max(0,n),z.debugBeetPx(`AudioHelpers.unmuteGain (audioContextCurrentTime: ${t}, fadeInMillis: ${n})`),u(r=us,pn,Ka).call(r,15,100,()=>{n>0?e.gain.setValueCurveAtTime([e.gain.value,1],t,n/1e3):e.gain.setValueAtTime(1,t)}).catch(o=>{}),setTimeout(()=>{s()},n)}};pn=new WeakSet,Ka=async function(e,t,n){if(e<=0)return z.warnBeetPx("AudioHelpers.#tryNTimes: Failed to perform the action in N trials."),Promise.reject();try{n()}catch(s){return z.debugBeetPx("AudioHelpers.#tryNTimes: err:",s),new Promise((r,o)=>{z.debugBeetPx(`AudioHelpers.#tryNTimes: Failed to perform the action, trying ${e} more times…`),setTimeout(()=>{u(this,pn,Ka).call(this,e-1,t,n).then(r,o)},t)})}},d(us,pn);let Ee=us;var Xt,Rt,ut,gn,rt,Ns,pl,Ls,gl,$s,ml,Bs,_l;const he=class he{constructor(e,t,n,s,r){d(this,Ns);d(this,Ls);d(this,$s);d(this,Bs);b(this,"onEnded");b(this,"startedAtMs");b(this,"pausedAtMs");b(this,"accumulatedPauseMs");b(this,"isPausedByEngine");b(this,"isPausedByGame");d(this,Xt,void 0);d(this,Rt,void 0);d(this,ut,void 0);d(this,gn,void 0);d(this,rt,void 0);s==="pause"?he.playbacksToPauseOnGamePause.add(this):s==="mute"&&he.playbacksToMuteOnGamePause.add(this),this.onEnded=()=>{r(),he.playbacksToPauseOnGamePause.delete(this),he.playbacksToMuteOnGamePause.delete(this)},g(this,ut,e),g(this,gn,t),g(this,rt,a(this,ut).createGain()),a(this,rt).gain.value=n?0:1,a(this,rt).connect(a(this,gn)),this.isPausedByGame=!1,this.isPausedByEngine=!1,g(this,Rt,n),g(this,Xt,!1),this.startedAtMs=a(this,ut).currentTime*1e3,this.pausedAtMs=null,this.accumulatedPauseMs=0}mute(e){z.debugBeetPx(`AudioPlayback.mute (id: ${this.id}, type: ${this.type}, fadeOutMillis: ${e})`),!a(this,Rt)&&(g(this,Rt,!0),!a(this,Xt)&&(this.isPausedByGame||this.isPausedByEngine||u(this,Ns,pl).call(this,e)))}muteByEngine(){z.debugBeetPx(`AudioPlayback.muteByEngine (id: ${this.id}, type: ${this.type})`),!a(this,Xt)&&(g(this,Xt,!0),!a(this,Rt)&&(this.isPausedByGame||this.isPausedByEngine||u(this,Ns,pl).call(this,_i.muteUnmuteDefaultFadeMillis)))}unmute(e){z.debugBeetPx(`AudioPlayback.unmute (id: ${this.id}, type: ${this.type}, fadeInMillis: ${e})`),a(this,Rt)&&(g(this,Rt,!1),!a(this,Xt)&&(this.isPausedByGame||this.isPausedByEngine||u(this,Ls,gl).call(this,e)))}unmuteByEngine(){z.debugBeetPx(`AudioPlayback.unmuteByEngine (id: ${this.id}, type: ${this.type})`),a(this,Xt)&&(g(this,Xt,!1),!a(this,Rt)&&(this.isPausedByGame||this.isPausedByEngine||u(this,Ls,gl).call(this,_i.muteUnmuteDefaultFadeMillis)))}stop(e){if(z.debugBeetPx(`AudioPlayback.stop (id: ${this.id}, type: ${this.type}, fadeOutMillis: ${e})`),this.isPausedByGame||this.isPausedByEngine){this.onEnded();return}Ee.muteGain(a(this,rt),a(this,ut).currentTime,e,()=>{this.stopAllNodes(),!this.isPausedByGame&&!this.isPausedByEngine&&this.onEnded()})}pause(){z.debugBeetPx(`AudioPlayback.pause (id: ${this.id}, type: ${this.type}})`),!this.isPausedByGame&&(this.isPausedByGame=!0,!this.isPausedByEngine&&u(this,$s,ml).call(this))}pauseByEngine(){z.debugBeetPx(`AudioPlayback.pauseByEngine (id: ${this.id}, type: ${this.type}})`),!this.isPausedByEngine&&(this.isPausedByEngine=!0,!this.isPausedByGame&&u(this,$s,ml).call(this))}resume(){z.debugBeetPx(`AudioPlayback.resume (id: ${this.id}, type: ${this.type})`),this.isPausedByGame&&(this.isPausedByGame=!1,!this.isPausedByEngine&&u(this,Bs,_l).call(this))}resumeByEngine(){z.debugBeetPx(`AudioPlayback.resumeByEngine (id: ${this.id}, type: ${this.type})`),this.isPausedByEngine&&(this.isPausedByEngine=!1,!this.isPausedByGame&&u(this,Bs,_l).call(this))}createSourceNode(){return a(this,ut).createBufferSource()}connectToMainGainNode(e){e.connect(a(this,rt))}disconnectFromOutput(){a(this,rt).disconnect()}};Xt=new WeakMap,Rt=new WeakMap,ut=new WeakMap,gn=new WeakMap,rt=new WeakMap,Ns=new WeakSet,pl=function(e){Ee.muteGain(a(this,rt),a(this,ut).currentTime,e)},Ls=new WeakSet,gl=function(e){Ee.unmuteGain(a(this,rt),a(this,ut).currentTime,e)},$s=new WeakSet,ml=function(){this.pausedAtMs=a(this,ut).currentTime*1e3,Ee.muteGain(a(this,rt),a(this,ut).currentTime,_i.muteUnmuteDefaultFadeMillis,()=>{this.stopAllNodes()})},Bs=new WeakSet,_l=function(){g(this,rt,a(this,ut).createGain()),a(this,rt).gain.value=a(this,Rt)||this.isPausedByEngine?0:1,a(this,rt).connect(a(this,gn)),this.setupAndStartNodes(),this.pausedAtMs!=null&&(this.accumulatedPauseMs+=a(this,ut).currentTime*1e3-this.pausedAtMs,this.pausedAtMs=null),!a(this,Rt)&&!this.isPausedByEngine&&Ee.unmuteGain(a(this,rt),a(this,ut).currentTime,_i.muteUnmuteDefaultFadeMillis,()=>{})},b(he,"playbacksToPauseOnGamePause",new Set),b(he,"playbacksToMuteOnGamePause",new Set),b(he,"nextPlaybackId",1);let At=he;var mn,Tt,Gs;class Pd extends At{constructor(t,n){super(n.audioContext,n.target,n.muteOnStart,n.onGamePause,n.onEnded);b(this,"id",At.nextPlaybackId++);b(this,"type","looped");d(this,mn,void 0);d(this,Tt,void 0);d(this,Gs,void 0);g(this,mn,n.assets.getSoundAsset(t)),g(this,Gs,a(this,mn).audioBuffer.duration*1e3),g(this,Tt,this.createSourceNode()),this.setupAndStartNodes()}stopAllNodes(){a(this,Tt).stop()}setupAndStartNodes(){this.pausedAtMs!=null&&g(this,Tt,this.createSourceNode()),a(this,Tt).buffer=a(this,mn).audioBuffer,a(this,Tt).loop=!0,this.connectToMainGainNode(a(this,Tt)),a(this,Tt).addEventListener("ended",()=>{a(this,Tt).disconnect(),this.disconnectFromOutput(),!this.isPausedByGame&&!this.isPausedByEngine&&this.onEnded()});const t=this.pausedAtMs?(this.pausedAtMs-this.startedAtMs-this.accumulatedPauseMs)%a(this,Gs):0;a(this,Tt).start(0,t/1e3)}}mn=new WeakMap,Tt=new WeakMap,Gs=new WeakMap;var Zs,$t;class Ud extends At{constructor(t,n){super(n.audioContext,n.target,n.muteOnStart,n.onGamePause,n.onEnded);b(this,"id",At.nextPlaybackId++);b(this,"type","once");d(this,Zs,void 0);d(this,$t,void 0);g(this,Zs,n.assets.getSoundAsset(t)),g(this,$t,this.createSourceNode()),this.setupAndStartNodes()}stopAllNodes(){a(this,$t).stop()}setupAndStartNodes(){this.pausedAtMs!=null&&g(this,$t,this.createSourceNode()),a(this,$t).buffer=a(this,Zs).audioBuffer,this.connectToMainGainNode(a(this,$t)),a(this,$t).addEventListener("ended",()=>{a(this,$t).disconnect(),this.disconnectFromOutput(),!this.isPausedByGame&&!this.isPausedByEngine&&this.onEnded()});const t=this.pausedAtMs?this.pausedAtMs-this.startedAtMs-this.accumulatedPauseMs:0;a(this,$t).start(0,t/1e3)}}Zs=new WeakMap,$t=new WeakMap;function Id(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var s=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return i[n]}})}),t}var Kr={},Kl=function(e){if(typeof window>"u")return null;var t=window.OfflineAudioContext||window.webkitOfflineAudioContext,n=window.AudioContext||window.webkitAudioContext;if(!n)return null;typeof e=="number"&&(e={sampleRate:e});var s=e&&e.sampleRate;if(e&&e.offline)return t?new t(e.channels||2,e.length,s||44100):null;var r=Kr[s];if(r)return r;try{r=new n(e)}catch{r=new n}return Kr[r.sampleRate]=Kr[s]=r,r},zd=Kl,tu=Qe;function Qe(i,e){if(!(this instanceof Qe))return new Qe(i,e);if(e||(e=i,i=e&&e.context),e||(e={}),i===void 0&&(i=zd()),e.numberOfChannels==null&&(e.numberOfChannels=1),e.sampleRate==null&&(e.sampleRate=i&&i.sampleRate||this.sampleRate),e.length==null&&(e.duration!=null?e.length=e.duration*e.sampleRate:e.length=1),i&&i.createBuffer)return i.createBuffer(e.numberOfChannels,Math.ceil(e.length),e.sampleRate);this.length=Math.ceil(e.length),this.numberOfChannels=e.numberOfChannels,this.sampleRate=e.sampleRate,this.duration=this.length/this.sampleRate,this._data=new Float32Array(this.length*this.numberOfChannels),this._channelData=[];for(var t=0;t<this.numberOfChannels;t++)this._channelData.push(this._data.subarray(t*this.length,(t+1)*this.length))}Qe.prototype.numberOfChannels=1;Qe.prototype.sampleRate=44100;Qe.prototype.getChannelData=function(i){if(i>=this.numberOfChannels||i<0||i==null)throw Error("Cannot getChannelData: channel number ("+i+") exceeds number of channels ("+this.numberOfChannels+")");return this._channelData[i]};Qe.prototype.copyFromChannel=function(i,e,t){t==null&&(t=0);for(var n=this._channelData[e],s=t,r=0;s<this.length&&r<i.length;s++,r++)i[r]=n[s]};Qe.prototype.copyToChannel=function(i,e,t){var n=this._channelData[e];t||(t=0);for(var s=t,r=0;s<this.length&&r<i.length;s++,r++)n[s]=i[r]};var Tr=function(e){return e!=null&&typeof e.length=="number"&&typeof e.sampleRate=="number"&&typeof e.getChannelData=="function"&&typeof e.duration=="number"},Nd=Ld;function Ld(i,e,t){return e<t?i<e?e:i>t?t:i:i<t?t:i>e?e:i}var $d=Object.prototype.toString,eu=function(i){var e;return $d.call(i)==="[object Object]"&&(e=Object.getPrototypeOf(i),e===null||e===Object.getPrototypeOf({}))};const Bd={},Gd=Object.freeze(Object.defineProperty({__proto__:null,default:Bd},Symbol.toStringTag,{value:"Module"})),iu=Id(Gd);/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var Zd=function(i){return i!=null&&(nu(i)||Hd(i)||!!i._isBuffer)};function nu(i){return!!i.constructor&&typeof i.constructor.isBuffer=="function"&&i.constructor.isBuffer(i)}function Hd(i){return typeof i.readFloatLE=="function"&&typeof i.slice=="function"&&nu(i.slice(0,0))}const Jd={8e3:8e3,11025:11025,16e3:16e3,22050:22050,44100:44100,48e3:48e3,88200:88200,96e3:96e3,176400:176400,192e3:192e3,352800:352800,384e3:384e3};/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var Wd=function(i){return i!=null&&(su(i)||qd(i)||!!i._isBuffer)};function su(i){return!!i.constructor&&typeof i.constructor.isBuffer=="function"&&i.constructor.isBuffer(i)}function qd(i){return typeof i.readFloatLE=="function"&&typeof i.slice=="function"&&su(i.slice(0,0))}var au=function(e,t,n){var s={},r,o;if(typeof t=="string"&&(t=Qo(t)),Array.isArray(t)){var h={};for(o=0;o<t.length;o++)h[t[o]]=!0;t=h}for(r in t)t[r]=Qo(t[r]);var c={};for(r in t){var l=t[r];if(Array.isArray(l))for(o=0;o<l.length;o++){var f=l[o];if(n&&(c[f]=!0),f in e){if(s[r]=e[f],n)for(var _=o;_<l.length;_++)c[l[_]]=!0;break}}else r in e&&(t[r]&&(s[r]=e[r]),n&&(c[r]=!0))}if(n)for(r in e)c[r]||(s[r]=e[r]);return s},Yr={};function Qo(i){return Yr[i]?Yr[i]:(typeof i=="string"&&(i=Yr[i]=i.split(/\s*,\s*|\s+/)),i)}var Vo=Jd,th=iu,Kd=Tr,Yd=Wd,Xd=eu,jd=au,ru={parse:hu,stringify:Vd,detect:bl,type:uu},lu=th.endianness instanceof Function?th.endianness().toLowerCase():"le",eh={uint:"uint32",uint8:"uint8",uint8_clamped:"uint8",uint16:"uint16",uint32:"uint32",int:"int32",int8:"int8",int16:"int16",int32:"int32",float:"float32",float32:"float32",float64:"float64",array:"array",arraybuffer:"arraybuffer",buffer:"buffer",audiobuffer:"audiobuffer",ndarray:"ndarray",ndsamples:"ndsamples"},ys={mono:1,stereo:2,quad:4,"5.1":6,"2.1":3,"3-channel":3,"5-channel":5},Qd=32;for(var Ba=6;Ba<Qd;Ba++)ys[Ba+"-channel"]=Ba;var ou={};for(var ih in ys)ou[ys[ih]]=ih;function hu(i){for(var e={},t=i.split(/\s*[,;_]\s*|\s+/),n=0;n<t.length;n++){var s=t[n].toLowerCase();if(s==="planar"&&e.interleaved==null)e.interleaved=!1,e.channels==null&&(e.channels=2);else if((s==="interleave"||s==="interleaved")&&e.interleaved==null)e.interleaved=!0,e.channels==null&&(e.channels=2);else if(ys[s])e.channels=ys[s];else if(s==="le"||s==="LE"||s==="littleendian"||s==="bigEndian")e.endianness="le";else if(s==="be"||s==="BE"||s==="bigendian"||s==="bigEndian")e.endianness="be";else if(eh[s])e.type=eh[s],s==="audiobuffer"&&(e.endianness=lu,e.interleaved=!1);else if(Vo[s])e.sampleRate=Vo[s];else if(/^\d+$/.test(s))e.sampleRate=parseInt(s);else throw Error("Cannot identify part `"+s+"`")}return e}function bl(i){if(!i)return{};var e=jd(i,{channels:"channel channels numberOfChannels channelCount",sampleRate:"sampleRate rate",interleaved:"interleave interleaved",type:"type dtype",endianness:"endianness"});if(i.format&&(e.type="ndsamples"),e.sampleRate==null&&i.format&&i.format.sampleRate&&(e.sampleRate=i.format.sampleRate),i.planar&&(e.interleaved=!1),e.interleaved!=null&&e.channels==null&&(e.channels=2),e.type==null){var t=uu(i);t&&(e.type=t)}return e.type==="audiobuffer"&&(e.endianness=lu,e.interleaved=!1),e}function Vd(i,e){e===void 0?e={endianness:"le"}:e==null?e={}:typeof e=="string"?e=hu(e):e=bl(e),Xd(i)||(i=bl(i));var t=[];return i.type!=null&&i.type!==e.type&&t.push(i.type||"float32"),i.channels!=null&&i.channels!==e.channels&&t.push(ou[i.channels]),i.endianness!=null&&i.endianness!==e.endianness&&t.push(i.endianness||"le"),i.interleaved!=null&&i.interleaved!==e.interleaved&&i.type!=="audiobuffer"&&t.push(i.interleaved?"interleaved":"planar"),i.sampleRate!=null&&i.sampleRate!==e.sampleRate&&t.push(i.sampleRate),t.join(" ")}function uu(i){if(Kd(i))return"audiobuffer";if(Yd(i))return"buffer";if(Array.isArray(i))return"array";if(i instanceof ArrayBuffer)return"arraybuffer";if(i.shape&&i.dtype)return i.format?"ndsamples":"ndarray";if(i instanceof Float32Array)return"float32";if(i instanceof Float64Array)return"float64";if(i instanceof Uint8Array)return"uint8";if(i instanceof Uint8ClampedArray)return"uint8_clamped";if(i instanceof Int8Array)return"int8";if(i instanceof Int16Array)return"int16";if(i instanceof Uint16Array)return"uint16";if(i instanceof Int32Array)return"int32";if(i instanceof Uint32Array)return"uint32"}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var nh=Object.getOwnPropertySymbols,t0=Object.prototype.hasOwnProperty,e0=Object.prototype.propertyIsEnumerable;function i0(i){if(i==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(i)}function n0(){try{if(!Object.assign)return!1;var i=new String("abc");if(i[5]="de",Object.getOwnPropertyNames(i)[0]==="5")return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;var n=Object.getOwnPropertyNames(e).map(function(r){return e[r]});if(n.join("")!=="0123456789")return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach(function(r){s[r]=r}),Object.keys(Object.assign({},s)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var s0=n0()?Object.assign:function(i,e){for(var t,n=i0(i),s,r=1;r<arguments.length;r++){t=Object(arguments[r]);for(var o in t)t0.call(t,o)&&(n[o]=t[o]);if(nh){s=nh(t);for(var h=0;h<s.length;h++)e0.call(t,s[h])&&(n[s[h]]=t[s[h]])}}return n},sh=iu,a0=Zd,ke=ru,ah=s0,r0=Tr,l0=o0;function o0(i,e,t,n){if(sh(i,"First argument should be data"),sh(e,"Second argument should be format string or object"),e===t)return i;if(rh(e))n=e,t=ke.detect(n),e=ke.detect(i);else if(t===void 0&&n===void 0)t=Ga(e),e=ke.detect(i);else if(rh(t))n=t,t=Ga(e),e=ke.detect(i);else{var s=Ga(e),r=ke.detect(i);r.dtype=s.type==="arraybuffer"?r.type:s.type,e=ah(s,r);var o=Ga(t),h=ke.detect(n);o.type&&(h.dtype=o.type==="arraybuffer"?h.type||e.dtype:o.type),t=ah(o,h)}if(t.channels==null&&e.channels!=null&&(t.channels=e.channels),t.type==null&&(t.type=e.type,t.dtype=e.dtype),t.interleaved!=null&&e.channels==null&&(e.channels=2),e.type===t.type&&e.interleaved===t.interleaved&&e.endianness===t.endianness)return i;lh(e),lh(t),(i.buffers||i.buffer&&i.buffer.buffers)&&(i.buffer&&(i=i.buffer),i.buffers&&(i=i.join()));var c;if(r0(i))if(i._data)c=i._data;else{c=new Float32Array(i.length*i.numberOfChannels);for(var l=0,f=i.numberOfChannels;l<f;l++)c.set(i.getChannelData(l),i.length*l)}else i instanceof ArrayBuffer?c=new Za[e.dtype](i):a0(i)?(i.byteOffset!=null?c=i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength):c=i.buffer,c=new Za[e.dtype](c)):c=i;var _=t.type==="array"?Array.from(c):new Za[t.dtype](c);if(e.max!==t.max)for(var m=e.max-e.min,p=t.max-t.min,y=0,f=c.length;y<f;y++){var U=c[y],O=(U-e.min)/m;U=O*p+t.min,_[y]=Math.max(t.min,Math.min(t.max,U))}if(e.interleaved!=t.interleaved){var C=e.channels,P=Math.floor(c.length/C);e.interleaved&&!t.interleaved?_=_.map(function(W,G,$){var Z=G%P,zt=~~(G/P);return $[Z*C+zt]}):!e.interleaved&&t.interleaved&&(_=_.map(function(W,G,$){var Z=~~(G/C),zt=G%C;return $[zt*P+Z]}))}if(t.dtype!="array"&&t.dtype!="int8"&&t.dtype!="uint8"&&e.endianness&&t.endianness&&e.endianness!==t.endianness)for(var I=t.endianness==="le",x=new DataView(_.buffer),B=_.BYTES_PER_ELEMENT,L="set"+t.dtype[0].toUpperCase()+t.dtype.slice(1),y=0,f=_.length;y<f;y++)x[L](y*B,_[y],I);if(t.type,n){if(Array.isArray(n))for(var y=0;y<_.length;y++)n[y]=_[y];else if(n instanceof ArrayBuffer){var k=new Za[t.dtype](n);k.set(_),n=k}else n.set(_);_=n}return(t.type==="arraybuffer"||t.type==="buffer")&&(_=_.buffer),_}function Ga(i){return typeof i=="string"?ke.parse(i):ke.detect(i)}function rh(i){return typeof i!="string"&&(Array.isArray(i)||ArrayBuffer.isView(i)||i instanceof ArrayBuffer)}var Za={uint8:Uint8Array,uint8_clamped:Uint8ClampedArray,uint16:Uint16Array,uint32:Uint32Array,int8:Int8Array,int16:Int16Array,int32:Int32Array,float32:Float32Array,float64:Float64Array,array:Array,arraybuffer:Uint8Array,buffer:Uint8Array},h0={float32:"float32",audiobuffer:"float32",ndsamples:"float32",ndarray:"float32",float64:"float64",buffer:"uint8",arraybuffer:"uint8",uint8:"uint8",uint8_clamped:"uint8",uint16:"uint16",uint32:"uint32",int8:"int8",int16:"int16",int32:"int32",array:"array"};function lh(i){switch(i.dtype||(i.dtype=h0[i.type]||"array"),i.dtype){case"float32":case"float64":case"audiobuffer":case"ndsamples":case"ndarray":i.min=-1,i.max=1;break;case"uint8":i.min=0,i.max=255;break;case"uint16":i.min=0,i.max=65535;break;case"uint32":i.min=0,i.max=4294967295;break;case"int8":i.min=-128,i.max=127;break;case"int16":i.min=-32768,i.max=32767;break;case"int32":i.min=-2147483648,i.max=2147483647;break;default:i.min=-1,i.max=1;break}return i}var u0=function(e){return atob(e)},wl={exports:{}};(function(i,e){(function(t){function n(s,r){if(s instanceof Boolean||typeof s=="boolean"||(r instanceof Object||(r={}),r.hasOwnProperty("allowBlank")&&!r.allowBlank&&s===""))return!1;var o="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+/]{3}=)?";return r.mime&&(o="(data:\\w+\\/[a-zA-Z\\+\\-\\.]+;base64,)?"+o),r.paddingRequired===!1&&(o="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}(==)?|[A-Za-z0-9+\\/]{3}=?)?"),new RegExp("^"+o+"$","gi").test(s)}i.exports&&(e=i.exports=n),e.isBase64=n})()})(wl,wl.exports);var f0=wl.exports,fu=u0,c0=f0,d0=function(e){if(typeof e!="string")throw Error("Argument should be a string");return/^data\:/i.test(e)?p0(e):(c0(e)&&(e=fu(e)),cu(e))};function cu(i){for(var e=new Uint8Array(i.length),t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e.buffer}function p0(i){i=i.replace(/\r?\n/g,"");var e=i.indexOf(",");if(e===-1||e<=4)throw new TypeError("malformed data-URI");for(var t=i.substring(5,e).split(";"),n=!1,s="US-ASCII",r=0;r<t.length;r++)t[r]=="base64"?n=!0:t[r].indexOf("charset=")==0&&(s=t[r].substring(8));var o=unescape(i.substring(e+1));n&&(o=fu(o));var h=cu(o);return h.type=t[0]||"text/plain",h.charset=s,h}var g0=tu,m0=Tr,_0=eu,b0=Kl,w0=l0,oh=ru,y0=d0,v0=au,x0=function i(e,t){var n,s,r,o,h,c,l;if(typeof t=="number"?t={channels:t}:typeof t=="string"?t={format:t}:t===void 0&&(_0(e)?(t=e,e=void 0):t={}),t=v0(t,{format:"format type dtype dataType",channels:"channel channels numberOfChannels channelCount",sampleRate:"sampleRate rate",length:"length size",duration:"duration time"}),r=t.channels,o=t.sampleRate,t.format&&(h=hh(t.format)),h&&(r&&!h.channels?h.channels=r:h.channels&&!r&&(r=h.channels),!o&&h.sampleRate&&(o=h.sampleRate)),e==null)t.duration!=null?(o||(o=44100),n=o*t.duration):n=t.length;else if(m0(e))if(n=e.length,r==null&&(r=e.numberOfChannels),o==null&&(o=e.sampleRate),e._channelData)s=e._channelData.slice(0,r);else for(s=[],c=0,l=r;c<l;c++)s[c]=e.getChannelData(c);else if(typeof e=="number")n=e;else if(Array.isArray(e)&&(Array.isArray(e[0])||ArrayBuffer.isView(e[0])))for(n=e[0].length,s=[],r||(r=e.length),c=0;c<r;c++)s[c]=e[c]instanceof Float32Array?e[c]:new Float32Array(e[c]);else{if(e.shape&&e.data)return e.shape&&(r=e.shape[1]),!o&&e.format&&(o=e.format.sampleRate),i(e.data,{channels:r,sampleRate:o});for(typeof e=="string"&&(e=y0(e)),h||(h=hh(e)),r||(r=h.channels||1),e=w0(e,h,"float32 planar"),n=Math.floor(e.length/r),s=[],c=0;c<r;c++)s[c]=e.subarray(c*n,(c+1)*n)}var f=new g0(t.context===null||n===0?null:t.context||b0(),{length:n??1,numberOfChannels:r||1,sampleRate:o||44100});if(s)for(c=0,l=s.length;c<l;c++)f.getChannelData(c).set(s[c]);return f};function hh(i){return typeof i=="string"?oh.parse(i):oh.detect(i)}var du=tu,Da=Tr,A0=Nd,E0=Kl,S0=x0,k0=function(i){return i===0&&1/i===-1/0},It=function(e,t){return e==null?0:k0(e)?t:e<=-t?0:e<0?t+e%t:Math.min(t,e)},Xr,Mr={create:Yn,copy:Yl,shallow:pu,clone:C0,reverse:R0,invert:T0,zero:M0,noise:O0,equal:gu,fill:Ve,slice:Xl,concat:vs,resize:P0,pad:jl,padLeft:U0,padRight:I0,rotate:z0,shift:N0,normalize:L0,removeStatic:$0,trim:G0,trimLeft:Z0,trimRight:H0,mix:J0,size:W0,data:q0,subbuffer:D0,repeat:F0};Object.defineProperty(Mr,"context",{get:function(){return Xr||(Xr=E0()),Xr}});var es=Mr;function Yn(i,e,t){return typeof e=="number"?e={channels:e}:typeof e=="string"?e={format:e}:e||(e={}),t&&(e.sampleRate=t),e.context=Mr.context,S0(i,e)}function Yl(i,e,t){Q(i),Q(e),t=t||0;for(var n=0,s=Math.min(i.numberOfChannels,e.numberOfChannels);n<s;n++)e.getChannelData(n).set(i.getChannelData(n),t);return e}function Q(i){if(!Da(i))throw new Error("Argument should be an AudioBuffer instance.")}function pu(i){return Q(i),Mr.context.createBuffer(i.numberOfChannels,i.length,i.sampleRate)}function C0(i){return Yl(i,pu(i))}function R0(i,e,t,n){Q(i),!Da(e)&&e!=null&&(n=t,t=e,e=null),e?(Q(e),Yl(i,e)):e=i,t=t==null?0:It(t,i.length),n=n==null?i.length:It(n,i.length);for(var s=0,r=e.numberOfChannels;s<r;++s)e.getChannelData(s).subarray(t,n).reverse();return e}function T0(i,e,t,n){return!Da(e)&&e!=null&&(n=t,t=e,e=null),Ve(i,e,function(s){return-s},t,n)}function M0(i,e,t,n){return Ve(i,e,0,t,n)}function O0(i,e,t,n){return Ve(i,e,function(s){return Math.random()*2-1},t,n)}function gu(i,e){if(arguments.length>2){for(var t=0,n=arguments.length-1;t<n;t++)if(!gu(arguments[t],arguments[t+1]))return!1;return!0}if(Q(i),Q(e),i.length!==e.length||i.numberOfChannels!==e.numberOfChannels)return!1;for(var s=0;s<i.numberOfChannels;s++)for(var r=i.getChannelData(s),o=e.getChannelData(s),t=0;t<r.length;t++)if(r[t]!==o[t])return!1;return!0}function Ve(i,e,t,n,s){if(Q(i),!Da(e)&&e!=null&&(typeof t=="function"||(s=n,n=t,t=e),e=null),e?Q(e):e=i,n=n==null?0:It(n,i.length),s=s==null?i.length:It(s,i.length),t instanceof Function)for(var r=0,o=i.numberOfChannels;r<o;r++)for(var l=i.getChannelData(r),h=e.getChannelData(r),c=n;c<s;c++)h[c]=t.call(i,l[c],c,r,l);else for(var r=0,o=i.numberOfChannels;r<o;r++)for(var h=e.getChannelData(r),c=n;c<s;c++)h[c]=t;return e}function F0(i,e){if(Q(i),!e||e<0)return new du(null,{length:0,numberOfChannels:i.numberOfChannels,sampleRate:i.sampleRate});if(e===1)return i;for(var t=[],n=0;n<e;n++)t.push(i);return vs(t)}function Xl(i,e,t){Q(i),e=e==null?0:It(e,i.length),t=t==null?i.length:It(t,i.length);for(var n=[],s=0;s<i.numberOfChannels;s++){var r=i.getChannelData(s);n.push(r.slice(e,t))}return Yn(n,i.numberOfChannels,i.sampleRate)}function D0(i,e,t,n){if(Q(i),Array.isArray(e)?(n=e,e=0,t=-0):Array.isArray(t)&&(n=t,t=-0),!Array.isArray(n)){n=Array(i.numberOfChannels);for(var s=0;s<i.numberOfChannels;s++)n[s]=s}e=e==null?0:It(e,i.length),t=t==null?i.length:It(t,i.length);for(var r=[],o=0;o<n.length;o++){var h=n[o],c=i.getChannelData(h);r.push(c.subarray(e,t))}var l=new du(null,{length:0,sampleRate:i.sampleRate,numberOfChannels:i.numberOfChannels});return l.length=r[0].length,l._data=null,l._channelData=r,l.duration=l.length/l.sampleRate,l}function vs(){for(var i=[],e=0,t=arguments.length;e<t;e++){var n=arguments[e];if(Array.isArray(n))for(var s=0;s<n.length;s++)i.push(n[s]);else i.push(n)}for(var r=1,o=0,h=0,e=0;e<i.length;e++){var c=i[e];Q(c),o+=c.length,r=Math.max(c.numberOfChannels,r),h=Math.max(c.sampleRate,h)}for(var l=[],f=0;f<r;f++){for(var _=new Float32Array(o),m=0,e=0;e<i.length;e++){var c=i[e];f<c.numberOfChannels&&_.set(c.getChannelData(f),m),m+=c.length}l.push(_)}return Yn(l,r,h)}function P0(i,e){return Q(i),e<i.length?Xl(i,0,e):vs(i,Yn(e-i.length,i.numberOfChannels))}function jl(i,e,t){var n,s;return typeof i=="number"?(n=e,s=i):(n=i,s=e),t=t||0,Q(n),s<n.length?n:n===e?vs(Ve(Yn(s-n.length,n.numberOfChannels),t),n):vs(n,Ve(Yn(s-n.length,n.numberOfChannels),t))}function U0(i,e,t){return jl(e,i,t)}function I0(i,e,t){return jl(i,e,t)}function z0(i,e){Q(i);for(var t=0;t<i.numberOfChannels;t++)for(var n=i.getChannelData(t),s=n.slice(),r=0,o=n.length,h;r<o;r++)h=(e+(e+r<0?o+r:r))%o,n[h]=s[r];return i}function N0(i,e){Q(i);for(var t=0;t<i.numberOfChannels;t++){var n=i.getChannelData(t);if(e>0)for(var s=n.length-e;s--;)n[s+e]=n[s];else for(var s=-e,r=n.length-e;s<r;s++)n[s+e]=n[s]||0}return i}function L0(i,e,t,n){Da(e)||(n=t,t=e,e=null),t=t==null?0:It(t,i.length),n=n==null?i.length:It(n,i.length);for(var s=0,r=0;r<i.numberOfChannels;r++)for(var o=i.getChannelData(r),h=t;h<n;h++)s=Math.max(Math.abs(o[h]),s);var c=Math.max(1/s,1);return Ve(i,e,function(l,f,_){return A0(l*c,-1,1)},t,n)}function $0(i,e,t,n){var s=B0(i,t,n);return Ve(i,e,function(r,o,h){return r-s[h]},t,n)}function B0(i,e,t){if(Q(i),e=e==null?0:It(e,i.length),t=t==null?i.length:It(t,i.length),t-e<1)return[];for(var n=[],s=0;s<i.numberOfChannels;s++){for(var r=0,o=i.getChannelData(s),h=e;h<t;h++)r+=o[h];n.push(r/(t-e))}return n}function G0(i,e){return Ql(i,e,!0,!0)}function Z0(i,e){return Ql(i,e,!0,!1)}function H0(i,e){return Ql(i,e,!1,!0)}function Ql(i,e,t,n){Q(i),e=e==null?0:Math.abs(e);var s,r;if(t){s=i.length;for(var o=0,h=i.numberOfChannels;o<h;o++)for(var c=i.getChannelData(o),l=0;l<c.length&&!(l>s);l++)if(Math.abs(c[l])>e){s=l;break}}else s=0;if(n){r=0;for(var o=0,h=i.numberOfChannels;o<h;o++)for(var c=i.getChannelData(o),l=c.length-1;l>=0&&!(l<r);l--)if(Math.abs(c[l])>e){r=l+1;break}}else r=i.length;return Xl(i,s,r)}function J0(i,e,t,n){Q(i),Q(e),t==null&&(t=.5);var s=t instanceof Function?t:function(f,_){return f*(1-t)+_*t};n==null?n=0:n<0&&(n+=i.length);for(var r=0;r<i.numberOfChannels;r++)for(var o=i.getChannelData(r),h=e.getChannelData(r),c=n,l=0;c<i.length&&l<e.length;c++,l++)o[c]=s.call(i,o[c],h[l],l,r);return i}function W0(i){return Q(i),i.numberOfChannels*i.getChannelData(0).byteLength}function q0(i,e){Q(i),e=e||[];for(var t=0;t<i.numberOfChannels;t++)ArrayBuffer.isView(e[t])?e[t].set(i.getChannelData(t)):e[t]=i.getChannelData(t);return e}var _n,Me,bn,mt,Hs,yl,lr,mu;class K0 extends At{constructor(t,n){super(n.audioContext,n.target,n.muteOnStart,n.onGamePause,n.onEnded);d(this,Hs);d(this,lr);b(this,"id",At.nextPlaybackId++);b(this,"type","sequence");d(this,_n,void 0);d(this,Me,void 0);d(this,bn,void 0);d(this,mt,void 0);const s=t.intro??[],r=t.loop??[];if(s.length+r.length<=0)throw Error("Cannot play an empty sound sequence");const o=s.map(c=>u(this,Hs,yl).call(this,c,n.assets)),h=r.map(c=>u(this,Hs,yl).call(this,c,n.assets));g(this,_n,u(this,lr,mu).call(this,[...o,...h])),g(this,Me,o.reduce((c,l)=>c+l.durationMs,0)),g(this,bn,h.reduce((c,l)=>c+l.durationMs,0)),g(this,mt,this.createSourceNode()),this.setupAndStartNodes()}stopAllNodes(){a(this,mt).stop()}setupAndStartNodes(){this.pausedAtMs!=null&&g(this,mt,this.createSourceNode()),a(this,mt).buffer=a(this,_n),a(this,bn)>0&&(a(this,mt).loop=!0,a(this,mt).loopStart=a(this,Me)/1e3,a(this,mt).loopEnd=a(this,_n).duration),this.connectToMainGainNode(a(this,mt)),a(this,mt).addEventListener("ended",()=>{a(this,mt).disconnect(),this.disconnectFromOutput(),!this.isPausedByGame&&!this.isPausedByEngine&&this.onEnded()});let t=this.pausedAtMs?this.pausedAtMs-this.startedAtMs-this.accumulatedPauseMs:0;t>a(this,Me)&&(t=(t-a(this,Me))%a(this,bn)+a(this,Me)),a(this,mt).start(0,t/1e3)}}_n=new WeakMap,Me=new WeakMap,bn=new WeakMap,mt=new WeakMap,Hs=new WeakSet,yl=function(t,n){if(t.length<1)throw Error("Each intro sequence entry needs at least 1 sound");const[s,...r]=t,o=typeof s!="string"?s.url:s,h=n.getSoundAsset(o).audioBuffer,c=h.duration*1e3,l=typeof s!="string"&&s.durationMs?s.durationMs(c):c,f=es.resize(h,l/1e3*h.sampleRate),_=r.map(m=>typeof m=="string"?{url:m}:m).map(({url:m})=>n.getSoundAsset(m).audioBuffer).map(m=>es.resize(m,l/1e3*m.sampleRate));return{firstBuffer:f,otherBuffers:_,durationMs:l}},lr=new WeakSet,mu=function(t){const n=(r,o)=>Hn(-1,r+o,1),s=t.map(r=>r.otherBuffers.reduce((o,h)=>es.mix(o,h,n),es.clone(r.firstBuffer)));return es.concat(...s)};var wn,Js,yi,_t,Mt,lt,ft,or,_u,hr,bu,Ws,vl;const at=class at{constructor(e,t){d(this,or);d(this,hr);d(this,Ws);d(this,yi,void 0);d(this,_t,void 0);d(this,Mt,void 0);d(this,lt,new Map);d(this,ft,void 0);g(this,yi,e),g(this,_t,t),g(this,ft,u(this,hr,bu).call(this)),N.updateMutedClass(a(this,ft)),g(this,Mt,a(this,_t).createGain()),a(this,Mt).gain.value=a(this,ft)?0:1,a(this,Mt).connect(a(this,_t).destination)}restart(){u(this,or,_u).call(this),a(this,lt).clear()}async tryToResumeAudioContextSuspendedByBrowserForSecurityReasons(){return z.debugBeetPx("AudioApi.tryToResumeAudioContextSuspendedByBrowserForSecurityReasons"),a(this,_t).state==="running"?(z.debugBeetPx("Audio Context is already running"),Promise.resolve(!0)):a(this,_t).resume().then(()=>(z.debugBeetPx("Audio Context got resumed"),!0)).catch(e=>(z.errorBeetPx(e),!1))}startPlayback(e,t){t??(t={}),t.muteOnStart??(t.muteOnStart=!1),t.onGamePause??(t.onGamePause="pause"),z.debugBeetPx(`AudioApi.startPlayback (muteOnStart: ${t.muteOnStart}, onGamePause: ${t.onGamePause})`);const n=new Ud(e,{assets:a(this,yi),audioContext:a(this,_t),target:a(this,Mt),muteOnStart:t.muteOnStart,onGamePause:t.onGamePause,onEnded:()=>{z.debugBeetPx(`AudioApi: deleting playback ${n.id}`),a(this,lt).delete(n.id)}});return a(this,lt).set(n.id,n),n.id}startPlaybackLooped(e,t){t??(t={}),t.muteOnStart??(t.muteOnStart=!1),t.onGamePause??(t.onGamePause="pause"),z.debugBeetPx(`AudioApi.startPlaybackLooped (muteOnStart: ${t.muteOnStart}, onGamePause: ${t.onGamePause})`);const n=new Pd(e,{assets:a(this,yi),audioContext:a(this,_t),target:a(this,Mt),muteOnStart:t.muteOnStart,onGamePause:t.onGamePause,onEnded:()=>{z.debugBeetPx(`AudioApi: deleting playback ${n.id}`),a(this,lt).delete(n.id)}});return a(this,lt).set(n.id,n),n.id}startPlaybackSequence(e,t){t??(t={}),t.muteOnStart??(t.muteOnStart=!1),t.onGamePause??(t.onGamePause="pause"),z.debugBeetPx(`AudioApi.startPlaybackSequence (muteOnStart: ${t.muteOnStart}, onGamePause: ${t.onGamePause})`);const n=new K0(e,{assets:a(this,yi),audioContext:a(this,_t),target:a(this,Mt),muteOnStart:t.muteOnStart,onGamePause:t.onGamePause,onEnded:()=>{z.debugBeetPx(`AudioApi: deleting playback ${n.id}`),a(this,lt).delete(n.id)}});return a(this,lt).set(n.id,n),n.id}isAudioMuted(){return a(this,ft)}muteAudio(e={}){z.debugBeetPx(`AudioApi.muteAudio (fadeOutMillis: ${e.fadeOutMillis})`),!a(this,ft)&&(u(this,Ws,vl).call(this,!0),g(this,ft,!0),N.updateMutedClass(a(this,ft)),Ee.muteGain(a(this,Mt),a(this,_t).currentTime,e.fadeOutMillis??at.muteUnmuteDefaultFadeMillis))}unmuteAudio(e={}){z.debugBeetPx(`AudioApi.unmuteAudio (fadeInMillis: ${e.fadeInMillis})`),a(this,ft)&&(u(this,Ws,vl).call(this,!1),g(this,ft,!1),N.updateMutedClass(a(this,ft)),Ee.unmuteGain(a(this,Mt),a(this,_t).currentTime,e.fadeInMillis??at.muteUnmuteDefaultFadeMillis))}mutePlayback(e,t={}){var n;z.debugBeetPx(`AudioApi.mutePlayback (fadeOutMillis: ${t.fadeOutMillis})`),(n=a(this,lt).get(e))==null||n.mute(t.fadeOutMillis??at.muteUnmuteDefaultFadeMillis)}unmutePlayback(e,t={}){var n;z.debugBeetPx(`AudioApi.unmutePlayback (fadeInMillis: ${t.fadeInMillis})`),(n=a(this,lt).get(e))==null||n.unmute(t.fadeInMillis??at.muteUnmuteDefaultFadeMillis)}stopPlayback(e,t={}){var n;z.debugBeetPx(`AudioApi.stopPlayback (fadeOutMillis: ${t.fadeOutMillis})`),(n=a(this,lt).get(e))==null||n.stop(a(this,ft)?0:t.fadeOutMillis??at.muteUnmuteDefaultFadeMillis)}pausePlayback(e){var t;z.debugBeetPx("AudioApi.pausePlayback"),(t=a(this,lt).get(e))==null||t.pause()}resumePlayback(e){var t;z.debugBeetPx("AudioApi.resumePlayback"),(t=a(this,lt).get(e))==null||t.resume()}getAudioContext(){return a(this,_t)}getGlobalGainNode(){return a(this,Mt)}};wn=new WeakMap,Js=new WeakMap,yi=new WeakMap,_t=new WeakMap,Mt=new WeakMap,lt=new WeakMap,ft=new WeakMap,or=new WeakSet,_u=function(e={}){z.debugBeetPx(`AudioApi.#stopAllPlaybacks (fadeOutMillis: ${e.fadeOutMillis})`);for(const t of a(this,lt).values())t.stop(a(this,ft)?0:e.fadeOutMillis??at.muteUnmuteDefaultFadeMillis)},hr=new WeakSet,bu=function(){return window.localStorage.getItem(a(at,wn))===a(at,Js)},Ws=new WeakSet,vl=function(e){e?window.localStorage.setItem(a(at,wn),a(at,Js)):window.localStorage.removeItem(a(at,wn))},d(at,wn,"audio_api__muted"),d(at,Js,"yes"),b(at,"muteUnmuteDefaultFadeMillis",100);let _i=at;class Y0{static detect(e){const t=(e==null?void 0:e.toLowerCase())??"";return t.includes("firefox")?t.includes("win64")?"firefox_windows":"firefox_other":t.includes("chrome")?"chromium":t.includes("safari")?"safari":"other"}}function Vi(i){throw Error(i)}var ce,de,Oe,Fe,yn;class X0{constructor(e){b(this,"canvasSize");d(this,ce,void 0);d(this,de,void 0);d(this,Oe,void 0);d(this,Fe,void 0);d(this,yn,null);this.canvasSize=e.round(),g(this,ce,0),g(this,de,0),g(this,Oe,this.canvasSize.x-1),g(this,Fe,this.canvasSize.y-1)}setClippingRegion(e,t){const n=[D.of(a(this,ce),a(this,de)),D.of(a(this,Oe)-a(this,ce)+1,a(this,Fe)-a(this,de)+1)],[s,r]=D.minMax(e.round(),e.add(t).round());return g(this,ce,s.x),g(this,de,s.y),g(this,Oe,r.x-1),g(this,Fe,r.y-1),n}removeClippingRegion(){return this.setClippingRegion(D.of(0,0),this.canvasSize)}canSetAny(e,t,n,s){return n>=a(this,ce)&&s>=a(this,de)&&e<=a(this,Oe)&&t<=a(this,Fe)}canSetAt(e,t){return e>=a(this,ce)&&t>=a(this,de)&&e<=a(this,Oe)&&t<=a(this,Fe)}takeSnapshot(){g(this,yn,this.newSnapshot())}getMostRecentSnapshot(){return a(this,yn)}render(){g(this,yn,null),this.doRender()}}ce=new WeakMap,de=new WeakMap,Oe=new WeakMap,Fe=new WeakMap,yn=new WeakMap;var pe,qs;class j0{constructor(e,t){d(this,pe,void 0);d(this,qs,void 0);g(this,pe,e),g(this,qs,t)}getColorAt(e,t){const n=t*a(this,qs)+e;if(n>=a(this,pe).length/4)throw Error(`index out of bounds: index = ${n}, max allowed index = ${a(this,pe).length/4-1}`);const s=n*4;return j.of(a(this,pe)[s],a(this,pe)[s+1],a(this,pe)[s+2])}}pe=new WeakMap,qs=new WeakMap;var vn,De,xn,Bt,Gt,ur,wu;class Q0 extends X0{constructor(t,n,s){super(t);d(this,ur);d(this,vn,void 0);d(this,De,void 0);d(this,xn,void 0);d(this,Bt,void 0);d(this,Gt,void 0);g(this,vn,t.x*t.y),g(this,De,n),a(this,De).style.backgroundColor=s.cssHex,g(this,xn,a(this,De).getContext("2d",{colorSpace:"srgb",alpha:!0})??Vi("Was unable to obtain '2d' context from <canvas>")),a(this,xn).imageSmoothingEnabled=!1;const r=document.createElement("canvas").transferControlToOffscreen();r.width=t.x,r.height=t.y,g(this,Bt,r.getContext("2d",{colorSpace:"srgb",alpha:!1})??Vi("Was unable to obtain '2d' context from OffscreenCanvas")),g(this,Gt,a(this,Bt).createImageData(a(this,Bt).canvas.width,a(this,Bt).canvas.height,{colorSpace:"srgb"})),u(this,ur,wu).call(this)}set(t,n,s){if(n<0||s<0||n>=this.canvasSize.x||s>=this.canvasSize.y)throw Error(`(x,y) index out of bounds: (x,y) = (${n},${s}), bottom bound = (0,0), upper bound = (${this.canvasSize.x-1},${this.canvasSize.y-1})`);const r=s*this.canvasSize.x+n;if(r>=a(this,vn))throw Error(`index out of bounds: index = ${r}, max allowed index = ${a(this,vn)-1}`);const o=r*4;a(this,Gt).data[o]=t.r,a(this,Gt).data[o+1]=t.g,a(this,Gt).data[o+2]=t.b}newSnapshot(){return new j0(a(this,Gt).data.slice(),this.canvasSize.x)}doRender(){a(this,Bt).putImageData(a(this,Gt),0,0);const t=D.of(a(this,De).width,a(this,De).height),n=Math.max(1,Math.min(t.div(this.canvasSize).floor().x,t.div(this.canvasSize).floor().y)),s=t.sub(this.canvasSize.mul(n)).div(2).floor();a(this,xn).drawImage(a(this,Bt).canvas,0,0,a(this,Bt).canvas.width,a(this,Bt).canvas.height,s.x,s.y,n*this.canvasSize.x,n*this.canvasSize.y)}}vn=new WeakMap,De=new WeakMap,xn=new WeakMap,Bt=new WeakMap,Gt=new WeakMap,ur=new WeakSet,wu=function(){for(let t=3;t<a(this,Gt).data.length;t+=4)a(this,Gt).data[t]=255};var jt,ge,Pe,An,vi,Ks,xi,me,Qt,tt,bt,Ys,wt,Ct,_e,ti;const io=class io{constructor(e,t){d(this,wt);d(this,_e);d(this,jt,void 0);d(this,ge,void 0);d(this,Pe,void 0);d(this,An,void 0);d(this,vi,void 0);d(this,Ks,void 0);d(this,xi,void 0);d(this,me,void 0);d(this,Qt,void 0);d(this,tt,void 0);d(this,bt,void 0);d(this,Ys,void 0);g(this,Ks,t.onGamePause==="ignore"),g(this,xi,t.onGamePause),g(this,jt,[...e.intro,...e.loop].map(n=>({name:n[0],frames:Math.max(0,Math.round(n[1]))}))),g(this,ge,e.loop.map(n=>({name:n[0],frames:Math.max(0,Math.round(n[1]))}))),g(this,Pe,a(this,jt).reduce((n,s)=>n+s.frames,0)),g(this,An,a(this,ge).reduce((n,s)=>n+s.frames,0)),g(this,vi,a(this,_e,ti)+t.delayFrames),g(this,tt,fn.for({frames:a(this,Pe),loop:!1,pause:t.pause,delayFrames:t.delayFrames,onGamePause:a(this,xi)})),g(this,bt,a(this,ge).length>0?fn.for({frames:a(this,An),loop:!0,pause:t.pause,delayFrames:t.delayFrames+a(this,Pe),onGamePause:a(this,xi)}):null),g(this,me,!1),g(this,Qt,null),t.pause&&this.pause()}static of(e,t){return new io(e,t)}get justFinishedPhase(){return this.hasJustFinishedOverall||a(this,wt,Ct).t===0?a(this,wt,Ct).recentlyFinishedPhase:null}get currentPhase(){var e;return((e=a(this,wt,Ct).phase)==null?void 0:e.name)??null}get t(){return a(this,wt,Ct).t}get progress(){return a(this,wt,Ct).phase&&a(this,wt,Ct).phase.frames>0?a(this,wt,Ct).t/a(this,wt,Ct).phase.frames:1}get framesLeft(){return a(this,wt,Ct).phase?a(this,wt,Ct).phase.frames-a(this,wt,Ct).t:0}get tOverall(){var e;return a(this,tt).hasFinished?((e=a(this,bt))==null?void 0:e.t)??a(this,tt).t:a(this,tt).t}get framesLeftOverall(){var e;return a(this,tt).hasFinished?((e=a(this,bt))==null?void 0:e.framesLeft)??a(this,tt).framesLeft:a(this,tt).framesLeft}get progressOverall(){var e;return a(this,tt).hasFinished?((e=a(this,bt))==null?void 0:e.progress)??a(this,tt).progress:a(this,tt).progress}get hasFinishedOverall(){return a(this,tt).hasFinished}get hasJustFinishedOverall(){var e;return((e=a(this,bt))==null?void 0:e.hasJustFinished)||a(this,tt).hasJustFinished}pause(){var e;a(this,me)||(g(this,me,!0),g(this,Qt,a(this,_e,ti)),a(this,tt).pause(),(e=a(this,bt))==null||e.pause())}resume(){var e;a(this,me)&&(g(this,me,!1),g(this,vi,a(this,vi)+(a(this,_e,ti)-(a(this,Qt)??0))),g(this,Qt,null),a(this,tt).resume(),(e=a(this,bt))==null||e.resume())}restart(){g(this,vi,a(this,_e,ti)),g(this,me,!1),g(this,Qt,null),a(this,tt).restart(),a(this,bt)&&g(this,bt,fn.for({frames:a(this,An),loop:!0,pause:!1,delayFrames:a(this,Pe),onGamePause:a(this,xi)}))}};jt=new WeakMap,ge=new WeakMap,Pe=new WeakMap,An=new WeakMap,vi=new WeakMap,Ks=new WeakMap,xi=new WeakMap,me=new WeakMap,Qt=new WeakMap,tt=new WeakMap,bt=new WeakMap,Ys=new WeakMap,wt=new WeakSet,Ct=function(){var o;if(((o=a(this,Ys))==null?void 0:o.frameNumber)===(a(this,Qt)??a(this,_e,ti)))return a(this,Ys).value;if(!a(this,bt)||(a(this,Qt)??a(this,_e,ti))<a(this,vi)+a(this,Pe)){const h=a(this,tt).t;let c=0,l=null,f=0;for(;f<a(this,jt).length-1;){let m=a(this,jt)[f];if(h<c+m.frames)return{recentlyFinishedPhase:(l==null?void 0:l.name)??null,phase:m,t:h-c};c+=m.frames,l=m,f+=1}let _=a(this,jt)[f]??null;return{recentlyFinishedPhase:a(this,tt).hasJustFinished?(_==null?void 0:_.name)??null:(l==null?void 0:l.name)??null,phase:_,t:h-c}}const e=a(this,bt).t;let t=0,n=a(this,jt)[a(this,jt).length-1]??null,s=0;for(;s<a(this,ge).length-1;){let h=a(this,ge)[s];if(e<t+h.frames)return{recentlyFinishedPhase:(n==null?void 0:n.name)??null,phase:h,t:e-t};t+=h.frames,n=h,s+=1}let r=a(this,ge)[s]??null;return{recentlyFinishedPhase:(n==null?void 0:n.name)??null,phase:r,t:e-t}},_e=new WeakSet,ti=function(){return a(this,Ks)?kt.frameNumber:kt.frameNumberOutsidePause};let xl=io;function V0(i){return(e,t,n,s)=>zl.from(i,e,t,n,s)}function Vl(i,e){return i instanceof as?as.basedOn(i,e??Ll):as.of(i)}const to=Vl(new tl),tp=Vl(new Du),ep=Vl(new Pu);function Kt(i,e,t){return typeof i=="string"?j.fromCssHex(i):j.of(i,e??0,t??0)}const ip=Kt("#000000"),np=Kt("#ffffff");Kt("#ff0000");Kt("#00ff00");Kt("#0000ff");Kt("#00ffff");Kt("#ff00ff");Kt("#ffff00");const yu=it;function uh(i){return(e,t,n,s)=>Jn.from(i,e,t,n,s)}function sp(i,e){return xl.of({intro:i.intro??[],loop:i.loop??[]},{pause:(e==null?void 0:e.pause)??!1,delayFrames:(e==null?void 0:e.delayFrames)??0,onGamePause:(e==null?void 0:e.onGamePause)??"pause"})}function et(i,e){return D.of(i,e??i)}const xs=et(0,0),Ha=et(1,1);var Ue,Xs,En,js,Qs,Ie,ze,Ne;class ap{constructor(e,t,n){d(this,Ue,void 0);d(this,Xs,void 0);d(this,En,void 0);d(this,js,void 0);d(this,Qs,void 0);d(this,Ie,void 0);d(this,ze,void 0);d(this,Ne,void 0);g(this,Ue,e),g(this,Xs,n.color??yu.orange),g(this,En,t);const s=n.placement??"top-right";g(this,Qs,s.endsWith("-left")),g(this,js,s.startsWith("top-")),g(this,Ie,Array.from({length:15},()=>0)),g(this,ze,0),g(this,Ne,0)}drawRenderingFps(e){if(a(this,Ie)[a(this,ze)]=e,g(this,ze,di(a(this,ze)+1,a(this,Ie).length)),a(this,ze)===0){g(this,Ne,0);for(const r of a(this,Ie))g(this,Ne,a(this,Ne)+r);g(this,Ne,a(this,Ne)/a(this,Ie).length)}const t=a(this,Ue).useFont(to),n=a(this,Ne).toFixed(),s=Xn.measureText(n).wh;a(this,Ue).drawText(n,a(this,Ue).cameraXy.add(a(this,Qs)?1:a(this,En).x-s.x-1,a(this,js)?1:a(this,En).y-s.y-1),a(this,Xs)),a(this,Ue).useFont(t)}}Ue=new WeakMap,Xs=new WeakMap,En=new WeakMap,js=new WeakMap,Qs=new WeakMap,Ie=new WeakMap,ze=new WeakMap,Ne=new WeakMap;var Sn;const fr=class fr{static get active(){return a(fr,Sn)}static set active(e){g(this,Sn,e),z.infoBeetPx(`FrameByFrame flag set to: ${a(this,Sn)}`)}};Sn=new WeakMap,d(fr,Sn,!1);let ei=fr;var Ai;class rp{constructor(e){d(this,Ai,void 0);g(this,Ai,e)}draw(e){for(let t=0;t<a(this,Ai).canvasSize.x;++t)for(let n=0;n<a(this,Ai).canvasSize.y;++n)a(this,Ai).set(e,t,n)}}Ai=new WeakMap;var ct,X,V;class lp{constructor(e){d(this,X);d(this,ct,void 0);g(this,ct,e)}draw(e,t,n,s,r){const[o,h]=D.minMax(e.round(),e.add(t).round());if(h.x-o.x<=0||h.y-o.y<=0||!a(this,ct).canSetAny(o.x,o.y,h.x-1,h.y-1))return;const c=n.type==="pattern"?n.primary:n,l=n.type==="pattern"?n.secondary:null,f=(c==null?void 0:c.type)==="canvas_snapshot_mapping"?a(this,ct).getMostRecentSnapshot():null,_=r;let m=h.x-o.x-1,p=h.y-o.y-1,y=p&1,U=o.x,O=h.x-1,C=o.y+Math.floor((p+1)/2),P=C-y,I=4*(1-m)*p*p,x=4*(y+1)*m*m,B=I+x+y*m*m;m=8*m*m,y=8*p*p;do{if(u(this,X,V).call(this,U,P,c,l,_,f),u(this,X,V).call(this,O,P,c,l,_,f),u(this,X,V).call(this,O,C,c,l,_,f),u(this,X,V).call(this,U,C,c,l,_,f),s==="inside")for(let k=U+1;k<O;++k)u(this,X,V).call(this,k,P,c,l,_,f),u(this,X,V).call(this,k,C,c,l,_,f);else if(s==="outside"){for(let k=0;k<U;++k)u(this,X,V).call(this,k,P,c,l,_,f),u(this,X,V).call(this,k,C,c,l,_,f);for(let k=O+1;k<a(this,ct).canvasSize.x;++k)u(this,X,V).call(this,k,P,c,l,_,f),u(this,X,V).call(this,k,C,c,l,_,f)}const L=B;2*L<=x&&(C+=1,P-=1,x+=m,B+=x),(2*L>=I||2*B>x)&&(U+=1,O-=1,I+=y,B+=I)}while(U<=O);for(;C-P<=p;){if(u(this,X,V).call(this,U-1,C,c,l,_,f),u(this,X,V).call(this,O+1,C,c,l,_,f),s==="outside"){for(let L=0;L<U-1;++L)u(this,X,V).call(this,L,C,c,l,_,f);for(let L=O+2;L<a(this,ct).canvasSize.x;++L)u(this,X,V).call(this,L,C,c,l,_,f)}if(C+=1,u(this,X,V).call(this,U-1,P,c,l,_,f),u(this,X,V).call(this,O+1,P,c,l,_,f),s==="outside"){for(let L=0;L<U-1;++L)u(this,X,V).call(this,L,P,c,l,_,f);for(let L=O+2;L<a(this,ct).canvasSize.x;++L)u(this,X,V).call(this,L,P,c,l,_,f)}P-=1}if(s==="outside")for(let L=0;L<a(this,ct).canvasSize.x;++L){for(let k=0;k<P+1;++k)u(this,X,V).call(this,L,k,c,l,_,f);for(let k=C;k<a(this,ct).canvasSize.y;++k)u(this,X,V).call(this,L,k,c,l,_,f)}}}ct=new WeakMap,X=new WeakSet,V=function(e,t,n,s,r,o){if(a(this,ct).canSetAt(e,t))if(r.hasPrimaryColorAt(e,t)){if(n)if(n.type==="rgb")a(this,ct).set(n,e,t);else{const h=n.getMappedColor(o,e,t);h&&a(this,ct).set(h,e,t)}}else s!=null&&a(this,ct).set(s,e,t)};var be,cr,vu;class op{constructor(e){d(this,cr);d(this,be,void 0);g(this,be,e)}draw(e,t,n,s){const r=e.round(),o=e.add(t).round();if(o.x-r.x===0||o.y-r.y===0)return;t=o.sub(r);const h=t.sub(t.sign()),c=n.type==="pattern"?n.primary:n,l=n.type==="pattern"?n.secondary:null,f=(c==null?void 0:c.type)==="canvas_snapshot_mapping"?a(this,be).getMostRecentSnapshot():null,_=s;let m=h.abs().mul(et(1,-1)),p=r;const y=r.add(h),U=h.sign();let O=m.x+m.y;for(;u(this,cr,vu).call(this,p.x,p.y,c,l,_,f),!p.eq(y);){const C=O;2*C>=m.y&&(p=p.add(et(U.x,0)),O+=m.y),2*C<=m.x&&(p=p.add(et(0,U.y)),O+=m.x)}}}be=new WeakMap,cr=new WeakSet,vu=function(e,t,n,s,r,o){if(a(this,be).canSetAt(e,t))if(r.hasPrimaryColorAt(e,t)){if(n)if(n.type==="rgb")a(this,be).set(n,e,t);else{const h=n.getMappedColor(o,e,t);h&&a(this,be).set(h,e,t)}}else s!=null&&a(this,be).set(s,e,t)};var kn;class hp{constructor(e){d(this,kn,void 0);g(this,kn,e)}draw(e,t,n){e=e.round(),a(this,kn).canSetAt(e.x,e.y)&&n.hasPrimaryColorAt(e.x,e.y)&&a(this,kn).set(t,e.x,e.y)}}kn=new WeakMap;var Cn,Vs;class xu{constructor(e,t={}){d(this,Cn,void 0);d(this,Vs,void 0);g(this,Cn,e),g(this,Vs,t)}draw(e,t,n,s,r,o){t=a(this,Vs).disableRounding?t:t.round(),s=D.max(s.floor(),xs);for(let h=0;h<e.asciiRows.length;h+=1){const c=t.y+(r[1]?e.size.y-1-h:h)*s.y;for(let l=0;l<e.asciiRows[h].length;l+=1){const f=t.x+(r[0]?e.size.x-1-l:l)*s.x;if(e.asciiRows[h][l]==="#")for(let _=0;_<s.y;++_)for(let m=0;m<s.x;++m){const p=c+_,y=f+m;o.hasPrimaryColorAt(y,p)&&a(this,Cn).canSetAt(y,p)&&a(this,Cn).set(n,y,p)}}}}}Cn=new WeakMap,Vs=new WeakMap;var yt,ot,pt;class up{constructor(e){d(this,ot);d(this,yt,void 0);g(this,yt,e)}draw(e,t,n,s,r){const[o,h]=D.minMax(e.round(),e.add(t).round());if(!a(this,yt).canSetAny(o.x,o.y,h.x-1,h.y-1))return;const c=n.type==="pattern"?n.primary:n,l=n.type==="pattern"?n.secondary:null,f=(c==null?void 0:c.type)==="canvas_snapshot_mapping"?a(this,yt).getMostRecentSnapshot():null,_=r;for(let m=o.x;m<h.x;m+=1)u(this,ot,pt).call(this,m,o.y,c,l,_,f),u(this,ot,pt).call(this,m,h.y-1,c,l,_,f);for(let m=o.y+1;m<h.y-1;m+=1)u(this,ot,pt).call(this,o.x,m,c,l,_,f),u(this,ot,pt).call(this,h.x-1,m,c,l,_,f);if(s==="inside")for(let m=o.x;m<h.x;m+=1)for(let p=o.y+1;p<h.y-1;p+=1)u(this,ot,pt).call(this,m,p,c,l,_,f);else if(s==="outside"){for(let m=0;m<o.x;m+=1){for(let p=0;p<o.y;p+=1)u(this,ot,pt).call(this,m,p,c,l,_,f);for(let p=o.y;p<h.y;p+=1)u(this,ot,pt).call(this,m,p,c,l,_,f);for(let p=h.y;p<a(this,yt).canvasSize.y;p+=1)u(this,ot,pt).call(this,m,p,c,l,_,f)}for(let m=o.x;m<h.x;m+=1)for(let p=0;p<o.y;p+=1)u(this,ot,pt).call(this,m,p,c,l,_,f);for(let m=o.x;m<h.x;m+=1)for(let p=h.y;p<a(this,yt).canvasSize.y;p+=1)u(this,ot,pt).call(this,m,p,c,l,_,f);for(let m=h.x;m<a(this,yt).canvasSize.x;m+=1){for(let p=0;p<o.y;p+=1)u(this,ot,pt).call(this,m,p,c,l,_,f);for(let p=o.y;p<h.y;p+=1)u(this,ot,pt).call(this,m,p,c,l,_,f);for(let p=h.y;p<a(this,yt).canvasSize.y;p+=1)u(this,ot,pt).call(this,m,p,c,l,_,f)}}}}yt=new WeakMap,ot=new WeakSet,pt=function(e,t,n,s,r,o){if(a(this,yt).canSetAt(e,t))if(r.hasPrimaryColorAt(e,t)){if(n)if(n.type==="rgb")a(this,yt).set(n,e,t);else{const h=n.getMappedColor(o,e,t);h&&a(this,yt).set(h,e,t)}}else s!=null&&a(this,yt).set(s,e,t)};var Rn;class fp{constructor(){d(this,Rn,new Map)}prepareOrGetFromCache(e,t,n,s){const r=e.imageUrl+"::"+e.xy.x.toString()+":"+e.xy.y.toString()+":"+e.size.x.toString()+":"+e.size.y.toString();if(a(this,Rn).has(r))return a(this,Rn).get(r);const o=e.size.x,h=e.size.y,c=ja(o).map(()=>ja(h).map(()=>null));for(let f=0;f<h;++f){const _=e.xy.y+f;for(let m=0;m<o;++m){const p=e.xy.x+m,y=(_*n+p)*s;c[m][f]=s===3||t[y+3]>=255/2?Kt(t[y],t[y+1],t[y+2]):null}}const l={w:e.size.x,h:e.size.y,colors:c,cacheHit:!0};return a(this,Rn).set(r,l),{...l,cacheHit:!1}}}Rn=new WeakMap;var dr,Ei,ta;class Au{constructor(e,t={}){d(this,dr,new fp);d(this,Ei,void 0);d(this,ta,void 0);g(this,Ei,e),g(this,ta,t)}draw(e,t,n,s,r,o,h){n=a(this,ta).disableRounding?n:n.round(),s=D.max(s.floor(),xs);const{width:c,height:l,channels:f,rgba8bitData:_}=t;if(e=e.clipBy(xs,et(c,l)),!a(this,Ei).canSetAny(n.x,n.y,n.x+e.size.x*s.x-1,n.y+e.size.y*s.y-1))return;const m=a(this,dr).prepareOrGetFromCache(e,_,c,f);for(let p=0;p<m.h;p+=1){const y=n.y+(r[1]?e.size.y-1-p:p)*s.y;for(let U=0;U<m.w;U+=1){const O=n.x+(r[0]?e.size.x-1-U:U)*s.x;for(let C=0;C<s.y;++C)for(let P=0;P<s.x;++P){const I=O+P,x=y+C;if(a(this,Ei).canSetAt(I,x)&&h.hasPrimaryColorAt(I,x)){const B=m.colors[U][p];if(B){const L=o.getMappedColor(B,U,p);L&&a(this,Ei).set(L,I,x)}}}}}}}dr=new WeakMap,Ei=new WeakMap,ta=new WeakMap;var Tn,ea,ia,na;class cp{constructor(e,t){d(this,Tn,void 0);d(this,ea,void 0);d(this,ia,void 0);d(this,na,void 0);g(this,Tn,e),g(this,ea,t),g(this,ia,new Au(a(this,Tn),{disableRounding:!0})),g(this,na,new xu(a(this,Tn),{disableRounding:!0}))}draw(e,t,n,s,r,o,h){n=n.round(),o=D.max(o.floor(),xs);for(const c of t.arrangeGlyphsFor(e,s,r)){if(c.type==="line_break")continue;const l=n.add(c.leftTop.mul(o));c.type==="sprite"?a(this,ia).draw(c.sprite,a(this,ea).getImageAsset(c.sprite.imageUrl),l,o,[!1,!1],c.spriteColorMapping,h):c.type==="pixels"?a(this,na).draw(c.pixels,l,c.color,o,[!1,!1],h):Nl()}}}Tn=new WeakMap,ea=new WeakMap,ia=new WeakMap,na=new WeakMap;var sa,Si,aa,ra,la,oa,ki,Ci,ha,ua,ht,Mn,Vt,Ri;class dp{constructor(e){d(this,sa,void 0);d(this,Si,void 0);d(this,aa,void 0);d(this,ra,void 0);d(this,la,void 0);d(this,oa,void 0);d(this,ki,void 0);d(this,Ci,void 0);d(this,ha,void 0);d(this,ua,void 0);b(this,"cameraXy",et(0,0));d(this,ht,Qr.primaryOnly);d(this,Mn,Xa.noMapping);d(this,Vt,to);d(this,Ri,{});g(this,sa,e.assets),g(this,Si,e.canvas),g(this,aa,new rp(e.canvas)),g(this,ra,new hp(e.canvas)),g(this,la,new xu(e.canvas)),g(this,oa,new op(e.canvas)),g(this,ki,new up(e.canvas)),g(this,Ci,new lp(e.canvas)),g(this,ha,new Au(e.canvas)),g(this,ua,new cp(e.canvas,e.assets))}clearCanvas(e){a(this,aa).draw(e)}setClippingRegion(e,t){return a(this,Si).setClippingRegion(e,t)}removeClippingRegion(){return a(this,Si).removeClippingRegion()}setCameraXy(e){const t=this.cameraXy;return this.cameraXy=e,t}setDrawingPattern(e){const t=a(this,ht);return g(this,ht,e),t}drawPixel(e,t){a(this,ra).draw(e.sub(this.cameraXy),t,a(this,ht))}drawPixels(e,t,n,s){var o,h;const r=(s==null?void 0:s.centerXy)??[!1,!1];(r[0]||r[1])&&(t=t.sub(r[0]?e.size.x*(((o=s==null?void 0:s.scaleXy)==null?void 0:o.x)??1)/2:0,r[1]?e.size.y*(((h=s==null?void 0:s.scaleXy)==null?void 0:h.y)??1)/2:0)),a(this,la).draw(e,t.sub(this.cameraXy),n,(s==null?void 0:s.scaleXy)??Ha,(s==null?void 0:s.flipXy)??[!1,!1],a(this,ht))}drawLine(e,t,n){a(this,oa).draw(e.sub(this.cameraXy),t,n,a(this,ht))}drawRect(e,t,n){a(this,ki).draw(e.sub(this.cameraXy),t,n,"none",a(this,ht))}drawRectFilled(e,t,n){a(this,ki).draw(e.sub(this.cameraXy),t,n,"inside",a(this,ht))}drawRectOutsideFilled(e,t,n){a(this,ki).draw(e.sub(this.cameraXy),t,n,"outside",a(this,ht))}drawEllipse(e,t,n){a(this,Ci).draw(e.sub(this.cameraXy),t,n,"none",a(this,ht))}drawEllipseFilled(e,t,n){a(this,Ci).draw(e.sub(this.cameraXy),t,n,"inside",a(this,ht))}drawEllipseOutsideFilled(e,t,n){a(this,Ci).draw(e.sub(this.cameraXy),t,n,"outside",a(this,ht))}setSpriteColorMapping(e){const t=a(this,Mn);return g(this,Mn,e),t}drawSprite(e,t,n){var o,h;const s=(n==null?void 0:n.centerXy)??[!1,!1];(s[0]||s[1])&&(t=t.sub(s[0]?e.size.x*(((o=n==null?void 0:n.scaleXy)==null?void 0:o.x)??1)/2:0,s[1]?e.size.y*(((h=n==null?void 0:n.scaleXy)==null?void 0:h.y)??1)/2:0));const r=a(this,sa).getImageAsset(e.imageUrl);a(this,ha).draw(e.type==="static"?e:e.current,r,t.sub(this.cameraXy),(n==null?void 0:n.scaleXy)??Ha,(n==null?void 0:n.flipXy)??[!1,!1],a(this,Mn),a(this,ht))}useFont(e){const t=a(this,Vt);return g(this,Vt,e),t}setTextColorMarkers(e){const t=a(this,Ri);return g(this,Ri,e),t}measureText(e,t){var h,c;let n=0,s=0;for(const l of a(this,Vt).arrangeGlyphsFor(e,np,a(this,Ri)))l.type==="line_break"?n=Math.max(n,l.lineNumber+1):(n=Math.max(n,l.lineNumber),s=Math.max(s,l.leftTop.x+(l.type==="sprite"?l.sprite.size.x:l.pixels.size.x)));const r=et(s,(n+1)*(a(this,Vt).ascent+a(this,Vt).descent)+n*a(this,Vt).lineGap).mul((t==null?void 0:t.scaleXy)??Ha),o=et((h=t==null?void 0:t.centerXy)!=null&&h[0]?-r.x/2:0,(c=t==null?void 0:t.centerXy)!=null&&c[1]?-r.y/2:0);return{wh:r,offset:o}}drawText(e,t,n,s){const r=(s==null?void 0:s.centerXy)??[!1,!1];if(r[0]||r[1]){const{offset:o}=this.measureText(e,{scaleXy:s==null?void 0:s.scaleXy,centerXy:s==null?void 0:s.centerXy});t=t.add(o)}a(this,ua).draw(e,a(this,Vt),t.sub(this.cameraXy),n,a(this,Ri),(s==null?void 0:s.scaleXy)??Ha,a(this,ht))}takeCanvasSnapshot(){return a(this,Si).takeSnapshot()}}sa=new WeakMap,Si=new WeakMap,aa=new WeakMap,ra=new WeakMap,la=new WeakMap,oa=new WeakMap,ki=new WeakMap,Ci=new WeakMap,ha=new WeakMap,ua=new WeakMap,ht=new WeakMap,Mn=new WeakMap,Vt=new WeakMap,Ri=new WeakMap;var Le,Ti,Mi,Oi,Fi,On,Ya;class Dt{constructor(){d(this,On);d(this,Le,!1);d(this,Ti,!1);d(this,Mi,null);d(this,Oi,null);d(this,Fi,null)}setRepeating(e){g(this,Mi,e.firstRepeatFrames),g(this,Oi,e.loopedRepeatFrames)}get isPressed(){return a(this,Le)}get wasJustPressed(){var e;return a(this,Ti)&&a(this,Le)||a(this,On,Ya)&&((e=a(this,Fi))==null?void 0:e.justFinishedPhase)!=null}get wasJustReleased(){var e;return a(this,Ti)&&!a(this,Le)||a(this,On,Ya)&&((e=a(this,Fi))==null?void 0:e.justFinishedPhase)!=null}update(e){e?a(this,Ti)&&a(this,On,Ya)&&g(this,Fi,sp({intro:a(this,Mi)?[["first",a(this,Mi)]]:void 0,loop:a(this,Oi)?[["looped",a(this,Oi)]]:void 0},{onGamePause:"ignore"})):g(this,Fi,null),g(this,Ti,a(this,Le)!==e),g(this,Le,e)}}Le=new WeakMap,Ti=new WeakMap,Mi=new WeakMap,Oi=new WeakMap,Fi=new WeakMap,On=new WeakSet,Ya=function(){return a(this,Mi)!=null||a(this,Oi)!=null};var Zt,Ht,Jt,Wt,te,ee,ie;class pp{constructor(){d(this,Zt,new Dt);d(this,Ht,new Dt);d(this,Jt,new Dt);d(this,Wt,new Dt);d(this,te,new Dt);d(this,ee,new Dt);d(this,ie,new Dt)}update(e){a(this,Zt).update(e.has("button_left")),a(this,Ht).update(e.has("button_right")),a(this,Jt).update(e.has("button_up")),a(this,Wt).update(e.has("button_down")),a(this,te).update(e.has("button_a")),a(this,ee).update(e.has("button_b")),a(this,ie).update(e.has("button_menu"))}isAnyPressed(){return a(this,Zt).isPressed||a(this,Ht).isPressed||a(this,Jt).isPressed||a(this,Wt).isPressed||a(this,te).isPressed||a(this,ee).isPressed||a(this,ie).isPressed}isPressed(e){switch(e){case"left":return a(this,Zt).isPressed;case"right":return a(this,Ht).isPressed;case"up":return a(this,Jt).isPressed;case"down":return a(this,Wt).isPressed;case"a":return a(this,te).isPressed;case"b":return a(this,ee).isPressed;case"menu":return a(this,ie).isPressed}}getPressedDirection(){return et((a(this,Zt).isPressed?-1:0)+(a(this,Ht).isPressed?1:0),(a(this,Jt).isPressed?-1:0)+(a(this,Wt).isPressed?1:0))}setButtonRepeating(e,t){switch(e){case"left":a(this,Zt).setRepeating(t);return;case"right":a(this,Ht).setRepeating(t);return;case"up":a(this,Jt).setRepeating(t);return;case"down":a(this,Wt).setRepeating(t);return;case"a":a(this,te).setRepeating(t);return;case"b":a(this,ee).setRepeating(t);return;case"menu":a(this,ie).setRepeating(t);return}}wasAnyJustPressed(){return a(this,Zt).wasJustPressed||a(this,Ht).wasJustPressed||a(this,Jt).wasJustPressed||a(this,Wt).wasJustPressed||a(this,te).wasJustPressed||a(this,ee).wasJustPressed||a(this,ie).wasJustPressed}wasJustPressed(e){switch(e){case"left":return a(this,Zt).wasJustPressed;case"right":return a(this,Ht).wasJustPressed;case"up":return a(this,Jt).wasJustPressed;case"down":return a(this,Wt).wasJustPressed;case"a":return a(this,te).wasJustPressed;case"b":return a(this,ee).wasJustPressed;case"menu":return a(this,ie).wasJustPressed}}wasJustReleased(e){switch(e){case"left":return a(this,Zt).wasJustReleased;case"right":return a(this,Ht).wasJustReleased;case"up":return a(this,Jt).wasJustReleased;case"down":return a(this,Wt).wasJustReleased;case"a":return a(this,te).wasJustReleased;case"b":return a(this,ee).wasJustReleased;case"menu":return a(this,ie).wasJustReleased}}}Zt=new WeakMap,Ht=new WeakMap,Jt=new WeakMap,Wt=new WeakMap,te=new WeakMap,ee=new WeakMap,ie=new WeakMap;function Eu(i){return i!=null}var Di;const ni=class ni{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 0:case 4:return"button_a";case 1:case 3:return"button_b";case 10:case 11:return"button_menu"}return null}eventsForAxisValue(e,t){if(e===9){const n=t*7+8;if(n<.5||n>15.5||n>7.5&&n<8.5)return[];switch(Math.round(n)){case 1:return["button_up"];case 3:return["button_up","button_right"];case 5:return["button_right"];case 7:return["button_down","button_right"];case 9:return["button_down"];case 11:return["button_down","button_left"];case 13:return["button_left"];case 15:return["button_up","button_left"];default:return[]}}switch(e){case 0:case 2:return t>a(ni,Di)?["button_right"]:t<-a(ni,Di)?["button_left"]:[];case 1:case 5:return t>a(ni,Di)?["button_down"]:t<-a(ni,Di)?["button_up"]:[];default:return[]}}};Di=new WeakMap,d(ni,Di,.6);let Al=ni;var Pi;const si=class si{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 0:case 3:case 4:case 7:return"button_a";case 1:case 2:case 5:case 6:return"button_b";case 12:return"button_up";case 13:return"button_down";case 14:return"button_left";case 15:return"button_right";case 8:case 9:case 10:case 11:case 16:case 17:return"button_menu"}return null}eventsForAxisValue(e,t){switch(e){case 0:case 2:return t>a(si,Pi)?["button_right"]:t<-a(si,Pi)?["button_left"]:[];case 1:case 3:return t>a(si,Pi)?["button_down"]:t<-a(si,Pi)?["button_up"]:[];default:return[]}}};Pi=new WeakMap,d(si,Pi,.6);let El=si;var Ui;const ai=class ai{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 0:case 4:return"button_a";case 1:case 3:return"button_b";case 10:case 11:return"button_menu"}return null}eventsForAxisValue(e,t){if(e===0){const n=t*7+8;if(n<.5||n>15.5||n>7.5&&n<8.5)return[];switch(Math.round(n)){case 1:return["button_up"];case 3:return["button_up","button_right"];case 5:return["button_right"];case 7:return["button_down","button_right"];case 9:return["button_down"];case 11:return["button_down","button_left"];case 13:return["button_left"];case 15:return["button_up","button_left"];default:return[]}}switch(e){case 1:case 3:return t>a(ai,Ui)?["button_right"]:t<-a(ai,Ui)?["button_left"]:[];case 2:case 4:return t>a(ai,Ui)?["button_down"]:t<-a(ai,Ui)?["button_up"]:[];default:return[]}}};Ui=new WeakMap,d(ai,Ui,.6);let Sl=ai;var Ii;const ri=class ri{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 0:case 4:return"button_a";case 1:case 3:return"button_b";case 10:case 11:return"button_menu"}return null}eventsForAxisValue(e,t){if(e===9){const n=t*7+8;if(n<.5||n>15.5||n>7.5&&n<8.5)return[];switch(Math.round(n)){case 1:return["button_up"];case 3:return["button_up","button_right"];case 5:return["button_right"];case 7:return["button_down","button_right"];case 9:return["button_down"];case 11:return["button_down","button_left"];case 13:return["button_left"];case 15:return["button_up","button_left"];default:return[]}}switch(e){case 0:case 2:return t>a(ri,Ii)?["button_right"]:t<-a(ri,Ii)?["button_left"]:[];case 1:case 5:return t>a(ri,Ii)?["button_down"]:t<-a(ri,Ii)?["button_up"]:[];default:return[]}}};Ii=new WeakMap,d(ri,Ii,.6);let kl=ri;var zi;const li=class li{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 1:case 3:return"button_a";case 0:case 2:return"button_b";case 9:return"button_menu"}return null}eventsForAxisValue(e,t){if(e===4){const n=t*7+8;if(n<.5||n>15.5||n>7.5&&n<8.5)return[];switch(Math.round(n)){case 1:return["button_up"];case 3:return["button_up","button_right"];case 5:return["button_right"];case 7:return["button_down","button_right"];case 9:return["button_down"];case 11:return["button_down","button_left"];case 13:return["button_left"];case 15:return["button_up","button_left"];default:return[]}}switch(e){case 0:case 2:return t>a(li,zi)?["button_right"]:t<-a(li,zi)?["button_left"]:[];case 1:case 3:return t>a(li,zi)?["button_down"]:t<-a(li,zi)?["button_up"]:[];default:return[]}}};zi=new WeakMap,d(li,zi,.6);let Cl=li;var Ni;const oi=class oi{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 1:case 3:return"button_a";case 0:case 2:return"button_b";case 9:return"button_menu"}return null}eventsForAxisValue(e,t){switch(e){case 0:case 2:return t>a(oi,Ni)?["button_right"]:t<-a(oi,Ni)?["button_left"]:[];case 1:case 5:return t>a(oi,Ni)?["button_down"]:t<-a(oi,Ni)?["button_up"]:[];default:return[]}}};Ni=new WeakMap,d(oi,Ni,.6);let Rl=oi;var Li;const hi=class hi{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 1:case 5:case 4:case 7:return"button_a";case 2:case 3:case 0:case 6:return"button_b";case 12:return"button_up";case 13:return"button_down";case 14:return"button_left";case 15:return"button_right";case 16:case 8:case 9:case 10:case 11:case 17:return"button_menu"}return null}eventsForAxisValue(e,t){switch(e){case 0:case 2:return t>a(hi,Li)?["button_right"]:t<-a(hi,Li)?["button_left"]:[];case 1:case 3:return t>a(hi,Li)?["button_down"]:t<-a(hi,Li)?["button_up"]:[];default:return[]}}};Li=new WeakMap,d(hi,Li,.6);let Tl=hi;var $i;const ui=class ui{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 0:case 3:return"button_a";case 1:case 2:return"button_b";case 12:return"button_up";case 13:return"button_down";case 14:return"button_left";case 15:return"button_right";case 8:case 9:return"button_menu"}return null}eventsForAxisValue(e,t){switch(e){case 0:case 2:return t>a(ui,$i)?["button_right"]:t<-a(ui,$i)?["button_left"]:[];case 1:case 3:return t>a(ui,$i)?["button_down"]:t<-a(ui,$i)?["button_up"]:[];default:return[]}}};$i=new WeakMap,d(ui,$i,.6);let Ml=ui;var Bi;const fi=class fi{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 0:case 3:return"button_a";case 1:case 2:return"button_b";case 12:return"button_up";case 13:return"button_down";case 14:return"button_left";case 15:return"button_right";case 9:return"button_menu"}return null}eventsForAxisValue(e,t){switch(e){case 0:case 2:return t>a(fi,Bi)?["button_right"]:t<-a(fi,Bi)?["button_left"]:[];case 1:case 3:return t>a(fi,Bi)?["button_down"]:t<-a(fi,Bi)?["button_up"]:[];default:return[]}}};Bi=new WeakMap,d(fi,Bi,.6);let Ol=fi;var we,Ot,pr,Su;class gp{constructor(e){d(this,pr);b(this,"inputMethod","gamepad");d(this,we,void 0);d(this,Ot,{standard:new Ol,firefoxDualSenseWindows:new Rl,firefoxDualSenseOther:new Cl,firefox8bitdoWindows:new kl,firefox8bitdoOther:new Sl,firefoxOther:new Tl,safari8bitdo:new Ml,"8bitdo":new Al,other:new El});g(this,we,e.browserType)}startListening(){}update(e){let t=!1;for(const n of navigator.getGamepads()){if(!n)continue;const s=u(this,pr,Su).call(this,n);for(let r=0;r<n.buttons.length;++r){const o=s.eventForButton(r,n.buttons[r]);o&&(e.add(o),t=!0)}for(let r=0;r<n.axes.length;++r)s.eventsForAxisValue(r,n.axes[r]).forEach(o=>{e.add(o),t=!0})}return t}connectedGamepadTypes(){return new Set(navigator.getGamepads().filter(Eu).map(e=>ro.detect(e)))}}we=new WeakMap,Ot=new WeakMap,pr=new WeakSet,Su=function(e){const t=ro.detect(e);return a(this,we)==="firefox_windows"||a(this,we)==="firefox_other"?t==="dualsense"?a(this,we)==="firefox_windows"?a(this,Ot).firefoxDualSenseWindows:a(this,Ot).firefoxDualSenseOther:t==="8bitdo"?a(this,we)==="firefox_windows"?a(this,Ot).firefox8bitdoWindows:a(this,Ot).firefox8bitdoOther:a(this,Ot).firefoxOther:t==="8bitdo"?a(this,we)==="safari"?a(this,Ot).safari8bitdo:a(this,Ot)["8bitdo"]:e.mapping==="standard"?a(this,Ot).standard:a(this,Ot).other};var $e,Gi;class mp{constructor(e){b(this,"inputMethod","keyboard");d(this,$e,new Map([["ArrowLeft","button_left"],["ArrowRight","button_right"],["ArrowUp","button_up"],["ArrowDown","button_down"],["w","button_up"],["W","button_up"],["s","button_down"],["S","button_down"],["a","button_left"],["A","button_left"],["d","button_right"],["D","button_right"],["j","button_a"],["J","button_a"],["k","button_b"],["K","button_b"],["c","button_a"],["C","button_a"],["x","button_b"],["x","button_b"],["p","button_menu"],["P","button_menu"],["Escape","button_menu"],["Enter","button_menu"],["m","mute_unmute_toggle"],["M","mute_unmute_toggle"],["f","full_screen"],["F","full_screen"]]));d(this,Gi,new Set);e.enableDebugToggle&&a(this,$e).set(";","debug_toggle"),e.enableFrameByFrameControls&&(a(this,$e).set(",","frame_by_frame_toggle"),a(this,$e).set(".","frame_by_frame_step"))}startListening(){document.addEventListener("keydown",e=>{const t=a(this,$e).get(e.key);t&&(e.preventDefault(),a(this,Gi).add(t))}),document.addEventListener("keyup",e=>{const t=a(this,$e).get(e.key);t&&(e.preventDefault(),a(this,Gi).delete(t))})}update(e){let t=!1;for(const n of a(this,Gi))e.add(n),t=!0;return a(this,Gi).delete("full_screen"),t}}$e=new WeakMap,Gi=new WeakMap;var Zi;const gr=class gr{constructor(){b(this,"inputMethod","mouse");d(this,Zi,new Set)}startListening(){gr.mapping.forEach(({event:e,selector:t})=>{document.querySelectorAll(t).forEach(n=>{n.addEventListener("mousedown",()=>{a(this,Zi).add(e)}),n.addEventListener("mouseup",()=>{a(this,Zi).delete(e)})})})}update(e){let t=!1;for(const n of a(this,Zi))e.add(n),t=!0;return a(this,Zi).delete("full_screen"),t}};Zi=new WeakMap,b(gr,"mapping",[{event:"button_left",selector:N.selectors.controlsLeft},{event:"button_left",selector:N.selectors.controlsUpLeft},{event:"button_left",selector:N.selectors.controlsDownLeft},{event:"button_right",selector:N.selectors.controlsRight},{event:"button_right",selector:N.selectors.controlsUpRight},{event:"button_right",selector:N.selectors.controlsDownRight},{event:"button_up",selector:N.selectors.controlsUp},{event:"button_up",selector:N.selectors.controlsUpLeft},{event:"button_up",selector:N.selectors.controlsUpRight},{event:"button_down",selector:N.selectors.controlsDown},{event:"button_down",selector:N.selectors.controlsDownLeft},{event:"button_down",selector:N.selectors.controlsDownRight},{event:"button_a",selector:N.selectors.controlsA},{event:"button_b",selector:N.selectors.controlsB},{event:"button_menu",selector:N.selectors.controlsMenu},{event:"mute_unmute_toggle",selector:N.selectors.controlsMuteToggle},{event:"full_screen",selector:N.selectors.controlsFullScreen}]);let Fl=gr;var K,Hi,Be,Ji,ss,fa,Pl;const q=class q{constructor(){d(this,Ji);d(this,fa);b(this,"inputMethod","touch");d(this,Hi,[{bitMask:a(q,K).up|a(q,K).left,events:["button_up","button_left"],requiresStart:!1,selector:N.selectors.controlsUpLeft,elements:[]},{bitMask:a(q,K).up,events:["button_up"],requiresStart:!1,selector:N.selectors.controlsUp,elements:[]},{bitMask:a(q,K).up|a(q,K).right,events:["button_up","button_right"],requiresStart:!1,selector:N.selectors.controlsUpRight,elements:[]},{bitMask:a(q,K).left,events:["button_left"],requiresStart:!1,selector:N.selectors.controlsLeft,elements:[]},{bitMask:a(q,K).right,events:["button_right"],requiresStart:!1,selector:N.selectors.controlsRight,elements:[]},{bitMask:a(q,K).down|a(q,K).left,events:["button_down","button_left"],requiresStart:!1,selector:N.selectors.controlsDownLeft,elements:[]},{bitMask:a(q,K).down,events:["button_down"],requiresStart:!1,selector:N.selectors.controlsDown,elements:[]},{bitMask:a(q,K).down|a(q,K).right,events:["button_down","button_right"],requiresStart:!1,selector:N.selectors.controlsDownRight,elements:[]},{bitMask:a(q,K).a,events:["button_a"],requiresStart:!1,selector:N.selectors.controlsA,elements:[]},{bitMask:a(q,K).b,events:["button_b"],requiresStart:!1,selector:N.selectors.controlsB,elements:[]},{bitMask:a(q,K).menu,events:["button_menu"],requiresStart:!0,selector:N.selectors.controlsMenu,elements:[]},{bitMask:a(q,K).muteUnmute,events:["mute_unmute_toggle"],requiresStart:!0,selector:N.selectors.controlsMuteToggle,elements:[]},{bitMask:a(q,K).fullScreen,events:["full_screen"],requiresStart:!0,selector:N.selectors.controlsFullScreen,elements:[]}]);d(this,Be,new Map);a(this,Hi).forEach(({selector:e,elements:t})=>{t.push(...document.querySelectorAll(e))})}startListening(){document.addEventListener("touchstart",u(this,Ji,ss).bind(this)),document.addEventListener("touchmove",u(this,Ji,ss).bind(this)),document.addEventListener("touchcancel",u(this,Ji,ss).bind(this)),document.addEventListener("touchend",u(this,Ji,ss).bind(this))}update(e){let t=!1;for(const[n,s]of a(this,Be).entries()){for(const{bitMask:r,events:o}of a(this,Hi))if((s&r)===r)for(const h of o)e.add(h);s&a(q,K).fullScreen&&a(this,Be).set(n,s&~a(q,K).fullScreen)}return t}};K=new WeakMap,Hi=new WeakMap,Be=new WeakMap,Ji=new WeakSet,ss=function(e){e.preventDefault();for(const t of e.changedTouches)if(e.type==="touchmove"){let n=0;for(const{elements:s,bitMask:r,requiresStart:o}of a(this,Hi))!o&&u(this,fa,Pl).call(this,s,t,r)&&(n|=r);a(this,Be).set(t.identifier,n)}else if(e.type==="touchstart"){let n=0;for(const{elements:s,bitMask:r,events:o}of a(this,Hi))u(this,fa,Pl).call(this,s,t,r)&&(n|=r);a(this,Be).set(t.identifier,n)}else(e.type==="touchend"||e.type==="touchcancel")&&a(this,Be).delete(t.identifier)},fa=new WeakSet,Pl=function(e,t,n){for(const s of e){const r=s.getBoundingClientRect();if(t.clientX>=r.left-(n&a(q,K).left?r.width:0)&&t.clientX<=r.right+(n&a(q,K).right?r.width:0)&&t.clientY>=r.top-(n&a(q,K).up?r.height:0)&&t.clientY<=r.bottom+(n&a(q,K).down?r.height:0))return!0}return!1},d(q,K,{up:256,down:128,left:64,right:32,a:16,b:8,menu:4,muteUnmute:2,fullScreen:1});let Dl=q;var ca,Fn;class _p{constructor(e){b(this,"gameInputsSpecialized");b(this,"gameInputGamepad");b(this,"gameButtons");b(this,"buttonFullScreen");b(this,"buttonMuteUnmute");b(this,"buttonDebugToggle");b(this,"buttonFrameByFrameToggle");b(this,"buttonFrameByFrameStep");d(this,ca,new Set);d(this,Fn,new Set);this.gameInputGamepad=new gp({browserType:e.browserType}),this.gameInputsSpecialized=[new Fl,new mp({enableDebugToggle:e.enableDebugToggle,enableFrameByFrameControls:e.enableFrameByFrameControls}),new Dl,this.gameInputGamepad],this.gameButtons=new pp,this.buttonFullScreen=new Dt,this.buttonMuteUnmute=new Dt,this.buttonDebugToggle=new Dt,this.buttonFrameByFrameToggle=new Dt,this.buttonFrameByFrameStep=new Dt}startListening(){for(const e of this.gameInputsSpecialized)e.startListening()}update(e){a(this,Fn).clear();const t=new Set;for(const n of this.gameInputsSpecialized)n.update(t)&&a(this,Fn).add(n.inputMethod);return g(this,ca,t),e.skipGameButtons||this.gameButtons.update(t),this.buttonFullScreen.update(t.has("full_screen")),this.buttonMuteUnmute.update(t.has("mute_unmute_toggle")),this.buttonDebugToggle.update(t.has("debug_toggle")),this.buttonFrameByFrameToggle.update(t.has("frame_by_frame_toggle")),this.buttonFrameByFrameStep.update(t.has("frame_by_frame_step")),N.updatePressedClasses({up:this.gameButtons.isPressed("up"),down:this.gameButtons.isPressed("down"),left:this.gameButtons.isPressed("left"),right:this.gameButtons.isPressed("right"),a:this.gameButtons.isPressed("a"),b:this.gameButtons.isPressed("b"),menu:this.gameButtons.isPressed("menu"),mute:this.buttonMuteUnmute.isPressed,fullscreen:this.buttonFullScreen.isPressed}),t.size>0}getRecentInputMethods(){return a(this,Fn)}getConnectedGamepadTypes(){return this.gameInputGamepad.connectedGamepadTypes()}getEventsCapturedInLastUpdate(){return a(this,ca)}}ca=new WeakMap,Fn=new WeakMap;var Wi,da,qi,Dn,Ki,Ge,Pn,pa,Un;const mr=class mr{constructor(e){d(this,Wi,void 0);d(this,da,void 0);d(this,qi,{updateFn:()=>{},renderFn:()=>{}});d(this,Dn,void 0);d(this,Ki,void 0);d(this,Ge,0);d(this,Pn,0);d(this,pa,5);d(this,Un,e=>{if(a(this,da).visibilityState==="hidden"){g(this,Ki,e),a(this,Wi).call(this,a(this,Un));return}const t=e-(a(this,Ki)??e);for(g(this,Ge,a(this,Ge)+t),g(this,Ki,e),g(this,Pn,0);a(this,Ge)>=a(this,Dn);)g(this,Pn,a(this,Pn)+1),a(this,Pn)<=a(this,pa)?(a(this,qi).updateFn(),g(this,Ge,a(this,Ge)-a(this,Dn))):(g(this,Ge,0),z.warnBeetPx(`Reached the safety limit of ${a(this,pa)} update calls`));const n=Math.floor(Math.min(1e3/t,mr.renderFpsResultCap));a(this,qi).renderFn(n),a(this,Wi).call(this,a(this,Un))});g(this,Wi,e.rafFn),g(this,da,e.documentVisibilityStateProvider),g(this,Dn,1e3/e.fixedTimestepFps)}start(e){a(this,qi).updateFn=e.updateFn,a(this,qi).renderFn=e.renderFn,g(this,Ki,void 0),g(this,Ge,0),a(this,Wi).call(this,a(this,Un))}};Wi=new WeakMap,da=new WeakMap,qi=new WeakMap,Dn=new WeakMap,Ki=new WeakMap,Ge=new WeakMap,Pn=new WeakMap,pa=new WeakMap,Un=new WeakMap,b(mr,"renderFpsResultCap",999);let Ul=mr;var ga;const fs=class fs{isFullScreenSupported(){return a(fs,ga)}static create(){return a(fs,ga)?new wp:new bp}};ga=new WeakMap,d(fs,ga,!!(!(typeof document>"u")&&(document.fullscreenEnabled||document.webkitFullscreenEnabled)));let As=fs;class bp extends As{constructor(){super(),document.querySelectorAll(N.selectors.controlsFullScreen).forEach(e=>{e.style.display="none"})}isInFullScreen(){return!1}toggleFullScreen(){}}var Yi,ma,_a,_r,ku,br,Cu;class wp extends As{constructor(){super();d(this,_r);d(this,br);d(this,Yi,void 0);d(this,ma,void 0);d(this,_a,void 0);const t=document.querySelector(N.selectors.fullScreenSubject);if(!t)throw Error(`Was unable to find a full screen subject by selector '${N.selectors.fullScreenSubject}'`);g(this,Yi,t);const n=a(this,Yi).requestFullscreen??a(this,Yi).webkitRequestFullscreen??(()=>{});g(this,ma,n.bind(a(this,Yi)));const s=document.exitFullscreen??document.webkitExitFullscreen??(()=>{});g(this,_a,s.bind(document))}isInFullScreen(){return!!(document.fullscreenElement||document.webkitFullscreenElement)}toggleFullScreen(){this.isInFullScreen()?u(this,br,Cu).call(this):u(this,_r,ku).call(this)}}Yi=new WeakMap,ma=new WeakMap,_a=new WeakMap,_r=new WeakSet,ku=function(){const t=a(this,ma).call(this);typeof t=="object"&&t.catch(n=>{z.errorBeetPx(n)})},br=new WeakSet,Cu=function(){const t=a(this,_a).call(this);typeof t=="object"&&t.catch(n=>{z.errorBeetPx(n)})};function Ru(i){return new Promise(e=>{setTimeout(()=>e(),i)})}var wr,In,ba;class yp{constructor(e){d(this,wr,Ru(750));d(this,In,void 0);d(this,ba,void 0);g(this,In,document.querySelector(N.selectors.startButton)??Vi(`Unable to find a start button under a selector "${N.selectors.startButton}"`)),g(this,ba,new Promise(t=>{a(this,In).addEventListener("click",()=>{e.onStartClicked(),t()})}))}async showStartScreen(){await a(this,wr),N.addLoadedClass(),a(this,In).focus(),await a(this,ba),N.addStartedClass()}}wr=new WeakMap,In=new WeakMap,ba=new WeakMap;var Ze,zn,ye;const ci=class ci{static enable(){g(this,Ze,!0)}static get isActive(){return a(this,Ze)?a(this,ye):!1}static get wasJustActivated(){return a(this,Ze)?a(this,ye)&&!a(this,zn):!1}static get wasJustDeactivated(){return a(this,Ze)?!a(this,ye)&&a(this,zn):!1}static update(){if(a(this,Ze)){if(ci.wasJustActivated){for(const e of At.playbacksToPauseOnGamePause)e.pauseByEngine();for(const e of At.playbacksToMuteOnGamePause)e.muteByEngine()}else if(ci.wasJustDeactivated){for(const e of At.playbacksToPauseOnGamePause)e.resumeByEngine();for(const e of At.playbacksToMuteOnGamePause)e.unmuteByEngine()}g(this,zn,a(this,ye))}}static activate(){g(this,ye,!0)}static deactivate(){g(this,ye,!1)}};Ze=new WeakMap,zn=new WeakMap,ye=new WeakMap,d(ci,Ze,!1),d(ci,zn,!1),d(ci,ye,!1);let vt=ci;var Nn;const hn=class hn{savePersistedState(e){window.localStorage.setItem(a(hn,Nn),JSON.stringify(e,null,2))}loadPersistedState(){const e=window.localStorage.getItem(a(hn,Nn));return e?JSON.parse(e):null}clearPersistedState(){window.localStorage.removeItem(a(hn,Nn))}};Nn=new WeakMap,d(hn,Nn,"game_stored_state");let Il=hn;var He,Ln,yr,wa,ya,va,$n,xa,Aa,Bn,Ea,Sa,ne,ve,ka,Ca,Gn,vr,Tu;class vp{constructor(e={}){d(this,vr);d(this,He,void 0);d(this,Ln,void 0);b(this,"canvasSize");d(this,yr,j.fromCssHex("#000000"));d(this,wa,void 0);b(this,"gameInput");d(this,ya,void 0);b(this,"audioApi");b(this,"fullScreen");b(this,"storageApi");d(this,va,void 0);b(this,"assets");d(this,$n,void 0);b(this,"drawApi");d(this,xa,void 0);d(this,Aa,!1);b(this,"isInsideDrawOrStartedCallback",!1);d(this,Bn,void 0);d(this,Ea,void 0);d(this,Sa,void 0);d(this,ne,0);d(this,ve,0);d(this,ka,1);d(this,Ca,!1);d(this,Gn,!1);var r,o,h,c,l,f,_,m;e.canvasSize??(e.canvasSize="128x128"),e.fixedTimestep??(e.fixedTimestep="60fps"),window.addEventListener("error",p=>{var y;return N.showError(p.message),(y=this.audioApi)==null||y.getAudioContext().suspend().then(()=>{}),!0}),window.addEventListener("unhandledrejection",p=>{var y;N.showError(p.reason),(y=this.audioApi)==null||y.getAudioContext().suspend().then(()=>{})}),(r=e.globalPause)!=null&&r.available&&vt.enable(),qt.loadFromStorage(),(o=e.debugMode)!=null&&o.available?e.debugMode.forceEnabledOnStart&&(qt.enabled=!0):qt.enabled=!1,(h=e.frameByFrame)!=null&&h.available&&((c=e.frameByFrame)!=null&&c.activateOnStart)&&(ei.active=!0),z.debugBeetPx("Engine init params:",e),g(this,He,e.assets??[]),a(this,He).push(...to.spriteSheetUrls),a(this,He).push(...tp.spriteSheetUrls),a(this,He).push(...ep.spriteSheetUrls);const t=e.fixedTimestep==="60fps"?60:e.fixedTimestep==="30fps"?30:Vi(`Unsupported fixedTimestep: "${e.fixedTimestep}"`);g(this,Ln,Y0.detect(navigator.userAgent)),this.canvasSize=e.canvasSize==="64x64"?et(64,64):e.canvasSize==="128x128"?et(128,128):e.canvasSize==="256x256"?et(256,256):Vi(`Unsupported canvasSize: "${e.canvasSize}"`),this.gameInput=new _p({enableDebugToggle:((l=e.debugMode)==null?void 0:l.available)??!1,enableFrameByFrameControls:((f=e.frameByFrame)==null?void 0:f.available)??!1,browserType:a(this,Ln)}),g(this,ya,new Ul({fixedTimestepFps:t,rafFn:window.requestAnimationFrame.bind(window),documentVisibilityStateProvider:document})),this.storageApi=new Il;const n=new AudioContext;this.assets=new Dd,g(this,va,new Fd(this.assets,{decodeAudioData:p=>n.decodeAudioData(p)})),this.audioApi=new _i(this.assets,n),g(this,wa,new yp({onStartClicked:()=>{this.audioApi.tryToResumeAudioContextSuspendedByBrowserForSecurityReasons().then(p=>{p&&g(this,Gn,!0)})}})),this.fullScreen=As.create();const s=document.querySelector(N.selectors.canvas)??Vi(`Was unable to find <canvas> by selector '${N.selectors.canvas}'`);g(this,$n,new Q0(this.canvasSize,s,a(this,yr))),this.drawApi=new dp({canvas:a(this,$n),assets:this.assets}),(m=(_=e.debugMode)==null?void 0:_.fpsDisplay)!=null&&m.enabled&&g(this,xa,new ap(this.drawApi,this.canvasSize,{color:e.debugMode.fpsDisplay.color,placement:e.debugMode.fpsDisplay.placement}))}get frameNumber(){return a(this,ne)}get frameNumberOutsidePause(){return a(this,ve)}get renderingFps(){return a(this,ka)}get detectedBrowserType(){return a(this,Ln)}async init(){return await a(this,va).loadAssets(a(this,He)),{startGame:u(this,vr,Tu).bind(this)}}setOnStarted(e){g(this,Bn,e)}setOnUpdate(e){g(this,Ea,e)}setOnDraw(e){g(this,Sa,e)}restart(){var e;g(this,ne,0),g(this,ve,0),this.audioApi.restart(),this.drawApi.clearCanvas(ip),At.playbacksToPauseOnGamePause.clear(),At.playbacksToMuteOnGamePause.clear(),vt.deactivate(),this.isInsideDrawOrStartedCallback=!0,(e=a(this,Bn))==null||e.call(this),this.isInsideDrawOrStartedCallback=!1}}He=new WeakMap,Ln=new WeakMap,yr=new WeakMap,wa=new WeakMap,ya=new WeakMap,va=new WeakMap,$n=new WeakMap,xa=new WeakMap,Aa=new WeakMap,Bn=new WeakMap,Ea=new WeakMap,Sa=new WeakMap,ne=new WeakMap,ve=new WeakMap,ka=new WeakMap,Ca=new WeakMap,Gn=new WeakMap,vr=new WeakSet,Tu=async function(){var e;if(a(this,Aa))throw Error("Tried to start a game, but it is already started");g(this,Aa,!0),window.BEETPX__IS_PROD&&window.addEventListener("beforeunload",t=>(t.preventDefault(),t.returnValue="","")),g(this,ne,0),g(this,ve,0),await a(this,wa).showStartScreen(),this.isInsideDrawOrStartedCallback=!0,(e=a(this,Bn))==null||e.call(this),this.isInsideDrawOrStartedCallback=!1,this.gameInput.startListening(),a(this,ya).start({updateFn:()=>{var s;this.gameInput.buttonFullScreen.wasJustPressed&&this.fullScreen.toggleFullScreen(),this.gameInput.buttonMuteUnmute.wasJustPressed&&(this.audioApi.isAudioMuted()?this.audioApi.unmuteAudio():this.audioApi.muteAudio()),this.gameInput.gameButtons.wasJustPressed("menu")&&(vt.isActive?vt.deactivate():vt.activate()),vt.update(),this.gameInput.buttonDebugToggle.wasJustPressed&&(qt.enabled=!qt.enabled),this.gameInput.buttonFrameByFrameToggle.wasJustPressed&&(ei.active=!ei.active);const t=!ei.active||this.gameInput.buttonFrameByFrameStep.wasJustPressed;this.gameInput.update({skipGameButtons:!t})&&!a(this,Gn)&&this.audioApi.tryToResumeAudioContextSuspendedByBrowserForSecurityReasons().then(r=>{r&&g(this,Gn,!0)}),t&&(ei.active&&z.infoBeetPx(`Running onUpdate for frame: ${a(this,ne)}`),(s=a(this,Ea))==null||s.call(this),g(this,Ca,!0),g(this,ne,a(this,ne)>=Number.MAX_SAFE_INTEGER?0:a(this,ne)+1),vt.isActive||g(this,ve,a(this,ve)>=Number.MAX_SAFE_INTEGER?0:a(this,ve)+1))},renderFn:t=>{var n,s;g(this,ka,t),this.isInsideDrawOrStartedCallback=!0,a(this,Ca)&&((n=a(this,Sa))==null||n.call(this),qt.enabled&&((s=a(this,xa))==null||s.drawRenderingFps(t))),this.isInsideDrawOrStartedCallback=!1,a(this,$n).render()}})};function xp(i,e){return i>0?((e==null?void 0:e.onGamePause)==="ignore"?kt.frameNumber:kt.frameNumberOutsidePause)%(i*2)<i:!0}function Mu(){return[D.of(-1,-1),D.of(0,-1),D.of(1,-1),D.of(1,0),D.of(1,1),D.of(0,1),D.of(-1,1),D.of(-1,0)]}function Ap(i,e,t,n,s){for(const r of Mu())kt.draw.text(i,e.add(r),n,{centerXy:s==null?void 0:s.centerXy,scaleXy:s==null?void 0:s.scaleXy});kt.draw.text(i,e,t,{centerXy:s==null?void 0:s.centerXy,scaleXy:s==null?void 0:s.scaleXy})}function Ep(){return[D.of(-1,-1),D.of(1,-1),D.of(1,1),D.of(-1,1)]}function Sp(i){if(!(i.length<=0))return i[Math.floor(Math.random()*i.length)]}function kp(i,e){i=i>0?Math.round(i):0;const t=new Array(i*e.length);for(let n=0;n<t.length;n++)t[n]=e[Math.floor(n/i)];return t}var Je,R,T;const w=class w{static async init(e){z.infoBeetPx(`BeetPx ${window.BEETPX__VERSION} : Initializing…`),g(this,Je,new vp(e));const{startGame:t}=await a(this,Je).init();return z.infoBeetPx(`BeetPx ${window.BEETPX__VERSION} : Initialized`),{startGame:t}}static get debug(){return qt.enabled}static get canvasSize(){return u(this,R,T).call(this).canvasSize}static get frameNumber(){return u(this,R,T).call(this).frameNumber}static get frameNumberOutsidePause(){return u(this,R,T).call(this).frameNumberOutsidePause}static get renderingFps(){return u(this,R,T).call(this).renderingFps}static get detectedBrowserType(){return u(this,R,T).call(this).detectedBrowserType}static get isPaused(){return vt.isActive}static get wasJustPaused(){return vt.wasJustActivated}static get wasJustResumed(){return vt.wasJustDeactivated}static pause(){vt.activate()}static resume(){vt.deactivate()}};Je=new WeakMap,R=new WeakSet,T=function(e){if(!a(this,Je))throw Error("Tried to access BeetPx API without calling BeetPx.init(…) first.");return e&&!a(this,Je).isInsideDrawOrStartedCallback&&z.warnBeetPx(`Used "${e}" outside of either "setOnDraw" or "setOnStarted" callback.`),a(this,Je)},d(w,R),d(w,Je,void 0),b(w,"setOnStarted",(...e)=>{var t;return u(t=w,R,T).call(t).setOnStarted(...e)}),b(w,"setOnUpdate",(...e)=>{var t;return u(t=w,R,T).call(t).setOnUpdate(...e)}),b(w,"setOnDraw",(...e)=>{var t;return u(t=w,R,T).call(t).setOnDraw(...e)}),b(w,"restart",(...e)=>{var t;return u(t=w,R,T).call(t).restart(...e)}),b(w,"logDebug",(...e)=>z.debug(...e)),b(w,"logInfo",(...e)=>z.info(...e)),b(w,"logWarn",(...e)=>z.warn(...e)),b(w,"logError",(...e)=>z.error(...e)),b(w,"wasAnyButtonJustPressed",(...e)=>{var t;return u(t=w,R,T).call(t).gameInput.gameButtons.wasAnyJustPressed(...e)}),b(w,"wasButtonJustPressed",(...e)=>{var t;return u(t=w,R,T).call(t).gameInput.gameButtons.wasJustPressed(...e)}),b(w,"wasButtonJustReleased",(...e)=>{var t;return u(t=w,R,T).call(t).gameInput.gameButtons.wasJustReleased(...e)}),b(w,"isAnyButtonPressed",(...e)=>{var t;return u(t=w,R,T).call(t).gameInput.gameButtons.isAnyPressed(...e)}),b(w,"isButtonPressed",(...e)=>{var t;return u(t=w,R,T).call(t).gameInput.gameButtons.isPressed(...e)}),b(w,"getPressedDirection",(...e)=>{var t;return u(t=w,R,T).call(t).gameInput.gameButtons.getPressedDirection(...e)}),b(w,"setButtonRepeating",(...e)=>{var t;return u(t=w,R,T).call(t).gameInput.gameButtons.setButtonRepeating(...e)}),b(w,"getRecentInputMethods",(...e)=>{var t;return u(t=w,R,T).call(t).gameInput.getRecentInputMethods(...e)}),b(w,"getConnectedGamepadTypes",(...e)=>{var t;return u(t=w,R,T).call(t).gameInput.getConnectedGamepadTypes(...e)}),b(w,"getEventsCapturedInLastUpdate",(...e)=>{var t;return u(t=w,R,T).call(t).gameInput.getEventsCapturedInLastUpdate(...e)}),b(w,"isAudioMuted",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.isAudioMuted(...e)}),b(w,"muteAudio",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.muteAudio(...e)}),b(w,"unmuteAudio",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.unmuteAudio(...e)}),b(w,"startPlayback",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.startPlayback(...e)}),b(w,"startPlaybackLooped",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.startPlaybackLooped(...e)}),b(w,"startPlaybackSequence",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.startPlaybackSequence(...e)}),b(w,"mutePlayback",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.mutePlayback(...e)}),b(w,"unmutePlayback",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.unmutePlayback(...e)}),b(w,"stopPlayback",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.stopPlayback(...e)}),b(w,"pausePlayback",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.pausePlayback(...e)}),b(w,"resumePlayback",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.resumePlayback(...e)}),b(w,"getAudioContext",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.getAudioContext(...e)}),b(w,"isFullScreenSupported",(...e)=>{var t;return u(t=w,R,T).call(t).fullScreen.isFullScreenSupported(...e)}),b(w,"isInFullScreen",(...e)=>{var t;return u(t=w,R,T).call(t).fullScreen.isInFullScreen(...e)}),b(w,"toggleFullScreen",(...e)=>{var t;return u(t=w,R,T).call(t).fullScreen.toggleFullScreen(...e)}),b(w,"savePersistedState",(...e)=>{var t;return u(t=w,R,T).call(t).storageApi.savePersistedState(...e)}),b(w,"loadPersistedState",(...e)=>{var t;return u(t=w,R,T).call(t).storageApi.loadPersistedState(...e)}),b(w,"clearPersistedState",(...e)=>{var t;return u(t=w,R,T).call(t).storageApi.clearPersistedState(...e)}),b(w,"getImageAsset",(...e)=>{var t;return u(t=w,R,T).call(t).assets.getImageAsset(...e)}),b(w,"getSoundAsset",(...e)=>{var t;return u(t=w,R,T).call(t).assets.getSoundAsset(...e)}),b(w,"getJsonAsset",(...e)=>{var t;return u(t=w,R,T).call(t).assets.getJsonAsset(...e)}),b(w,"draw",{clearCanvas(e){var t;u(t=w,R,T).call(t,"clearCanvas").drawApi.clearCanvas(e)},setClippingRegion(e,t){var n;return u(n=w,R,T).call(n,"setClippingRegion").drawApi.setClippingRegion(e,t)},removeClippingRegion(){var e;return u(e=w,R,T).call(e,"removeClippingRegion").drawApi.removeClippingRegion()},setCameraXy(e){var t;return u(t=w,R,T).call(t,"setCameraXy").drawApi.setCameraXy(e)},setDrawingPattern(e){var t;return u(t=w,R,T).call(t,"setDrawingPattern").drawApi.setDrawingPattern(e)},pixel(e,t){var n;u(n=w,R,T).call(n,"pixel").drawApi.drawPixel(e,t)},pixels(e,t,n,s){var r;u(r=w,R,T).call(r,"pixels").drawApi.drawPixels(e,t,n,s)},line(e,t,n){var s;u(s=w,R,T).call(s,"line").drawApi.drawLine(e,t,n)},rect(e,t,n){var s;u(s=w,R,T).call(s,"rect").drawApi.drawRect(e,t,n)},rectFilled(e,t,n){var s;u(s=w,R,T).call(s,"rectFilled").drawApi.drawRectFilled(e,t,n)},rectOutsideFilled(e,t,n){var s;u(s=w,R,T).call(s,"rectOutsideFilled").drawApi.drawRectOutsideFilled(e,t,n)},ellipse(e,t,n){var s;u(s=w,R,T).call(s,"ellipse").drawApi.drawEllipse(e,t,n)},ellipseFilled(e,t,n){var s;u(s=w,R,T).call(s,"ellipseFilled").drawApi.drawEllipseFilled(e,t,n)},ellipseOutsideFilled(e,t,n){var s;u(s=w,R,T).call(s,"ellipseOutsideFilled").drawApi.drawEllipseOutsideFilled(e,t,n)},setSpriteColorMapping(e){var t;return u(t=w,R,T).call(t,"setSpriteColorMapping").drawApi.setSpriteColorMapping(e)},sprite(e,t,n){var s;u(s=w,R,T).call(s,"sprite").drawApi.drawSprite(e,t,n)},useFont(e){var t;return u(t=w,R,T).call(t,"useFont").drawApi.useFont(e)},setTextColorMarkers(e){var t;return u(t=w,R,T).call(t,"setTextColorMarkers").drawApi.setTextColorMarkers(e)},measureText(e,t){var n;return u(n=w,R,T).call(n,"measureText").drawApi.measureText(e,t)},text(e,t,n,s){var r;u(r=w,R,T).call(r,"text").drawApi.drawText(e,t,n,s)},takeCanvasSnapshot(){var e;u(e=w,R,T).call(e,"takeCanvasSnapshot").drawApi.takeCanvasSnapshot()}}),b(w,"utils",{assertUnreachable:Nl,booleanChangingEveryNthFrame:xp,clamp:Hn,drawTextWithOutline:Ap,identity:Ll,isDefined:Eu,lerp:Vr,mod:di,noop:dl,offset4Directions:Ep,offset8Directions:Mu,randomElementOf:Sp,range:ja,repeatEachElement:kp,throwError:Vi,trigAtan2:ch,trigCos:dh,trigSin:ph,wait:Ru});let kt=w;const rn=kt,Xn=kt.draw,Es=kt.utils;var Ft,Xi,Ra,xe,ji,Ae,We,ln,se,Se;const no=class no{constructor(e){d(this,We);d(this,se);d(this,Ft,void 0);d(this,Xi,void 0);d(this,Ra,void 0);d(this,xe,void 0);d(this,ji,void 0);d(this,Ae,void 0);g(this,Ra,e.onGamePause==="ignore"),g(this,Ft,Math.max(0,Math.round(e.frames))),g(this,Xi,e.loop),g(this,ji,a(this,We,ln)+e.delayFrames),g(this,xe,!1),g(this,Ae,null),e.pause&&this.pause()}static for(e){return new no(e)}get t(){return a(this,Xi)?a(this,se,Se)>=0?di(a(this,se,Se),a(this,Ft)):0:Hn(0,a(this,se,Se),a(this,Ft))}get framesLeft(){return a(this,Ft)-this.t}get progress(){return a(this,Ft)>0?this.t/a(this,Ft):1}get hasFinished(){return a(this,se,Se)>=a(this,Ft)}get hasJustFinished(){return a(this,Ft)>0?a(this,Xi)?a(this,se,Se)>0&&this.t===0:a(this,se,Se)===a(this,Ft):a(this,Xi)?!0:a(this,se,Se)===0}pause(){a(this,xe)||(g(this,xe,!0),g(this,Ae,a(this,We,ln)))}resume(){a(this,xe)&&(g(this,xe,!1),g(this,ji,a(this,ji)+(a(this,We,ln)-(a(this,Ae)??0))),g(this,Ae,null))}restart(){g(this,ji,a(this,We,ln)),g(this,Ae,null),g(this,xe,!1)}};Ft=new WeakMap,Xi=new WeakMap,Ra=new WeakMap,xe=new WeakMap,ji=new WeakMap,Ae=new WeakMap,We=new WeakSet,ln=function(){return a(this,Ra)?kt.frameNumber:kt.frameNumberOutsidePause},se=new WeakSet,Se=function(){return(a(this,Ae)??a(this,We,ln))-a(this,ji)};let fn=no;var Zn,qe;const so=class so{constructor(e,t){b(this,"type","animated");b(this,"imageUrl");b(this,"size");d(this,Zn,void 0);d(this,qe,void 0);this.imageUrl=e.imageUrl,this.size=D.of(e.w,e.h).abs().round(),g(this,Zn,e.xys.map(([n,s])=>Jn.from(e.imageUrl,e.w,e.h,n,s))),g(this,qe,fn.for({frames:a(this,Zn).length,loop:!0,pause:t.pause??!1,delayFrames:0,onGamePause:t.onGamePause}))}static from(e,t,n,s,r){return new so({imageUrl:e,w:t,h:n,xys:s},{pause:(r==null?void 0:r.pause)??!1,onGamePause:(r==null?void 0:r.onGamePause)??"pause"})}get current(){return a(this,Zn)[a(this,qe).t]}pause(){a(this,qe).pause()}resume(){a(this,qe).resume()}restart(){a(this,qe).restart()}};Zn=new WeakMap,qe=new WeakMap;let zl=so;var Qi,xr;class fh{constructor(){d(this,Qi,xs);d(this,xr,V0("fire.png")(16,32,Es.repeatEachElement(5,Es.range(8).map(e=>[e*16,0]))))}setPosition(e){g(this,Qi,e)}get position(){return a(this,Qi)}draw(){Xn.sprite(a(this,xr).current,a(this,Qi).sub(8,24)),rn.debug&&Xn.pixel(a(this,Qi),yu.ember)}}Qi=new WeakMap,xr=new WeakMap;const Ja=16;var Ar,Er;class Cp{constructor(){d(this,Ar,uh("tiles.png")(8,8,0,0));d(this,Er,uh("tiles.png")(8,8,8,0))}draw(){Es.range(Ja).forEach(e=>{Es.range(Ja).forEach(t=>{Xn.sprite(e===0||e===Ja-1||t===0||t===Ja-1?a(this,Er):a(this,Ar),et(t,e).mul(8))})})}isReachableByLight(e,t){return e>=7&&e<=120&&t>=6&&t<=120}}Ar=new WeakMap,Er=new WeakMap;rn.init({canvasSize:"128x128",fixedTimestep:"60fps",assets:["tiles.png","fire.png"],debugMode:{available:!0}}).then(async({startGame:i})=>{const e=new Cp,t=new fh,n=new fh;t.setPosition(et(32)),n.setPosition(et(64));let s=0;const r=c=>c?Kt((50+c.r)*1.25,(30+c.g)*1.2,(10+c.b)*1.05):null,o=(c,l,f)=>e.isReachableByLight(l,f)?c:null;rn.setOnUpdate(()=>{t.setPosition(t.position.add(rn.getPressedDirection()).clamp(et(12),et(116))),s=30+Es.trigCos(rn.frameNumber/40)}),rn.setOnDraw(()=>{e.draw(),Xn.takeCanvasSnapshot(),h(t),h(n),t.draw(),n.draw()});function h(c){Xn.ellipseFilled(c.position.sub(s),et(s*2),jr.of((l,f,_)=>r(o(l,f,_))))}await i()});
