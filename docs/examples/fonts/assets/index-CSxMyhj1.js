var Au=Object.defineProperty;var Su=(i,e,t)=>e in i?Au(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var b=(i,e,t)=>(Su(i,typeof e!="symbol"?e+"":e,t),t),Cr=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var r=(i,e,t)=>(Cr(i,e,"read from private field"),t?t.call(i):e.get(i)),d=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},m=(i,e,t,n)=>(Cr(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t);var u=(i,e,t)=>(Cr(i,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();class Q{constructor(e,t,n){b(this,"type","rgb");b(this,"r");b(this,"g");b(this,"b");b(this,"cssHex");this.r=Math.min(Math.max(0,Math.round(e)),255),this.g=Math.min(Math.max(0,Math.round(t)),255),this.b=Math.min(Math.max(0,Math.round(n)),255),this.cssHex="#"+e.toString(16).padStart(2,"0")+t.toString(16).padStart(2,"0")+n.toString(16).padStart(2,"0")}static of(e,t,n){return new Q(e,t,n)}static fromCssHex(e){if(!/^#[0-9a-fA-F]{6}$/.test(e))throw Error("Hexadecimal representation of the color doesn't contain exactly 6 hexadecimal digits, preceded by a single '#'");return new Q(parseInt(e.slice(1,3),16),parseInt(e.slice(3,5),16),parseInt(e.slice(5,7),16))}isSameAs(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}asArray(){return[this.r,this.g,this.b]}}class it{}b(it,"black",Q.fromCssHex("#000000")),b(it,"storm",Q.fromCssHex("#1D2B53")),b(it,"wine",Q.fromCssHex("#7E2553")),b(it,"moss",Q.fromCssHex("#008751")),b(it,"tan",Q.fromCssHex("#AB5236")),b(it,"slate",Q.fromCssHex("#5F574F")),b(it,"silver",Q.fromCssHex("#C2C3C7")),b(it,"white",Q.fromCssHex("#FFF1E8")),b(it,"ember",Q.fromCssHex("#FF004D")),b(it,"orange",Q.fromCssHex("#FFA300")),b(it,"lemon",Q.fromCssHex("#FFEC27")),b(it,"lime",Q.fromCssHex("#00E436")),b(it,"sky",Q.fromCssHex("#29ADFF")),b(it,"dusk",Q.fromCssHex("#83769C")),b(it,"pink",Q.fromCssHex("#FF77A8")),b(it,"peach",Q.fromCssHex("#FFCCAA"));var Es;const hn=class hn{constructor(e){b(this,"type","sprite_mapping");d(this,Es,void 0);m(this,Es,e)}static from(e){const t=new Map(e.map(([n,s])=>[n.cssHex,s]));return new hn((n,s,a)=>{if(!n)return n;const l=t.get(n.cssHex);return typeof l>"u"?n:l})}static of(e){return new hn(e)}getMappedColor(e,t,n){return r(this,Es).call(this,e,t,n)}};Es=new WeakMap,b(hn,"noMapping",new hn((e,t,n)=>e));let Ka=hn;var ks;const Fe=class Fe{constructor(e){d(this,ks,void 0);if(e<0||e>65535)throw Error("BpxPatter: bits representation of the pattern is out of range of valid values. The value should be in range of 0b0000_0000_0000_0000 to 0b1111_1111_1111_1111.");m(this,ks,e)}static from(e){e=e.replace(/\s/g,"");const t=e.search(/[^#-]/);if(t>=0)throw Error(`BpxPattern.from: Unexpected character found: "${e[t]}"`);if(e.length!==16)throw Error(`BpxPattern.from: Unexpected amount of # and - symbols. There should be 16 of them (4 rows x 4 columns), but instead there is: ${e.length}`);let n=0;for(let s=0;s<16;++s)e[s]==="#"&&(n|=1<<15-s);return new Fe(n)}static of(e){return new Fe(e)}hasPrimaryColorAt(e,t){const n=e%4,s=t%4,a=4*4-(s*4+n)-1;return!!(r(this,ks)&1<<a)}};ks=new WeakMap,b(Fe,"primaryOnly",Fe.of(65535)),b(Fe,"secondaryOnly",Fe.of(0));let Yr=Fe;function Zn(i,e,t){return i<e?e<t?e:i<t?t:i:e>t?e:i>t?t:i}function Kr(i,e,t,n){const s=i+(e-i)*t;return n!=null&&n.clamp?Zn(i,s,e):s}function gi(i,e){return e===0?0:(i%e+e)%e}function ih(i,e){return(Math.atan2(e,i)/Math.PI/2+1)%1}function nh(i){return Math.cos(i*Math.PI*2)}function sh(i){return Math.sin(i*Math.PI*2)}class D{constructor(e,t){this.x=e,this.y=t}static unitFromAngle(e){return new D(nh(e),sh(e))}static of(e,t){return new D(e,t??e)}static min(e,t){return new D(Math.min(e.x,t.x),Math.min(e.y,t.y))}static max(e,t){return new D(Math.max(e.x,t.x),Math.max(e.y,t.y))}static minMax(e,t){return[D.min(e,t),D.max(e,t)]}static lerp(e,t,n,s){return new D(Kr(e.x,t.x,n,s),Kr(e.y,t.y,n,s))}asArray(){return[this.x,this.y]}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const e=this.magnitude();return new D(this.x/e,this.y/e)}sign(){return new D(Math.sign(this.x),Math.sign(this.y))}abs(){return new D(Math.abs(this.x),Math.abs(this.y))}floor(){return new D(Math.floor(this.x),Math.floor(this.y))}ceil(){return new D(Math.ceil(this.x),Math.ceil(this.y))}round(){return new D(Math.round(this.x),Math.round(this.y))}toAngle(){return ih(this.x,this.y)}eq(e){return typeof e!="number"?this.x===e.x&&this.y===e.y:this.x===e&&this.y===e}gt(e){return typeof e!="number"?this.x>e.x&&this.y>e.y:this.x>e&&this.y>e}gte(e){return typeof e!="number"?this.x>=e.x&&this.y>=e.y:this.x>=e&&this.y>=e}lt(e){return typeof e!="number"?this.x<e.x&&this.y<e.y:this.x<e&&this.y<e}lte(e){return typeof e!="number"?this.x<=e.x&&this.y<=e.y:this.x<=e&&this.y<=e}clamp(e,t){return new D(Zn(e.x,this.x,t.x),Zn(e.y,this.y,t.y))}mod(e,t){return typeof e!="number"?new D(gi(this.x,e.x),gi(this.y,e.y)):new D(gi(this.x,e),gi(this.y,t??e))}add(e,t){return typeof e!="number"?new D(this.x+e.x,this.y+e.y):new D(this.x+e,this.y+(t??e))}sub(e,t){return typeof e!="number"?new D(this.x-e.x,this.y-e.y):new D(this.x-e,this.y-(t??e))}mul(e,t){return typeof e!="number"?new D(this.x*e.x,this.y*e.y):new D(this.x*e,this.y*(t??e))}div(e,t){return typeof e!="number"?new D(this.x/e.x,this.y/e.y):new D(this.x/e,this.y/(t??e))}*[Symbol.iterator](){yield this.x,yield this.y}[Symbol.toPrimitive](e){switch(e){case"default":case"string":return`(${this.x},${this.y})`;case"number":return NaN}}get[Symbol.toStringTag](){return"BpxVector2d"}__printDebug(){return`(${this.x},${this.y})`}}class Xn{constructor(e){b(this,"asciiRows");b(this,"size");this.asciiRows=e.split(`
`).map(n=>n.replace(/\s/g,"")).filter(n=>n.length>0);let t=0;for(const n of this.asciiRows){const s=n.search(/[^#-]/);if(s>=0)throw Error(`DrawPixels.draw: Unexpected character found: "${n[s]}"`);t=Math.max(t,n.length)}this.size=D.of(t,this.asciiRows.length)}static from(e){return new Xn(e)}}function Ol(i){throw Error("Somehow reached the unreachable code ¯\\_(ツ)_/¯")}function Dl(i){return i}function Xa(i){return Array.from({length:i},(e,t)=>t)}var Cs,_t,Ts;const ai=class ai{constructor(e){d(this,_t,void 0);d(this,Ts,void 0);m(this,_t,e),m(this,Ts,[...new Set(Array.from(e.glyphs.values()).filter(t=>t.type==="sprite").map(t=>t.sprite.imageUrl))])}static of(e){return new ai({ascent:e.ascent??8,descent:e.descent??8,lineGap:e.lineGap??1,mapGrapheme:e.mapGrapheme??Dl,glyphs:e.glyphs??new Map})}static basedOn(e,t){const n=t(r(e,_t));return new ai(n)}get spriteSheetUrls(){return r(this,Ts)}get ascent(){return r(this,_t).ascent}get descent(){return r(this,_t).descent}get lineGap(){return r(this,_t).lineGap}arrangeGlyphsFor(e,t,n){var o;n??(n={});const s=[];let a=D.of(0,0),l=0,h=`
`;const f=r(ai,Cs).segment(e)[Symbol.iterator]();for(let c=f.next();!c.done;c=f.next()){const _=r(this,_t).mapGrapheme(c.value.segment),g=c.value.index;if(_===`
`){s.push({type:"line_break",lineNumber:l}),h=`
`,a=D.of(0,a.y+r(this,_t).ascent+r(this,_t).descent+r(this,_t).lineGap),l+=1;continue}if(_==="["){let F;for(const[C,P]of Object.entries(n)){const U=`[${C}]`;if(e.slice(g,g+U.length)===U){F=P;const x=[...r(ai,Cs).segment(U)].length-1;Xa(x).forEach(()=>{f.next()});break}}if(F){t=F;continue}}const p=r(this,_t).glyphs.get(_);if(!p)continue;const y=((o=p.kerning)==null?void 0:o[h])??0,I=t;if(p.type==="sprite"){s.push({type:"sprite",char:_,sprite:p.sprite,spriteColorMapping:Ka.of(F=>p.isTextColor(F)?I:null),lineNumber:l,leftTop:a.add(0,r(this,_t).ascent).sub(0,p.sprite.size.y).add(p.offset??D.of(0,0)).add(y,0)}),h=_,a=a.add(p.advance+y,0);continue}if(p.type==="pixels"){s.push({type:"pixels",char:_,pixels:p.pixels,color:I,lineNumber:l,leftTop:a.add(0,this.ascent).sub(0,p.pixels.size.y).add(p.offset??D.of(0,0)).add(y,0)}),h=_,a=a.add(p.advance+y,0);continue}if(p.type==="whitespace"){h=_,a=a.add(p.advance+y,0);continue}Ol()}return s}};Cs=new WeakMap,_t=new WeakMap,Ts=new WeakMap,d(ai,Cs,new Intl.Segmenter("en",{granularity:"grapheme",localeMatcher:"best fit"}));let as=ai;class ds{constructor(e,t,n,s,a){b(this,"type","static");b(this,"imageUrl");b(this,"size");b(this,"xy");t<0&&(t=-t,s-=t),n<0&&(n=-n,a-=n),this.imageUrl=e,this.xy=D.of(s,a).round(),this.size=D.of(s+t,a+n).round().sub(this.xy)}static from(e,t,n,s,a){return new ds(e,t,n,s,a)}clipBy(e,t){const n=this.xy.clamp(e,t),s=this.xy.add(this.size).clamp(e,t).sub(n);return new ds(this.imageUrl,s.x,s.y,n.x,n.y)}}var S,E;const nr=class nr{constructor(){d(this,S);b(this,"ascent",5);b(this,"descent",0);b(this,"lineGap",1);b(this,"glyphs",new Map([[" ",{type:"whitespace",advance:4}],["0",u(this,S,E).call(this,0,3)],["1",u(this,S,E).call(this,1,3)],["2",u(this,S,E).call(this,2,3)],["3",u(this,S,E).call(this,3,3)],["4",u(this,S,E).call(this,4,3)],["5",u(this,S,E).call(this,5,3)],["6",u(this,S,E).call(this,6,3)],["7",u(this,S,E).call(this,7,3)],["8",u(this,S,E).call(this,8,3)],["9",u(this,S,E).call(this,9,3)],["-",u(this,S,E).call(this,13,2)],["+",u(this,S,E).call(this,11,2)],["=",u(this,S,E).call(this,13,3)],["(",u(this,S,E).call(this,8,2)],[")",u(this,S,E).call(this,9,2)],["[",u(this,S,E).call(this,11,5)],["]",u(this,S,E).call(this,13,5)],["{",u(this,S,E).call(this,11,7)],["}",u(this,S,E).call(this,13,7)],["<",u(this,S,E).call(this,12,3)],[">",u(this,S,E).call(this,14,3)],["~",u(this,S,E).call(this,14,7)],["!",u(this,S,E).call(this,1,2)],["?",u(this,S,E).call(this,15,3)],["@",u(this,S,E).call(this,0,4)],["#",u(this,S,E).call(this,3,2)],["$",u(this,S,E).call(this,4,2)],["%",u(this,S,E).call(this,5,2)],["^",u(this,S,E).call(this,14,5)],["&",u(this,S,E).call(this,6,2)],["*",u(this,S,E).call(this,10,2)],["_",u(this,S,E).call(this,15,5)],[".",u(this,S,E).call(this,14,2)],[",",u(this,S,E).call(this,12,2)],[":",u(this,S,E).call(this,10,3)],[";",u(this,S,E).call(this,11,3)],["`",u(this,S,E).call(this,0,6)],["'",u(this,S,E).call(this,7,2)],['"',u(this,S,E).call(this,2,2)],["/",u(this,S,E).call(this,15,2)],["|",u(this,S,E).call(this,12,7)],["\\",u(this,S,E).call(this,12,5)],["a",u(this,S,E).call(this,1,6)],["b",u(this,S,E).call(this,2,6)],["c",u(this,S,E).call(this,3,6)],["d",u(this,S,E).call(this,4,6)],["e",u(this,S,E).call(this,5,6)],["f",u(this,S,E).call(this,6,6)],["g",u(this,S,E).call(this,7,6)],["h",u(this,S,E).call(this,8,6)],["i",u(this,S,E).call(this,9,6)],["j",u(this,S,E).call(this,10,6)],["k",u(this,S,E).call(this,11,6)],["l",u(this,S,E).call(this,12,6)],["m",u(this,S,E).call(this,13,6)],["n",u(this,S,E).call(this,14,6)],["o",u(this,S,E).call(this,15,6)],["p",u(this,S,E).call(this,0,7)],["q",u(this,S,E).call(this,1,7)],["r",u(this,S,E).call(this,2,7)],["s",u(this,S,E).call(this,3,7)],["t",u(this,S,E).call(this,4,7)],["u",u(this,S,E).call(this,5,7)],["v",u(this,S,E).call(this,6,7)],["w",u(this,S,E).call(this,7,7)],["x",u(this,S,E).call(this,8,7)],["y",u(this,S,E).call(this,9,7)],["z",u(this,S,E).call(this,10,7)],["⬅",u(this,S,E).call(this,11,8,7)],["➡",u(this,S,E).call(this,1,9,7)],["⬆",u(this,S,E).call(this,4,9,7)],["⬇",u(this,S,E).call(this,3,8,7)],["⭐",u(this,S,E).call(this,2,9,7)],["❤️",u(this,S,E).call(this,7,8,7)],["❎",u(this,S,E).call(this,7,9,7)],["⭕",u(this,S,E).call(this,14,8,7)],["♪",u(this,S,E).call(this,13,8,7)]]))}mapGrapheme(e){return e.toLowerCase()}};S=new WeakSet,E=function(e,t,n=3){const s=ds.from(nr.spriteSheetUrl,n,5,e*8,t*8);return{type:"sprite",sprite:s,isTextColor:a=>(a==null?void 0:a.cssHex)===it.white.cssHex,advance:s.size.x+1}},b(nr,"spriteSheetUrl",".beetpx/pico-8-font.png");let ja=nr;var M,O;class Eu{constructor(){d(this,M);b(this,"ascent",4);b(this,"descent",0);b(this,"lineGap",2);b(this,"glyphs",new Map([[" ",u(this,M,O).call(this,`
        ----
        ----
        ----
        ----
      `)],[".",u(this,M,O).call(this,`
        -
        -
        -
        #
      `)],[":",u(this,M,O).call(this,`
        #
        -
        -
        #
      `)],["!",u(this,M,O).call(this,`
        #
        #
        #
        -
        #
      `)],["?",u(this,M,O).call(this,`
        -#-
        #-#
        --#
        -#-
        -#-
      `)],["'",u(this,M,O).call(this,`
        #
        #
        -
        -
        -
      `)],['"',u(this,M,O).call(this,`
        #-#
        #-#
        ---
        ---
        ---
      `)],["*",u(this,M,O).call(this,`
        #-#
        -#-
        #-#
        ---
      `)],["/",u(this,M,O).call(this,`
        --#
        -#-
        -#-
        #--
      `)],["+",u(this,M,O).call(this,`
        ---
        -#-
        ###
        -#-
      `)],["-",u(this,M,O).call(this,`
        ---
        ---
        ###
        ---
      `)],["0",u(this,M,O).call(this,`
        -#-
        #-#
        #-#
        -#-
      `)],["1",u(this,M,O).call(this,`
        -#-
        ##-
        -#-
        -#-
      `)],["2",u(this,M,O).call(this,`
        ##-
        -##
        #--
        ###
      `)],["3",u(this,M,O).call(this,`
        ###
        -##
        --#
        ###
      `)],["4",u(this,M,O).call(this,`
        #-#
        #-#
        ###
        --#
      `)],["5",u(this,M,O).call(this,`
        ###
        ##-
        --#
        ##-
      `)],["6",u(this,M,O).call(this,`
        -#-
        #--
        ###
        -#-
      `)],["7",u(this,M,O).call(this,`
        ###
        --#
        -#-
        #--
      `)],["8",u(this,M,O).call(this,`
        ###
        -#-
        #-#
        -#-
      `)],["9",u(this,M,O).call(this,`
        ###
        ###
        --#
        ##-
      `)],["%",u(this,M,O).call(this,`
        #--#
        --#-
        -#--
        #--#
      `)],["$",u(this,M,O).call(this,`
        -##
        ##-
        -##
        ##-
      `)],["(",u(this,M,O).call(this,`
        -#
        #-
        #-
        -#
      `)],[")",u(this,M,O).call(this,`
        #-
        -#
        -#
        #-
      `)],["[",u(this,M,O).call(this,`
        ##
        #-
        #-
        ##
      `)],["]",u(this,M,O).call(this,`
        ##
        -#
        -#
        ##
      `)],["{",u(this,M,O).call(this,`
        -#
        ##
        ##
        -#
      `)],["}",u(this,M,O).call(this,`
        #-
        ##
        ##
        #-
      `)],["<",u(this,M,O).call(this,`
        ---
        -##
        #--
        -##
      `)],[">",u(this,M,O).call(this,`
        ##-
        --#
        ##-
        ---
      `)],["a",u(this,M,O).call(this,`
        ##-
        #-#
        ###
        #-#
      `)],["b",u(this,M,O).call(this,`
        #--
        ##-
        #-#
        ###
      `)],["c",u(this,M,O).call(this,`
        -##
        #--
        #--
        -##
      `)],["d",u(this,M,O).call(this,`
        ##-
        #-#
        #-#
        ##-
      `)],["e",u(this,M,O).call(this,`
        ###
        ##-
        #--
        ###
      `)],["f",u(this,M,O).call(this,`
        ###
        #--
        ##-
        #--
      `)],["g",u(this,M,O).call(this,`
        -##
        #--
        #-#
        -##
      `)],["h",u(this,M,O).call(this,`
        #--
        ##-
        #-#
        #-#
      `)],["i",u(this,M,O).call(this,`
        #
        #
        #
        #
      `)],["j",u(this,M,O).call(this,`
        ##
        -#
        -#
        #-
      `)],["k",u(this,M,O).call(this,`
        #-#
        ##-
        #-#
        #-#
      `)],["l",u(this,M,O).call(this,`
        #-
        #-
        #-
        ##
      `)],["m",u(this,M,O).call(this,`
        #-#
        ###
        #-#
        #-#
      `)],["n",u(this,M,O).call(this,`
        ##-
        #-#
        #-#
        #-#
      `)],["o",u(this,M,O).call(this,`
        -##
        #-#
        #-#
        ##-
      `)],["p",u(this,M,O).call(this,`
        ###
        #-#
        ##-
        #--
      `)],["q",u(this,M,O).call(this,`
        -#-
        #-#
        ###
        -#-
      `)],["r",u(this,M,O).call(this,`
        ##-
        #-#
        ##-
        #-#
      `)],["s",u(this,M,O).call(this,`
        -##
        ##-
        --#
        ##-
      `)],["t",u(this,M,O).call(this,`
        ###
        -#-
        -#-
        -#-
      `)],["u",u(this,M,O).call(this,`
        #-#
        #-#
        #-#
        ##-
      `)],["v",u(this,M,O).call(this,`
        #-#
        #-#
        #-#
        -#-
      `)],["w",u(this,M,O).call(this,`
        #-#
        #-#
        ###
        #-#
      `)],["x",u(this,M,O).call(this,`
        #-#
        -#-
        #-#
        #-#
      `)],["y",u(this,M,O).call(this,`
        #-#
        #-#
        -#-
        -#-
      `)],["z",u(this,M,O).call(this,`
        ###
        -#-
        #--
        ###
      `)]]))}mapGrapheme(e){return e.toLowerCase()}}M=new WeakSet,O=function(e){const t=Xn.from(e);return{type:"pixels",pixels:t,advance:t.size.x+1}};var v,A;class ku{constructor(){d(this,v);b(this,"ascent",5);b(this,"descent",0);b(this,"lineGap",2);b(this,"glyphs",new Map([[" ",u(this,v,A).call(this,`
        ----
        ----
        ----
        ----
        ----
      `)],[".",u(this,v,A).call(this,`
        --
        --
        --
        ##
        ##
      `)],[":",u(this,v,A).call(this,`
        #
        -
        -
        #
        -
      `)],["!",u(this,v,A).call(this,`
        ###
        ###
        -#-
        ---
        -#-
      `)],["?",u(this,v,A).call(this,`
        ###
        --#
        -#-
        ---
        -#-
      `)],["'",u(this,v,A).call(this,`
        -
        #
        #
        -
        -
      `)],['"',u(this,v,A).call(this,`
        #-#
        #-#
        ---
        ---
        ---
      `)],["*",u(this,v,A).call(this,`
        --
        ##
        ##
        --
        --
      `)],["/",u(this,v,A).call(this,`
        --#
        --#
        -#-
        #--
        #--
      `)],["+",u(this,v,A).call(this,`
        ---
        -#-
        ###
        -#-
        ---
      `)],["-",u(this,v,A).call(this,`
        ---
        ---
        ###
        ---
        ---
      `)],["0",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        #-#
        -#-
      `)],["1",u(this,v,A).call(this,`
        -#-
        ##-
        -#-
        -#-
        ###
      `)],["2",u(this,v,A).call(this,`
        -#-
        #-#
        --#
        -#-
        ###
      `)],["3",u(this,v,A).call(this,`
        ###
        --#
        -##
        --#
        ##-
      `)],["4",u(this,v,A).call(this,`
        --#
        -##
        #-#
        ###
        --#
      `)],["5",u(this,v,A).call(this,`
        ###
        #--
        ###
        --#
        ##-
      `)],["6",u(this,v,A).call(this,`
        ###
        #--
        ###
        #-#
        ###
      `)],["7",u(this,v,A).call(this,`
        ###
        --#
        -#-
        -#-
        -#-
      `)],["8",u(this,v,A).call(this,`
        ###
        #-#
        -#-
        #-#
        ###
      `)],["9",u(this,v,A).call(this,`
        ###
        #-#
        ###
        --#
        ###
      `)],["%",u(this,v,A).call(this,`
        #-#
        --#
        -#-
        #--
        #-#
      `)],["$",u(this,v,A).call(this,`
        ###
        ##-
        -##
        ###
        -#-
      `)],["(",u(this,v,A).call(this,`
        -#
        #-
        #-
        #-
        -#
      `)],[")",u(this,v,A).call(this,`
        #-
        -#
        -#
        -#
        #-
      `)],["[",u(this,v,A).call(this,`
        ##
        #-
        #-
        #-
        ##
      `)],["]",u(this,v,A).call(this,`
        ##
        -#
        -#
        -#
        ##
      `)],["{",u(this,v,A).call(this,`
        -##
        -#-
        #--
        -#-
        -##
      `)],["}",u(this,v,A).call(this,`
        ##-
        -#-
        --#
        -#-
        ##-
      `)],["<",u(this,v,A).call(this,`
        --#
        -#-
        #--
        -#-
        --#
      `)],[">",u(this,v,A).call(this,`
        #--
        -#-
        --#
        -#-
        #--
      `)],["A",u(this,v,A).call(this,`
        -#-
        #-#
        ###
        #-#
        #-#
      `)],["B",u(this,v,A).call(this,`
        ##-
        #-#
        ##-
        #-#
        ###
      `)],["C",u(this,v,A).call(this,`
        -#-
        #-#
        #--
        #-#
        -#-
      `)],["D",u(this,v,A).call(this,`
        ##-
        #-#
        #-#
        #-#
        ##-
      `)],["E",u(this,v,A).call(this,`
        ###
        #--
        ##-
        #--
        ###
      `)],["F",u(this,v,A).call(this,`
        ###
        #--
        ##-
        #--
        #--
      `)],["G",u(this,v,A).call(this,`
        -#-
        #-#
        #--
        #-#
        -##
      `)],["H",u(this,v,A).call(this,`
        #-#
        #-#
        ###
        #-#
        #-#
      `)],["I",u(this,v,A).call(this,`
        ###
        -#-
        -#-
        -#-
        ###
      `)],["J",u(this,v,A).call(this,`
        --#
        --#
        --#
        #-#
        -#-
      `)],["K",u(this,v,A).call(this,`
        #-#
        #-#
        ##-
        #-#
        #-#
      `)],["L",u(this,v,A).call(this,`
        #--
        #--
        #--
        #--
        ###
      `)],["M",u(this,v,A).call(this,`
        #-#
        ###
        ###
        #-#
        #-#
      `)],["N",u(this,v,A).call(this,`
        ##-
        ###
        #-#
        #-#
        #-#
      `)],["O",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        #-#
        -#-
      `)],["P",u(this,v,A).call(this,`
        ##-
        #-#
        ###
        #--
        #--
      `)],["Q",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        ###
        -##
      `)],["R",u(this,v,A).call(this,`
        ##-
        #-#
        ##-
        #-#
        #-#
      `)],["S",u(this,v,A).call(this,`
        ###
        #--
        -#-
        --#
        ##-
      `)],["T",u(this,v,A).call(this,`
        ###
        -#-
        -#-
        -#-
        -#-
      `)],["U",u(this,v,A).call(this,`
        #-#
        #-#
        #-#
        #-#
        ###
      `)],["V",u(this,v,A).call(this,`
        #-#
        #-#
        #-#
        -#-
        -#-
      `)],["W",u(this,v,A).call(this,`
        #-#
        #-#
        ###
        ###
        #-#
      `)],["X",u(this,v,A).call(this,`
        #-#
        #-#
        -#-
        #-#
        #-#
      `)],["Y",u(this,v,A).call(this,`
        #-#
        #-#
        -#-
        -#-
        -#-
      `)],["Z",u(this,v,A).call(this,`
        ###
        --#
        -#-
        #--
        ###
      `)],["a",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        ###
        #-#
      `)],["b",u(this,v,A).call(this,`
        #--
        #--
        ##-
        #-#
        ##-
      `)],["c",u(this,v,A).call(this,`
        -##
        #--
        #--
        #--
        -##
      `)],["d",u(this,v,A).call(this,`
        --#
        --#
        -##
        #-#
        ###
      `)],["e",u(this,v,A).call(this,`
        -#-
        #-#
        ###
        #--
        -##
      `)],["f",u(this,v,A).call(this,`
        -##
        -#-
        ###
        -#-
        -#-
      `)],["g",u(this,v,A).call(this,`
        -#-
        #-#
        #--
        #-#
        -##
      `)],["h",u(this,v,A).call(this,`
        #--
        #--
        ##-
        #-#
        #-#
      `)],["i",u(this,v,A).call(this,`
        -#
        --
        -#
        -#
        -#
      `)],["j",u(this,v,A).call(this,`
        -##
        --#
        --#
        #-#
        -#-
      `)],["k",u(this,v,A).call(this,`
        #-#
        #-#
        ##-
        #-#
        #-#
      `)],["l",u(this,v,A).call(this,`
        #
        #
        #
        #
        #
      `)],["m",u(this,v,A).call(this,`
        #-#
        ###
        ###
        #-#
        #-#
      `)],["n",u(this,v,A).call(this,`
        ##-
        #-#
        #-#
        #-#
        #-#
      `)],["o",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        #-#
        -#-
      `)],["p",u(this,v,A).call(this,`
        ##-
        #-#
        ###
        #--
        #--
      `)],["q",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        ###
        -##
      `)],["r",u(this,v,A).call(this,`
        -#-
        #-#
        #--
        #--
        #--
      `)],["s",u(this,v,A).call(this,`
        -##
        #--
        -#-
        --#
        ##-
      `)],["t",u(this,v,A).call(this,`
        -#-
        ###
        -#-
        -#-
        -##
      `)],["u",u(this,v,A).call(this,`
        #-#
        #-#
        #-#
        #-#
        -#-
      `)],["v",u(this,v,A).call(this,`
        #-#
        #-#
        #-#
        -#-
        -#-
      `)],["w",u(this,v,A).call(this,`
        #-#
        #-#
        ###
        ###
        #-#
      `)],["x",u(this,v,A).call(this,`
        #-#
        #-#
        -#-
        #-#
        #-#
      `)],["y",u(this,v,A).call(this,`
        #-#
        #-#
        -#-
        -#-
        -#-
      `)],["z",u(this,v,A).call(this,`
        ###
        --#
        -#-
        #--
        ###
      `)]]))}mapGrapheme(e){return e}}v=new WeakSet,A=function(e){const t=Xn.from(e);return{type:"pixels",pixels:t,advance:t.size.x+1}};class Xl{static detect(e){const t=e.id.toLowerCase();return t.includes("dualsense")?"dualsense":t.includes("8bitdo")||t.includes("2dc8")?"8bitdo":t.includes("054c")?"dualsense":t.includes("xbox")||t.includes("045e")?"xbox":(t.includes("xinput"),"other")}}class N{static addLoadedClass(){document.body.classList.add("loaded")}static addStartedClass(){document.body.classList.add("started")}static showError(e){document.body.classList.add("error"),document.getElementById("screen_error__message").innerText=String(e)}static updateMutedClass(e){document.body.classList[e?"add":"remove"]("muted")}static updateDebugClass(e){document.body.classList[e?"add":"remove"]("debug")}static updatePressedClasses(e){document.body.classList[e.up?"add":"remove"]("pressed_u"),document.body.classList[e.down?"add":"remove"]("pressed_d"),document.body.classList[e.left?"add":"remove"]("pressed_l"),document.body.classList[e.right?"add":"remove"]("pressed_r"),document.body.classList[e.a?"add":"remove"]("pressed_a"),document.body.classList[e.b?"add":"remove"]("pressed_b"),document.body.classList[e.menu?"add":"remove"]("pressed_menu"),document.body.classList[e.mute?"add":"remove"]("pressed_mute"),document.body.classList[e.fullscreen?"add":"remove"]("pressed_fullscreen")}}b(N,"selectors",{fullScreenSubject:"body",canvas:"#game_canvas",startButton:"#screen_start_game__button",controlsLeft:"#dpad_l",controlsRight:"#dpad_r",controlsUp:"#dpad_u",controlsDown:"#dpad_d",controlsUpLeft:"#dpad_ul",controlsUpRight:"#dpad_ur",controlsDownLeft:"#dpad_dl",controlsDownRight:"#dpad_dr",controlsA:"#button_a",controlsB:"#button_b",controlsMenu:"#button_menu",controlsFullScreen:"#button_fullscreen",controlsMuteToggle:"#button_mute"});(function(i){if(i.TextEncoder&&i.TextDecoder)return!1;function e(n="utf-8"){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${n}') is invalid.`)}Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),e.prototype.encode=function(n,s={stream:!1}){if(s.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let a=0;const l=n.length;let h=0,f=Math.max(32,l+(l>>1)+7),o=new Uint8Array(f>>3<<3);for(;a<l;){let c=n.charCodeAt(a++);if(c>=55296&&c<=56319){if(a<l){const _=n.charCodeAt(a);(_&64512)===56320&&(++a,c=((c&1023)<<10)+(_&1023)+65536)}if(c>=55296&&c<=56319)continue}if(h+4>o.length){f+=8,f*=1+a/n.length*2,f=f>>3<<3;const _=new Uint8Array(f);_.set(o),o=_}if(c&4294967168)if(!(c&4294965248))o[h++]=c>>6&31|192;else if(!(c&4294901760))o[h++]=c>>12&15|224,o[h++]=c>>6&63|128;else if(!(c&4292870144))o[h++]=c>>18&7|240,o[h++]=c>>12&63|128,o[h++]=c>>6&63|128;else continue;else{o[h++]=c;continue}o[h++]=c&63|128}return o.slice(0,h)};function t(n="utf-8",s={fatal:!1}){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${n}') is invalid.`);if(s.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(t.prototype,"fatal",{value:!1}),Object.defineProperty(t.prototype,"ignoreBOM",{value:!1}),t.prototype.decode=function(n,s={stream:!1}){if(s.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const a=new Uint8Array(n);let l=0;const h=a.length,f=[];for(;l<h;){const o=a[l++];if(o===0)break;if(!(o&128))f.push(o);else if((o&224)===192){const c=a[l++]&63;f.push((o&31)<<6|c)}else if((o&240)===224){const c=a[l++]&63,_=a[l++]&63;f.push((o&31)<<12|c<<6|_)}else if((o&248)===240){const c=a[l++]&63,_=a[l++]&63,g=a[l++]&63;let p=(o&7)<<18|c<<12|_<<6|g;p>65535&&(p-=65536,f.push(p>>>10&1023|55296),p=56320|p&1023),f.push(p)}}return String.fromCharCode.apply(null,f)},i.TextEncoder=e,i.TextDecoder=t})(typeof window<"u"?window:typeof self<"u"?self:void 0);function jl(i,e="utf8"){return new TextDecoder(e).decode(i)}const Cu=new TextEncoder;function Tu(i){return Cu.encode(i)}const Ru=1024*8,Mu=(()=>{const i=new Uint8Array(4),e=new Uint32Array(i.buffer);return!((e[0]=1)&i[0])})(),Tr={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class Pl{constructor(e=Ru,t={}){let n=!1;typeof e=="number"?e=new ArrayBuffer(e):(n=!0,this.lastWrittenByte=e.byteLength);const s=t.offset?t.offset>>>0:0,a=e.byteLength-s;let l=s;(ArrayBuffer.isView(e)||e instanceof Pl)&&(e.byteLength!==e.buffer.byteLength&&(l=e.byteOffset+s),e=e.buffer),n?this.lastWrittenByte=a:this.lastWrittenByte=0,this.buffer=e,this.length=a,this.byteLength=a,this.byteOffset=l,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,l,a),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const n=(this.offset+e)*2,s=new Uint8Array(n);s.set(new Uint8Array(this.buffer)),this.buffer=s.buffer,this.length=this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,t){const n=Tr[t].BYTES_PER_ELEMENT*e,s=this.byteOffset+this.offset,a=this.buffer.slice(s,s+n);if(this.littleEndian===Mu&&t!=="uint8"&&t!=="int8"){const h=new Uint8Array(this.buffer.slice(s,s+n));h.reverse();const f=new Tr[t](h.buffer);return this.offset+=n,f.reverse(),f}const l=new Tr[t](a);return this.offset+=n,l}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let t="";for(let n=0;n<e;n++)t+=this.readChar();return t}readUtf8(e=1){return jl(this.readBytes(e))}decodeText(e=1,t="utf-8"){return jl(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(Tu(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Fu=4,Ql=0,Vl=1,Ou=2;function jn(i){let e=i.length;for(;--e>=0;)i[e]=0}const Du=0,ah=1,Pu=2,Iu=3,Uu=258,Il=29,Ta=256,ps=Ta+1+Il,cn=30,Ul=19,rh=2*ps+1,_i=15,Rr=16,zu=7,zl=256,lh=16,oh=17,hh=18,Xr=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Ja=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Nu=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),uh=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Bu=512,de=new Array((ps+2)*2);jn(de);const rs=new Array(cn*2);jn(rs);const ms=new Array(Bu);jn(ms);const gs=new Array(Uu-Iu+1);jn(gs);const Nl=new Array(Il);jn(Nl);const Qa=new Array(cn);jn(Qa);function Mr(i,e,t,n,s){this.static_tree=i,this.extra_bits=e,this.extra_base=t,this.elems=n,this.max_length=s,this.has_stree=i&&i.length}let ch,fh,dh;function Fr(i,e){this.dyn_tree=i,this.max_code=0,this.stat_desc=e}const ph=i=>i<256?ms[i]:ms[256+(i>>>7)],_s=(i,e)=>{i.pending_buf[i.pending++]=e&255,i.pending_buf[i.pending++]=e>>>8&255},St=(i,e,t)=>{i.bi_valid>Rr-t?(i.bi_buf|=e<<i.bi_valid&65535,_s(i,i.bi_buf),i.bi_buf=e>>Rr-i.bi_valid,i.bi_valid+=t-Rr):(i.bi_buf|=e<<i.bi_valid&65535,i.bi_valid+=t)},re=(i,e,t)=>{St(i,t[e*2],t[e*2+1])},mh=(i,e)=>{let t=0;do t|=i&1,i>>>=1,t<<=1;while(--e>0);return t>>>1},$u=i=>{i.bi_valid===16?(_s(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=i.bi_buf&255,i.bi_buf>>=8,i.bi_valid-=8)},Lu=(i,e)=>{const t=e.dyn_tree,n=e.max_code,s=e.stat_desc.static_tree,a=e.stat_desc.has_stree,l=e.stat_desc.extra_bits,h=e.stat_desc.extra_base,f=e.stat_desc.max_length;let o,c,_,g,p,y,I=0;for(g=0;g<=_i;g++)i.bl_count[g]=0;for(t[i.heap[i.heap_max]*2+1]=0,o=i.heap_max+1;o<rh;o++)c=i.heap[o],g=t[t[c*2+1]*2+1]+1,g>f&&(g=f,I++),t[c*2+1]=g,!(c>n)&&(i.bl_count[g]++,p=0,c>=h&&(p=l[c-h]),y=t[c*2],i.opt_len+=y*(g+p),a&&(i.static_len+=y*(s[c*2+1]+p)));if(I!==0){do{for(g=f-1;i.bl_count[g]===0;)g--;i.bl_count[g]--,i.bl_count[g+1]+=2,i.bl_count[f]--,I-=2}while(I>0);for(g=f;g!==0;g--)for(c=i.bl_count[g];c!==0;)_=i.heap[--o],!(_>n)&&(t[_*2+1]!==g&&(i.opt_len+=(g-t[_*2+1])*t[_*2],t[_*2+1]=g),c--)}},gh=(i,e,t)=>{const n=new Array(_i+1);let s=0,a,l;for(a=1;a<=_i;a++)s=s+t[a-1]<<1,n[a]=s;for(l=0;l<=e;l++){let h=i[l*2+1];h!==0&&(i[l*2]=mh(n[h]++,h))}},Gu=()=>{let i,e,t,n,s;const a=new Array(_i+1);for(t=0,n=0;n<Il-1;n++)for(Nl[n]=t,i=0;i<1<<Xr[n];i++)gs[t++]=n;for(gs[t-1]=n,s=0,n=0;n<16;n++)for(Qa[n]=s,i=0;i<1<<Ja[n];i++)ms[s++]=n;for(s>>=7;n<cn;n++)for(Qa[n]=s<<7,i=0;i<1<<Ja[n]-7;i++)ms[256+s++]=n;for(e=0;e<=_i;e++)a[e]=0;for(i=0;i<=143;)de[i*2+1]=8,i++,a[8]++;for(;i<=255;)de[i*2+1]=9,i++,a[9]++;for(;i<=279;)de[i*2+1]=7,i++,a[7]++;for(;i<=287;)de[i*2+1]=8,i++,a[8]++;for(gh(de,ps+1,a),i=0;i<cn;i++)rs[i*2+1]=5,rs[i*2]=mh(i,5);ch=new Mr(de,Xr,Ta+1,ps,_i),fh=new Mr(rs,Ja,0,cn,_i),dh=new Mr(new Array(0),Nu,0,Ul,zu)},_h=i=>{let e;for(e=0;e<ps;e++)i.dyn_ltree[e*2]=0;for(e=0;e<cn;e++)i.dyn_dtree[e*2]=0;for(e=0;e<Ul;e++)i.bl_tree[e*2]=0;i.dyn_ltree[zl*2]=1,i.opt_len=i.static_len=0,i.sym_next=i.matches=0},bh=i=>{i.bi_valid>8?_s(i,i.bi_buf):i.bi_valid>0&&(i.pending_buf[i.pending++]=i.bi_buf),i.bi_buf=0,i.bi_valid=0},to=(i,e,t,n)=>{const s=e*2,a=t*2;return i[s]<i[a]||i[s]===i[a]&&n[e]<=n[t]},Or=(i,e,t)=>{const n=i.heap[t];let s=t<<1;for(;s<=i.heap_len&&(s<i.heap_len&&to(e,i.heap[s+1],i.heap[s],i.depth)&&s++,!to(e,n,i.heap[s],i.depth));)i.heap[t]=i.heap[s],t=s,s<<=1;i.heap[t]=n},eo=(i,e,t)=>{let n,s,a=0,l,h;if(i.sym_next!==0)do n=i.pending_buf[i.sym_buf+a++]&255,n+=(i.pending_buf[i.sym_buf+a++]&255)<<8,s=i.pending_buf[i.sym_buf+a++],n===0?re(i,s,e):(l=gs[s],re(i,l+Ta+1,e),h=Xr[l],h!==0&&(s-=Nl[l],St(i,s,h)),n--,l=ph(n),re(i,l,t),h=Ja[l],h!==0&&(n-=Qa[l],St(i,n,h)));while(a<i.sym_next);re(i,zl,e)},jr=(i,e)=>{const t=e.dyn_tree,n=e.stat_desc.static_tree,s=e.stat_desc.has_stree,a=e.stat_desc.elems;let l,h,f=-1,o;for(i.heap_len=0,i.heap_max=rh,l=0;l<a;l++)t[l*2]!==0?(i.heap[++i.heap_len]=f=l,i.depth[l]=0):t[l*2+1]=0;for(;i.heap_len<2;)o=i.heap[++i.heap_len]=f<2?++f:0,t[o*2]=1,i.depth[o]=0,i.opt_len--,s&&(i.static_len-=n[o*2+1]);for(e.max_code=f,l=i.heap_len>>1;l>=1;l--)Or(i,t,l);o=a;do l=i.heap[1],i.heap[1]=i.heap[i.heap_len--],Or(i,t,1),h=i.heap[1],i.heap[--i.heap_max]=l,i.heap[--i.heap_max]=h,t[o*2]=t[l*2]+t[h*2],i.depth[o]=(i.depth[l]>=i.depth[h]?i.depth[l]:i.depth[h])+1,t[l*2+1]=t[h*2+1]=o,i.heap[1]=o++,Or(i,t,1);while(i.heap_len>=2);i.heap[--i.heap_max]=i.heap[1],Lu(i,e),gh(t,f,i.bl_count)},io=(i,e,t)=>{let n,s=-1,a,l=e[0*2+1],h=0,f=7,o=4;for(l===0&&(f=138,o=3),e[(t+1)*2+1]=65535,n=0;n<=t;n++)a=l,l=e[(n+1)*2+1],!(++h<f&&a===l)&&(h<o?i.bl_tree[a*2]+=h:a!==0?(a!==s&&i.bl_tree[a*2]++,i.bl_tree[lh*2]++):h<=10?i.bl_tree[oh*2]++:i.bl_tree[hh*2]++,h=0,s=a,l===0?(f=138,o=3):a===l?(f=6,o=3):(f=7,o=4))},no=(i,e,t)=>{let n,s=-1,a,l=e[0*2+1],h=0,f=7,o=4;for(l===0&&(f=138,o=3),n=0;n<=t;n++)if(a=l,l=e[(n+1)*2+1],!(++h<f&&a===l)){if(h<o)do re(i,a,i.bl_tree);while(--h!==0);else a!==0?(a!==s&&(re(i,a,i.bl_tree),h--),re(i,lh,i.bl_tree),St(i,h-3,2)):h<=10?(re(i,oh,i.bl_tree),St(i,h-3,3)):(re(i,hh,i.bl_tree),St(i,h-11,7));h=0,s=a,l===0?(f=138,o=3):a===l?(f=6,o=3):(f=7,o=4)}},Zu=i=>{let e;for(io(i,i.dyn_ltree,i.l_desc.max_code),io(i,i.dyn_dtree,i.d_desc.max_code),jr(i,i.bl_desc),e=Ul-1;e>=3&&i.bl_tree[uh[e]*2+1]===0;e--);return i.opt_len+=3*(e+1)+5+5+4,e},Hu=(i,e,t,n)=>{let s;for(St(i,e-257,5),St(i,t-1,5),St(i,n-4,4),s=0;s<n;s++)St(i,i.bl_tree[uh[s]*2+1],3);no(i,i.dyn_ltree,e-1),no(i,i.dyn_dtree,t-1)},Ju=i=>{let e=4093624447,t;for(t=0;t<=31;t++,e>>>=1)if(e&1&&i.dyn_ltree[t*2]!==0)return Ql;if(i.dyn_ltree[9*2]!==0||i.dyn_ltree[10*2]!==0||i.dyn_ltree[13*2]!==0)return Vl;for(t=32;t<Ta;t++)if(i.dyn_ltree[t*2]!==0)return Vl;return Ql};let so=!1;const Wu=i=>{so||(Gu(),so=!0),i.l_desc=new Fr(i.dyn_ltree,ch),i.d_desc=new Fr(i.dyn_dtree,fh),i.bl_desc=new Fr(i.bl_tree,dh),i.bi_buf=0,i.bi_valid=0,_h(i)},wh=(i,e,t,n)=>{St(i,(Du<<1)+(n?1:0),3),bh(i),_s(i,t),_s(i,~t),t&&i.pending_buf.set(i.window.subarray(e,e+t),i.pending),i.pending+=t},qu=i=>{St(i,ah<<1,3),re(i,zl,de),$u(i)},Yu=(i,e,t,n)=>{let s,a,l=0;i.level>0?(i.strm.data_type===Ou&&(i.strm.data_type=Ju(i)),jr(i,i.l_desc),jr(i,i.d_desc),l=Zu(i),s=i.opt_len+3+7>>>3,a=i.static_len+3+7>>>3,a<=s&&(s=a)):s=a=t+5,t+4<=s&&e!==-1?wh(i,e,t,n):i.strategy===Fu||a===s?(St(i,(ah<<1)+(n?1:0),3),eo(i,de,rs)):(St(i,(Pu<<1)+(n?1:0),3),Hu(i,i.l_desc.max_code+1,i.d_desc.max_code+1,l+1),eo(i,i.dyn_ltree,i.dyn_dtree)),_h(i),n&&bh(i)},Ku=(i,e,t)=>(i.pending_buf[i.sym_buf+i.sym_next++]=e,i.pending_buf[i.sym_buf+i.sym_next++]=e>>8,i.pending_buf[i.sym_buf+i.sym_next++]=t,e===0?i.dyn_ltree[t*2]++:(i.matches++,e--,i.dyn_ltree[(gs[t]+Ta+1)*2]++,i.dyn_dtree[ph(e)*2]++),i.sym_next===i.sym_end);var Xu=Wu,ju=wh,Qu=Yu,Vu=Ku,tc=qu,ec={_tr_init:Xu,_tr_stored_block:ju,_tr_flush_block:Qu,_tr_tally:Vu,_tr_align:tc};const ic=(i,e,t,n)=>{let s=i&65535|0,a=i>>>16&65535|0,l=0;for(;t!==0;){l=t>2e3?2e3:t,t-=l;do s=s+e[n++]|0,a=a+s|0;while(--l);s%=65521,a%=65521}return s|a<<16|0};var bs=ic;const nc=()=>{let i,e=[];for(var t=0;t<256;t++){i=t;for(var n=0;n<8;n++)i=i&1?3988292384^i>>>1:i>>>1;e[t]=i}return e},sc=new Uint32Array(nc()),ac=(i,e,t,n)=>{const s=sc,a=n+t;i^=-1;for(let l=n;l<a;l++)i=i>>>8^s[(i^e[l])&255];return i^-1};var nt=ac,Hn={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ra={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:rc,_tr_stored_block:Qr,_tr_flush_block:lc,_tr_tally:Qe,_tr_align:oc}=ec,{Z_NO_FLUSH:Ve,Z_PARTIAL_FLUSH:hc,Z_FULL_FLUSH:uc,Z_FINISH:Ut,Z_BLOCK:ao,Z_OK:st,Z_STREAM_END:ro,Z_STREAM_ERROR:le,Z_DATA_ERROR:cc,Z_BUF_ERROR:Dr,Z_DEFAULT_COMPRESSION:fc,Z_FILTERED:dc,Z_HUFFMAN_ONLY:Ua,Z_RLE:pc,Z_FIXED:mc,Z_DEFAULT_STRATEGY:gc,Z_UNKNOWN:_c,Z_DEFLATED:xr}=Ra,bc=9,wc=15,yc=8,vc=29,xc=256,Vr=xc+1+vc,Ac=30,Sc=19,Ec=2*Vr+1,kc=15,H=3,je=258,oe=je+H+1,Cc=32,Jn=42,Bl=57,tl=69,el=73,il=91,nl=103,bi=113,is=666,mt=1,Qn=2,nn=3,Vn=4,Tc=3,wi=(i,e)=>(i.msg=Hn[e],e),lo=i=>i*2-(i>4?9:0),Oe=i=>{let e=i.length;for(;--e>=0;)i[e]=0},Rc=i=>{let e,t,n,s=i.w_size;e=i.hash_size,n=e;do t=i.head[--n],i.head[n]=t>=s?t-s:0;while(--e);e=s,n=e;do t=i.prev[--n],i.prev[n]=t>=s?t-s:0;while(--e)};let Mc=(i,e,t)=>(e<<i.hash_shift^t)&i.hash_mask,ti=Mc;const kt=i=>{const e=i.state;let t=e.pending;t>i.avail_out&&(t=i.avail_out),t!==0&&(i.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),i.next_out),i.next_out+=t,e.pending_out+=t,i.total_out+=t,i.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},Ct=(i,e)=>{lc(i,i.block_start>=0?i.block_start:-1,i.strstart-i.block_start,e),i.block_start=i.strstart,kt(i.strm)},J=(i,e)=>{i.pending_buf[i.pending++]=e},ts=(i,e)=>{i.pending_buf[i.pending++]=e>>>8&255,i.pending_buf[i.pending++]=e&255},sl=(i,e,t,n)=>{let s=i.avail_in;return s>n&&(s=n),s===0?0:(i.avail_in-=s,e.set(i.input.subarray(i.next_in,i.next_in+s),t),i.state.wrap===1?i.adler=bs(i.adler,e,s,t):i.state.wrap===2&&(i.adler=nt(i.adler,e,s,t)),i.next_in+=s,i.total_in+=s,s)},yh=(i,e)=>{let t=i.max_chain_length,n=i.strstart,s,a,l=i.prev_length,h=i.nice_match;const f=i.strstart>i.w_size-oe?i.strstart-(i.w_size-oe):0,o=i.window,c=i.w_mask,_=i.prev,g=i.strstart+je;let p=o[n+l-1],y=o[n+l];i.prev_length>=i.good_match&&(t>>=2),h>i.lookahead&&(h=i.lookahead);do if(s=e,!(o[s+l]!==y||o[s+l-1]!==p||o[s]!==o[n]||o[++s]!==o[n+1])){n+=2,s++;do;while(o[++n]===o[++s]&&o[++n]===o[++s]&&o[++n]===o[++s]&&o[++n]===o[++s]&&o[++n]===o[++s]&&o[++n]===o[++s]&&o[++n]===o[++s]&&o[++n]===o[++s]&&n<g);if(a=je-(g-n),n=g-je,a>l){if(i.match_start=e,l=a,a>=h)break;p=o[n+l-1],y=o[n+l]}}while((e=_[e&c])>f&&--t!==0);return l<=i.lookahead?l:i.lookahead},Wn=i=>{const e=i.w_size;let t,n,s;do{if(n=i.window_size-i.lookahead-i.strstart,i.strstart>=e+(e-oe)&&(i.window.set(i.window.subarray(e,e+e-n),0),i.match_start-=e,i.strstart-=e,i.block_start-=e,i.insert>i.strstart&&(i.insert=i.strstart),Rc(i),n+=e),i.strm.avail_in===0)break;if(t=sl(i.strm,i.window,i.strstart+i.lookahead,n),i.lookahead+=t,i.lookahead+i.insert>=H)for(s=i.strstart-i.insert,i.ins_h=i.window[s],i.ins_h=ti(i,i.ins_h,i.window[s+1]);i.insert&&(i.ins_h=ti(i,i.ins_h,i.window[s+H-1]),i.prev[s&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=s,s++,i.insert--,!(i.lookahead+i.insert<H)););}while(i.lookahead<oe&&i.strm.avail_in!==0)},vh=(i,e)=>{let t=i.pending_buf_size-5>i.w_size?i.w_size:i.pending_buf_size-5,n,s,a,l=0,h=i.strm.avail_in;do{if(n=65535,a=i.bi_valid+42>>3,i.strm.avail_out<a||(a=i.strm.avail_out-a,s=i.strstart-i.block_start,n>s+i.strm.avail_in&&(n=s+i.strm.avail_in),n>a&&(n=a),n<t&&(n===0&&e!==Ut||e===Ve||n!==s+i.strm.avail_in)))break;l=e===Ut&&n===s+i.strm.avail_in?1:0,Qr(i,0,0,l),i.pending_buf[i.pending-4]=n,i.pending_buf[i.pending-3]=n>>8,i.pending_buf[i.pending-2]=~n,i.pending_buf[i.pending-1]=~n>>8,kt(i.strm),s&&(s>n&&(s=n),i.strm.output.set(i.window.subarray(i.block_start,i.block_start+s),i.strm.next_out),i.strm.next_out+=s,i.strm.avail_out-=s,i.strm.total_out+=s,i.block_start+=s,n-=s),n&&(sl(i.strm,i.strm.output,i.strm.next_out,n),i.strm.next_out+=n,i.strm.avail_out-=n,i.strm.total_out+=n)}while(l===0);return h-=i.strm.avail_in,h&&(h>=i.w_size?(i.matches=2,i.window.set(i.strm.input.subarray(i.strm.next_in-i.w_size,i.strm.next_in),0),i.strstart=i.w_size,i.insert=i.strstart):(i.window_size-i.strstart<=h&&(i.strstart-=i.w_size,i.window.set(i.window.subarray(i.w_size,i.w_size+i.strstart),0),i.matches<2&&i.matches++,i.insert>i.strstart&&(i.insert=i.strstart)),i.window.set(i.strm.input.subarray(i.strm.next_in-h,i.strm.next_in),i.strstart),i.strstart+=h,i.insert+=h>i.w_size-i.insert?i.w_size-i.insert:h),i.block_start=i.strstart),i.high_water<i.strstart&&(i.high_water=i.strstart),l?Vn:e!==Ve&&e!==Ut&&i.strm.avail_in===0&&i.strstart===i.block_start?Qn:(a=i.window_size-i.strstart,i.strm.avail_in>a&&i.block_start>=i.w_size&&(i.block_start-=i.w_size,i.strstart-=i.w_size,i.window.set(i.window.subarray(i.w_size,i.w_size+i.strstart),0),i.matches<2&&i.matches++,a+=i.w_size,i.insert>i.strstart&&(i.insert=i.strstart)),a>i.strm.avail_in&&(a=i.strm.avail_in),a&&(sl(i.strm,i.window,i.strstart,a),i.strstart+=a,i.insert+=a>i.w_size-i.insert?i.w_size-i.insert:a),i.high_water<i.strstart&&(i.high_water=i.strstart),a=i.bi_valid+42>>3,a=i.pending_buf_size-a>65535?65535:i.pending_buf_size-a,t=a>i.w_size?i.w_size:a,s=i.strstart-i.block_start,(s>=t||(s||e===Ut)&&e!==Ve&&i.strm.avail_in===0&&s<=a)&&(n=s>a?a:s,l=e===Ut&&i.strm.avail_in===0&&n===s?1:0,Qr(i,i.block_start,n,l),i.block_start+=n,kt(i.strm)),l?nn:mt)},Pr=(i,e)=>{let t,n;for(;;){if(i.lookahead<oe){if(Wn(i),i.lookahead<oe&&e===Ve)return mt;if(i.lookahead===0)break}if(t=0,i.lookahead>=H&&(i.ins_h=ti(i,i.ins_h,i.window[i.strstart+H-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),t!==0&&i.strstart-t<=i.w_size-oe&&(i.match_length=yh(i,t)),i.match_length>=H)if(n=Qe(i,i.strstart-i.match_start,i.match_length-H),i.lookahead-=i.match_length,i.match_length<=i.max_lazy_match&&i.lookahead>=H){i.match_length--;do i.strstart++,i.ins_h=ti(i,i.ins_h,i.window[i.strstart+H-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart;while(--i.match_length!==0);i.strstart++}else i.strstart+=i.match_length,i.match_length=0,i.ins_h=i.window[i.strstart],i.ins_h=ti(i,i.ins_h,i.window[i.strstart+1]);else n=Qe(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++;if(n&&(Ct(i,!1),i.strm.avail_out===0))return mt}return i.insert=i.strstart<H-1?i.strstart:H-1,e===Ut?(Ct(i,!0),i.strm.avail_out===0?nn:Vn):i.sym_next&&(Ct(i,!1),i.strm.avail_out===0)?mt:Qn},rn=(i,e)=>{let t,n,s;for(;;){if(i.lookahead<oe){if(Wn(i),i.lookahead<oe&&e===Ve)return mt;if(i.lookahead===0)break}if(t=0,i.lookahead>=H&&(i.ins_h=ti(i,i.ins_h,i.window[i.strstart+H-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),i.prev_length=i.match_length,i.prev_match=i.match_start,i.match_length=H-1,t!==0&&i.prev_length<i.max_lazy_match&&i.strstart-t<=i.w_size-oe&&(i.match_length=yh(i,t),i.match_length<=5&&(i.strategy===dc||i.match_length===H&&i.strstart-i.match_start>4096)&&(i.match_length=H-1)),i.prev_length>=H&&i.match_length<=i.prev_length){s=i.strstart+i.lookahead-H,n=Qe(i,i.strstart-1-i.prev_match,i.prev_length-H),i.lookahead-=i.prev_length-1,i.prev_length-=2;do++i.strstart<=s&&(i.ins_h=ti(i,i.ins_h,i.window[i.strstart+H-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart);while(--i.prev_length!==0);if(i.match_available=0,i.match_length=H-1,i.strstart++,n&&(Ct(i,!1),i.strm.avail_out===0))return mt}else if(i.match_available){if(n=Qe(i,0,i.window[i.strstart-1]),n&&Ct(i,!1),i.strstart++,i.lookahead--,i.strm.avail_out===0)return mt}else i.match_available=1,i.strstart++,i.lookahead--}return i.match_available&&(n=Qe(i,0,i.window[i.strstart-1]),i.match_available=0),i.insert=i.strstart<H-1?i.strstart:H-1,e===Ut?(Ct(i,!0),i.strm.avail_out===0?nn:Vn):i.sym_next&&(Ct(i,!1),i.strm.avail_out===0)?mt:Qn},Fc=(i,e)=>{let t,n,s,a;const l=i.window;for(;;){if(i.lookahead<=je){if(Wn(i),i.lookahead<=je&&e===Ve)return mt;if(i.lookahead===0)break}if(i.match_length=0,i.lookahead>=H&&i.strstart>0&&(s=i.strstart-1,n=l[s],n===l[++s]&&n===l[++s]&&n===l[++s])){a=i.strstart+je;do;while(n===l[++s]&&n===l[++s]&&n===l[++s]&&n===l[++s]&&n===l[++s]&&n===l[++s]&&n===l[++s]&&n===l[++s]&&s<a);i.match_length=je-(a-s),i.match_length>i.lookahead&&(i.match_length=i.lookahead)}if(i.match_length>=H?(t=Qe(i,1,i.match_length-H),i.lookahead-=i.match_length,i.strstart+=i.match_length,i.match_length=0):(t=Qe(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++),t&&(Ct(i,!1),i.strm.avail_out===0))return mt}return i.insert=0,e===Ut?(Ct(i,!0),i.strm.avail_out===0?nn:Vn):i.sym_next&&(Ct(i,!1),i.strm.avail_out===0)?mt:Qn},Oc=(i,e)=>{let t;for(;;){if(i.lookahead===0&&(Wn(i),i.lookahead===0)){if(e===Ve)return mt;break}if(i.match_length=0,t=Qe(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++,t&&(Ct(i,!1),i.strm.avail_out===0))return mt}return i.insert=0,e===Ut?(Ct(i,!0),i.strm.avail_out===0?nn:Vn):i.sym_next&&(Ct(i,!1),i.strm.avail_out===0)?mt:Qn};function Xt(i,e,t,n,s){this.good_length=i,this.max_lazy=e,this.nice_length=t,this.max_chain=n,this.func=s}const ns=[new Xt(0,0,0,0,vh),new Xt(4,4,8,4,Pr),new Xt(4,5,16,8,Pr),new Xt(4,6,32,32,Pr),new Xt(4,4,16,16,rn),new Xt(8,16,32,32,rn),new Xt(8,16,128,128,rn),new Xt(8,32,128,256,rn),new Xt(32,128,258,1024,rn),new Xt(32,258,258,4096,rn)],Dc=i=>{i.window_size=2*i.w_size,Oe(i.head),i.max_lazy_match=ns[i.level].max_lazy,i.good_match=ns[i.level].good_length,i.nice_match=ns[i.level].nice_length,i.max_chain_length=ns[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=H-1,i.match_available=0,i.ins_h=0};function Pc(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=xr,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(Ec*2),this.dyn_dtree=new Uint16Array((2*Ac+1)*2),this.bl_tree=new Uint16Array((2*Sc+1)*2),Oe(this.dyn_ltree),Oe(this.dyn_dtree),Oe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(kc+1),this.heap=new Uint16Array(2*Vr+1),Oe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Vr+1),Oe(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ma=i=>{if(!i)return 1;const e=i.state;return!e||e.strm!==i||e.status!==Jn&&e.status!==Bl&&e.status!==tl&&e.status!==el&&e.status!==il&&e.status!==nl&&e.status!==bi&&e.status!==is?1:0},xh=i=>{if(Ma(i))return wi(i,le);i.total_in=i.total_out=0,i.data_type=_c;const e=i.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?Bl:e.wrap?Jn:bi,i.adler=e.wrap===2?0:1,e.last_flush=-2,rc(e),st},Ah=i=>{const e=xh(i);return e===st&&Dc(i.state),e},Ic=(i,e)=>Ma(i)||i.state.wrap!==2?le:(i.state.gzhead=e,st),Sh=(i,e,t,n,s,a)=>{if(!i)return le;let l=1;if(e===fc&&(e=6),n<0?(l=0,n=-n):n>15&&(l=2,n-=16),s<1||s>bc||t!==xr||n<8||n>15||e<0||e>9||a<0||a>mc||n===8&&l!==1)return wi(i,le);n===8&&(n=9);const h=new Pc;return i.state=h,h.strm=i,h.status=Jn,h.wrap=l,h.gzhead=null,h.w_bits=n,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=s+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+H-1)/H),h.window=new Uint8Array(h.w_size*2),h.head=new Uint16Array(h.hash_size),h.prev=new Uint16Array(h.w_size),h.lit_bufsize=1<<s+6,h.pending_buf_size=h.lit_bufsize*4,h.pending_buf=new Uint8Array(h.pending_buf_size),h.sym_buf=h.lit_bufsize,h.sym_end=(h.lit_bufsize-1)*3,h.level=e,h.strategy=a,h.method=t,Ah(i)},Uc=(i,e)=>Sh(i,e,xr,wc,yc,gc),zc=(i,e)=>{if(Ma(i)||e>ao||e<0)return i?wi(i,le):le;const t=i.state;if(!i.output||i.avail_in!==0&&!i.input||t.status===is&&e!==Ut)return wi(i,i.avail_out===0?Dr:le);const n=t.last_flush;if(t.last_flush=e,t.pending!==0){if(kt(i),i.avail_out===0)return t.last_flush=-1,st}else if(i.avail_in===0&&lo(e)<=lo(n)&&e!==Ut)return wi(i,Dr);if(t.status===is&&i.avail_in!==0)return wi(i,Dr);if(t.status===Jn&&t.wrap===0&&(t.status=bi),t.status===Jn){let s=xr+(t.w_bits-8<<4)<<8,a=-1;if(t.strategy>=Ua||t.level<2?a=0:t.level<6?a=1:t.level===6?a=2:a=3,s|=a<<6,t.strstart!==0&&(s|=Cc),s+=31-s%31,ts(t,s),t.strstart!==0&&(ts(t,i.adler>>>16),ts(t,i.adler&65535)),i.adler=1,t.status=bi,kt(i),t.pending!==0)return t.last_flush=-1,st}if(t.status===Bl){if(i.adler=0,J(t,31),J(t,139),J(t,8),t.gzhead)J(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),J(t,t.gzhead.time&255),J(t,t.gzhead.time>>8&255),J(t,t.gzhead.time>>16&255),J(t,t.gzhead.time>>24&255),J(t,t.level===9?2:t.strategy>=Ua||t.level<2?4:0),J(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(J(t,t.gzhead.extra.length&255),J(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(i.adler=nt(i.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=tl;else if(J(t,0),J(t,0),J(t,0),J(t,0),J(t,0),J(t,t.level===9?2:t.strategy>=Ua||t.level<2?4:0),J(t,Tc),t.status=bi,kt(i),t.pending!==0)return t.last_flush=-1,st}if(t.status===tl){if(t.gzhead.extra){let s=t.pending,a=(t.gzhead.extra.length&65535)-t.gzindex;for(;t.pending+a>t.pending_buf_size;){let h=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+h),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>s&&(i.adler=nt(i.adler,t.pending_buf,t.pending-s,s)),t.gzindex+=h,kt(i),t.pending!==0)return t.last_flush=-1,st;s=0,a-=h}let l=new Uint8Array(t.gzhead.extra);t.pending_buf.set(l.subarray(t.gzindex,t.gzindex+a),t.pending),t.pending+=a,t.gzhead.hcrc&&t.pending>s&&(i.adler=nt(i.adler,t.pending_buf,t.pending-s,s)),t.gzindex=0}t.status=el}if(t.status===el){if(t.gzhead.name){let s=t.pending,a;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>s&&(i.adler=nt(i.adler,t.pending_buf,t.pending-s,s)),kt(i),t.pending!==0)return t.last_flush=-1,st;s=0}t.gzindex<t.gzhead.name.length?a=t.gzhead.name.charCodeAt(t.gzindex++)&255:a=0,J(t,a)}while(a!==0);t.gzhead.hcrc&&t.pending>s&&(i.adler=nt(i.adler,t.pending_buf,t.pending-s,s)),t.gzindex=0}t.status=il}if(t.status===il){if(t.gzhead.comment){let s=t.pending,a;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>s&&(i.adler=nt(i.adler,t.pending_buf,t.pending-s,s)),kt(i),t.pending!==0)return t.last_flush=-1,st;s=0}t.gzindex<t.gzhead.comment.length?a=t.gzhead.comment.charCodeAt(t.gzindex++)&255:a=0,J(t,a)}while(a!==0);t.gzhead.hcrc&&t.pending>s&&(i.adler=nt(i.adler,t.pending_buf,t.pending-s,s))}t.status=nl}if(t.status===nl){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(kt(i),t.pending!==0))return t.last_flush=-1,st;J(t,i.adler&255),J(t,i.adler>>8&255),i.adler=0}if(t.status=bi,kt(i),t.pending!==0)return t.last_flush=-1,st}if(i.avail_in!==0||t.lookahead!==0||e!==Ve&&t.status!==is){let s=t.level===0?vh(t,e):t.strategy===Ua?Oc(t,e):t.strategy===pc?Fc(t,e):ns[t.level].func(t,e);if((s===nn||s===Vn)&&(t.status=is),s===mt||s===nn)return i.avail_out===0&&(t.last_flush=-1),st;if(s===Qn&&(e===hc?oc(t):e!==ao&&(Qr(t,0,0,!1),e===uc&&(Oe(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),kt(i),i.avail_out===0))return t.last_flush=-1,st}return e!==Ut?st:t.wrap<=0?ro:(t.wrap===2?(J(t,i.adler&255),J(t,i.adler>>8&255),J(t,i.adler>>16&255),J(t,i.adler>>24&255),J(t,i.total_in&255),J(t,i.total_in>>8&255),J(t,i.total_in>>16&255),J(t,i.total_in>>24&255)):(ts(t,i.adler>>>16),ts(t,i.adler&65535)),kt(i),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?st:ro)},Nc=i=>{if(Ma(i))return le;const e=i.state.status;return i.state=null,e===bi?wi(i,cc):st},Bc=(i,e)=>{let t=e.length;if(Ma(i))return le;const n=i.state,s=n.wrap;if(s===2||s===1&&n.status!==Jn||n.lookahead)return le;if(s===1&&(i.adler=bs(i.adler,e,t,0)),n.wrap=0,t>=n.w_size){s===0&&(Oe(n.head),n.strstart=0,n.block_start=0,n.insert=0);let f=new Uint8Array(n.w_size);f.set(e.subarray(t-n.w_size,t),0),e=f,t=n.w_size}const a=i.avail_in,l=i.next_in,h=i.input;for(i.avail_in=t,i.next_in=0,i.input=e,Wn(n);n.lookahead>=H;){let f=n.strstart,o=n.lookahead-(H-1);do n.ins_h=ti(n,n.ins_h,n.window[f+H-1]),n.prev[f&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=f,f++;while(--o);n.strstart=f,n.lookahead=H-1,Wn(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=H-1,n.match_available=0,i.next_in=l,i.input=h,i.avail_in=a,n.wrap=s,st};var $c=Uc,Lc=Sh,Gc=Ah,Zc=xh,Hc=Ic,Jc=zc,Wc=Nc,qc=Bc,Yc="pako deflate (from Nodeca project)",ls={deflateInit:$c,deflateInit2:Lc,deflateReset:Gc,deflateResetKeep:Zc,deflateSetHeader:Hc,deflate:Jc,deflateEnd:Wc,deflateSetDictionary:qc,deflateInfo:Yc};const Kc=(i,e)=>Object.prototype.hasOwnProperty.call(i,e);var Xc=function(i){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const n in t)Kc(t,n)&&(i[n]=t[n])}}return i},jc=i=>{let e=0;for(let n=0,s=i.length;n<s;n++)e+=i[n].length;const t=new Uint8Array(e);for(let n=0,s=0,a=i.length;n<a;n++){let l=i[n];t.set(l,s),s+=l.length}return t},Ar={assign:Xc,flattenChunks:jc};let Eh=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Eh=!1}const ws=new Uint8Array(256);for(let i=0;i<256;i++)ws[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;ws[254]=ws[254]=1;var Qc=i=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(i);let e,t,n,s,a,l=i.length,h=0;for(s=0;s<l;s++)t=i.charCodeAt(s),(t&64512)===55296&&s+1<l&&(n=i.charCodeAt(s+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),s++)),h+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(h),a=0,s=0;a<h;s++)t=i.charCodeAt(s),(t&64512)===55296&&s+1<l&&(n=i.charCodeAt(s+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),s++)),t<128?e[a++]=t:t<2048?(e[a++]=192|t>>>6,e[a++]=128|t&63):t<65536?(e[a++]=224|t>>>12,e[a++]=128|t>>>6&63,e[a++]=128|t&63):(e[a++]=240|t>>>18,e[a++]=128|t>>>12&63,e[a++]=128|t>>>6&63,e[a++]=128|t&63);return e};const Vc=(i,e)=>{if(e<65534&&i.subarray&&Eh)return String.fromCharCode.apply(null,i.length===e?i:i.subarray(0,e));let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(i[n]);return t};var tf=(i,e)=>{const t=e||i.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(i.subarray(0,e));let n,s;const a=new Array(t*2);for(s=0,n=0;n<t;){let l=i[n++];if(l<128){a[s++]=l;continue}let h=ws[l];if(h>4){a[s++]=65533,n+=h-1;continue}for(l&=h===2?31:h===3?15:7;h>1&&n<t;)l=l<<6|i[n++]&63,h--;if(h>1){a[s++]=65533;continue}l<65536?a[s++]=l:(l-=65536,a[s++]=55296|l>>10&1023,a[s++]=56320|l&1023)}return Vc(a,s)},ef=(i,e)=>{e=e||i.length,e>i.length&&(e=i.length);let t=e-1;for(;t>=0&&(i[t]&192)===128;)t--;return t<0||t===0?e:t+ws[i[t]]>e?t:e},ys={string2buf:Qc,buf2string:tf,utf8border:ef};function nf(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var kh=nf;const Ch=Object.prototype.toString,{Z_NO_FLUSH:sf,Z_SYNC_FLUSH:af,Z_FULL_FLUSH:rf,Z_FINISH:lf,Z_OK:Va,Z_STREAM_END:of,Z_DEFAULT_COMPRESSION:hf,Z_DEFAULT_STRATEGY:uf,Z_DEFLATED:cf}=Ra;function $l(i){this.options=Ar.assign({level:hf,method:cf,chunkSize:16384,windowBits:15,memLevel:8,strategy:uf},i||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new kh,this.strm.avail_out=0;let t=ls.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==Va)throw new Error(Hn[t]);if(e.header&&ls.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=ys.string2buf(e.dictionary):Ch.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,t=ls.deflateSetDictionary(this.strm,n),t!==Va)throw new Error(Hn[t]);this._dict_set=!0}}$l.prototype.push=function(i,e){const t=this.strm,n=this.options.chunkSize;let s,a;if(this.ended)return!1;for(e===~~e?a=e:a=e===!0?lf:sf,typeof i=="string"?t.input=ys.string2buf(i):Ch.call(i)==="[object ArrayBuffer]"?t.input=new Uint8Array(i):t.input=i,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),(a===af||a===rf)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(s=ls.deflate(t,a),s===of)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),s=ls.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Va;if(t.avail_out===0){this.onData(t.output);continue}if(a>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};$l.prototype.onData=function(i){this.chunks.push(i)};$l.prototype.onEnd=function(i){i===Va&&(this.result=Ar.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};const za=16209,ff=16191;var df=function(e,t){let n,s,a,l,h,f,o,c,_,g,p,y,I,F,C,P,U,x,L,B,k,W,G,$;const Z=e.state;n=e.next_in,G=e.input,s=n+(e.avail_in-5),a=e.next_out,$=e.output,l=a-(t-e.avail_out),h=a+(e.avail_out-257),f=Z.dmax,o=Z.wsize,c=Z.whave,_=Z.wnext,g=Z.window,p=Z.hold,y=Z.bits,I=Z.lencode,F=Z.distcode,C=(1<<Z.lenbits)-1,P=(1<<Z.distbits)-1;t:do{y<15&&(p+=G[n++]<<y,y+=8,p+=G[n++]<<y,y+=8),U=I[p&C];e:for(;;){if(x=U>>>24,p>>>=x,y-=x,x=U>>>16&255,x===0)$[a++]=U&65535;else if(x&16){L=U&65535,x&=15,x&&(y<x&&(p+=G[n++]<<y,y+=8),L+=p&(1<<x)-1,p>>>=x,y-=x),y<15&&(p+=G[n++]<<y,y+=8,p+=G[n++]<<y,y+=8),U=F[p&P];i:for(;;){if(x=U>>>24,p>>>=x,y-=x,x=U>>>16&255,x&16){if(B=U&65535,x&=15,y<x&&(p+=G[n++]<<y,y+=8,y<x&&(p+=G[n++]<<y,y+=8)),B+=p&(1<<x)-1,B>f){e.msg="invalid distance too far back",Z.mode=za;break t}if(p>>>=x,y-=x,x=a-l,B>x){if(x=B-x,x>c&&Z.sane){e.msg="invalid distance too far back",Z.mode=za;break t}if(k=0,W=g,_===0){if(k+=o-x,x<L){L-=x;do $[a++]=g[k++];while(--x);k=a-B,W=$}}else if(_<x){if(k+=o+_-x,x-=_,x<L){L-=x;do $[a++]=g[k++];while(--x);if(k=0,_<L){x=_,L-=x;do $[a++]=g[k++];while(--x);k=a-B,W=$}}}else if(k+=_-x,x<L){L-=x;do $[a++]=g[k++];while(--x);k=a-B,W=$}for(;L>2;)$[a++]=W[k++],$[a++]=W[k++],$[a++]=W[k++],L-=3;L&&($[a++]=W[k++],L>1&&($[a++]=W[k++]))}else{k=a-B;do $[a++]=$[k++],$[a++]=$[k++],$[a++]=$[k++],L-=3;while(L>2);L&&($[a++]=$[k++],L>1&&($[a++]=$[k++]))}}else if(x&64){e.msg="invalid distance code",Z.mode=za;break t}else{U=F[(U&65535)+(p&(1<<x)-1)];continue i}break}}else if(x&64)if(x&32){Z.mode=ff;break t}else{e.msg="invalid literal/length code",Z.mode=za;break t}else{U=I[(U&65535)+(p&(1<<x)-1)];continue e}break}}while(n<s&&a<h);L=y>>3,n-=L,y-=L<<3,p&=(1<<y)-1,e.next_in=n,e.next_out=a,e.avail_in=n<s?5+(s-n):5-(n-s),e.avail_out=a<h?257+(h-a):257-(a-h),Z.hold=p,Z.bits=y};const ln=15,oo=852,ho=592,uo=0,Ir=1,co=2,pf=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),mf=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),gf=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),_f=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),bf=(i,e,t,n,s,a,l,h)=>{const f=h.bits;let o=0,c=0,_=0,g=0,p=0,y=0,I=0,F=0,C=0,P=0,U,x,L,B,k,W=null,G;const $=new Uint16Array(ln+1),Z=new Uint16Array(ln+1);let Bt=null,Kl,Pa,Ia;for(o=0;o<=ln;o++)$[o]=0;for(c=0;c<n;c++)$[e[t+c]]++;for(p=f,g=ln;g>=1&&$[g]===0;g--);if(p>g&&(p=g),g===0)return s[a++]=1<<24|64<<16|0,s[a++]=1<<24|64<<16|0,h.bits=1,0;for(_=1;_<g&&$[_]===0;_++);for(p<_&&(p=_),F=1,o=1;o<=ln;o++)if(F<<=1,F-=$[o],F<0)return-1;if(F>0&&(i===uo||g!==1))return-1;for(Z[1]=0,o=1;o<ln;o++)Z[o+1]=Z[o]+$[o];for(c=0;c<n;c++)e[t+c]!==0&&(l[Z[e[t+c]]++]=c);if(i===uo?(W=Bt=l,G=20):i===Ir?(W=pf,Bt=mf,G=257):(W=gf,Bt=_f,G=0),P=0,c=0,o=_,k=a,y=p,I=0,L=-1,C=1<<p,B=C-1,i===Ir&&C>oo||i===co&&C>ho)return 1;for(;;){Kl=o-I,l[c]+1<G?(Pa=0,Ia=l[c]):l[c]>=G?(Pa=Bt[l[c]-G],Ia=W[l[c]-G]):(Pa=96,Ia=0),U=1<<o-I,x=1<<y,_=x;do x-=U,s[k+(P>>I)+x]=Kl<<24|Pa<<16|Ia|0;while(x!==0);for(U=1<<o-1;P&U;)U>>=1;if(U!==0?(P&=U-1,P+=U):P=0,c++,--$[o]===0){if(o===g)break;o=e[t+l[c]]}if(o>p&&(P&B)!==L){for(I===0&&(I=p),k+=_,y=o-I,F=1<<y;y+I<g&&(F-=$[y+I],!(F<=0));)y++,F<<=1;if(C+=1<<y,i===Ir&&C>oo||i===co&&C>ho)return 1;L=P&B,s[L]=p<<24|y<<16|k-a|0}}return P!==0&&(s[k+P]=o-I<<24|64<<16|0),h.bits=p,0};var os=bf;const wf=0,Th=1,Rh=2,{Z_FINISH:fo,Z_BLOCK:yf,Z_TREES:Na,Z_OK:sn,Z_STREAM_END:vf,Z_NEED_DICT:xf,Z_STREAM_ERROR:zt,Z_DATA_ERROR:Mh,Z_MEM_ERROR:Fh,Z_BUF_ERROR:Af,Z_DEFLATED:po}=Ra,Sr=16180,mo=16181,go=16182,_o=16183,bo=16184,wo=16185,yo=16186,vo=16187,xo=16188,Ao=16189,tr=16190,ue=16191,Ur=16192,So=16193,zr=16194,Eo=16195,ko=16196,Co=16197,To=16198,Ba=16199,$a=16200,Ro=16201,Mo=16202,Fo=16203,Oo=16204,Do=16205,Nr=16206,Po=16207,Io=16208,X=16209,Oh=16210,Dh=16211,Sf=852,Ef=592,kf=15,Cf=kf,Uo=i=>(i>>>24&255)+(i>>>8&65280)+((i&65280)<<8)+((i&255)<<24);function Tf(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const an=i=>{if(!i)return 1;const e=i.state;return!e||e.strm!==i||e.mode<Sr||e.mode>Dh?1:0},Ph=i=>{if(an(i))return zt;const e=i.state;return i.total_in=i.total_out=e.total=0,i.msg="",e.wrap&&(i.adler=e.wrap&1),e.mode=Sr,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(Sf),e.distcode=e.distdyn=new Int32Array(Ef),e.sane=1,e.back=-1,sn},Ih=i=>{if(an(i))return zt;const e=i.state;return e.wsize=0,e.whave=0,e.wnext=0,Ph(i)},Uh=(i,e)=>{let t;if(an(i))return zt;const n=i.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?zt:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,Ih(i))},zh=(i,e)=>{if(!i)return zt;const t=new Tf;i.state=t,t.strm=i,t.window=null,t.mode=Sr;const n=Uh(i,e);return n!==sn&&(i.state=null),n},Rf=i=>zh(i,Cf);let zo=!0,Br,$r;const Mf=i=>{if(zo){Br=new Int32Array(512),$r=new Int32Array(32);let e=0;for(;e<144;)i.lens[e++]=8;for(;e<256;)i.lens[e++]=9;for(;e<280;)i.lens[e++]=7;for(;e<288;)i.lens[e++]=8;for(os(Th,i.lens,0,288,Br,0,i.work,{bits:9}),e=0;e<32;)i.lens[e++]=5;os(Rh,i.lens,0,32,$r,0,i.work,{bits:5}),zo=!1}i.lencode=Br,i.lenbits=9,i.distcode=$r,i.distbits=5},Nh=(i,e,t,n)=>{let s;const a=i.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),n>=a.wsize?(a.window.set(e.subarray(t-a.wsize,t),0),a.wnext=0,a.whave=a.wsize):(s=a.wsize-a.wnext,s>n&&(s=n),a.window.set(e.subarray(t-n,t-n+s),a.wnext),n-=s,n?(a.window.set(e.subarray(t-n,t),0),a.wnext=n,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0},Ff=(i,e)=>{let t,n,s,a,l,h,f,o,c,_,g,p,y,I,F=0,C,P,U,x,L,B,k,W;const G=new Uint8Array(4);let $,Z;const Bt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(an(i)||!i.output||!i.input&&i.avail_in!==0)return zt;t=i.state,t.mode===ue&&(t.mode=Ur),l=i.next_out,s=i.output,f=i.avail_out,a=i.next_in,n=i.input,h=i.avail_in,o=t.hold,c=t.bits,_=h,g=f,W=sn;t:for(;;)switch(t.mode){case Sr:if(t.wrap===0){t.mode=Ur;break}for(;c<16;){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}if(t.wrap&2&&o===35615){t.wbits===0&&(t.wbits=15),t.check=0,G[0]=o&255,G[1]=o>>>8&255,t.check=nt(t.check,G,2,0),o=0,c=0,t.mode=mo;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((o&255)<<8)+(o>>8))%31){i.msg="incorrect header check",t.mode=X;break}if((o&15)!==po){i.msg="unknown compression method",t.mode=X;break}if(o>>>=4,c-=4,k=(o&15)+8,t.wbits===0&&(t.wbits=k),k>15||k>t.wbits){i.msg="invalid window size",t.mode=X;break}t.dmax=1<<t.wbits,t.flags=0,i.adler=t.check=1,t.mode=o&512?Ao:ue,o=0,c=0;break;case mo:for(;c<16;){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}if(t.flags=o,(t.flags&255)!==po){i.msg="unknown compression method",t.mode=X;break}if(t.flags&57344){i.msg="unknown header flags set",t.mode=X;break}t.head&&(t.head.text=o>>8&1),t.flags&512&&t.wrap&4&&(G[0]=o&255,G[1]=o>>>8&255,t.check=nt(t.check,G,2,0)),o=0,c=0,t.mode=go;case go:for(;c<32;){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}t.head&&(t.head.time=o),t.flags&512&&t.wrap&4&&(G[0]=o&255,G[1]=o>>>8&255,G[2]=o>>>16&255,G[3]=o>>>24&255,t.check=nt(t.check,G,4,0)),o=0,c=0,t.mode=_o;case _o:for(;c<16;){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}t.head&&(t.head.xflags=o&255,t.head.os=o>>8),t.flags&512&&t.wrap&4&&(G[0]=o&255,G[1]=o>>>8&255,t.check=nt(t.check,G,2,0)),o=0,c=0,t.mode=bo;case bo:if(t.flags&1024){for(;c<16;){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}t.length=o,t.head&&(t.head.extra_len=o),t.flags&512&&t.wrap&4&&(G[0]=o&255,G[1]=o>>>8&255,t.check=nt(t.check,G,2,0)),o=0,c=0}else t.head&&(t.head.extra=null);t.mode=wo;case wo:if(t.flags&1024&&(p=t.length,p>h&&(p=h),p&&(t.head&&(k=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(a,a+p),k)),t.flags&512&&t.wrap&4&&(t.check=nt(t.check,n,p,a)),h-=p,a+=p,t.length-=p),t.length))break t;t.length=0,t.mode=yo;case yo:if(t.flags&2048){if(h===0)break t;p=0;do k=n[a+p++],t.head&&k&&t.length<65536&&(t.head.name+=String.fromCharCode(k));while(k&&p<h);if(t.flags&512&&t.wrap&4&&(t.check=nt(t.check,n,p,a)),h-=p,a+=p,k)break t}else t.head&&(t.head.name=null);t.length=0,t.mode=vo;case vo:if(t.flags&4096){if(h===0)break t;p=0;do k=n[a+p++],t.head&&k&&t.length<65536&&(t.head.comment+=String.fromCharCode(k));while(k&&p<h);if(t.flags&512&&t.wrap&4&&(t.check=nt(t.check,n,p,a)),h-=p,a+=p,k)break t}else t.head&&(t.head.comment=null);t.mode=xo;case xo:if(t.flags&512){for(;c<16;){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}if(t.wrap&4&&o!==(t.check&65535)){i.msg="header crc mismatch",t.mode=X;break}o=0,c=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),i.adler=t.check=0,t.mode=ue;break;case Ao:for(;c<32;){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}i.adler=t.check=Uo(o),o=0,c=0,t.mode=tr;case tr:if(t.havedict===0)return i.next_out=l,i.avail_out=f,i.next_in=a,i.avail_in=h,t.hold=o,t.bits=c,xf;i.adler=t.check=1,t.mode=ue;case ue:if(e===yf||e===Na)break t;case Ur:if(t.last){o>>>=c&7,c-=c&7,t.mode=Nr;break}for(;c<3;){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}switch(t.last=o&1,o>>>=1,c-=1,o&3){case 0:t.mode=So;break;case 1:if(Mf(t),t.mode=Ba,e===Na){o>>>=2,c-=2;break t}break;case 2:t.mode=ko;break;case 3:i.msg="invalid block type",t.mode=X}o>>>=2,c-=2;break;case So:for(o>>>=c&7,c-=c&7;c<32;){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}if((o&65535)!==(o>>>16^65535)){i.msg="invalid stored block lengths",t.mode=X;break}if(t.length=o&65535,o=0,c=0,t.mode=zr,e===Na)break t;case zr:t.mode=Eo;case Eo:if(p=t.length,p){if(p>h&&(p=h),p>f&&(p=f),p===0)break t;s.set(n.subarray(a,a+p),l),h-=p,a+=p,f-=p,l+=p,t.length-=p;break}t.mode=ue;break;case ko:for(;c<14;){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}if(t.nlen=(o&31)+257,o>>>=5,c-=5,t.ndist=(o&31)+1,o>>>=5,c-=5,t.ncode=(o&15)+4,o>>>=4,c-=4,t.nlen>286||t.ndist>30){i.msg="too many length or distance symbols",t.mode=X;break}t.have=0,t.mode=Co;case Co:for(;t.have<t.ncode;){for(;c<3;){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}t.lens[Bt[t.have++]]=o&7,o>>>=3,c-=3}for(;t.have<19;)t.lens[Bt[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,$={bits:t.lenbits},W=os(wf,t.lens,0,19,t.lencode,0,t.work,$),t.lenbits=$.bits,W){i.msg="invalid code lengths set",t.mode=X;break}t.have=0,t.mode=To;case To:for(;t.have<t.nlen+t.ndist;){for(;F=t.lencode[o&(1<<t.lenbits)-1],C=F>>>24,P=F>>>16&255,U=F&65535,!(C<=c);){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}if(U<16)o>>>=C,c-=C,t.lens[t.have++]=U;else{if(U===16){for(Z=C+2;c<Z;){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}if(o>>>=C,c-=C,t.have===0){i.msg="invalid bit length repeat",t.mode=X;break}k=t.lens[t.have-1],p=3+(o&3),o>>>=2,c-=2}else if(U===17){for(Z=C+3;c<Z;){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}o>>>=C,c-=C,k=0,p=3+(o&7),o>>>=3,c-=3}else{for(Z=C+7;c<Z;){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}o>>>=C,c-=C,k=0,p=11+(o&127),o>>>=7,c-=7}if(t.have+p>t.nlen+t.ndist){i.msg="invalid bit length repeat",t.mode=X;break}for(;p--;)t.lens[t.have++]=k}}if(t.mode===X)break;if(t.lens[256]===0){i.msg="invalid code -- missing end-of-block",t.mode=X;break}if(t.lenbits=9,$={bits:t.lenbits},W=os(Th,t.lens,0,t.nlen,t.lencode,0,t.work,$),t.lenbits=$.bits,W){i.msg="invalid literal/lengths set",t.mode=X;break}if(t.distbits=6,t.distcode=t.distdyn,$={bits:t.distbits},W=os(Rh,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,$),t.distbits=$.bits,W){i.msg="invalid distances set",t.mode=X;break}if(t.mode=Ba,e===Na)break t;case Ba:t.mode=$a;case $a:if(h>=6&&f>=258){i.next_out=l,i.avail_out=f,i.next_in=a,i.avail_in=h,t.hold=o,t.bits=c,df(i,g),l=i.next_out,s=i.output,f=i.avail_out,a=i.next_in,n=i.input,h=i.avail_in,o=t.hold,c=t.bits,t.mode===ue&&(t.back=-1);break}for(t.back=0;F=t.lencode[o&(1<<t.lenbits)-1],C=F>>>24,P=F>>>16&255,U=F&65535,!(C<=c);){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}if(P&&!(P&240)){for(x=C,L=P,B=U;F=t.lencode[B+((o&(1<<x+L)-1)>>x)],C=F>>>24,P=F>>>16&255,U=F&65535,!(x+C<=c);){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}o>>>=x,c-=x,t.back+=x}if(o>>>=C,c-=C,t.back+=C,t.length=U,P===0){t.mode=Do;break}if(P&32){t.back=-1,t.mode=ue;break}if(P&64){i.msg="invalid literal/length code",t.mode=X;break}t.extra=P&15,t.mode=Ro;case Ro:if(t.extra){for(Z=t.extra;c<Z;){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}t.length+=o&(1<<t.extra)-1,o>>>=t.extra,c-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=Mo;case Mo:for(;F=t.distcode[o&(1<<t.distbits)-1],C=F>>>24,P=F>>>16&255,U=F&65535,!(C<=c);){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}if(!(P&240)){for(x=C,L=P,B=U;F=t.distcode[B+((o&(1<<x+L)-1)>>x)],C=F>>>24,P=F>>>16&255,U=F&65535,!(x+C<=c);){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}o>>>=x,c-=x,t.back+=x}if(o>>>=C,c-=C,t.back+=C,P&64){i.msg="invalid distance code",t.mode=X;break}t.offset=U,t.extra=P&15,t.mode=Fo;case Fo:if(t.extra){for(Z=t.extra;c<Z;){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}t.offset+=o&(1<<t.extra)-1,o>>>=t.extra,c-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){i.msg="invalid distance too far back",t.mode=X;break}t.mode=Oo;case Oo:if(f===0)break t;if(p=g-f,t.offset>p){if(p=t.offset-p,p>t.whave&&t.sane){i.msg="invalid distance too far back",t.mode=X;break}p>t.wnext?(p-=t.wnext,y=t.wsize-p):y=t.wnext-p,p>t.length&&(p=t.length),I=t.window}else I=s,y=l-t.offset,p=t.length;p>f&&(p=f),f-=p,t.length-=p;do s[l++]=I[y++];while(--p);t.length===0&&(t.mode=$a);break;case Do:if(f===0)break t;s[l++]=t.length,f--,t.mode=$a;break;case Nr:if(t.wrap){for(;c<32;){if(h===0)break t;h--,o|=n[a++]<<c,c+=8}if(g-=f,i.total_out+=g,t.total+=g,t.wrap&4&&g&&(i.adler=t.check=t.flags?nt(t.check,s,g,l-g):bs(t.check,s,g,l-g)),g=f,t.wrap&4&&(t.flags?o:Uo(o))!==t.check){i.msg="incorrect data check",t.mode=X;break}o=0,c=0}t.mode=Po;case Po:if(t.wrap&&t.flags){for(;c<32;){if(h===0)break t;h--,o+=n[a++]<<c,c+=8}if(t.wrap&4&&o!==(t.total&4294967295)){i.msg="incorrect length check",t.mode=X;break}o=0,c=0}t.mode=Io;case Io:W=vf;break t;case X:W=Mh;break t;case Oh:return Fh;case Dh:default:return zt}return i.next_out=l,i.avail_out=f,i.next_in=a,i.avail_in=h,t.hold=o,t.bits=c,(t.wsize||g!==i.avail_out&&t.mode<X&&(t.mode<Nr||e!==fo))&&Nh(i,i.output,i.next_out,g-i.avail_out),_-=i.avail_in,g-=i.avail_out,i.total_in+=_,i.total_out+=g,t.total+=g,t.wrap&4&&g&&(i.adler=t.check=t.flags?nt(t.check,s,g,i.next_out-g):bs(t.check,s,g,i.next_out-g)),i.data_type=t.bits+(t.last?64:0)+(t.mode===ue?128:0)+(t.mode===Ba||t.mode===zr?256:0),(_===0&&g===0||e===fo)&&W===sn&&(W=Af),W},Of=i=>{if(an(i))return zt;let e=i.state;return e.window&&(e.window=null),i.state=null,sn},Df=(i,e)=>{if(an(i))return zt;const t=i.state;return t.wrap&2?(t.head=e,e.done=!1,sn):zt},Pf=(i,e)=>{const t=e.length;let n,s,a;return an(i)||(n=i.state,n.wrap!==0&&n.mode!==tr)?zt:n.mode===tr&&(s=1,s=bs(s,e,t,0),s!==n.check)?Mh:(a=Nh(i,e,t,t),a?(n.mode=Oh,Fh):(n.havedict=1,sn))};var If=Ih,Uf=Uh,zf=Ph,Nf=Rf,Bf=zh,$f=Ff,Lf=Of,Gf=Df,Zf=Pf,Hf="pako inflate (from Nodeca project)",pe={inflateReset:If,inflateReset2:Uf,inflateResetKeep:zf,inflateInit:Nf,inflateInit2:Bf,inflate:$f,inflateEnd:Lf,inflateGetHeader:Gf,inflateSetDictionary:Zf,inflateInfo:Hf};function Jf(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Wf=Jf;const Bh=Object.prototype.toString,{Z_NO_FLUSH:qf,Z_FINISH:Yf,Z_OK:vs,Z_STREAM_END:Lr,Z_NEED_DICT:Gr,Z_STREAM_ERROR:Kf,Z_DATA_ERROR:No,Z_MEM_ERROR:Xf}=Ra;function Fa(i){this.options=Ar.assign({chunkSize:1024*64,windowBits:15,to:""},i||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(i&&i.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new kh,this.strm.avail_out=0;let t=pe.inflateInit2(this.strm,e.windowBits);if(t!==vs)throw new Error(Hn[t]);if(this.header=new Wf,pe.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=ys.string2buf(e.dictionary):Bh.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=pe.inflateSetDictionary(this.strm,e.dictionary),t!==vs)))throw new Error(Hn[t])}Fa.prototype.push=function(i,e){const t=this.strm,n=this.options.chunkSize,s=this.options.dictionary;let a,l,h;if(this.ended)return!1;for(e===~~e?l=e:l=e===!0?Yf:qf,Bh.call(i)==="[object ArrayBuffer]"?t.input=new Uint8Array(i):t.input=i,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),a=pe.inflate(t,l),a===Gr&&s&&(a=pe.inflateSetDictionary(t,s),a===vs?a=pe.inflate(t,l):a===No&&(a=Gr));t.avail_in>0&&a===Lr&&t.state.wrap>0&&i[t.next_in]!==0;)pe.inflateReset(t),a=pe.inflate(t,l);switch(a){case Kf:case No:case Gr:case Xf:return this.onEnd(a),this.ended=!0,!1}if(h=t.avail_out,t.next_out&&(t.avail_out===0||a===Lr))if(this.options.to==="string"){let f=ys.utf8border(t.output,t.next_out),o=t.next_out-f,c=ys.buf2string(t.output,f);t.next_out=o,t.avail_out=n-o,o&&t.output.set(t.output.subarray(f,f+o),0),this.onData(c)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(a===vs&&h===0)){if(a===Lr)return a=pe.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};Fa.prototype.onData=function(i){this.chunks.push(i)};Fa.prototype.onEnd=function(i){i===vs&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Ar.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};function Ll(i,e){const t=new Fa(e);if(t.push(i),t.err)throw t.msg||Hn[t.err];return t.result}function jf(i,e){return e=e||{},e.raw=!0,Ll(i,e)}var Qf=Fa,Vf=Ll,td=jf,ed=Ll,id=Ra,nd={Inflate:Qf,inflate:Vf,inflateRaw:td,ungzip:ed,constants:id};const{Inflate:sd,inflate:ad,inflateRaw:xp,ungzip:Ap}=nd;var rd=sd,ld=ad;const Zr=[137,80,78,71,13,10,26,10],$h=[];for(let i=0;i<256;i++){let e=i;for(let t=0;t<8;t++)e&1?e=3988292384^e>>>1:e=e>>>1;$h[i]=e}const Bo=4294967295;function od(i,e,t){let n=i;for(let s=0;s<t;s++)n=$h[(n^e[s])&255]^n>>>8;return n}function hd(i,e){return(od(Bo,i,e)^Bo)>>>0}var $t;(function(i){i[i.UNKNOWN=-1]="UNKNOWN",i[i.GREYSCALE=0]="GREYSCALE",i[i.TRUECOLOUR=2]="TRUECOLOUR",i[i.INDEXED_COLOUR=3]="INDEXED_COLOUR",i[i.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",i[i.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"})($t||($t={}));var hs;(function(i){i[i.UNKNOWN=-1]="UNKNOWN",i[i.DEFLATE=0]="DEFLATE"})(hs||(hs={}));var er;(function(i){i[i.UNKNOWN=-1]="UNKNOWN",i[i.ADAPTIVE=0]="ADAPTIVE"})(er||(er={}));var ir;(function(i){i[i.UNKNOWN=-1]="UNKNOWN",i[i.NO_INTERLACE=0]="NO_INTERLACE",i[i.ADAM7=1]="ADAM7"})(ir||(ir={}));const ud=new Uint8Array(0),$o="\0",cd=new Uint16Array([255]),fd=new Uint8Array(cd.buffer),dd=fd[0]===255;class pd extends Pl{constructor(e,t={}){super(e);const{checkCrc:n=!1}=t;this._checkCrc=n,this._inflator=new rd,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=hs.UNKNOWN,this._filterMethod=er.UNKNOWN,this._interlaceMethod=ir.UNKNOWN,this._colorType=$t.UNKNOWN,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let e=0;e<Zr.length;e++)if(this.readUint8()!==Zr[e])throw new Error(`wrong PNG signature. Byte at ${e} should be ${Zr[e]}.`)}decodeChunk(){const e=this.readUint32(),t=this.readChars(4),n=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case"tEXt":this.decodetEXt(e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e);break}if(this.offset-n!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);if(this._checkCrc){const s=this.readUint32(),a=e+4,l=hd(new Uint8Array(this.buffer,this.byteOffset+this.offset-a-4,a),a);if(l!==s)throw new Error(`CRC mismatch for chunk ${t}. Expected ${s}, found ${l}`)}else this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=xd(this.readUint8());const t=this.readUint8();this._colorType=t;let n;switch(t){case $t.GREYSCALE:n=1;break;case $t.TRUECOLOUR:n=3;break;case $t.INDEXED_COLOUR:n=1;break;case $t.GREYSCALE_ALPHA:n=2;break;case $t.TRUECOLOUR_ALPHA:n=4;break;default:throw new Error(`Unknown color type: ${t}`)}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==hs.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(e){if(e%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);const t=e/3;this._hasPalette=!0;const n=[];this._palette=n;for(let s=0;s<t;s++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,e)),this.skip(e)}decodetRNS(e){switch(this._colorType){case $t.GREYSCALE:case $t.TRUECOLOUR:{if(e%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${e}`);if(e/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${e/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let t=0;t<e/2;t++)this._transparency[t]=this.readUint16();break}case $t.INDEXED_COLOUR:{if(e>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let t=0;for(;t<e;t++){const n=this.readByte();this._palette[t].push(n)}for(;t<this._palette.length;t++)this._palette[t].push(255);break}default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(e){let t="",n;for(;(n=this.readChar())!==$o;)t+=n;const s=this.readUint8();if(s!==hs.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${s}`);const a=this.readBytes(e-t.length-2);this._png.iccEmbeddedProfile={name:t,profile:ld(a)}}decodetEXt(e){let t="",n;for(;(n=this.readChar())!==$o;)t+=n;this._png.text[t]=this.readChars(e-t.length-1)}decodepHYs(){const e=this.readUint32(),t=this.readUint32(),n=this.readByte();this._png.resolution={x:e,y:t,unit:n}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const e=this._inflator.result;if(this._filterMethod!==er.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===ir.NO_INTERLACE)this.decodeInterlaceNull(e);else throw new Error(`Interlace method ${this._interlaceMethod} not supported`)}decodeInterlaceNull(e){const t=this._png.height,n=this._png.channels*this._png.depth/8,s=this._png.width*n,a=new Uint8Array(this._png.height*s);let l=ud,h=0,f,o;for(let c=0;c<t;c++){switch(f=e.subarray(h+1,h+1+s),o=a.subarray(c*s,(c+1)*s),e[h]){case 0:md(f,o,s);break;case 1:gd(f,o,s,n);break;case 2:_d(f,o,l,s);break;case 3:bd(f,o,l,s,n);break;case 4:wd(f,o,l,s,n);break;default:throw new Error(`Unsupported filter: ${e[h]}`)}l=o,h+=s+1}if(this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency),this._png.depth===16){const c=new Uint16Array(a.buffer);if(dd)for(let _=0;_<c.length;_++)c[_]=vd(c[_]);this._png.data=c}else this._png.data=a}}function md(i,e,t){for(let n=0;n<t;n++)e[n]=i[n]}function gd(i,e,t,n){let s=0;for(;s<n;s++)e[s]=i[s];for(;s<t;s++)e[s]=i[s]+e[s-n]&255}function _d(i,e,t,n){let s=0;if(t.length===0)for(;s<n;s++)e[s]=i[s];else for(;s<n;s++)e[s]=i[s]+t[s]&255}function bd(i,e,t,n,s){let a=0;if(t.length===0){for(;a<s;a++)e[a]=i[a];for(;a<n;a++)e[a]=i[a]+(e[a-s]>>1)&255}else{for(;a<s;a++)e[a]=i[a]+(t[a]>>1)&255;for(;a<n;a++)e[a]=i[a]+(e[a-s]+t[a]>>1)&255}}function wd(i,e,t,n,s){let a=0;if(t.length===0){for(;a<s;a++)e[a]=i[a];for(;a<n;a++)e[a]=i[a]+e[a-s]&255}else{for(;a<s;a++)e[a]=i[a]+t[a]&255;for(;a<n;a++)e[a]=i[a]+yd(e[a-s],t[a],t[a-s])&255}}function yd(i,e,t){const n=i+e-t,s=Math.abs(n-i),a=Math.abs(n-e),l=Math.abs(n-t);return s<=a&&s<=l?i:a<=l?e:t}function vd(i){return(i&255)<<8|i>>8&255}function xd(i){if(i!==1&&i!==2&&i!==4&&i!==8&&i!==16)throw new Error(`invalid bit depth: ${i}`);return i}var Lo;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.METRE=1]="METRE"})(Lo||(Lo={}));function Ad(i,e){return new pd(i,e).decode()}var fn,Rs,De;class Kt{static loadFromStorage(){m(this,De,window.localStorage.getItem(r(this,fn))!==r(this,Rs)),N.updateDebugClass(this.enabled)}static get enabled(){return r(this,De)}static set enabled(e){m(this,De,e),z.infoBeetPx(`Debug flag set to: ${r(this,De)}`),N.updateDebugClass(this.enabled),r(this,De)?window.localStorage.removeItem(r(this,fn)):window.localStorage.setItem(r(this,fn),r(this,Rs))}}fn=new WeakMap,Rs=new WeakMap,De=new WeakMap,d(Kt,fn,"beetpx__debug_disabled"),d(Kt,Rs,"yes"),d(Kt,De,!1);var vi;const Lt=class Lt{static debugBeetPx(...e){Lt.debug(r(Lt,vi),...e)}static debug(...e){Kt.enabled&&console.debug(...e.map(t=>t.__printDebug?t.__printDebug():t))}static infoBeetPx(...e){Lt.info(r(Lt,vi),...e)}static info(...e){console.info(...e.map(t=>t.__printDebug?t.__printDebug():t))}static warnBeetPx(...e){Lt.warn(r(Lt,vi),...e)}static warn(...e){console.warn(...e.map(t=>t.__printDebug?t.__printDebug():t))}static errorBeetPx(...e){Lt.error(r(Lt,vi),...e)}static error(...e){console.error(...e.map(t=>t.__printDebug?t.__printDebug():t))}};vi=new WeakMap,d(Lt,vi,"[BeetPx]");let z=Lt;var xi,Ms,Fs,al,Os,rl,Ds,ll,sr,Lh,ar,Gh,rr,Zh,dn,Wa;class Sd{constructor(e,t){d(this,Fs);d(this,Os);d(this,Ds);d(this,sr);d(this,ar);d(this,rr);d(this,dn);d(this,xi,void 0);d(this,Ms,void 0);m(this,xi,e),m(this,Ms,t.decodeAudioData)}async loadAssets(e){const t=e.map(s=>s.trim()).filter(s=>s.length>0),n=t.filter(s=>!u(this,Fs,al).call(this,s)&&!u(this,Os,rl).call(this,s)&&!u(this,Ds,ll).call(this,s));if(n.length>0)throw Error("Assets: following URLs don't look like any of supported formats: "+n.map(s=>`"${s}"`).join(", ")+'. Supported formats are: ".png", ".wav", ".flac", ".json", ".ldtk"');await Promise.all([...t.filter(s=>u(this,Fs,al).call(this,s)).map(s=>u(this,sr,Lh).call(this,s)),...t.filter(s=>u(this,Os,rl).call(this,s)).map(s=>u(this,ar,Gh).call(this,s)),...t.filter(s=>u(this,Ds,ll).call(this,s)).map(s=>u(this,rr,Zh).call(this,s))])}}xi=new WeakMap,Ms=new WeakMap,Fs=new WeakSet,al=function(e){return e.toLowerCase().endsWith(".png")},Os=new WeakSet,rl=function(e){return e.toLowerCase().endsWith(".wav")||e.toLowerCase().endsWith(".flac")},Ds=new WeakSet,ll=function(e){return e.toLowerCase().endsWith(".json")||e.toLowerCase().endsWith(".ldtk")},sr=new WeakSet,Lh=async function(e){z.infoBeetPx(`Assets: loading image "${e}"`);const t=await fetch(e);if(!u(this,dn,Wa).call(this,t.status))throw Error(`Assets: could not fetch PNG file: "${e}"`);const n=await t.arrayBuffer(),s=Ad(n);if(s.channels!==3&&s.channels!==4)throw Error(`Assets: only PNG image files with 3 or 4 channels are supported. The file which seems to have ${s.channels} channels instead: "${e}"`);r(this,xi).addImageAsset(e,{width:s.width,height:s.height,channels:s.channels,rgba8bitData:s.data})},ar=new WeakSet,Gh=async function(e){z.infoBeetPx(`Assets: loading sound "${e}"`);const t=await fetch(e);if(!u(this,dn,Wa).call(this,t.status))throw Error(`Assets: could not fetch sound file: "${e}"`);const n=await t.arrayBuffer(),s=await r(this,Ms).call(this,n);r(this,xi).addSoundAsset(e,{audioBuffer:s})},rr=new WeakSet,Zh=async function(e){z.infoBeetPx(`Assets: loading JSON "${e}"`);const t=await fetch(e);if(!u(this,dn,Wa).call(this,t.status))throw Error(`Assets: could not fetch JSON file: "${e}"`);const n=await t.json();r(this,xi).addJsonAsset(e,{json:n})},dn=new WeakSet,Wa=function(e){return e>=200&&e<300};var Ps,Is,Us;class Ed{constructor(){d(this,Ps,new Map);d(this,Is,new Map);d(this,Us,new Map)}addImageAsset(e,t){r(this,Ps).set(e,t)}addSoundAsset(e,t){r(this,Is).set(e,t)}addJsonAsset(e,t){r(this,Us).set(e,t)}getImageAsset(e){const t=r(this,Ps).get(e);if(!t)throw Error(`Assets: There is no image loaded for: ${e}`);return t}getSoundAsset(e){const t=r(this,Is).get(e);if(!t)throw Error(`Assets: There is no sound loaded for: ${e}`);return t}getJsonAsset(e){const t=r(this,Us).get(e);if(!t)throw Error(`Assets: There is no JSON loaded for: ${e}`);return t}}Ps=new WeakMap,Is=new WeakMap,Us=new WeakMap;function ol(){}var pn,qa;const cs=class cs{static muteGain(e,t,n,s=ol){var a;n=Math.max(0,n),z.debugBeetPx(`AudioHelpers.muteGain (audioContextCurrentTime: ${t}, fadeOutMillis: ${n})`),u(a=cs,pn,qa).call(a,15,100,()=>{n>0?e.gain.setValueCurveAtTime([e.gain.value,0],t,n/1e3):e.gain.setValueAtTime(0,t)}).catch(()=>{}),setTimeout(()=>{s()},n)}static unmuteGain(e,t,n,s=ol){var a;n=Math.max(0,n),z.debugBeetPx(`AudioHelpers.unmuteGain (audioContextCurrentTime: ${t}, fadeInMillis: ${n})`),u(a=cs,pn,qa).call(a,15,100,()=>{n>0?e.gain.setValueCurveAtTime([e.gain.value,1],t,n/1e3):e.gain.setValueAtTime(1,t)}).catch(l=>{}),setTimeout(()=>{s()},n)}};pn=new WeakSet,qa=async function(e,t,n){if(e<=0)return z.warnBeetPx("AudioHelpers.#tryNTimes: Failed to perform the action in N trials."),Promise.reject();try{n()}catch(s){return z.debugBeetPx("AudioHelpers.#tryNTimes: err:",s),new Promise((a,l)=>{z.debugBeetPx(`AudioHelpers.#tryNTimes: Failed to perform the action, trying ${e} more times…`),setTimeout(()=>{u(this,pn,qa).call(this,e-1,t,n).then(a,l)},t)})}},d(cs,pn);let Ce=cs;var jt,Mt,ct,mn,lt,zs,hl,Ns,ul,Bs,cl,$s,fl;const fe=class fe{constructor(e,t,n,s,a){d(this,zs);d(this,Ns);d(this,Bs);d(this,$s);b(this,"onEnded");b(this,"startedAtMs");b(this,"pausedAtMs");b(this,"accumulatedPauseMs");b(this,"isPausedByEngine");b(this,"isPausedByGame");d(this,jt,void 0);d(this,Mt,void 0);d(this,ct,void 0);d(this,mn,void 0);d(this,lt,void 0);s==="pause"?fe.playbacksToPauseOnGamePause.add(this):s==="mute"&&fe.playbacksToMuteOnGamePause.add(this),this.onEnded=()=>{a(),fe.playbacksToPauseOnGamePause.delete(this),fe.playbacksToMuteOnGamePause.delete(this)},m(this,ct,e),m(this,mn,t),m(this,lt,r(this,ct).createGain()),r(this,lt).gain.value=n?0:1,r(this,lt).connect(r(this,mn)),this.isPausedByGame=!1,this.isPausedByEngine=!1,m(this,Mt,n),m(this,jt,!1),this.startedAtMs=r(this,ct).currentTime*1e3,this.pausedAtMs=null,this.accumulatedPauseMs=0}mute(e){z.debugBeetPx(`AudioPlayback.mute (id: ${this.id}, type: ${this.type}, fadeOutMillis: ${e})`),!r(this,Mt)&&(m(this,Mt,!0),!r(this,jt)&&(this.isPausedByGame||this.isPausedByEngine||u(this,zs,hl).call(this,e)))}muteByEngine(){z.debugBeetPx(`AudioPlayback.muteByEngine (id: ${this.id}, type: ${this.type})`),!r(this,jt)&&(m(this,jt,!0),!r(this,Mt)&&(this.isPausedByGame||this.isPausedByEngine||u(this,zs,hl).call(this,yi.muteUnmuteDefaultFadeMillis)))}unmute(e){z.debugBeetPx(`AudioPlayback.unmute (id: ${this.id}, type: ${this.type}, fadeInMillis: ${e})`),r(this,Mt)&&(m(this,Mt,!1),!r(this,jt)&&(this.isPausedByGame||this.isPausedByEngine||u(this,Ns,ul).call(this,e)))}unmuteByEngine(){z.debugBeetPx(`AudioPlayback.unmuteByEngine (id: ${this.id}, type: ${this.type})`),r(this,jt)&&(m(this,jt,!1),!r(this,Mt)&&(this.isPausedByGame||this.isPausedByEngine||u(this,Ns,ul).call(this,yi.muteUnmuteDefaultFadeMillis)))}stop(e){if(z.debugBeetPx(`AudioPlayback.stop (id: ${this.id}, type: ${this.type}, fadeOutMillis: ${e})`),this.isPausedByGame||this.isPausedByEngine){this.onEnded();return}Ce.muteGain(r(this,lt),r(this,ct).currentTime,e,()=>{this.stopAllNodes(),!this.isPausedByGame&&!this.isPausedByEngine&&this.onEnded()})}pause(){z.debugBeetPx(`AudioPlayback.pause (id: ${this.id}, type: ${this.type}})`),!this.isPausedByGame&&(this.isPausedByGame=!0,!this.isPausedByEngine&&u(this,Bs,cl).call(this))}pauseByEngine(){z.debugBeetPx(`AudioPlayback.pauseByEngine (id: ${this.id}, type: ${this.type}})`),!this.isPausedByEngine&&(this.isPausedByEngine=!0,!this.isPausedByGame&&u(this,Bs,cl).call(this))}resume(){z.debugBeetPx(`AudioPlayback.resume (id: ${this.id}, type: ${this.type})`),this.isPausedByGame&&(this.isPausedByGame=!1,!this.isPausedByEngine&&u(this,$s,fl).call(this))}resumeByEngine(){z.debugBeetPx(`AudioPlayback.resumeByEngine (id: ${this.id}, type: ${this.type})`),this.isPausedByEngine&&(this.isPausedByEngine=!1,!this.isPausedByGame&&u(this,$s,fl).call(this))}createSourceNode(){return r(this,ct).createBufferSource()}connectToMainGainNode(e){e.connect(r(this,lt))}disconnectFromOutput(){r(this,lt).disconnect()}};jt=new WeakMap,Mt=new WeakMap,ct=new WeakMap,mn=new WeakMap,lt=new WeakMap,zs=new WeakSet,hl=function(e){Ce.muteGain(r(this,lt),r(this,ct).currentTime,e)},Ns=new WeakSet,ul=function(e){Ce.unmuteGain(r(this,lt),r(this,ct).currentTime,e)},Bs=new WeakSet,cl=function(){this.pausedAtMs=r(this,ct).currentTime*1e3,Ce.muteGain(r(this,lt),r(this,ct).currentTime,yi.muteUnmuteDefaultFadeMillis,()=>{this.stopAllNodes()})},$s=new WeakSet,fl=function(){m(this,lt,r(this,ct).createGain()),r(this,lt).gain.value=r(this,Mt)||this.isPausedByEngine?0:1,r(this,lt).connect(r(this,mn)),this.setupAndStartNodes(),this.pausedAtMs!=null&&(this.accumulatedPauseMs+=r(this,ct).currentTime*1e3-this.pausedAtMs,this.pausedAtMs=null),!r(this,Mt)&&!this.isPausedByEngine&&Ce.unmuteGain(r(this,lt),r(this,ct).currentTime,yi.muteUnmuteDefaultFadeMillis,()=>{})},b(fe,"playbacksToPauseOnGamePause",new Set),b(fe,"playbacksToMuteOnGamePause",new Set),b(fe,"nextPlaybackId",1);let Et=fe;var gn,Ft,Ls;class kd extends Et{constructor(t,n){super(n.audioContext,n.target,n.muteOnStart,n.onGamePause,n.onEnded);b(this,"id",Et.nextPlaybackId++);b(this,"type","looped");d(this,gn,void 0);d(this,Ft,void 0);d(this,Ls,void 0);m(this,gn,n.assets.getSoundAsset(t)),m(this,Ls,r(this,gn).audioBuffer.duration*1e3),m(this,Ft,this.createSourceNode()),this.setupAndStartNodes()}stopAllNodes(){r(this,Ft).stop()}setupAndStartNodes(){this.pausedAtMs!=null&&m(this,Ft,this.createSourceNode()),r(this,Ft).buffer=r(this,gn).audioBuffer,r(this,Ft).loop=!0,this.connectToMainGainNode(r(this,Ft)),r(this,Ft).addEventListener("ended",()=>{r(this,Ft).disconnect(),this.disconnectFromOutput(),!this.isPausedByGame&&!this.isPausedByEngine&&this.onEnded()});const t=this.pausedAtMs?(this.pausedAtMs-this.startedAtMs-this.accumulatedPauseMs)%r(this,Ls):0;r(this,Ft).start(0,t/1e3)}}gn=new WeakMap,Ft=new WeakMap,Ls=new WeakMap;var Gs,Gt;class Cd extends Et{constructor(t,n){super(n.audioContext,n.target,n.muteOnStart,n.onGamePause,n.onEnded);b(this,"id",Et.nextPlaybackId++);b(this,"type","once");d(this,Gs,void 0);d(this,Gt,void 0);m(this,Gs,n.assets.getSoundAsset(t)),m(this,Gt,this.createSourceNode()),this.setupAndStartNodes()}stopAllNodes(){r(this,Gt).stop()}setupAndStartNodes(){this.pausedAtMs!=null&&m(this,Gt,this.createSourceNode()),r(this,Gt).buffer=r(this,Gs).audioBuffer,this.connectToMainGainNode(r(this,Gt)),r(this,Gt).addEventListener("ended",()=>{r(this,Gt).disconnect(),this.disconnectFromOutput(),!this.isPausedByGame&&!this.isPausedByEngine&&this.onEnded()});const t=this.pausedAtMs?this.pausedAtMs-this.startedAtMs-this.accumulatedPauseMs:0;r(this,Gt).start(0,t/1e3)}}Gs=new WeakMap,Gt=new WeakMap;function Td(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var s=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return i[n]}})}),t}var Hr={},Gl=function(e){if(typeof window>"u")return null;var t=window.OfflineAudioContext||window.webkitOfflineAudioContext,n=window.AudioContext||window.webkitAudioContext;if(!n)return null;typeof e=="number"&&(e={sampleRate:e});var s=e&&e.sampleRate;if(e&&e.offline)return t?new t(e.channels||2,e.length,s||44100):null;var a=Hr[s];if(a)return a;try{a=new n(e)}catch{a=new n}return Hr[a.sampleRate]=Hr[s]=a,a},Rd=Gl,Hh=ei;function ei(i,e){if(!(this instanceof ei))return new ei(i,e);if(e||(e=i,i=e&&e.context),e||(e={}),i===void 0&&(i=Rd()),e.numberOfChannels==null&&(e.numberOfChannels=1),e.sampleRate==null&&(e.sampleRate=i&&i.sampleRate||this.sampleRate),e.length==null&&(e.duration!=null?e.length=e.duration*e.sampleRate:e.length=1),i&&i.createBuffer)return i.createBuffer(e.numberOfChannels,Math.ceil(e.length),e.sampleRate);this.length=Math.ceil(e.length),this.numberOfChannels=e.numberOfChannels,this.sampleRate=e.sampleRate,this.duration=this.length/this.sampleRate,this._data=new Float32Array(this.length*this.numberOfChannels),this._channelData=[];for(var t=0;t<this.numberOfChannels;t++)this._channelData.push(this._data.subarray(t*this.length,(t+1)*this.length))}ei.prototype.numberOfChannels=1;ei.prototype.sampleRate=44100;ei.prototype.getChannelData=function(i){if(i>=this.numberOfChannels||i<0||i==null)throw Error("Cannot getChannelData: channel number ("+i+") exceeds number of channels ("+this.numberOfChannels+")");return this._channelData[i]};ei.prototype.copyFromChannel=function(i,e,t){t==null&&(t=0);for(var n=this._channelData[e],s=t,a=0;s<this.length&&a<i.length;s++,a++)i[a]=n[s]};ei.prototype.copyToChannel=function(i,e,t){var n=this._channelData[e];t||(t=0);for(var s=t,a=0;s<this.length&&a<i.length;s++,a++)n[s]=i[a]};var Er=function(e){return e!=null&&typeof e.length=="number"&&typeof e.sampleRate=="number"&&typeof e.getChannelData=="function"&&typeof e.duration=="number"},Md=Fd;function Fd(i,e,t){return e<t?i<e?e:i>t?t:i:i<t?t:i>e?e:i}var Od=Object.prototype.toString,Jh=function(i){var e;return Od.call(i)==="[object Object]"&&(e=Object.getPrototypeOf(i),e===null||e===Object.getPrototypeOf({}))};const Dd={},Pd=Object.freeze(Object.defineProperty({__proto__:null,default:Dd},Symbol.toStringTag,{value:"Module"})),Wh=Td(Pd);/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var Id=function(i){return i!=null&&(qh(i)||Ud(i)||!!i._isBuffer)};function qh(i){return!!i.constructor&&typeof i.constructor.isBuffer=="function"&&i.constructor.isBuffer(i)}function Ud(i){return typeof i.readFloatLE=="function"&&typeof i.slice=="function"&&qh(i.slice(0,0))}const zd={8e3:8e3,11025:11025,16e3:16e3,22050:22050,44100:44100,48e3:48e3,88200:88200,96e3:96e3,176400:176400,192e3:192e3,352800:352800,384e3:384e3};/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var Nd=function(i){return i!=null&&(Yh(i)||Bd(i)||!!i._isBuffer)};function Yh(i){return!!i.constructor&&typeof i.constructor.isBuffer=="function"&&i.constructor.isBuffer(i)}function Bd(i){return typeof i.readFloatLE=="function"&&typeof i.slice=="function"&&Yh(i.slice(0,0))}var Kh=function(e,t,n){var s={},a,l;if(typeof t=="string"&&(t=Go(t)),Array.isArray(t)){var h={};for(l=0;l<t.length;l++)h[t[l]]=!0;t=h}for(a in t)t[a]=Go(t[a]);var f={};for(a in t){var o=t[a];if(Array.isArray(o))for(l=0;l<o.length;l++){var c=o[l];if(n&&(f[c]=!0),c in e){if(s[a]=e[c],n)for(var _=l;_<o.length;_++)f[o[_]]=!0;break}}else a in e&&(t[a]&&(s[a]=e[a]),n&&(f[a]=!0))}if(n)for(a in e)f[a]||(s[a]=e[a]);return s},Jr={};function Go(i){return Jr[i]?Jr[i]:(typeof i=="string"&&(i=Jr[i]=i.split(/\s*,\s*|\s+/)),i)}var Zo=zd,Ho=Wh,$d=Er,Ld=Nd,Gd=Jh,Zd=Kh,Xh={parse:Vh,stringify:Jd,detect:dl,type:tu},jh=Ho.endianness instanceof Function?Ho.endianness().toLowerCase():"le",Jo={uint:"uint32",uint8:"uint8",uint8_clamped:"uint8",uint16:"uint16",uint32:"uint32",int:"int32",int8:"int8",int16:"int16",int32:"int32",float:"float32",float32:"float32",float64:"float64",array:"array",arraybuffer:"arraybuffer",buffer:"buffer",audiobuffer:"audiobuffer",ndarray:"ndarray",ndsamples:"ndsamples"},xs={mono:1,stereo:2,quad:4,"5.1":6,"2.1":3,"3-channel":3,"5-channel":5},Hd=32;for(var La=6;La<Hd;La++)xs[La+"-channel"]=La;var Qh={};for(var Wo in xs)Qh[xs[Wo]]=Wo;function Vh(i){for(var e={},t=i.split(/\s*[,;_]\s*|\s+/),n=0;n<t.length;n++){var s=t[n].toLowerCase();if(s==="planar"&&e.interleaved==null)e.interleaved=!1,e.channels==null&&(e.channels=2);else if((s==="interleave"||s==="interleaved")&&e.interleaved==null)e.interleaved=!0,e.channels==null&&(e.channels=2);else if(xs[s])e.channels=xs[s];else if(s==="le"||s==="LE"||s==="littleendian"||s==="bigEndian")e.endianness="le";else if(s==="be"||s==="BE"||s==="bigendian"||s==="bigEndian")e.endianness="be";else if(Jo[s])e.type=Jo[s],s==="audiobuffer"&&(e.endianness=jh,e.interleaved=!1);else if(Zo[s])e.sampleRate=Zo[s];else if(/^\d+$/.test(s))e.sampleRate=parseInt(s);else throw Error("Cannot identify part `"+s+"`")}return e}function dl(i){if(!i)return{};var e=Zd(i,{channels:"channel channels numberOfChannels channelCount",sampleRate:"sampleRate rate",interleaved:"interleave interleaved",type:"type dtype",endianness:"endianness"});if(i.format&&(e.type="ndsamples"),e.sampleRate==null&&i.format&&i.format.sampleRate&&(e.sampleRate=i.format.sampleRate),i.planar&&(e.interleaved=!1),e.interleaved!=null&&e.channels==null&&(e.channels=2),e.type==null){var t=tu(i);t&&(e.type=t)}return e.type==="audiobuffer"&&(e.endianness=jh,e.interleaved=!1),e}function Jd(i,e){e===void 0?e={endianness:"le"}:e==null?e={}:typeof e=="string"?e=Vh(e):e=dl(e),Gd(i)||(i=dl(i));var t=[];return i.type!=null&&i.type!==e.type&&t.push(i.type||"float32"),i.channels!=null&&i.channels!==e.channels&&t.push(Qh[i.channels]),i.endianness!=null&&i.endianness!==e.endianness&&t.push(i.endianness||"le"),i.interleaved!=null&&i.interleaved!==e.interleaved&&i.type!=="audiobuffer"&&t.push(i.interleaved?"interleaved":"planar"),i.sampleRate!=null&&i.sampleRate!==e.sampleRate&&t.push(i.sampleRate),t.join(" ")}function tu(i){if($d(i))return"audiobuffer";if(Ld(i))return"buffer";if(Array.isArray(i))return"array";if(i instanceof ArrayBuffer)return"arraybuffer";if(i.shape&&i.dtype)return i.format?"ndsamples":"ndarray";if(i instanceof Float32Array)return"float32";if(i instanceof Float64Array)return"float64";if(i instanceof Uint8Array)return"uint8";if(i instanceof Uint8ClampedArray)return"uint8_clamped";if(i instanceof Int8Array)return"int8";if(i instanceof Int16Array)return"int16";if(i instanceof Uint16Array)return"uint16";if(i instanceof Int32Array)return"int32";if(i instanceof Uint32Array)return"uint32"}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var qo=Object.getOwnPropertySymbols,Wd=Object.prototype.hasOwnProperty,qd=Object.prototype.propertyIsEnumerable;function Yd(i){if(i==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(i)}function Kd(){try{if(!Object.assign)return!1;var i=new String("abc");if(i[5]="de",Object.getOwnPropertyNames(i)[0]==="5")return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;var n=Object.getOwnPropertyNames(e).map(function(a){return e[a]});if(n.join("")!=="0123456789")return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach(function(a){s[a]=a}),Object.keys(Object.assign({},s)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var Xd=Kd()?Object.assign:function(i,e){for(var t,n=Yd(i),s,a=1;a<arguments.length;a++){t=Object(arguments[a]);for(var l in t)Wd.call(t,l)&&(n[l]=t[l]);if(qo){s=qo(t);for(var h=0;h<s.length;h++)qd.call(t,s[h])&&(n[s[h]]=t[s[h]])}}return n},Yo=Wh,jd=Id,Me=Xh,Ko=Xd,Qd=Er,Vd=t0;function t0(i,e,t,n){if(Yo(i,"First argument should be data"),Yo(e,"Second argument should be format string or object"),e===t)return i;if(Xo(e))n=e,t=Me.detect(n),e=Me.detect(i);else if(t===void 0&&n===void 0)t=Ga(e),e=Me.detect(i);else if(Xo(t))n=t,t=Ga(e),e=Me.detect(i);else{var s=Ga(e),a=Me.detect(i);a.dtype=s.type==="arraybuffer"?a.type:s.type,e=Ko(s,a);var l=Ga(t),h=Me.detect(n);l.type&&(h.dtype=l.type==="arraybuffer"?h.type||e.dtype:l.type),t=Ko(l,h)}if(t.channels==null&&e.channels!=null&&(t.channels=e.channels),t.type==null&&(t.type=e.type,t.dtype=e.dtype),t.interleaved!=null&&e.channels==null&&(e.channels=2),e.type===t.type&&e.interleaved===t.interleaved&&e.endianness===t.endianness)return i;jo(e),jo(t),(i.buffers||i.buffer&&i.buffer.buffers)&&(i.buffer&&(i=i.buffer),i.buffers&&(i=i.join()));var f;if(Qd(i))if(i._data)f=i._data;else{f=new Float32Array(i.length*i.numberOfChannels);for(var o=0,c=i.numberOfChannels;o<c;o++)f.set(i.getChannelData(o),i.length*o)}else i instanceof ArrayBuffer?f=new Za[e.dtype](i):jd(i)?(i.byteOffset!=null?f=i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength):f=i.buffer,f=new Za[e.dtype](f)):f=i;var _=t.type==="array"?Array.from(f):new Za[t.dtype](f);if(e.max!==t.max)for(var g=e.max-e.min,p=t.max-t.min,y=0,c=f.length;y<c;y++){var I=f[y],F=(I-e.min)/g;I=F*p+t.min,_[y]=Math.max(t.min,Math.min(t.max,I))}if(e.interleaved!=t.interleaved){var C=e.channels,P=Math.floor(f.length/C);e.interleaved&&!t.interleaved?_=_.map(function(W,G,$){var Z=G%P,Bt=~~(G/P);return $[Z*C+Bt]}):!e.interleaved&&t.interleaved&&(_=_.map(function(W,G,$){var Z=~~(G/C),Bt=G%C;return $[Bt*P+Z]}))}if(t.dtype!="array"&&t.dtype!="int8"&&t.dtype!="uint8"&&e.endianness&&t.endianness&&e.endianness!==t.endianness)for(var U=t.endianness==="le",x=new DataView(_.buffer),L=_.BYTES_PER_ELEMENT,B="set"+t.dtype[0].toUpperCase()+t.dtype.slice(1),y=0,c=_.length;y<c;y++)x[B](y*L,_[y],U);if(t.type,n){if(Array.isArray(n))for(var y=0;y<_.length;y++)n[y]=_[y];else if(n instanceof ArrayBuffer){var k=new Za[t.dtype](n);k.set(_),n=k}else n.set(_);_=n}return(t.type==="arraybuffer"||t.type==="buffer")&&(_=_.buffer),_}function Ga(i){return typeof i=="string"?Me.parse(i):Me.detect(i)}function Xo(i){return typeof i!="string"&&(Array.isArray(i)||ArrayBuffer.isView(i)||i instanceof ArrayBuffer)}var Za={uint8:Uint8Array,uint8_clamped:Uint8ClampedArray,uint16:Uint16Array,uint32:Uint32Array,int8:Int8Array,int16:Int16Array,int32:Int32Array,float32:Float32Array,float64:Float64Array,array:Array,arraybuffer:Uint8Array,buffer:Uint8Array},e0={float32:"float32",audiobuffer:"float32",ndsamples:"float32",ndarray:"float32",float64:"float64",buffer:"uint8",arraybuffer:"uint8",uint8:"uint8",uint8_clamped:"uint8",uint16:"uint16",uint32:"uint32",int8:"int8",int16:"int16",int32:"int32",array:"array"};function jo(i){switch(i.dtype||(i.dtype=e0[i.type]||"array"),i.dtype){case"float32":case"float64":case"audiobuffer":case"ndsamples":case"ndarray":i.min=-1,i.max=1;break;case"uint8":i.min=0,i.max=255;break;case"uint16":i.min=0,i.max=65535;break;case"uint32":i.min=0,i.max=4294967295;break;case"int8":i.min=-128,i.max=127;break;case"int16":i.min=-32768,i.max=32767;break;case"int32":i.min=-2147483648,i.max=2147483647;break;default:i.min=-1,i.max=1;break}return i}var i0=function(e){return atob(e)},pl={exports:{}};(function(i,e){(function(t){function n(s,a){if(s instanceof Boolean||typeof s=="boolean"||(a instanceof Object||(a={}),a.hasOwnProperty("allowBlank")&&!a.allowBlank&&s===""))return!1;var l="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+/]{3}=)?";return a.mime&&(l="(data:\\w+\\/[a-zA-Z\\+\\-\\.]+;base64,)?"+l),a.paddingRequired===!1&&(l="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}(==)?|[A-Za-z0-9+\\/]{3}=?)?"),new RegExp("^"+l+"$","gi").test(s)}i.exports&&(e=i.exports=n),e.isBase64=n})()})(pl,pl.exports);var n0=pl.exports,eu=i0,s0=n0,a0=function(e){if(typeof e!="string")throw Error("Argument should be a string");return/^data\:/i.test(e)?r0(e):(s0(e)&&(e=eu(e)),iu(e))};function iu(i){for(var e=new Uint8Array(i.length),t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e.buffer}function r0(i){i=i.replace(/\r?\n/g,"");var e=i.indexOf(",");if(e===-1||e<=4)throw new TypeError("malformed data-URI");for(var t=i.substring(5,e).split(";"),n=!1,s="US-ASCII",a=0;a<t.length;a++)t[a]=="base64"?n=!0:t[a].indexOf("charset=")==0&&(s=t[a].substring(8));var l=unescape(i.substring(e+1));n&&(l=eu(l));var h=iu(l);return h.type=t[0]||"text/plain",h.charset=s,h}var l0=Hh,o0=Er,h0=Jh,u0=Gl,c0=Vd,Qo=Xh,f0=a0,d0=Kh,p0=function i(e,t){var n,s,a,l,h,f,o;if(typeof t=="number"?t={channels:t}:typeof t=="string"?t={format:t}:t===void 0&&(h0(e)?(t=e,e=void 0):t={}),t=d0(t,{format:"format type dtype dataType",channels:"channel channels numberOfChannels channelCount",sampleRate:"sampleRate rate",length:"length size",duration:"duration time"}),a=t.channels,l=t.sampleRate,t.format&&(h=Vo(t.format)),h&&(a&&!h.channels?h.channels=a:h.channels&&!a&&(a=h.channels),!l&&h.sampleRate&&(l=h.sampleRate)),e==null)t.duration!=null?(l||(l=44100),n=l*t.duration):n=t.length;else if(o0(e))if(n=e.length,a==null&&(a=e.numberOfChannels),l==null&&(l=e.sampleRate),e._channelData)s=e._channelData.slice(0,a);else for(s=[],f=0,o=a;f<o;f++)s[f]=e.getChannelData(f);else if(typeof e=="number")n=e;else if(Array.isArray(e)&&(Array.isArray(e[0])||ArrayBuffer.isView(e[0])))for(n=e[0].length,s=[],a||(a=e.length),f=0;f<a;f++)s[f]=e[f]instanceof Float32Array?e[f]:new Float32Array(e[f]);else{if(e.shape&&e.data)return e.shape&&(a=e.shape[1]),!l&&e.format&&(l=e.format.sampleRate),i(e.data,{channels:a,sampleRate:l});for(typeof e=="string"&&(e=f0(e)),h||(h=Vo(e)),a||(a=h.channels||1),e=c0(e,h,"float32 planar"),n=Math.floor(e.length/a),s=[],f=0;f<a;f++)s[f]=e.subarray(f*n,(f+1)*n)}var c=new l0(t.context===null||n===0?null:t.context||u0(),{length:n??1,numberOfChannels:a||1,sampleRate:l||44100});if(s)for(f=0,o=s.length;f<o;f++)c.getChannelData(f).set(s[f]);return c};function Vo(i){return typeof i=="string"?Qo.parse(i):Qo.detect(i)}var nu=Hh,Oa=Er,m0=Md,g0=Gl,_0=p0,b0=function(i){return i===0&&1/i===-1/0},Nt=function(e,t){return e==null?0:b0(e)?t:e<=-t?0:e<0?t+e%t:Math.min(t,e)},Wr,kr={create:qn,copy:Zl,shallow:su,clone:w0,reverse:y0,invert:v0,zero:x0,noise:A0,equal:au,fill:ii,slice:Hl,concat:As,resize:k0,pad:Jl,padLeft:C0,padRight:T0,rotate:R0,shift:M0,normalize:F0,removeStatic:O0,trim:P0,trimLeft:I0,trimRight:U0,mix:z0,size:N0,data:B0,subbuffer:E0,repeat:S0};Object.defineProperty(kr,"context",{get:function(){return Wr||(Wr=g0()),Wr}});var es=kr;function qn(i,e,t){return typeof e=="number"?e={channels:e}:typeof e=="string"?e={format:e}:e||(e={}),t&&(e.sampleRate=t),e.context=kr.context,_0(i,e)}function Zl(i,e,t){V(i),V(e),t=t||0;for(var n=0,s=Math.min(i.numberOfChannels,e.numberOfChannels);n<s;n++)e.getChannelData(n).set(i.getChannelData(n),t);return e}function V(i){if(!Oa(i))throw new Error("Argument should be an AudioBuffer instance.")}function su(i){return V(i),kr.context.createBuffer(i.numberOfChannels,i.length,i.sampleRate)}function w0(i){return Zl(i,su(i))}function y0(i,e,t,n){V(i),!Oa(e)&&e!=null&&(n=t,t=e,e=null),e?(V(e),Zl(i,e)):e=i,t=t==null?0:Nt(t,i.length),n=n==null?i.length:Nt(n,i.length);for(var s=0,a=e.numberOfChannels;s<a;++s)e.getChannelData(s).subarray(t,n).reverse();return e}function v0(i,e,t,n){return!Oa(e)&&e!=null&&(n=t,t=e,e=null),ii(i,e,function(s){return-s},t,n)}function x0(i,e,t,n){return ii(i,e,0,t,n)}function A0(i,e,t,n){return ii(i,e,function(s){return Math.random()*2-1},t,n)}function au(i,e){if(arguments.length>2){for(var t=0,n=arguments.length-1;t<n;t++)if(!au(arguments[t],arguments[t+1]))return!1;return!0}if(V(i),V(e),i.length!==e.length||i.numberOfChannels!==e.numberOfChannels)return!1;for(var s=0;s<i.numberOfChannels;s++)for(var a=i.getChannelData(s),l=e.getChannelData(s),t=0;t<a.length;t++)if(a[t]!==l[t])return!1;return!0}function ii(i,e,t,n,s){if(V(i),!Oa(e)&&e!=null&&(typeof t=="function"||(s=n,n=t,t=e),e=null),e?V(e):e=i,n=n==null?0:Nt(n,i.length),s=s==null?i.length:Nt(s,i.length),t instanceof Function)for(var a=0,l=i.numberOfChannels;a<l;a++)for(var o=i.getChannelData(a),h=e.getChannelData(a),f=n;f<s;f++)h[f]=t.call(i,o[f],f,a,o);else for(var a=0,l=i.numberOfChannels;a<l;a++)for(var h=e.getChannelData(a),f=n;f<s;f++)h[f]=t;return e}function S0(i,e){if(V(i),!e||e<0)return new nu(null,{length:0,numberOfChannels:i.numberOfChannels,sampleRate:i.sampleRate});if(e===1)return i;for(var t=[],n=0;n<e;n++)t.push(i);return As(t)}function Hl(i,e,t){V(i),e=e==null?0:Nt(e,i.length),t=t==null?i.length:Nt(t,i.length);for(var n=[],s=0;s<i.numberOfChannels;s++){var a=i.getChannelData(s);n.push(a.slice(e,t))}return qn(n,i.numberOfChannels,i.sampleRate)}function E0(i,e,t,n){if(V(i),Array.isArray(e)?(n=e,e=0,t=-0):Array.isArray(t)&&(n=t,t=-0),!Array.isArray(n)){n=Array(i.numberOfChannels);for(var s=0;s<i.numberOfChannels;s++)n[s]=s}e=e==null?0:Nt(e,i.length),t=t==null?i.length:Nt(t,i.length);for(var a=[],l=0;l<n.length;l++){var h=n[l],f=i.getChannelData(h);a.push(f.subarray(e,t))}var o=new nu(null,{length:0,sampleRate:i.sampleRate,numberOfChannels:i.numberOfChannels});return o.length=a[0].length,o._data=null,o._channelData=a,o.duration=o.length/o.sampleRate,o}function As(){for(var i=[],e=0,t=arguments.length;e<t;e++){var n=arguments[e];if(Array.isArray(n))for(var s=0;s<n.length;s++)i.push(n[s]);else i.push(n)}for(var a=1,l=0,h=0,e=0;e<i.length;e++){var f=i[e];V(f),l+=f.length,a=Math.max(f.numberOfChannels,a),h=Math.max(f.sampleRate,h)}for(var o=[],c=0;c<a;c++){for(var _=new Float32Array(l),g=0,e=0;e<i.length;e++){var f=i[e];c<f.numberOfChannels&&_.set(f.getChannelData(c),g),g+=f.length}o.push(_)}return qn(o,a,h)}function k0(i,e){return V(i),e<i.length?Hl(i,0,e):As(i,qn(e-i.length,i.numberOfChannels))}function Jl(i,e,t){var n,s;return typeof i=="number"?(n=e,s=i):(n=i,s=e),t=t||0,V(n),s<n.length?n:n===e?As(ii(qn(s-n.length,n.numberOfChannels),t),n):As(n,ii(qn(s-n.length,n.numberOfChannels),t))}function C0(i,e,t){return Jl(e,i,t)}function T0(i,e,t){return Jl(i,e,t)}function R0(i,e){V(i);for(var t=0;t<i.numberOfChannels;t++)for(var n=i.getChannelData(t),s=n.slice(),a=0,l=n.length,h;a<l;a++)h=(e+(e+a<0?l+a:a))%l,n[h]=s[a];return i}function M0(i,e){V(i);for(var t=0;t<i.numberOfChannels;t++){var n=i.getChannelData(t);if(e>0)for(var s=n.length-e;s--;)n[s+e]=n[s];else for(var s=-e,a=n.length-e;s<a;s++)n[s+e]=n[s]||0}return i}function F0(i,e,t,n){Oa(e)||(n=t,t=e,e=null),t=t==null?0:Nt(t,i.length),n=n==null?i.length:Nt(n,i.length);for(var s=0,a=0;a<i.numberOfChannels;a++)for(var l=i.getChannelData(a),h=t;h<n;h++)s=Math.max(Math.abs(l[h]),s);var f=Math.max(1/s,1);return ii(i,e,function(o,c,_){return m0(o*f,-1,1)},t,n)}function O0(i,e,t,n){var s=D0(i,t,n);return ii(i,e,function(a,l,h){return a-s[h]},t,n)}function D0(i,e,t){if(V(i),e=e==null?0:Nt(e,i.length),t=t==null?i.length:Nt(t,i.length),t-e<1)return[];for(var n=[],s=0;s<i.numberOfChannels;s++){for(var a=0,l=i.getChannelData(s),h=e;h<t;h++)a+=l[h];n.push(a/(t-e))}return n}function P0(i,e){return Wl(i,e,!0,!0)}function I0(i,e){return Wl(i,e,!0,!1)}function U0(i,e){return Wl(i,e,!1,!0)}function Wl(i,e,t,n){V(i),e=e==null?0:Math.abs(e);var s,a;if(t){s=i.length;for(var l=0,h=i.numberOfChannels;l<h;l++)for(var f=i.getChannelData(l),o=0;o<f.length&&!(o>s);o++)if(Math.abs(f[o])>e){s=o;break}}else s=0;if(n){a=0;for(var l=0,h=i.numberOfChannels;l<h;l++)for(var f=i.getChannelData(l),o=f.length-1;o>=0&&!(o<a);o--)if(Math.abs(f[o])>e){a=o+1;break}}else a=i.length;return Hl(i,s,a)}function z0(i,e,t,n){V(i),V(e),t==null&&(t=.5);var s=t instanceof Function?t:function(c,_){return c*(1-t)+_*t};n==null?n=0:n<0&&(n+=i.length);for(var a=0;a<i.numberOfChannels;a++)for(var l=i.getChannelData(a),h=e.getChannelData(a),f=n,o=0;f<i.length&&o<e.length;f++,o++)l[f]=s.call(i,l[f],h[o],o,a);return i}function N0(i){return V(i),i.numberOfChannels*i.getChannelData(0).byteLength}function B0(i,e){V(i),e=e||[];for(var t=0;t<i.numberOfChannels;t++)ArrayBuffer.isView(e[t])?e[t].set(i.getChannelData(t)):e[t]=i.getChannelData(t);return e}var _n,Pe,bn,bt,Zs,ml,lr,ru;class $0 extends Et{constructor(t,n){super(n.audioContext,n.target,n.muteOnStart,n.onGamePause,n.onEnded);d(this,Zs);d(this,lr);b(this,"id",Et.nextPlaybackId++);b(this,"type","sequence");d(this,_n,void 0);d(this,Pe,void 0);d(this,bn,void 0);d(this,bt,void 0);const s=t.intro??[],a=t.loop??[];if(s.length+a.length<=0)throw Error("Cannot play an empty sound sequence");const l=s.map(f=>u(this,Zs,ml).call(this,f,n.assets)),h=a.map(f=>u(this,Zs,ml).call(this,f,n.assets));m(this,_n,u(this,lr,ru).call(this,[...l,...h])),m(this,Pe,l.reduce((f,o)=>f+o.durationMs,0)),m(this,bn,h.reduce((f,o)=>f+o.durationMs,0)),m(this,bt,this.createSourceNode()),this.setupAndStartNodes()}stopAllNodes(){r(this,bt).stop()}setupAndStartNodes(){this.pausedAtMs!=null&&m(this,bt,this.createSourceNode()),r(this,bt).buffer=r(this,_n),r(this,bn)>0&&(r(this,bt).loop=!0,r(this,bt).loopStart=r(this,Pe)/1e3,r(this,bt).loopEnd=r(this,_n).duration),this.connectToMainGainNode(r(this,bt)),r(this,bt).addEventListener("ended",()=>{r(this,bt).disconnect(),this.disconnectFromOutput(),!this.isPausedByGame&&!this.isPausedByEngine&&this.onEnded()});let t=this.pausedAtMs?this.pausedAtMs-this.startedAtMs-this.accumulatedPauseMs:0;t>r(this,Pe)&&(t=(t-r(this,Pe))%r(this,bn)+r(this,Pe)),r(this,bt).start(0,t/1e3)}}_n=new WeakMap,Pe=new WeakMap,bn=new WeakMap,bt=new WeakMap,Zs=new WeakSet,ml=function(t,n){if(t.length<1)throw Error("Each intro sequence entry needs at least 1 sound");const[s,...a]=t,l=typeof s!="string"?s.url:s,h=n.getSoundAsset(l).audioBuffer,f=h.duration*1e3,o=typeof s!="string"&&s.durationMs?s.durationMs(f):f,c=es.resize(h,o/1e3*h.sampleRate),_=a.map(g=>typeof g=="string"?{url:g}:g).map(({url:g})=>n.getSoundAsset(g).audioBuffer).map(g=>es.resize(g,o/1e3*g.sampleRate));return{firstBuffer:c,otherBuffers:_,durationMs:o}},lr=new WeakSet,ru=function(t){const n=(a,l)=>Zn(-1,a+l,1),s=t.map(a=>a.otherBuffers.reduce((l,h)=>es.mix(l,h,n),es.clone(a.firstBuffer)));return es.concat(...s)};var wn,Hs,Ai,wt,Ot,ot,ft,or,lu,hr,ou,Js,gl;const rt=class rt{constructor(e,t){d(this,or);d(this,hr);d(this,Js);d(this,Ai,void 0);d(this,wt,void 0);d(this,Ot,void 0);d(this,ot,new Map);d(this,ft,void 0);m(this,Ai,e),m(this,wt,t),m(this,ft,u(this,hr,ou).call(this)),N.updateMutedClass(r(this,ft)),m(this,Ot,r(this,wt).createGain()),r(this,Ot).gain.value=r(this,ft)?0:1,r(this,Ot).connect(r(this,wt).destination)}restart(){u(this,or,lu).call(this),r(this,ot).clear()}async tryToResumeAudioContextSuspendedByBrowserForSecurityReasons(){return z.debugBeetPx("AudioApi.tryToResumeAudioContextSuspendedByBrowserForSecurityReasons"),r(this,wt).state==="running"?(z.debugBeetPx("Audio Context is already running"),Promise.resolve(!0)):r(this,wt).resume().then(()=>(z.debugBeetPx("Audio Context got resumed"),!0)).catch(e=>(z.errorBeetPx(e),!1))}startPlayback(e,t){t??(t={}),t.muteOnStart??(t.muteOnStart=!1),t.onGamePause??(t.onGamePause="pause"),z.debugBeetPx(`AudioApi.startPlayback (muteOnStart: ${t.muteOnStart}, onGamePause: ${t.onGamePause})`);const n=new Cd(e,{assets:r(this,Ai),audioContext:r(this,wt),target:r(this,Ot),muteOnStart:t.muteOnStart,onGamePause:t.onGamePause,onEnded:()=>{z.debugBeetPx(`AudioApi: deleting playback ${n.id}`),r(this,ot).delete(n.id)}});return r(this,ot).set(n.id,n),n.id}startPlaybackLooped(e,t){t??(t={}),t.muteOnStart??(t.muteOnStart=!1),t.onGamePause??(t.onGamePause="pause"),z.debugBeetPx(`AudioApi.startPlaybackLooped (muteOnStart: ${t.muteOnStart}, onGamePause: ${t.onGamePause})`);const n=new kd(e,{assets:r(this,Ai),audioContext:r(this,wt),target:r(this,Ot),muteOnStart:t.muteOnStart,onGamePause:t.onGamePause,onEnded:()=>{z.debugBeetPx(`AudioApi: deleting playback ${n.id}`),r(this,ot).delete(n.id)}});return r(this,ot).set(n.id,n),n.id}startPlaybackSequence(e,t){t??(t={}),t.muteOnStart??(t.muteOnStart=!1),t.onGamePause??(t.onGamePause="pause"),z.debugBeetPx(`AudioApi.startPlaybackSequence (muteOnStart: ${t.muteOnStart}, onGamePause: ${t.onGamePause})`);const n=new $0(e,{assets:r(this,Ai),audioContext:r(this,wt),target:r(this,Ot),muteOnStart:t.muteOnStart,onGamePause:t.onGamePause,onEnded:()=>{z.debugBeetPx(`AudioApi: deleting playback ${n.id}`),r(this,ot).delete(n.id)}});return r(this,ot).set(n.id,n),n.id}isAudioMuted(){return r(this,ft)}muteAudio(e={}){z.debugBeetPx(`AudioApi.muteAudio (fadeOutMillis: ${e.fadeOutMillis})`),!r(this,ft)&&(u(this,Js,gl).call(this,!0),m(this,ft,!0),N.updateMutedClass(r(this,ft)),Ce.muteGain(r(this,Ot),r(this,wt).currentTime,e.fadeOutMillis??rt.muteUnmuteDefaultFadeMillis))}unmuteAudio(e={}){z.debugBeetPx(`AudioApi.unmuteAudio (fadeInMillis: ${e.fadeInMillis})`),r(this,ft)&&(u(this,Js,gl).call(this,!1),m(this,ft,!1),N.updateMutedClass(r(this,ft)),Ce.unmuteGain(r(this,Ot),r(this,wt).currentTime,e.fadeInMillis??rt.muteUnmuteDefaultFadeMillis))}mutePlayback(e,t={}){var n;z.debugBeetPx(`AudioApi.mutePlayback (fadeOutMillis: ${t.fadeOutMillis})`),(n=r(this,ot).get(e))==null||n.mute(t.fadeOutMillis??rt.muteUnmuteDefaultFadeMillis)}unmutePlayback(e,t={}){var n;z.debugBeetPx(`AudioApi.unmutePlayback (fadeInMillis: ${t.fadeInMillis})`),(n=r(this,ot).get(e))==null||n.unmute(t.fadeInMillis??rt.muteUnmuteDefaultFadeMillis)}stopPlayback(e,t={}){var n;z.debugBeetPx(`AudioApi.stopPlayback (fadeOutMillis: ${t.fadeOutMillis})`),(n=r(this,ot).get(e))==null||n.stop(r(this,ft)?0:t.fadeOutMillis??rt.muteUnmuteDefaultFadeMillis)}pausePlayback(e){var t;z.debugBeetPx("AudioApi.pausePlayback"),(t=r(this,ot).get(e))==null||t.pause()}resumePlayback(e){var t;z.debugBeetPx("AudioApi.resumePlayback"),(t=r(this,ot).get(e))==null||t.resume()}getAudioContext(){return r(this,wt)}getGlobalGainNode(){return r(this,Ot)}};wn=new WeakMap,Hs=new WeakMap,Ai=new WeakMap,wt=new WeakMap,Ot=new WeakMap,ot=new WeakMap,ft=new WeakMap,or=new WeakSet,lu=function(e={}){z.debugBeetPx(`AudioApi.#stopAllPlaybacks (fadeOutMillis: ${e.fadeOutMillis})`);for(const t of r(this,ot).values())t.stop(r(this,ft)?0:e.fadeOutMillis??rt.muteUnmuteDefaultFadeMillis)},hr=new WeakSet,ou=function(){return window.localStorage.getItem(r(rt,wn))===r(rt,Hs)},Js=new WeakSet,gl=function(e){e?window.localStorage.setItem(r(rt,wn),r(rt,Hs)):window.localStorage.removeItem(r(rt,wn))},d(rt,wn,"audio_api__muted"),d(rt,Hs,"yes"),b(rt,"muteUnmuteDefaultFadeMillis",100);let yi=rt;class L0{static detect(e){const t=(e==null?void 0:e.toLowerCase())??"";return t.includes("firefox")?t.includes("win64")?"firefox_windows":"firefox_other":t.includes("chrome")?"chromium":t.includes("safari")?"safari":"other"}}function en(i){throw Error(i)}var me,ge,Ie,Ue,yn;class G0{constructor(e){b(this,"canvasSize");d(this,me,void 0);d(this,ge,void 0);d(this,Ie,void 0);d(this,Ue,void 0);d(this,yn,null);this.canvasSize=e.round(),m(this,me,0),m(this,ge,0),m(this,Ie,this.canvasSize.x-1),m(this,Ue,this.canvasSize.y-1)}setClippingRegion(e,t){const n=[D.of(r(this,me),r(this,ge)),D.of(r(this,Ie)-r(this,me)+1,r(this,Ue)-r(this,ge)+1)],[s,a]=D.minMax(e.round(),e.add(t).round());return m(this,me,s.x),m(this,ge,s.y),m(this,Ie,a.x-1),m(this,Ue,a.y-1),n}removeClippingRegion(){return this.setClippingRegion(D.of(0,0),this.canvasSize)}canSetAny(e,t,n,s){return n>=r(this,me)&&s>=r(this,ge)&&e<=r(this,Ie)&&t<=r(this,Ue)}canSetAt(e,t){return e>=r(this,me)&&t>=r(this,ge)&&e<=r(this,Ie)&&t<=r(this,Ue)}takeSnapshot(){m(this,yn,this.newSnapshot())}getMostRecentSnapshot(){return r(this,yn)}render(){m(this,yn,null),this.doRender()}}me=new WeakMap,ge=new WeakMap,Ie=new WeakMap,Ue=new WeakMap,yn=new WeakMap;var _e,Ws;class Z0{constructor(e,t){d(this,_e,void 0);d(this,Ws,void 0);m(this,_e,e),m(this,Ws,t)}getColorAt(e,t){const n=t*r(this,Ws)+e;if(n>=r(this,_e).length/4)throw Error(`index out of bounds: index = ${n}, max allowed index = ${r(this,_e).length/4-1}`);const s=n*4;return Q.of(r(this,_e)[s],r(this,_e)[s+1],r(this,_e)[s+2])}}_e=new WeakMap,Ws=new WeakMap;var vn,ze,xn,Zt,Ht,ur,hu;class H0 extends G0{constructor(t,n,s){super(t);d(this,ur);d(this,vn,void 0);d(this,ze,void 0);d(this,xn,void 0);d(this,Zt,void 0);d(this,Ht,void 0);m(this,vn,t.x*t.y),m(this,ze,n),r(this,ze).style.backgroundColor=s.cssHex,m(this,xn,r(this,ze).getContext("2d",{colorSpace:"srgb",alpha:!0})??en("Was unable to obtain '2d' context from <canvas>")),r(this,xn).imageSmoothingEnabled=!1;const a=document.createElement("canvas").transferControlToOffscreen();a.width=t.x,a.height=t.y,m(this,Zt,a.getContext("2d",{colorSpace:"srgb",alpha:!1})??en("Was unable to obtain '2d' context from OffscreenCanvas")),m(this,Ht,r(this,Zt).createImageData(r(this,Zt).canvas.width,r(this,Zt).canvas.height,{colorSpace:"srgb"})),u(this,ur,hu).call(this)}set(t,n,s){if(n<0||s<0||n>=this.canvasSize.x||s>=this.canvasSize.y)throw Error(`(x,y) index out of bounds: (x,y) = (${n},${s}), bottom bound = (0,0), upper bound = (${this.canvasSize.x-1},${this.canvasSize.y-1})`);const a=s*this.canvasSize.x+n;if(a>=r(this,vn))throw Error(`index out of bounds: index = ${a}, max allowed index = ${r(this,vn)-1}`);const l=a*4;r(this,Ht).data[l]=t.r,r(this,Ht).data[l+1]=t.g,r(this,Ht).data[l+2]=t.b}newSnapshot(){return new Z0(r(this,Ht).data.slice(),this.canvasSize.x)}doRender(){r(this,Zt).putImageData(r(this,Ht),0,0);const t=D.of(r(this,ze).width,r(this,ze).height),n=Math.max(1,Math.min(t.div(this.canvasSize).floor().x,t.div(this.canvasSize).floor().y)),s=t.sub(this.canvasSize.mul(n)).div(2).floor();r(this,xn).drawImage(r(this,Zt).canvas,0,0,r(this,Zt).canvas.width,r(this,Zt).canvas.height,s.x,s.y,n*this.canvasSize.x,n*this.canvasSize.y)}}vn=new WeakMap,ze=new WeakMap,xn=new WeakMap,Zt=new WeakMap,Ht=new WeakMap,ur=new WeakSet,hu=function(){for(let t=3;t<r(this,Ht).data.length;t+=4)r(this,Ht).data[t]=255};var Qt,be,Ne,An,Si,qs,Ei,we,Vt,et,yt,Ys,vt,Rt,ye,ni;const ql=class ql{constructor(e,t){d(this,vt);d(this,ye);d(this,Qt,void 0);d(this,be,void 0);d(this,Ne,void 0);d(this,An,void 0);d(this,Si,void 0);d(this,qs,void 0);d(this,Ei,void 0);d(this,we,void 0);d(this,Vt,void 0);d(this,et,void 0);d(this,yt,void 0);d(this,Ys,void 0);m(this,qs,t.onGamePause==="ignore"),m(this,Ei,t.onGamePause),m(this,Qt,[...e.intro,...e.loop].map(n=>({name:n[0],frames:Math.max(0,Math.round(n[1]))}))),m(this,be,e.loop.map(n=>({name:n[0],frames:Math.max(0,Math.round(n[1]))}))),m(this,Ne,r(this,Qt).reduce((n,s)=>n+s.frames,0)),m(this,An,r(this,be).reduce((n,s)=>n+s.frames,0)),m(this,Si,r(this,ye,ni)+t.delayFrames),m(this,et,us.for({frames:r(this,Ne),loop:!1,pause:t.pause,delayFrames:t.delayFrames,onGamePause:r(this,Ei)})),m(this,yt,r(this,be).length>0?us.for({frames:r(this,An),loop:!0,pause:t.pause,delayFrames:t.delayFrames+r(this,Ne),onGamePause:r(this,Ei)}):null),m(this,we,!1),m(this,Vt,null),t.pause&&this.pause()}static of(e,t){return new ql(e,t)}get justFinishedPhase(){return this.hasJustFinishedOverall||r(this,vt,Rt).t===0?r(this,vt,Rt).recentlyFinishedPhase:null}get currentPhase(){var e;return((e=r(this,vt,Rt).phase)==null?void 0:e.name)??null}get t(){return r(this,vt,Rt).t}get progress(){return r(this,vt,Rt).phase&&r(this,vt,Rt).phase.frames>0?r(this,vt,Rt).t/r(this,vt,Rt).phase.frames:1}get framesLeft(){return r(this,vt,Rt).phase?r(this,vt,Rt).phase.frames-r(this,vt,Rt).t:0}get tOverall(){var e;return r(this,et).hasFinished?((e=r(this,yt))==null?void 0:e.t)??r(this,et).t:r(this,et).t}get framesLeftOverall(){var e;return r(this,et).hasFinished?((e=r(this,yt))==null?void 0:e.framesLeft)??r(this,et).framesLeft:r(this,et).framesLeft}get progressOverall(){var e;return r(this,et).hasFinished?((e=r(this,yt))==null?void 0:e.progress)??r(this,et).progress:r(this,et).progress}get hasFinishedOverall(){return r(this,et).hasFinished}get hasJustFinishedOverall(){var e;return((e=r(this,yt))==null?void 0:e.hasJustFinished)||r(this,et).hasJustFinished}pause(){var e;r(this,we)||(m(this,we,!0),m(this,Vt,r(this,ye,ni)),r(this,et).pause(),(e=r(this,yt))==null||e.pause())}resume(){var e;r(this,we)&&(m(this,we,!1),m(this,Si,r(this,Si)+(r(this,ye,ni)-(r(this,Vt)??0))),m(this,Vt,null),r(this,et).resume(),(e=r(this,yt))==null||e.resume())}restart(){m(this,Si,r(this,ye,ni)),m(this,we,!1),m(this,Vt,null),r(this,et).restart(),r(this,yt)&&m(this,yt,us.for({frames:r(this,An),loop:!0,pause:!1,delayFrames:r(this,Ne),onGamePause:r(this,Ei)}))}};Qt=new WeakMap,be=new WeakMap,Ne=new WeakMap,An=new WeakMap,Si=new WeakMap,qs=new WeakMap,Ei=new WeakMap,we=new WeakMap,Vt=new WeakMap,et=new WeakMap,yt=new WeakMap,Ys=new WeakMap,vt=new WeakSet,Rt=function(){var l;if(((l=r(this,Ys))==null?void 0:l.frameNumber)===(r(this,Vt)??r(this,ye,ni)))return r(this,Ys).value;if(!r(this,yt)||(r(this,Vt)??r(this,ye,ni))<r(this,Si)+r(this,Ne)){const h=r(this,et).t;let f=0,o=null,c=0;for(;c<r(this,Qt).length-1;){let g=r(this,Qt)[c];if(h<f+g.frames)return{recentlyFinishedPhase:(o==null?void 0:o.name)??null,phase:g,t:h-f};f+=g.frames,o=g,c+=1}let _=r(this,Qt)[c]??null;return{recentlyFinishedPhase:r(this,et).hasJustFinished?(_==null?void 0:_.name)??null:(o==null?void 0:o.name)??null,phase:_,t:h-f}}const e=r(this,yt).t;let t=0,n=r(this,Qt)[r(this,Qt).length-1]??null,s=0;for(;s<r(this,be).length-1;){let h=r(this,be)[s];if(e<t+h.frames)return{recentlyFinishedPhase:(n==null?void 0:n.name)??null,phase:h,t:e-t};t+=h.frames,n=h,s+=1}let a=r(this,be)[s]??null;return{recentlyFinishedPhase:(n==null?void 0:n.name)??null,phase:a,t:e-t}},ye=new WeakSet,ni=function(){return r(this,qs)?Tt.frameNumber:Tt.frameNumberOutsidePause};let _l=ql;function Da(i,e){return i instanceof as?as.basedOn(i,e??Dl):as.of(i)}const Yn=Da(new ja),uu=Da(new Eu),cu=Da(new ku);function he(i,e,t){return typeof i=="string"?Q.fromCssHex(i):Q.of(i,e??0,t??0)}const J0=he("#000000"),W0=he("#ffffff");he("#ff0000");he("#00ff00");he("#0000ff");he("#00ffff");he("#ff00ff");he("#ffff00");const pt=it;function fu(i){return(e,t,n,s)=>ds.from(i,e,t,n,s)}function q0(i,e){return _l.of({intro:i.intro??[],loop:i.loop??[]},{pause:(e==null?void 0:e.pause)??!1,delayFrames:(e==null?void 0:e.delayFrames)??0,onGamePause:(e==null?void 0:e.onGamePause)??"pause"})}function q(i,e){return D.of(i,e??i)}const Kn=q(0,0),Ha=q(1,1);var Be,Ks,Sn,Xs,js,$e,Le,Ge;class Y0{constructor(e,t,n){d(this,Be,void 0);d(this,Ks,void 0);d(this,Sn,void 0);d(this,Xs,void 0);d(this,js,void 0);d(this,$e,void 0);d(this,Le,void 0);d(this,Ge,void 0);m(this,Be,e),m(this,Ks,n.color??pt.orange),m(this,Sn,t);const s=n.placement??"top-right";m(this,js,s.endsWith("-left")),m(this,Xs,s.startsWith("top-")),m(this,$e,Array.from({length:15},()=>0)),m(this,Le,0),m(this,Ge,0)}drawRenderingFps(e){if(r(this,$e)[r(this,Le)]=e,m(this,Le,gi(r(this,Le)+1,r(this,$e).length)),r(this,Le)===0){m(this,Ge,0);for(const a of r(this,$e))m(this,Ge,r(this,Ge)+a);m(this,Ge,r(this,Ge)/r(this,$e).length)}const t=r(this,Be).useFont(Yn),n=r(this,Ge).toFixed(),s=at.measureText(n).wh;r(this,Be).drawText(n,r(this,Be).cameraXy.add(r(this,js)?1:r(this,Sn).x-s.x-1,r(this,Xs)?1:r(this,Sn).y-s.y-1),r(this,Ks)),r(this,Be).useFont(t)}}Be=new WeakMap,Ks=new WeakMap,Sn=new WeakMap,Xs=new WeakMap,js=new WeakMap,$e=new WeakMap,Le=new WeakMap,Ge=new WeakMap;var En;const cr=class cr{static get active(){return r(cr,En)}static set active(e){m(this,En,e),z.infoBeetPx(`FrameByFrame flag set to: ${r(this,En)}`)}};En=new WeakMap,d(cr,En,!1);let si=cr;var ki;class K0{constructor(e){d(this,ki,void 0);m(this,ki,e)}draw(e){for(let t=0;t<r(this,ki).canvasSize.x;++t)for(let n=0;n<r(this,ki).canvasSize.y;++n)r(this,ki).set(e,t,n)}}ki=new WeakMap;var dt,j,tt;class X0{constructor(e){d(this,j);d(this,dt,void 0);m(this,dt,e)}draw(e,t,n,s,a){const[l,h]=D.minMax(e.round(),e.add(t).round());if(h.x-l.x<=0||h.y-l.y<=0||!r(this,dt).canSetAny(l.x,l.y,h.x-1,h.y-1))return;const f=n.type==="pattern"?n.primary:n,o=n.type==="pattern"?n.secondary:null,c=(f==null?void 0:f.type)==="canvas_snapshot_mapping"?r(this,dt).getMostRecentSnapshot():null,_=a;let g=h.x-l.x-1,p=h.y-l.y-1,y=p&1,I=l.x,F=h.x-1,C=l.y+Math.floor((p+1)/2),P=C-y,U=4*(1-g)*p*p,x=4*(y+1)*g*g,L=U+x+y*g*g;g=8*g*g,y=8*p*p;do{if(u(this,j,tt).call(this,I,P,f,o,_,c),u(this,j,tt).call(this,F,P,f,o,_,c),u(this,j,tt).call(this,F,C,f,o,_,c),u(this,j,tt).call(this,I,C,f,o,_,c),s==="inside")for(let k=I+1;k<F;++k)u(this,j,tt).call(this,k,P,f,o,_,c),u(this,j,tt).call(this,k,C,f,o,_,c);else if(s==="outside"){for(let k=0;k<I;++k)u(this,j,tt).call(this,k,P,f,o,_,c),u(this,j,tt).call(this,k,C,f,o,_,c);for(let k=F+1;k<r(this,dt).canvasSize.x;++k)u(this,j,tt).call(this,k,P,f,o,_,c),u(this,j,tt).call(this,k,C,f,o,_,c)}const B=L;2*B<=x&&(C+=1,P-=1,x+=g,L+=x),(2*B>=U||2*L>x)&&(I+=1,F-=1,U+=y,L+=U)}while(I<=F);for(;C-P<=p;){if(u(this,j,tt).call(this,I-1,C,f,o,_,c),u(this,j,tt).call(this,F+1,C,f,o,_,c),s==="outside"){for(let B=0;B<I-1;++B)u(this,j,tt).call(this,B,C,f,o,_,c);for(let B=F+2;B<r(this,dt).canvasSize.x;++B)u(this,j,tt).call(this,B,C,f,o,_,c)}if(C+=1,u(this,j,tt).call(this,I-1,P,f,o,_,c),u(this,j,tt).call(this,F+1,P,f,o,_,c),s==="outside"){for(let B=0;B<I-1;++B)u(this,j,tt).call(this,B,P,f,o,_,c);for(let B=F+2;B<r(this,dt).canvasSize.x;++B)u(this,j,tt).call(this,B,P,f,o,_,c)}P-=1}if(s==="outside")for(let B=0;B<r(this,dt).canvasSize.x;++B){for(let k=0;k<P+1;++k)u(this,j,tt).call(this,B,k,f,o,_,c);for(let k=C;k<r(this,dt).canvasSize.y;++k)u(this,j,tt).call(this,B,k,f,o,_,c)}}}dt=new WeakMap,j=new WeakSet,tt=function(e,t,n,s,a,l){if(r(this,dt).canSetAt(e,t))if(a.hasPrimaryColorAt(e,t)){if(n)if(n.type==="rgb")r(this,dt).set(n,e,t);else{const h=n.getMappedColor(l,e,t);h&&r(this,dt).set(h,e,t)}}else s!=null&&r(this,dt).set(s,e,t)};var ve,fr,du;class j0{constructor(e){d(this,fr);d(this,ve,void 0);m(this,ve,e)}draw(e,t,n,s){const a=e.round(),l=e.add(t).round();if(l.x-a.x===0||l.y-a.y===0)return;t=l.sub(a);const h=t.sub(t.sign()),f=n.type==="pattern"?n.primary:n,o=n.type==="pattern"?n.secondary:null,c=(f==null?void 0:f.type)==="canvas_snapshot_mapping"?r(this,ve).getMostRecentSnapshot():null,_=s;let g=h.abs().mul(q(1,-1)),p=a;const y=a.add(h),I=h.sign();let F=g.x+g.y;for(;u(this,fr,du).call(this,p.x,p.y,f,o,_,c),!p.eq(y);){const C=F;2*C>=g.y&&(p=p.add(q(I.x,0)),F+=g.y),2*C<=g.x&&(p=p.add(q(0,I.y)),F+=g.x)}}}ve=new WeakMap,fr=new WeakSet,du=function(e,t,n,s,a,l){if(r(this,ve).canSetAt(e,t))if(a.hasPrimaryColorAt(e,t)){if(n)if(n.type==="rgb")r(this,ve).set(n,e,t);else{const h=n.getMappedColor(l,e,t);h&&r(this,ve).set(h,e,t)}}else s!=null&&r(this,ve).set(s,e,t)};var kn;class Q0{constructor(e){d(this,kn,void 0);m(this,kn,e)}draw(e,t,n){e=e.round(),r(this,kn).canSetAt(e.x,e.y)&&n.hasPrimaryColorAt(e.x,e.y)&&r(this,kn).set(t,e.x,e.y)}}kn=new WeakMap;var Cn,Qs;class pu{constructor(e,t={}){d(this,Cn,void 0);d(this,Qs,void 0);m(this,Cn,e),m(this,Qs,t)}draw(e,t,n,s,a,l){t=r(this,Qs).disableRounding?t:t.round(),s=D.max(s.floor(),Kn);for(let h=0;h<e.asciiRows.length;h+=1){const f=t.y+(a[1]?e.size.y-1-h:h)*s.y;for(let o=0;o<e.asciiRows[h].length;o+=1){const c=t.x+(a[0]?e.size.x-1-o:o)*s.x;if(e.asciiRows[h][o]==="#")for(let _=0;_<s.y;++_)for(let g=0;g<s.x;++g){const p=f+_,y=c+g;l.hasPrimaryColorAt(y,p)&&r(this,Cn).canSetAt(y,p)&&r(this,Cn).set(n,y,p)}}}}}Cn=new WeakMap,Qs=new WeakMap;var xt,ht,gt;class V0{constructor(e){d(this,ht);d(this,xt,void 0);m(this,xt,e)}draw(e,t,n,s,a){const[l,h]=D.minMax(e.round(),e.add(t).round());if(!r(this,xt).canSetAny(l.x,l.y,h.x-1,h.y-1))return;const f=n.type==="pattern"?n.primary:n,o=n.type==="pattern"?n.secondary:null,c=(f==null?void 0:f.type)==="canvas_snapshot_mapping"?r(this,xt).getMostRecentSnapshot():null,_=a;for(let g=l.x;g<h.x;g+=1)u(this,ht,gt).call(this,g,l.y,f,o,_,c),u(this,ht,gt).call(this,g,h.y-1,f,o,_,c);for(let g=l.y+1;g<h.y-1;g+=1)u(this,ht,gt).call(this,l.x,g,f,o,_,c),u(this,ht,gt).call(this,h.x-1,g,f,o,_,c);if(s==="inside")for(let g=l.x;g<h.x;g+=1)for(let p=l.y+1;p<h.y-1;p+=1)u(this,ht,gt).call(this,g,p,f,o,_,c);else if(s==="outside"){for(let g=0;g<l.x;g+=1){for(let p=0;p<l.y;p+=1)u(this,ht,gt).call(this,g,p,f,o,_,c);for(let p=l.y;p<h.y;p+=1)u(this,ht,gt).call(this,g,p,f,o,_,c);for(let p=h.y;p<r(this,xt).canvasSize.y;p+=1)u(this,ht,gt).call(this,g,p,f,o,_,c)}for(let g=l.x;g<h.x;g+=1)for(let p=0;p<l.y;p+=1)u(this,ht,gt).call(this,g,p,f,o,_,c);for(let g=l.x;g<h.x;g+=1)for(let p=h.y;p<r(this,xt).canvasSize.y;p+=1)u(this,ht,gt).call(this,g,p,f,o,_,c);for(let g=h.x;g<r(this,xt).canvasSize.x;g+=1){for(let p=0;p<l.y;p+=1)u(this,ht,gt).call(this,g,p,f,o,_,c);for(let p=l.y;p<h.y;p+=1)u(this,ht,gt).call(this,g,p,f,o,_,c);for(let p=h.y;p<r(this,xt).canvasSize.y;p+=1)u(this,ht,gt).call(this,g,p,f,o,_,c)}}}}xt=new WeakMap,ht=new WeakSet,gt=function(e,t,n,s,a,l){if(r(this,xt).canSetAt(e,t))if(a.hasPrimaryColorAt(e,t)){if(n)if(n.type==="rgb")r(this,xt).set(n,e,t);else{const h=n.getMappedColor(l,e,t);h&&r(this,xt).set(h,e,t)}}else s!=null&&r(this,xt).set(s,e,t)};var Tn;class tp{constructor(){d(this,Tn,new Map)}prepareOrGetFromCache(e,t,n,s){const a=e.imageUrl+"::"+e.xy.x.toString()+":"+e.xy.y.toString()+":"+e.size.x.toString()+":"+e.size.y.toString();if(r(this,Tn).has(a))return r(this,Tn).get(a);const l=e.size.x,h=e.size.y,f=Xa(l).map(()=>Xa(h).map(()=>null));for(let c=0;c<h;++c){const _=e.xy.y+c;for(let g=0;g<l;++g){const p=e.xy.x+g,y=(_*n+p)*s;f[g][c]=s===3||t[y+3]>=255/2?he(t[y],t[y+1],t[y+2]):null}}const o={w:e.size.x,h:e.size.y,colors:f,cacheHit:!0};return r(this,Tn).set(a,o),{...o,cacheHit:!1}}}Tn=new WeakMap;var dr,Ci,Vs;class mu{constructor(e,t={}){d(this,dr,new tp);d(this,Ci,void 0);d(this,Vs,void 0);m(this,Ci,e),m(this,Vs,t)}draw(e,t,n,s,a,l,h){n=r(this,Vs).disableRounding?n:n.round(),s=D.max(s.floor(),Kn);const{width:f,height:o,channels:c,rgba8bitData:_}=t;if(e=e.clipBy(Kn,q(f,o)),!r(this,Ci).canSetAny(n.x,n.y,n.x+e.size.x*s.x-1,n.y+e.size.y*s.y-1))return;const g=r(this,dr).prepareOrGetFromCache(e,_,f,c);for(let p=0;p<g.h;p+=1){const y=n.y+(a[1]?e.size.y-1-p:p)*s.y;for(let I=0;I<g.w;I+=1){const F=n.x+(a[0]?e.size.x-1-I:I)*s.x;for(let C=0;C<s.y;++C)for(let P=0;P<s.x;++P){const U=F+P,x=y+C;if(r(this,Ci).canSetAt(U,x)&&h.hasPrimaryColorAt(U,x)){const L=g.colors[I][p];if(L){const B=l.getMappedColor(L,I,p);B&&r(this,Ci).set(B,U,x)}}}}}}}dr=new WeakMap,Ci=new WeakMap,Vs=new WeakMap;var Rn,ta,ea,ia;class ep{constructor(e,t){d(this,Rn,void 0);d(this,ta,void 0);d(this,ea,void 0);d(this,ia,void 0);m(this,Rn,e),m(this,ta,t),m(this,ea,new mu(r(this,Rn),{disableRounding:!0})),m(this,ia,new pu(r(this,Rn),{disableRounding:!0}))}draw(e,t,n,s,a,l,h){n=n.round(),l=D.max(l.floor(),Kn);for(const f of t.arrangeGlyphsFor(e,s,a)){if(f.type==="line_break")continue;const o=n.add(f.leftTop.mul(l));f.type==="sprite"?r(this,ea).draw(f.sprite,r(this,ta).getImageAsset(f.sprite.imageUrl),o,l,[!1,!1],f.spriteColorMapping,h):f.type==="pixels"?r(this,ia).draw(f.pixels,o,f.color,l,[!1,!1],h):Ol()}}}Rn=new WeakMap,ta=new WeakMap,ea=new WeakMap,ia=new WeakMap;var na,Ti,sa,aa,ra,la,Ri,Mi,oa,ha,ut,Mn,te,Fi;class ip{constructor(e){d(this,na,void 0);d(this,Ti,void 0);d(this,sa,void 0);d(this,aa,void 0);d(this,ra,void 0);d(this,la,void 0);d(this,Ri,void 0);d(this,Mi,void 0);d(this,oa,void 0);d(this,ha,void 0);b(this,"cameraXy",q(0,0));d(this,ut,Yr.primaryOnly);d(this,Mn,Ka.noMapping);d(this,te,Yn);d(this,Fi,{});m(this,na,e.assets),m(this,Ti,e.canvas),m(this,sa,new K0(e.canvas)),m(this,aa,new Q0(e.canvas)),m(this,ra,new pu(e.canvas)),m(this,la,new j0(e.canvas)),m(this,Ri,new V0(e.canvas)),m(this,Mi,new X0(e.canvas)),m(this,oa,new mu(e.canvas)),m(this,ha,new ep(e.canvas,e.assets))}clearCanvas(e){r(this,sa).draw(e)}setClippingRegion(e,t){return r(this,Ti).setClippingRegion(e,t)}removeClippingRegion(){return r(this,Ti).removeClippingRegion()}setCameraXy(e){const t=this.cameraXy;return this.cameraXy=e,t}setDrawingPattern(e){const t=r(this,ut);return m(this,ut,e),t}drawPixel(e,t){r(this,aa).draw(e.sub(this.cameraXy),t,r(this,ut))}drawPixels(e,t,n,s){var l,h;const a=(s==null?void 0:s.centerXy)??[!1,!1];(a[0]||a[1])&&(t=t.sub(a[0]?e.size.x*(((l=s==null?void 0:s.scaleXy)==null?void 0:l.x)??1)/2:0,a[1]?e.size.y*(((h=s==null?void 0:s.scaleXy)==null?void 0:h.y)??1)/2:0)),r(this,ra).draw(e,t.sub(this.cameraXy),n,(s==null?void 0:s.scaleXy)??Ha,(s==null?void 0:s.flipXy)??[!1,!1],r(this,ut))}drawLine(e,t,n){r(this,la).draw(e.sub(this.cameraXy),t,n,r(this,ut))}drawRect(e,t,n){r(this,Ri).draw(e.sub(this.cameraXy),t,n,"none",r(this,ut))}drawRectFilled(e,t,n){r(this,Ri).draw(e.sub(this.cameraXy),t,n,"inside",r(this,ut))}drawRectOutsideFilled(e,t,n){r(this,Ri).draw(e.sub(this.cameraXy),t,n,"outside",r(this,ut))}drawEllipse(e,t,n){r(this,Mi).draw(e.sub(this.cameraXy),t,n,"none",r(this,ut))}drawEllipseFilled(e,t,n){r(this,Mi).draw(e.sub(this.cameraXy),t,n,"inside",r(this,ut))}drawEllipseOutsideFilled(e,t,n){r(this,Mi).draw(e.sub(this.cameraXy),t,n,"outside",r(this,ut))}setSpriteColorMapping(e){const t=r(this,Mn);return m(this,Mn,e),t}drawSprite(e,t,n){var l,h;const s=(n==null?void 0:n.centerXy)??[!1,!1];(s[0]||s[1])&&(t=t.sub(s[0]?e.size.x*(((l=n==null?void 0:n.scaleXy)==null?void 0:l.x)??1)/2:0,s[1]?e.size.y*(((h=n==null?void 0:n.scaleXy)==null?void 0:h.y)??1)/2:0));const a=r(this,na).getImageAsset(e.imageUrl);r(this,oa).draw(e.type==="static"?e:e.current,a,t.sub(this.cameraXy),(n==null?void 0:n.scaleXy)??Ha,(n==null?void 0:n.flipXy)??[!1,!1],r(this,Mn),r(this,ut))}useFont(e){const t=r(this,te);return m(this,te,e),t}setTextColorMarkers(e){const t=r(this,Fi);return m(this,Fi,e),t}measureText(e,t){var h,f;let n=0,s=0;for(const o of r(this,te).arrangeGlyphsFor(e,W0,r(this,Fi)))o.type==="line_break"?n=Math.max(n,o.lineNumber+1):(n=Math.max(n,o.lineNumber),s=Math.max(s,o.leftTop.x+(o.type==="sprite"?o.sprite.size.x:o.pixels.size.x)));const a=q(s,(n+1)*(r(this,te).ascent+r(this,te).descent)+n*r(this,te).lineGap).mul((t==null?void 0:t.scaleXy)??Ha),l=q((h=t==null?void 0:t.centerXy)!=null&&h[0]?-a.x/2:0,(f=t==null?void 0:t.centerXy)!=null&&f[1]?-a.y/2:0);return{wh:a,offset:l}}drawText(e,t,n,s){const a=(s==null?void 0:s.centerXy)??[!1,!1];if(a[0]||a[1]){const{offset:l}=this.measureText(e,{scaleXy:s==null?void 0:s.scaleXy,centerXy:s==null?void 0:s.centerXy});t=t.add(l)}r(this,ha).draw(e,r(this,te),t.sub(this.cameraXy),n,r(this,Fi),(s==null?void 0:s.scaleXy)??Ha,r(this,ut))}takeCanvasSnapshot(){return r(this,Ti).takeSnapshot()}}na=new WeakMap,Ti=new WeakMap,sa=new WeakMap,aa=new WeakMap,ra=new WeakMap,la=new WeakMap,Ri=new WeakMap,Mi=new WeakMap,oa=new WeakMap,ha=new WeakMap,ut=new WeakMap,Mn=new WeakMap,te=new WeakMap,Fi=new WeakMap;var Ze,Oi,Di,Pi,Ii,Fn,Ya;class It{constructor(){d(this,Fn);d(this,Ze,!1);d(this,Oi,!1);d(this,Di,null);d(this,Pi,null);d(this,Ii,null)}setRepeating(e){m(this,Di,e.firstRepeatFrames),m(this,Pi,e.loopedRepeatFrames)}get isPressed(){return r(this,Ze)}get wasJustPressed(){var e;return r(this,Oi)&&r(this,Ze)||r(this,Fn,Ya)&&((e=r(this,Ii))==null?void 0:e.justFinishedPhase)!=null}get wasJustReleased(){var e;return r(this,Oi)&&!r(this,Ze)||r(this,Fn,Ya)&&((e=r(this,Ii))==null?void 0:e.justFinishedPhase)!=null}update(e){e?r(this,Oi)&&r(this,Fn,Ya)&&m(this,Ii,q0({intro:r(this,Di)?[["first",r(this,Di)]]:void 0,loop:r(this,Pi)?[["looped",r(this,Pi)]]:void 0},{onGamePause:"ignore"})):m(this,Ii,null),m(this,Oi,r(this,Ze)!==e),m(this,Ze,e)}}Ze=new WeakMap,Oi=new WeakMap,Di=new WeakMap,Pi=new WeakMap,Ii=new WeakMap,Fn=new WeakSet,Ya=function(){return r(this,Di)!=null||r(this,Pi)!=null};var Jt,Wt,qt,Yt,ee,ie,ne;class np{constructor(){d(this,Jt,new It);d(this,Wt,new It);d(this,qt,new It);d(this,Yt,new It);d(this,ee,new It);d(this,ie,new It);d(this,ne,new It)}update(e){r(this,Jt).update(e.has("button_left")),r(this,Wt).update(e.has("button_right")),r(this,qt).update(e.has("button_up")),r(this,Yt).update(e.has("button_down")),r(this,ee).update(e.has("button_a")),r(this,ie).update(e.has("button_b")),r(this,ne).update(e.has("button_menu"))}isAnyPressed(){return r(this,Jt).isPressed||r(this,Wt).isPressed||r(this,qt).isPressed||r(this,Yt).isPressed||r(this,ee).isPressed||r(this,ie).isPressed||r(this,ne).isPressed}isPressed(e){switch(e){case"left":return r(this,Jt).isPressed;case"right":return r(this,Wt).isPressed;case"up":return r(this,qt).isPressed;case"down":return r(this,Yt).isPressed;case"a":return r(this,ee).isPressed;case"b":return r(this,ie).isPressed;case"menu":return r(this,ne).isPressed}}getPressedDirection(){return q((r(this,Jt).isPressed?-1:0)+(r(this,Wt).isPressed?1:0),(r(this,qt).isPressed?-1:0)+(r(this,Yt).isPressed?1:0))}setButtonRepeating(e,t){switch(e){case"left":r(this,Jt).setRepeating(t);return;case"right":r(this,Wt).setRepeating(t);return;case"up":r(this,qt).setRepeating(t);return;case"down":r(this,Yt).setRepeating(t);return;case"a":r(this,ee).setRepeating(t);return;case"b":r(this,ie).setRepeating(t);return;case"menu":r(this,ne).setRepeating(t);return}}wasAnyJustPressed(){return r(this,Jt).wasJustPressed||r(this,Wt).wasJustPressed||r(this,qt).wasJustPressed||r(this,Yt).wasJustPressed||r(this,ee).wasJustPressed||r(this,ie).wasJustPressed||r(this,ne).wasJustPressed}wasJustPressed(e){switch(e){case"left":return r(this,Jt).wasJustPressed;case"right":return r(this,Wt).wasJustPressed;case"up":return r(this,qt).wasJustPressed;case"down":return r(this,Yt).wasJustPressed;case"a":return r(this,ee).wasJustPressed;case"b":return r(this,ie).wasJustPressed;case"menu":return r(this,ne).wasJustPressed}}wasJustReleased(e){switch(e){case"left":return r(this,Jt).wasJustReleased;case"right":return r(this,Wt).wasJustReleased;case"up":return r(this,qt).wasJustReleased;case"down":return r(this,Yt).wasJustReleased;case"a":return r(this,ee).wasJustReleased;case"b":return r(this,ie).wasJustReleased;case"menu":return r(this,ne).wasJustReleased}}}Jt=new WeakMap,Wt=new WeakMap,qt=new WeakMap,Yt=new WeakMap,ee=new WeakMap,ie=new WeakMap,ne=new WeakMap;function gu(i){return i!=null}var Ui;const ri=class ri{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 0:case 4:return"button_a";case 1:case 3:return"button_b";case 10:case 11:return"button_menu"}return null}eventsForAxisValue(e,t){if(e===9){const n=t*7+8;if(n<.5||n>15.5||n>7.5&&n<8.5)return[];switch(Math.round(n)){case 1:return["button_up"];case 3:return["button_up","button_right"];case 5:return["button_right"];case 7:return["button_down","button_right"];case 9:return["button_down"];case 11:return["button_down","button_left"];case 13:return["button_left"];case 15:return["button_up","button_left"];default:return[]}}switch(e){case 0:case 2:return t>r(ri,Ui)?["button_right"]:t<-r(ri,Ui)?["button_left"]:[];case 1:case 5:return t>r(ri,Ui)?["button_down"]:t<-r(ri,Ui)?["button_up"]:[];default:return[]}}};Ui=new WeakMap,d(ri,Ui,.6);let bl=ri;var zi;const li=class li{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 0:case 3:case 4:case 7:return"button_a";case 1:case 2:case 5:case 6:return"button_b";case 12:return"button_up";case 13:return"button_down";case 14:return"button_left";case 15:return"button_right";case 8:case 9:case 10:case 11:case 16:case 17:return"button_menu"}return null}eventsForAxisValue(e,t){switch(e){case 0:case 2:return t>r(li,zi)?["button_right"]:t<-r(li,zi)?["button_left"]:[];case 1:case 3:return t>r(li,zi)?["button_down"]:t<-r(li,zi)?["button_up"]:[];default:return[]}}};zi=new WeakMap,d(li,zi,.6);let wl=li;var Ni;const oi=class oi{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 0:case 4:return"button_a";case 1:case 3:return"button_b";case 10:case 11:return"button_menu"}return null}eventsForAxisValue(e,t){if(e===0){const n=t*7+8;if(n<.5||n>15.5||n>7.5&&n<8.5)return[];switch(Math.round(n)){case 1:return["button_up"];case 3:return["button_up","button_right"];case 5:return["button_right"];case 7:return["button_down","button_right"];case 9:return["button_down"];case 11:return["button_down","button_left"];case 13:return["button_left"];case 15:return["button_up","button_left"];default:return[]}}switch(e){case 1:case 3:return t>r(oi,Ni)?["button_right"]:t<-r(oi,Ni)?["button_left"]:[];case 2:case 4:return t>r(oi,Ni)?["button_down"]:t<-r(oi,Ni)?["button_up"]:[];default:return[]}}};Ni=new WeakMap,d(oi,Ni,.6);let yl=oi;var Bi;const hi=class hi{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 0:case 4:return"button_a";case 1:case 3:return"button_b";case 10:case 11:return"button_menu"}return null}eventsForAxisValue(e,t){if(e===9){const n=t*7+8;if(n<.5||n>15.5||n>7.5&&n<8.5)return[];switch(Math.round(n)){case 1:return["button_up"];case 3:return["button_up","button_right"];case 5:return["button_right"];case 7:return["button_down","button_right"];case 9:return["button_down"];case 11:return["button_down","button_left"];case 13:return["button_left"];case 15:return["button_up","button_left"];default:return[]}}switch(e){case 0:case 2:return t>r(hi,Bi)?["button_right"]:t<-r(hi,Bi)?["button_left"]:[];case 1:case 5:return t>r(hi,Bi)?["button_down"]:t<-r(hi,Bi)?["button_up"]:[];default:return[]}}};Bi=new WeakMap,d(hi,Bi,.6);let vl=hi;var $i;const ui=class ui{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 1:case 3:return"button_a";case 0:case 2:return"button_b";case 9:return"button_menu"}return null}eventsForAxisValue(e,t){if(e===4){const n=t*7+8;if(n<.5||n>15.5||n>7.5&&n<8.5)return[];switch(Math.round(n)){case 1:return["button_up"];case 3:return["button_up","button_right"];case 5:return["button_right"];case 7:return["button_down","button_right"];case 9:return["button_down"];case 11:return["button_down","button_left"];case 13:return["button_left"];case 15:return["button_up","button_left"];default:return[]}}switch(e){case 0:case 2:return t>r(ui,$i)?["button_right"]:t<-r(ui,$i)?["button_left"]:[];case 1:case 3:return t>r(ui,$i)?["button_down"]:t<-r(ui,$i)?["button_up"]:[];default:return[]}}};$i=new WeakMap,d(ui,$i,.6);let xl=ui;var Li;const ci=class ci{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 1:case 3:return"button_a";case 0:case 2:return"button_b";case 9:return"button_menu"}return null}eventsForAxisValue(e,t){switch(e){case 0:case 2:return t>r(ci,Li)?["button_right"]:t<-r(ci,Li)?["button_left"]:[];case 1:case 5:return t>r(ci,Li)?["button_down"]:t<-r(ci,Li)?["button_up"]:[];default:return[]}}};Li=new WeakMap,d(ci,Li,.6);let Al=ci;var Gi;const fi=class fi{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 1:case 5:case 4:case 7:return"button_a";case 2:case 3:case 0:case 6:return"button_b";case 12:return"button_up";case 13:return"button_down";case 14:return"button_left";case 15:return"button_right";case 16:case 8:case 9:case 10:case 11:case 17:return"button_menu"}return null}eventsForAxisValue(e,t){switch(e){case 0:case 2:return t>r(fi,Gi)?["button_right"]:t<-r(fi,Gi)?["button_left"]:[];case 1:case 3:return t>r(fi,Gi)?["button_down"]:t<-r(fi,Gi)?["button_up"]:[];default:return[]}}};Gi=new WeakMap,d(fi,Gi,.6);let Sl=fi;var Zi;const di=class di{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 0:case 3:return"button_a";case 1:case 2:return"button_b";case 12:return"button_up";case 13:return"button_down";case 14:return"button_left";case 15:return"button_right";case 8:case 9:return"button_menu"}return null}eventsForAxisValue(e,t){switch(e){case 0:case 2:return t>r(di,Zi)?["button_right"]:t<-r(di,Zi)?["button_left"]:[];case 1:case 3:return t>r(di,Zi)?["button_down"]:t<-r(di,Zi)?["button_up"]:[];default:return[]}}};Zi=new WeakMap,d(di,Zi,.6);let El=di;var Hi;const pi=class pi{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 0:case 3:return"button_a";case 1:case 2:return"button_b";case 12:return"button_up";case 13:return"button_down";case 14:return"button_left";case 15:return"button_right";case 9:return"button_menu"}return null}eventsForAxisValue(e,t){switch(e){case 0:case 2:return t>r(pi,Hi)?["button_right"]:t<-r(pi,Hi)?["button_left"]:[];case 1:case 3:return t>r(pi,Hi)?["button_down"]:t<-r(pi,Hi)?["button_up"]:[];default:return[]}}};Hi=new WeakMap,d(pi,Hi,.6);let kl=pi;var xe,Dt,pr,_u;class sp{constructor(e){d(this,pr);b(this,"inputMethod","gamepad");d(this,xe,void 0);d(this,Dt,{standard:new kl,firefoxDualSenseWindows:new Al,firefoxDualSenseOther:new xl,firefox8bitdoWindows:new vl,firefox8bitdoOther:new yl,firefoxOther:new Sl,safari8bitdo:new El,"8bitdo":new bl,other:new wl});m(this,xe,e.browserType)}startListening(){}update(e){let t=!1;for(const n of navigator.getGamepads()){if(!n)continue;const s=u(this,pr,_u).call(this,n);for(let a=0;a<n.buttons.length;++a){const l=s.eventForButton(a,n.buttons[a]);l&&(e.add(l),t=!0)}for(let a=0;a<n.axes.length;++a)s.eventsForAxisValue(a,n.axes[a]).forEach(l=>{e.add(l),t=!0})}return t}connectedGamepadTypes(){return new Set(navigator.getGamepads().filter(gu).map(e=>Xl.detect(e)))}}xe=new WeakMap,Dt=new WeakMap,pr=new WeakSet,_u=function(e){const t=Xl.detect(e);return r(this,xe)==="firefox_windows"||r(this,xe)==="firefox_other"?t==="dualsense"?r(this,xe)==="firefox_windows"?r(this,Dt).firefoxDualSenseWindows:r(this,Dt).firefoxDualSenseOther:t==="8bitdo"?r(this,xe)==="firefox_windows"?r(this,Dt).firefox8bitdoWindows:r(this,Dt).firefox8bitdoOther:r(this,Dt).firefoxOther:t==="8bitdo"?r(this,xe)==="safari"?r(this,Dt).safari8bitdo:r(this,Dt)["8bitdo"]:e.mapping==="standard"?r(this,Dt).standard:r(this,Dt).other};var He,Ji;class ap{constructor(e){b(this,"inputMethod","keyboard");d(this,He,new Map([["ArrowLeft","button_left"],["ArrowRight","button_right"],["ArrowUp","button_up"],["ArrowDown","button_down"],["w","button_up"],["W","button_up"],["s","button_down"],["S","button_down"],["a","button_left"],["A","button_left"],["d","button_right"],["D","button_right"],["j","button_a"],["J","button_a"],["k","button_b"],["K","button_b"],["c","button_a"],["C","button_a"],["x","button_b"],["x","button_b"],["p","button_menu"],["P","button_menu"],["Escape","button_menu"],["Enter","button_menu"],["m","mute_unmute_toggle"],["M","mute_unmute_toggle"],["f","full_screen"],["F","full_screen"]]));d(this,Ji,new Set);e.enableDebugToggle&&r(this,He).set(";","debug_toggle"),e.enableFrameByFrameControls&&(r(this,He).set(",","frame_by_frame_toggle"),r(this,He).set(".","frame_by_frame_step"))}startListening(){document.addEventListener("keydown",e=>{const t=r(this,He).get(e.key);t&&(e.preventDefault(),r(this,Ji).add(t))}),document.addEventListener("keyup",e=>{const t=r(this,He).get(e.key);t&&(e.preventDefault(),r(this,Ji).delete(t))})}update(e){let t=!1;for(const n of r(this,Ji))e.add(n),t=!0;return r(this,Ji).delete("full_screen"),t}}He=new WeakMap,Ji=new WeakMap;var Wi;const mr=class mr{constructor(){b(this,"inputMethod","mouse");d(this,Wi,new Set)}startListening(){mr.mapping.forEach(({event:e,selector:t})=>{document.querySelectorAll(t).forEach(n=>{n.addEventListener("mousedown",()=>{r(this,Wi).add(e)}),n.addEventListener("mouseup",()=>{r(this,Wi).delete(e)})})})}update(e){let t=!1;for(const n of r(this,Wi))e.add(n),t=!0;return r(this,Wi).delete("full_screen"),t}};Wi=new WeakMap,b(mr,"mapping",[{event:"button_left",selector:N.selectors.controlsLeft},{event:"button_left",selector:N.selectors.controlsUpLeft},{event:"button_left",selector:N.selectors.controlsDownLeft},{event:"button_right",selector:N.selectors.controlsRight},{event:"button_right",selector:N.selectors.controlsUpRight},{event:"button_right",selector:N.selectors.controlsDownRight},{event:"button_up",selector:N.selectors.controlsUp},{event:"button_up",selector:N.selectors.controlsUpLeft},{event:"button_up",selector:N.selectors.controlsUpRight},{event:"button_down",selector:N.selectors.controlsDown},{event:"button_down",selector:N.selectors.controlsDownLeft},{event:"button_down",selector:N.selectors.controlsDownRight},{event:"button_a",selector:N.selectors.controlsA},{event:"button_b",selector:N.selectors.controlsB},{event:"button_menu",selector:N.selectors.controlsMenu},{event:"mute_unmute_toggle",selector:N.selectors.controlsMuteToggle},{event:"full_screen",selector:N.selectors.controlsFullScreen}]);let Cl=mr;var K,qi,Je,Yi,ss,ua,Rl;const Y=class Y{constructor(){d(this,Yi);d(this,ua);b(this,"inputMethod","touch");d(this,qi,[{bitMask:r(Y,K).up|r(Y,K).left,events:["button_up","button_left"],requiresStart:!1,selector:N.selectors.controlsUpLeft,elements:[]},{bitMask:r(Y,K).up,events:["button_up"],requiresStart:!1,selector:N.selectors.controlsUp,elements:[]},{bitMask:r(Y,K).up|r(Y,K).right,events:["button_up","button_right"],requiresStart:!1,selector:N.selectors.controlsUpRight,elements:[]},{bitMask:r(Y,K).left,events:["button_left"],requiresStart:!1,selector:N.selectors.controlsLeft,elements:[]},{bitMask:r(Y,K).right,events:["button_right"],requiresStart:!1,selector:N.selectors.controlsRight,elements:[]},{bitMask:r(Y,K).down|r(Y,K).left,events:["button_down","button_left"],requiresStart:!1,selector:N.selectors.controlsDownLeft,elements:[]},{bitMask:r(Y,K).down,events:["button_down"],requiresStart:!1,selector:N.selectors.controlsDown,elements:[]},{bitMask:r(Y,K).down|r(Y,K).right,events:["button_down","button_right"],requiresStart:!1,selector:N.selectors.controlsDownRight,elements:[]},{bitMask:r(Y,K).a,events:["button_a"],requiresStart:!1,selector:N.selectors.controlsA,elements:[]},{bitMask:r(Y,K).b,events:["button_b"],requiresStart:!1,selector:N.selectors.controlsB,elements:[]},{bitMask:r(Y,K).menu,events:["button_menu"],requiresStart:!0,selector:N.selectors.controlsMenu,elements:[]},{bitMask:r(Y,K).muteUnmute,events:["mute_unmute_toggle"],requiresStart:!0,selector:N.selectors.controlsMuteToggle,elements:[]},{bitMask:r(Y,K).fullScreen,events:["full_screen"],requiresStart:!0,selector:N.selectors.controlsFullScreen,elements:[]}]);d(this,Je,new Map);r(this,qi).forEach(({selector:e,elements:t})=>{t.push(...document.querySelectorAll(e))})}startListening(){document.addEventListener("touchstart",u(this,Yi,ss).bind(this)),document.addEventListener("touchmove",u(this,Yi,ss).bind(this)),document.addEventListener("touchcancel",u(this,Yi,ss).bind(this)),document.addEventListener("touchend",u(this,Yi,ss).bind(this))}update(e){let t=!1;for(const[n,s]of r(this,Je).entries()){for(const{bitMask:a,events:l}of r(this,qi))if((s&a)===a)for(const h of l)e.add(h);s&r(Y,K).fullScreen&&r(this,Je).set(n,s&~r(Y,K).fullScreen)}return t}};K=new WeakMap,qi=new WeakMap,Je=new WeakMap,Yi=new WeakSet,ss=function(e){e.preventDefault();for(const t of e.changedTouches)if(e.type==="touchmove"){let n=0;for(const{elements:s,bitMask:a,requiresStart:l}of r(this,qi))!l&&u(this,ua,Rl).call(this,s,t,a)&&(n|=a);r(this,Je).set(t.identifier,n)}else if(e.type==="touchstart"){let n=0;for(const{elements:s,bitMask:a,events:l}of r(this,qi))u(this,ua,Rl).call(this,s,t,a)&&(n|=a);r(this,Je).set(t.identifier,n)}else(e.type==="touchend"||e.type==="touchcancel")&&r(this,Je).delete(t.identifier)},ua=new WeakSet,Rl=function(e,t,n){for(const s of e){const a=s.getBoundingClientRect();if(t.clientX>=a.left-(n&r(Y,K).left?a.width:0)&&t.clientX<=a.right+(n&r(Y,K).right?a.width:0)&&t.clientY>=a.top-(n&r(Y,K).up?a.height:0)&&t.clientY<=a.bottom+(n&r(Y,K).down?a.height:0))return!0}return!1},d(Y,K,{up:256,down:128,left:64,right:32,a:16,b:8,menu:4,muteUnmute:2,fullScreen:1});let Tl=Y;var ca,On;class rp{constructor(e){b(this,"gameInputsSpecialized");b(this,"gameInputGamepad");b(this,"gameButtons");b(this,"buttonFullScreen");b(this,"buttonMuteUnmute");b(this,"buttonDebugToggle");b(this,"buttonFrameByFrameToggle");b(this,"buttonFrameByFrameStep");d(this,ca,new Set);d(this,On,new Set);this.gameInputGamepad=new sp({browserType:e.browserType}),this.gameInputsSpecialized=[new Cl,new ap({enableDebugToggle:e.enableDebugToggle,enableFrameByFrameControls:e.enableFrameByFrameControls}),new Tl,this.gameInputGamepad],this.gameButtons=new np,this.buttonFullScreen=new It,this.buttonMuteUnmute=new It,this.buttonDebugToggle=new It,this.buttonFrameByFrameToggle=new It,this.buttonFrameByFrameStep=new It}startListening(){for(const e of this.gameInputsSpecialized)e.startListening()}update(e){r(this,On).clear();const t=new Set;for(const n of this.gameInputsSpecialized)n.update(t)&&r(this,On).add(n.inputMethod);return m(this,ca,t),e.skipGameButtons||this.gameButtons.update(t),this.buttonFullScreen.update(t.has("full_screen")),this.buttonMuteUnmute.update(t.has("mute_unmute_toggle")),this.buttonDebugToggle.update(t.has("debug_toggle")),this.buttonFrameByFrameToggle.update(t.has("frame_by_frame_toggle")),this.buttonFrameByFrameStep.update(t.has("frame_by_frame_step")),N.updatePressedClasses({up:this.gameButtons.isPressed("up"),down:this.gameButtons.isPressed("down"),left:this.gameButtons.isPressed("left"),right:this.gameButtons.isPressed("right"),a:this.gameButtons.isPressed("a"),b:this.gameButtons.isPressed("b"),menu:this.gameButtons.isPressed("menu"),mute:this.buttonMuteUnmute.isPressed,fullscreen:this.buttonFullScreen.isPressed}),t.size>0}getRecentInputMethods(){return r(this,On)}getConnectedGamepadTypes(){return this.gameInputGamepad.connectedGamepadTypes()}getEventsCapturedInLastUpdate(){return r(this,ca)}}ca=new WeakMap,On=new WeakMap;var Ki,fa,Xi,Dn,ji,We,Pn,da,In;const gr=class gr{constructor(e){d(this,Ki,void 0);d(this,fa,void 0);d(this,Xi,{updateFn:()=>{},renderFn:()=>{}});d(this,Dn,void 0);d(this,ji,void 0);d(this,We,0);d(this,Pn,0);d(this,da,5);d(this,In,e=>{if(r(this,fa).visibilityState==="hidden"){m(this,ji,e),r(this,Ki).call(this,r(this,In));return}const t=e-(r(this,ji)??e);for(m(this,We,r(this,We)+t),m(this,ji,e),m(this,Pn,0);r(this,We)>=r(this,Dn);)m(this,Pn,r(this,Pn)+1),r(this,Pn)<=r(this,da)?(r(this,Xi).updateFn(),m(this,We,r(this,We)-r(this,Dn))):(m(this,We,0),z.warnBeetPx(`Reached the safety limit of ${r(this,da)} update calls`));const n=Math.floor(Math.min(1e3/t,gr.renderFpsResultCap));r(this,Xi).renderFn(n),r(this,Ki).call(this,r(this,In))});m(this,Ki,e.rafFn),m(this,fa,e.documentVisibilityStateProvider),m(this,Dn,1e3/e.fixedTimestepFps)}start(e){r(this,Xi).updateFn=e.updateFn,r(this,Xi).renderFn=e.renderFn,m(this,ji,void 0),m(this,We,0),r(this,Ki).call(this,r(this,In))}};Ki=new WeakMap,fa=new WeakMap,Xi=new WeakMap,Dn=new WeakMap,ji=new WeakMap,We=new WeakMap,Pn=new WeakMap,da=new WeakMap,In=new WeakMap,b(gr,"renderFpsResultCap",999);let Ml=gr;var pa;const fs=class fs{isFullScreenSupported(){return r(fs,pa)}static create(){return r(fs,pa)?new op:new lp}};pa=new WeakMap,d(fs,pa,!!(!(typeof document>"u")&&(document.fullscreenEnabled||document.webkitFullscreenEnabled)));let Ss=fs;class lp extends Ss{constructor(){super(),document.querySelectorAll(N.selectors.controlsFullScreen).forEach(e=>{e.style.display="none"})}isInFullScreen(){return!1}toggleFullScreen(){}}var Qi,ma,ga,_r,bu,br,wu;class op extends Ss{constructor(){super();d(this,_r);d(this,br);d(this,Qi,void 0);d(this,ma,void 0);d(this,ga,void 0);const t=document.querySelector(N.selectors.fullScreenSubject);if(!t)throw Error(`Was unable to find a full screen subject by selector '${N.selectors.fullScreenSubject}'`);m(this,Qi,t);const n=r(this,Qi).requestFullscreen??r(this,Qi).webkitRequestFullscreen??(()=>{});m(this,ma,n.bind(r(this,Qi)));const s=document.exitFullscreen??document.webkitExitFullscreen??(()=>{});m(this,ga,s.bind(document))}isInFullScreen(){return!!(document.fullscreenElement||document.webkitFullscreenElement)}toggleFullScreen(){this.isInFullScreen()?u(this,br,wu).call(this):u(this,_r,bu).call(this)}}Qi=new WeakMap,ma=new WeakMap,ga=new WeakMap,_r=new WeakSet,bu=function(){const t=r(this,ma).call(this);typeof t=="object"&&t.catch(n=>{z.errorBeetPx(n)})},br=new WeakSet,wu=function(){const t=r(this,ga).call(this);typeof t=="object"&&t.catch(n=>{z.errorBeetPx(n)})};function yu(i){return new Promise(e=>{setTimeout(()=>e(),i)})}var wr,Un,_a;class hp{constructor(e){d(this,wr,yu(750));d(this,Un,void 0);d(this,_a,void 0);m(this,Un,document.querySelector(N.selectors.startButton)??en(`Unable to find a start button under a selector "${N.selectors.startButton}"`)),m(this,_a,new Promise(t=>{r(this,Un).addEventListener("click",()=>{e.onStartClicked(),t()})}))}async showStartScreen(){await r(this,wr),N.addLoadedClass(),r(this,Un).focus(),await r(this,_a),N.addStartedClass()}}wr=new WeakMap,Un=new WeakMap,_a=new WeakMap;var qe,zn,Ae;const mi=class mi{static enable(){m(this,qe,!0)}static get isActive(){return r(this,qe)?r(this,Ae):!1}static get wasJustActivated(){return r(this,qe)?r(this,Ae)&&!r(this,zn):!1}static get wasJustDeactivated(){return r(this,qe)?!r(this,Ae)&&r(this,zn):!1}static update(){if(r(this,qe)){if(mi.wasJustActivated){for(const e of Et.playbacksToPauseOnGamePause)e.pauseByEngine();for(const e of Et.playbacksToMuteOnGamePause)e.muteByEngine()}else if(mi.wasJustDeactivated){for(const e of Et.playbacksToPauseOnGamePause)e.resumeByEngine();for(const e of Et.playbacksToMuteOnGamePause)e.unmuteByEngine()}m(this,zn,r(this,Ae))}}static activate(){m(this,Ae,!0)}static deactivate(){m(this,Ae,!1)}};qe=new WeakMap,zn=new WeakMap,Ae=new WeakMap,d(mi,qe,!1),d(mi,zn,!1),d(mi,Ae,!1);let At=mi;var Nn;const un=class un{savePersistedState(e){window.localStorage.setItem(r(un,Nn),JSON.stringify(e,null,2))}loadPersistedState(){const e=window.localStorage.getItem(r(un,Nn));return e?JSON.parse(e):null}clearPersistedState(){window.localStorage.removeItem(r(un,Nn))}};Nn=new WeakMap,d(un,Nn,"game_stored_state");let Fl=un;var Ye,Bn,yr,ba,wa,ya,$n,va,xa,Ln,Aa,Sa,se,Se,Ea,ka,Gn,vr,vu;class up{constructor(e={}){d(this,vr);d(this,Ye,void 0);d(this,Bn,void 0);b(this,"canvasSize");d(this,yr,Q.fromCssHex("#000000"));d(this,ba,void 0);b(this,"gameInput");d(this,wa,void 0);b(this,"audioApi");b(this,"fullScreen");b(this,"storageApi");d(this,ya,void 0);b(this,"assets");d(this,$n,void 0);b(this,"drawApi");d(this,va,void 0);d(this,xa,!1);b(this,"isInsideDrawOrStartedCallback",!1);d(this,Ln,void 0);d(this,Aa,void 0);d(this,Sa,void 0);d(this,se,0);d(this,Se,0);d(this,Ea,1);d(this,ka,!1);d(this,Gn,!1);var a,l,h,f,o,c,_,g;e.canvasSize??(e.canvasSize="128x128"),e.fixedTimestep??(e.fixedTimestep="60fps"),window.addEventListener("error",p=>{var y;return N.showError(p.message),(y=this.audioApi)==null||y.getAudioContext().suspend().then(()=>{}),!0}),window.addEventListener("unhandledrejection",p=>{var y;N.showError(p.reason),(y=this.audioApi)==null||y.getAudioContext().suspend().then(()=>{})}),(a=e.globalPause)!=null&&a.available&&At.enable(),Kt.loadFromStorage(),(l=e.debugMode)!=null&&l.available?e.debugMode.forceEnabledOnStart&&(Kt.enabled=!0):Kt.enabled=!1,(h=e.frameByFrame)!=null&&h.available&&((f=e.frameByFrame)!=null&&f.activateOnStart)&&(si.active=!0),z.debugBeetPx("Engine init params:",e),m(this,Ye,e.assets??[]),r(this,Ye).push(...Yn.spriteSheetUrls),r(this,Ye).push(...uu.spriteSheetUrls),r(this,Ye).push(...cu.spriteSheetUrls);const t=e.fixedTimestep==="60fps"?60:e.fixedTimestep==="30fps"?30:en(`Unsupported fixedTimestep: "${e.fixedTimestep}"`);m(this,Bn,L0.detect(navigator.userAgent)),this.canvasSize=e.canvasSize==="64x64"?q(64,64):e.canvasSize==="128x128"?q(128,128):e.canvasSize==="256x256"?q(256,256):en(`Unsupported canvasSize: "${e.canvasSize}"`),this.gameInput=new rp({enableDebugToggle:((o=e.debugMode)==null?void 0:o.available)??!1,enableFrameByFrameControls:((c=e.frameByFrame)==null?void 0:c.available)??!1,browserType:r(this,Bn)}),m(this,wa,new Ml({fixedTimestepFps:t,rafFn:window.requestAnimationFrame.bind(window),documentVisibilityStateProvider:document})),this.storageApi=new Fl;const n=new AudioContext;this.assets=new Ed,m(this,ya,new Sd(this.assets,{decodeAudioData:p=>n.decodeAudioData(p)})),this.audioApi=new yi(this.assets,n),m(this,ba,new hp({onStartClicked:()=>{this.audioApi.tryToResumeAudioContextSuspendedByBrowserForSecurityReasons().then(p=>{p&&m(this,Gn,!0)})}})),this.fullScreen=Ss.create();const s=document.querySelector(N.selectors.canvas)??en(`Was unable to find <canvas> by selector '${N.selectors.canvas}'`);m(this,$n,new H0(this.canvasSize,s,r(this,yr))),this.drawApi=new ip({canvas:r(this,$n),assets:this.assets}),(g=(_=e.debugMode)==null?void 0:_.fpsDisplay)!=null&&g.enabled&&m(this,va,new Y0(this.drawApi,this.canvasSize,{color:e.debugMode.fpsDisplay.color,placement:e.debugMode.fpsDisplay.placement}))}get frameNumber(){return r(this,se)}get frameNumberOutsidePause(){return r(this,Se)}get renderingFps(){return r(this,Ea)}get detectedBrowserType(){return r(this,Bn)}async init(){return await r(this,ya).loadAssets(r(this,Ye)),{startGame:u(this,vr,vu).bind(this)}}setOnStarted(e){m(this,Ln,e)}setOnUpdate(e){m(this,Aa,e)}setOnDraw(e){m(this,Sa,e)}restart(){var e;m(this,se,0),m(this,Se,0),this.audioApi.restart(),this.drawApi.clearCanvas(J0),Et.playbacksToPauseOnGamePause.clear(),Et.playbacksToMuteOnGamePause.clear(),At.deactivate(),this.isInsideDrawOrStartedCallback=!0,(e=r(this,Ln))==null||e.call(this),this.isInsideDrawOrStartedCallback=!1}}Ye=new WeakMap,Bn=new WeakMap,yr=new WeakMap,ba=new WeakMap,wa=new WeakMap,ya=new WeakMap,$n=new WeakMap,va=new WeakMap,xa=new WeakMap,Ln=new WeakMap,Aa=new WeakMap,Sa=new WeakMap,se=new WeakMap,Se=new WeakMap,Ea=new WeakMap,ka=new WeakMap,Gn=new WeakMap,vr=new WeakSet,vu=async function(){var e;if(r(this,xa))throw Error("Tried to start a game, but it is already started");m(this,xa,!0),window.BEETPX__IS_PROD&&window.addEventListener("beforeunload",t=>(t.preventDefault(),t.returnValue="","")),m(this,se,0),m(this,Se,0),await r(this,ba).showStartScreen(),this.isInsideDrawOrStartedCallback=!0,(e=r(this,Ln))==null||e.call(this),this.isInsideDrawOrStartedCallback=!1,this.gameInput.startListening(),r(this,wa).start({updateFn:()=>{var s;this.gameInput.buttonFullScreen.wasJustPressed&&this.fullScreen.toggleFullScreen(),this.gameInput.buttonMuteUnmute.wasJustPressed&&(this.audioApi.isAudioMuted()?this.audioApi.unmuteAudio():this.audioApi.muteAudio()),this.gameInput.gameButtons.wasJustPressed("menu")&&(At.isActive?At.deactivate():At.activate()),At.update(),this.gameInput.buttonDebugToggle.wasJustPressed&&(Kt.enabled=!Kt.enabled),this.gameInput.buttonFrameByFrameToggle.wasJustPressed&&(si.active=!si.active);const t=!si.active||this.gameInput.buttonFrameByFrameStep.wasJustPressed;this.gameInput.update({skipGameButtons:!t})&&!r(this,Gn)&&this.audioApi.tryToResumeAudioContextSuspendedByBrowserForSecurityReasons().then(a=>{a&&m(this,Gn,!0)}),t&&(si.active&&z.infoBeetPx(`Running onUpdate for frame: ${r(this,se)}`),(s=r(this,Aa))==null||s.call(this),m(this,ka,!0),m(this,se,r(this,se)>=Number.MAX_SAFE_INTEGER?0:r(this,se)+1),At.isActive||m(this,Se,r(this,Se)>=Number.MAX_SAFE_INTEGER?0:r(this,Se)+1))},renderFn:t=>{var n,s;m(this,Ea,t),this.isInsideDrawOrStartedCallback=!0,r(this,ka)&&((n=r(this,Sa))==null||n.call(this),Kt.enabled&&((s=r(this,va))==null||s.drawRenderingFps(t))),this.isInsideDrawOrStartedCallback=!1,r(this,$n).render()}})};function cp(i,e){return i>0?((e==null?void 0:e.onGamePause)==="ignore"?Tt.frameNumber:Tt.frameNumberOutsidePause)%(i*2)<i:!0}function xu(){return[D.of(-1,-1),D.of(0,-1),D.of(1,-1),D.of(1,0),D.of(1,1),D.of(0,1),D.of(-1,1),D.of(-1,0)]}function fp(i,e,t,n,s){for(const a of xu())Tt.draw.text(i,e.add(a),n,{centerXy:s==null?void 0:s.centerXy,scaleXy:s==null?void 0:s.scaleXy});Tt.draw.text(i,e,t,{centerXy:s==null?void 0:s.centerXy,scaleXy:s==null?void 0:s.scaleXy})}function dp(){return[D.of(-1,-1),D.of(1,-1),D.of(1,1),D.of(-1,1)]}function pp(i){if(!(i.length<=0))return i[Math.floor(Math.random()*i.length)]}function mp(i,e){i=i>0?Math.round(i):0;const t=new Array(i*e.length);for(let n=0;n<t.length;n++)t[n]=e[Math.floor(n/i)];return t}var Ke,T,R;const w=class w{static async init(e){z.infoBeetPx(`BeetPx ${window.BEETPX__VERSION} : Initializing…`),m(this,Ke,new up(e));const{startGame:t}=await r(this,Ke).init();return z.infoBeetPx(`BeetPx ${window.BEETPX__VERSION} : Initialized`),{startGame:t}}static get debug(){return Kt.enabled}static get canvasSize(){return u(this,T,R).call(this).canvasSize}static get frameNumber(){return u(this,T,R).call(this).frameNumber}static get frameNumberOutsidePause(){return u(this,T,R).call(this).frameNumberOutsidePause}static get renderingFps(){return u(this,T,R).call(this).renderingFps}static get detectedBrowserType(){return u(this,T,R).call(this).detectedBrowserType}static get isPaused(){return At.isActive}static get wasJustPaused(){return At.wasJustActivated}static get wasJustResumed(){return At.wasJustDeactivated}static pause(){At.activate()}static resume(){At.deactivate()}};Ke=new WeakMap,T=new WeakSet,R=function(e){if(!r(this,Ke))throw Error("Tried to access BeetPx API without calling BeetPx.init(…) first.");return e&&!r(this,Ke).isInsideDrawOrStartedCallback&&z.warnBeetPx(`Used "${e}" outside of either "setOnDraw" or "setOnStarted" callback.`),r(this,Ke)},d(w,T),d(w,Ke,void 0),b(w,"setOnStarted",(...e)=>{var t;return u(t=w,T,R).call(t).setOnStarted(...e)}),b(w,"setOnUpdate",(...e)=>{var t;return u(t=w,T,R).call(t).setOnUpdate(...e)}),b(w,"setOnDraw",(...e)=>{var t;return u(t=w,T,R).call(t).setOnDraw(...e)}),b(w,"restart",(...e)=>{var t;return u(t=w,T,R).call(t).restart(...e)}),b(w,"logDebug",(...e)=>z.debug(...e)),b(w,"logInfo",(...e)=>z.info(...e)),b(w,"logWarn",(...e)=>z.warn(...e)),b(w,"logError",(...e)=>z.error(...e)),b(w,"wasAnyButtonJustPressed",(...e)=>{var t;return u(t=w,T,R).call(t).gameInput.gameButtons.wasAnyJustPressed(...e)}),b(w,"wasButtonJustPressed",(...e)=>{var t;return u(t=w,T,R).call(t).gameInput.gameButtons.wasJustPressed(...e)}),b(w,"wasButtonJustReleased",(...e)=>{var t;return u(t=w,T,R).call(t).gameInput.gameButtons.wasJustReleased(...e)}),b(w,"isAnyButtonPressed",(...e)=>{var t;return u(t=w,T,R).call(t).gameInput.gameButtons.isAnyPressed(...e)}),b(w,"isButtonPressed",(...e)=>{var t;return u(t=w,T,R).call(t).gameInput.gameButtons.isPressed(...e)}),b(w,"getPressedDirection",(...e)=>{var t;return u(t=w,T,R).call(t).gameInput.gameButtons.getPressedDirection(...e)}),b(w,"setButtonRepeating",(...e)=>{var t;return u(t=w,T,R).call(t).gameInput.gameButtons.setButtonRepeating(...e)}),b(w,"getRecentInputMethods",(...e)=>{var t;return u(t=w,T,R).call(t).gameInput.getRecentInputMethods(...e)}),b(w,"getConnectedGamepadTypes",(...e)=>{var t;return u(t=w,T,R).call(t).gameInput.getConnectedGamepadTypes(...e)}),b(w,"getEventsCapturedInLastUpdate",(...e)=>{var t;return u(t=w,T,R).call(t).gameInput.getEventsCapturedInLastUpdate(...e)}),b(w,"isAudioMuted",(...e)=>{var t;return u(t=w,T,R).call(t).audioApi.isAudioMuted(...e)}),b(w,"muteAudio",(...e)=>{var t;return u(t=w,T,R).call(t).audioApi.muteAudio(...e)}),b(w,"unmuteAudio",(...e)=>{var t;return u(t=w,T,R).call(t).audioApi.unmuteAudio(...e)}),b(w,"startPlayback",(...e)=>{var t;return u(t=w,T,R).call(t).audioApi.startPlayback(...e)}),b(w,"startPlaybackLooped",(...e)=>{var t;return u(t=w,T,R).call(t).audioApi.startPlaybackLooped(...e)}),b(w,"startPlaybackSequence",(...e)=>{var t;return u(t=w,T,R).call(t).audioApi.startPlaybackSequence(...e)}),b(w,"mutePlayback",(...e)=>{var t;return u(t=w,T,R).call(t).audioApi.mutePlayback(...e)}),b(w,"unmutePlayback",(...e)=>{var t;return u(t=w,T,R).call(t).audioApi.unmutePlayback(...e)}),b(w,"stopPlayback",(...e)=>{var t;return u(t=w,T,R).call(t).audioApi.stopPlayback(...e)}),b(w,"pausePlayback",(...e)=>{var t;return u(t=w,T,R).call(t).audioApi.pausePlayback(...e)}),b(w,"resumePlayback",(...e)=>{var t;return u(t=w,T,R).call(t).audioApi.resumePlayback(...e)}),b(w,"getAudioContext",(...e)=>{var t;return u(t=w,T,R).call(t).audioApi.getAudioContext(...e)}),b(w,"isFullScreenSupported",(...e)=>{var t;return u(t=w,T,R).call(t).fullScreen.isFullScreenSupported(...e)}),b(w,"isInFullScreen",(...e)=>{var t;return u(t=w,T,R).call(t).fullScreen.isInFullScreen(...e)}),b(w,"toggleFullScreen",(...e)=>{var t;return u(t=w,T,R).call(t).fullScreen.toggleFullScreen(...e)}),b(w,"savePersistedState",(...e)=>{var t;return u(t=w,T,R).call(t).storageApi.savePersistedState(...e)}),b(w,"loadPersistedState",(...e)=>{var t;return u(t=w,T,R).call(t).storageApi.loadPersistedState(...e)}),b(w,"clearPersistedState",(...e)=>{var t;return u(t=w,T,R).call(t).storageApi.clearPersistedState(...e)}),b(w,"getImageAsset",(...e)=>{var t;return u(t=w,T,R).call(t).assets.getImageAsset(...e)}),b(w,"getSoundAsset",(...e)=>{var t;return u(t=w,T,R).call(t).assets.getSoundAsset(...e)}),b(w,"getJsonAsset",(...e)=>{var t;return u(t=w,T,R).call(t).assets.getJsonAsset(...e)}),b(w,"draw",{clearCanvas(e){var t;u(t=w,T,R).call(t,"clearCanvas").drawApi.clearCanvas(e)},setClippingRegion(e,t){var n;return u(n=w,T,R).call(n,"setClippingRegion").drawApi.setClippingRegion(e,t)},removeClippingRegion(){var e;return u(e=w,T,R).call(e,"removeClippingRegion").drawApi.removeClippingRegion()},setCameraXy(e){var t;return u(t=w,T,R).call(t,"setCameraXy").drawApi.setCameraXy(e)},setDrawingPattern(e){var t;return u(t=w,T,R).call(t,"setDrawingPattern").drawApi.setDrawingPattern(e)},pixel(e,t){var n;u(n=w,T,R).call(n,"pixel").drawApi.drawPixel(e,t)},pixels(e,t,n,s){var a;u(a=w,T,R).call(a,"pixels").drawApi.drawPixels(e,t,n,s)},line(e,t,n){var s;u(s=w,T,R).call(s,"line").drawApi.drawLine(e,t,n)},rect(e,t,n){var s;u(s=w,T,R).call(s,"rect").drawApi.drawRect(e,t,n)},rectFilled(e,t,n){var s;u(s=w,T,R).call(s,"rectFilled").drawApi.drawRectFilled(e,t,n)},rectOutsideFilled(e,t,n){var s;u(s=w,T,R).call(s,"rectOutsideFilled").drawApi.drawRectOutsideFilled(e,t,n)},ellipse(e,t,n){var s;u(s=w,T,R).call(s,"ellipse").drawApi.drawEllipse(e,t,n)},ellipseFilled(e,t,n){var s;u(s=w,T,R).call(s,"ellipseFilled").drawApi.drawEllipseFilled(e,t,n)},ellipseOutsideFilled(e,t,n){var s;u(s=w,T,R).call(s,"ellipseOutsideFilled").drawApi.drawEllipseOutsideFilled(e,t,n)},setSpriteColorMapping(e){var t;return u(t=w,T,R).call(t,"setSpriteColorMapping").drawApi.setSpriteColorMapping(e)},sprite(e,t,n){var s;u(s=w,T,R).call(s,"sprite").drawApi.drawSprite(e,t,n)},useFont(e){var t;return u(t=w,T,R).call(t,"useFont").drawApi.useFont(e)},setTextColorMarkers(e){var t;return u(t=w,T,R).call(t,"setTextColorMarkers").drawApi.setTextColorMarkers(e)},measureText(e,t){var n;return u(n=w,T,R).call(n,"measureText").drawApi.measureText(e,t)},text(e,t,n,s){var a;u(a=w,T,R).call(a,"text").drawApi.drawText(e,t,n,s)},takeCanvasSnapshot(){var e;u(e=w,T,R).call(e,"takeCanvasSnapshot").drawApi.takeCanvasSnapshot()}}),b(w,"utils",{assertUnreachable:Ol,booleanChangingEveryNthFrame:cp,clamp:Zn,drawTextWithOutline:fp,identity:Dl,isDefined:gu,lerp:Kr,mod:gi,noop:ol,offset4Directions:dp,offset8Directions:xu,randomElementOf:pp,range:Xa,repeatEachElement:mp,throwError:en,trigAtan2:ih,trigCos:nh,trigSin:sh,wait:yu});let Tt=w;const Te=Tt,at=Tt.draw;Tt.utils;var Pt,Vi,Ca,Ee,tn,ke,Xe,on,ae,Re;const Yl=class Yl{constructor(e){d(this,Xe);d(this,ae);d(this,Pt,void 0);d(this,Vi,void 0);d(this,Ca,void 0);d(this,Ee,void 0);d(this,tn,void 0);d(this,ke,void 0);m(this,Ca,e.onGamePause==="ignore"),m(this,Pt,Math.max(0,Math.round(e.frames))),m(this,Vi,e.loop),m(this,tn,r(this,Xe,on)+e.delayFrames),m(this,Ee,!1),m(this,ke,null),e.pause&&this.pause()}static for(e){return new Yl(e)}get t(){return r(this,Vi)?r(this,ae,Re)>=0?gi(r(this,ae,Re),r(this,Pt)):0:Zn(0,r(this,ae,Re),r(this,Pt))}get framesLeft(){return r(this,Pt)-this.t}get progress(){return r(this,Pt)>0?this.t/r(this,Pt):1}get hasFinished(){return r(this,ae,Re)>=r(this,Pt)}get hasJustFinished(){return r(this,Pt)>0?r(this,Vi)?r(this,ae,Re)>0&&this.t===0:r(this,ae,Re)===r(this,Pt):r(this,Vi)?!0:r(this,ae,Re)===0}pause(){r(this,Ee)||(m(this,Ee,!0),m(this,ke,r(this,Xe,on)))}resume(){r(this,Ee)&&(m(this,Ee,!1),m(this,tn,r(this,tn)+(r(this,Xe,on)-(r(this,ke)??0))),m(this,ke,null))}restart(){m(this,tn,r(this,Xe,on)),m(this,ke,null),m(this,Ee,!1)}};Pt=new WeakMap,Vi=new WeakMap,Ca=new WeakMap,Ee=new WeakMap,tn=new WeakMap,ke=new WeakMap,Xe=new WeakSet,on=function(){return r(this,Ca)?Tt.frameNumber:Tt.frameNumberOutsidePause},ae=new WeakSet,Re=function(){return(r(this,ke)??r(this,Xe,on))-r(this,tn)};let us=Yl;const th=3,eh=Da({ascent:8,descent:th,lineGap:3,glyphs:new Map([[" ",{type:"whitespace",advance:3}],["T",ce(5,8,3,0)],["b",ce(3,8,5,5)],["e",ce(3,5,8,0)],["f",ce(3,8,6,9,{kerning:{" ":-1},useExternalSpriteSheet:!0})],["h",ce(3,8,0,0,{kerning:{t:-1,T:-1},useExternalSpriteSheet:!0})],["n",qr(`
        ##-
        #-#
        #-#
        #-#
        #-#
      `)],["o",ce(3,5,5,8)],["q",ce(3,8,5,8,{offsetY:th})],["r",ce(3,5,5,0,{useExternalSpriteSheet:!0})],["w",qr(`
        #-#-#
        #-#-#
        #-#-#
        -#-#-
        -#-#-
      `)],["x",ce(3,5,1,8,{kerning:{o:1}})],["➡",qr(`
        ----------
        ----------
        -------#--
        -------##-
        ##########
        -------##-
        -------#--
        ----------
      `)]])});function ce(i,e,t,n,s){const a=fu(s!=null&&s.useExternalSpriteSheet?"https://raw.githubusercontent.com/beetrootpaul/beetpx/main/examples/fonts/public/custom-font.png":"custom-font.png")(i,e,t,n);return{type:"sprite",sprite:a,isTextColor:l=>(l==null?void 0:l.cssHex)==="#99e550",advance:a.size.x+1,offset:s!=null&&s.offsetY?q(0,s.offsetY):void 0,kerning:s==null?void 0:s.kerning}}function qr(i){const e=Xn.from(i);return{type:"pixels",pixels:e,advance:e.size.x+1}}const gp=fu(ja.spriteSheetUrl),_p=i=>(i==null?void 0:i.cssHex)===it.white.cssHex,bp=Da(Yn,i=>({...i,ascent:6,descent:1,glyphs:new Map([...i.glyphs,["x",{type:"sprite",sprite:gp(5,5,57,72),isTextColor:_p,advance:6}],["⏏️",{type:"pixels",pixels:Xn.from(`
          --#--
          -###-
          #####
          -----
          #####
        `),advance:6}]])}));Te.init({canvasSize:"256x256",assets:[...eh.spriteSheetUrls],debugMode:{available:!0,fpsDisplay:{enabled:!0}}}).then(async({startGame:i})=>{const e=["The quick [brown]brown[_] fox jumps","over the [🟦]lazy[_] dog","0123456789 -+= .,:;!? ~@#$%^&*_","⭐❤️⬅➡⬆⬇⭕❎♪⏏️","()[]{}<> /|\\ `'\""].join(`
`),t=q(1),n=q(8);let s=t,a=Kn;Te.setOnStarted(()=>{at.setTextColorMarkers({_:pt.peach,brown:pt.tan,"🟦":pt.sky})}),Te.setOnUpdate(()=>{if(Te.wasButtonJustPressed("a")){const l=s.mul(2).clamp(t,n);a=a.mul(l.div(s)),s=l}if(Te.wasButtonJustPressed("b")){const l=s.div(2).clamp(t,n);a=a.mul(l.div(s)),s=l}Te.wasButtonJustPressed("menu")&&(a=Kn,s=t),a=a.sub(Te.getPressedDirection().mul(2).mul(s))}),Te.setOnDraw(()=>{at.setCameraXy(a),at.clearCanvas(pt.wine);let l=q(8,4).mul(s);for(const[h,f]of[[Yn,"$font_pico8"],[bp,"pico8FontWithAdjustments"],[uu,"$font_saint11Minimal4"],[cu,"$font_saint11Minimal5"],[eh,"customFont"]]){at.useFont(Yn),at.text(f,l,pt.dusk,{scaleXy:s}),l=l.add(s.mul(0,8)),at.useFont(h);const{wh:o,offset:c}=at.measureText(e,{scaleXy:s});wp(o,l.add(c),s),at.text(e,l,pt.peach,{scaleXy:s}),yp(h,l.add(c),s),l=l.add(0,o.y).add(s.mul(0,4))}}),await i()});function wp(i,e,t){at.rectFilled(e.sub(t),i.add(q(2).mul(t)),pt.dusk),at.rectFilled(e,i,pt.storm)}function yp(i,e,t){at.rectFilled(e.add(q(-3,0).mul(t)),t,pt.pink),at.rectFilled(e.add(q(-4,0).mul(t)),q(1,i.ascent).mul(t),pt.pink),at.rectFilled(e.add(q(-3,i.ascent-1).mul(t)),t,pt.pink),at.rectFilled(e.add(q(-4,i.ascent).mul(t)),q(1,i.descent).mul(t),pt.pink),at.rectFilled(e.add(q(-3,i.ascent+i.descent-1).mul(t)),t,pt.pink),at.rectFilled(e.add(q(-4,i.ascent+i.descent).mul(t)),q(1,i.lineGap).mul(t),pt.pink)}
