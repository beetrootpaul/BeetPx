var bu=Object.defineProperty;var wu=(i,e,t)=>e in i?bu(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var b=(i,e,t)=>(wu(i,typeof e!="symbol"?e+"":e,t),t),Ar=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var a=(i,e,t)=>(Ar(i,e,"read from private field"),t?t.call(i):e.get(i)),d=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},g=(i,e,t,n)=>(Ar(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t);var u=(i,e,t)=>(Ar(i,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();class j{constructor(e,t,n){b(this,"type","rgb");b(this,"r");b(this,"g");b(this,"b");b(this,"cssHex");this.r=Math.min(Math.max(0,Math.round(e)),255),this.g=Math.min(Math.max(0,Math.round(t)),255),this.b=Math.min(Math.max(0,Math.round(n)),255),this.cssHex="#"+e.toString(16).padStart(2,"0")+t.toString(16).padStart(2,"0")+n.toString(16).padStart(2,"0")}static of(e,t,n){return new j(e,t,n)}static fromCssHex(e){if(!/^#[0-9a-fA-F]{6}$/.test(e))throw Error("Hexadecimal representation of the color doesn't contain exactly 6 hexadecimal digits, preceded by a single '#'");return new j(parseInt(e.slice(1,3),16),parseInt(e.slice(3,5),16),parseInt(e.slice(5,7),16))}isSameAs(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}asArray(){return[this.r,this.g,this.b]}}class et{}b(et,"black",j.fromCssHex("#000000")),b(et,"storm",j.fromCssHex("#1D2B53")),b(et,"wine",j.fromCssHex("#7E2553")),b(et,"moss",j.fromCssHex("#008751")),b(et,"tan",j.fromCssHex("#AB5236")),b(et,"slate",j.fromCssHex("#5F574F")),b(et,"silver",j.fromCssHex("#C2C3C7")),b(et,"white",j.fromCssHex("#FFF1E8")),b(et,"ember",j.fromCssHex("#FF004D")),b(et,"orange",j.fromCssHex("#FFA300")),b(et,"lemon",j.fromCssHex("#FFEC27")),b(et,"lime",j.fromCssHex("#00E436")),b(et,"sky",j.fromCssHex("#29ADFF")),b(et,"dusk",j.fromCssHex("#83769C")),b(et,"pink",j.fromCssHex("#FF77A8")),b(et,"peach",j.fromCssHex("#FFCCAA"));var vs;const rn=class rn{constructor(e){b(this,"type","sprite_mapping");d(this,vs,void 0);g(this,vs,e)}static from(e){const t=new Map(e.map(([n,s])=>[n.cssHex,s]));return new rn((n,s,r)=>{if(!n)return n;const o=t.get(n.cssHex);return typeof o>"u"?n:o})}static of(e){return new rn(e)}getMappedColor(e,t,n){return a(this,vs).call(this,e,t,n)}};vs=new WeakMap,b(rn,"noMapping",new rn((e,t,n)=>e));let Ja=rn;var xs;const Re=class Re{constructor(e){d(this,xs,void 0);if(e<0||e>65535)throw Error("BpxPatter: bits representation of the pattern is out of range of valid values. The value should be in range of 0b0000_0000_0000_0000 to 0b1111_1111_1111_1111.");g(this,xs,e)}static from(e){e=e.replace(/\s/g,"");const t=e.search(/[^#-]/);if(t>=0)throw Error(`BpxPattern.from: Unexpected character found: "${e[t]}"`);if(e.length!==16)throw Error(`BpxPattern.from: Unexpected amount of # and - symbols. There should be 16 of them (4 rows x 4 columns), but instead there is: ${e.length}`);let n=0;for(let s=0;s<16;++s)e[s]==="#"&&(n|=1<<15-s);return new Re(n)}static of(e){return new Re(e)}hasPrimaryColorAt(e,t){const n=e%4,s=t%4,r=4*4-(s*4+n)-1;return!!(a(this,xs)&1<<r)}};xs=new WeakMap,b(Re,"primaryOnly",Re.of(65535)),b(Re,"secondaryOnly",Re.of(0));let Zr=Re;function Ln(i,e,t){return i<e?e<t?e:i<t?t:i:e>t?e:i>t?t:i}function Hr(i,e,t,n){const s=i+(e-i)*t;return n!=null&&n.clamp?Ln(i,s,e):s}function di(i,e){return e===0?0:(i%e+e)%e}function th(i,e){return(Math.atan2(e,i)/Math.PI/2+1)%1}function eh(i){return Math.cos(i*Math.PI*2)}function ih(i){return Math.sin(i*Math.PI*2)}class D{constructor(e,t){this.x=e,this.y=t}static unitFromAngle(e){return new D(eh(e),ih(e))}static of(e,t){return new D(e,t??e)}static min(e,t){return new D(Math.min(e.x,t.x),Math.min(e.y,t.y))}static max(e,t){return new D(Math.max(e.x,t.x),Math.max(e.y,t.y))}static minMax(e,t){return[D.min(e,t),D.max(e,t)]}static lerp(e,t,n,s){return new D(Hr(e.x,t.x,n,s),Hr(e.y,t.y,n,s))}asArray(){return[this.x,this.y]}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const e=this.magnitude();return new D(this.x/e,this.y/e)}sign(){return new D(Math.sign(this.x),Math.sign(this.y))}abs(){return new D(Math.abs(this.x),Math.abs(this.y))}floor(){return new D(Math.floor(this.x),Math.floor(this.y))}ceil(){return new D(Math.ceil(this.x),Math.ceil(this.y))}round(){return new D(Math.round(this.x),Math.round(this.y))}toAngle(){return th(this.x,this.y)}eq(e){return typeof e!="number"?this.x===e.x&&this.y===e.y:this.x===e&&this.y===e}gt(e){return typeof e!="number"?this.x>e.x&&this.y>e.y:this.x>e&&this.y>e}gte(e){return typeof e!="number"?this.x>=e.x&&this.y>=e.y:this.x>=e&&this.y>=e}lt(e){return typeof e!="number"?this.x<e.x&&this.y<e.y:this.x<e&&this.y<e}lte(e){return typeof e!="number"?this.x<=e.x&&this.y<=e.y:this.x<=e&&this.y<=e}clamp(e,t){return new D(Ln(e.x,this.x,t.x),Ln(e.y,this.y,t.y))}mod(e,t){return typeof e!="number"?new D(di(this.x,e.x),di(this.y,e.y)):new D(di(this.x,e),di(this.y,t??e))}add(e,t){return typeof e!="number"?new D(this.x+e.x,this.y+e.y):new D(this.x+e,this.y+(t??e))}sub(e,t){return typeof e!="number"?new D(this.x-e.x,this.y-e.y):new D(this.x-e,this.y-(t??e))}mul(e,t){return typeof e!="number"?new D(this.x*e.x,this.y*e.y):new D(this.x*e,this.y*(t??e))}div(e,t){return typeof e!="number"?new D(this.x/e.x,this.y/e.y):new D(this.x/e,this.y/(t??e))}*[Symbol.iterator](){yield this.x,yield this.y}[Symbol.toPrimitive](e){switch(e){case"default":case"string":return`(${this.x},${this.y})`;case"number":return NaN}}get[Symbol.toStringTag](){return"BpxVector2d"}__printDebug(){return`(${this.x},${this.y})`}}class mr{constructor(e){b(this,"asciiRows");b(this,"size");this.asciiRows=e.split(`
`).map(n=>n.replace(/\s/g,"")).filter(n=>n.length>0);let t=0;for(const n of this.asciiRows){const s=n.search(/[^#-]/);if(s>=0)throw Error(`DrawPixels.draw: Unexpected character found: "${n[s]}"`);t=Math.max(t,n.length)}this.size=D.of(t,this.asciiRows.length)}static from(e){return new mr(e)}}function Tl(i){throw Error("Somehow reached the unreachable code ¯\\_(ツ)_/¯")}function Ml(i){return i}function Wa(i){return Array.from({length:i},(e,t)=>t)}var As,pt,Ss;const ii=class ii{constructor(e){d(this,pt,void 0);d(this,Ss,void 0);g(this,pt,e),g(this,Ss,[...new Set(Array.from(e.glyphs.values()).filter(t=>t.type==="sprite").map(t=>t.sprite.imageUrl))])}static of(e){return new ii({ascent:e.ascent??8,descent:e.descent??8,lineGap:e.lineGap??1,mapGrapheme:e.mapGrapheme??Ml,glyphs:e.glyphs??new Map})}static basedOn(e,t){const n=t(a(e,pt));return new ii(n)}get spriteSheetUrls(){return a(this,Ss)}get ascent(){return a(this,pt).ascent}get descent(){return a(this,pt).descent}get lineGap(){return a(this,pt).lineGap}arrangeGlyphsFor(e,t,n){var l;n??(n={});const s=[];let r=D.of(0,0),o=0,h=`
`;const c=a(ii,As).segment(e)[Symbol.iterator]();for(let f=c.next();!f.done;f=c.next()){const m=a(this,pt).mapGrapheme(f.value.segment),_=f.value.index;if(m===`
`){s.push({type:"line_break",lineNumber:o}),h=`
`,r=D.of(0,r.y+a(this,pt).ascent+a(this,pt).descent+a(this,pt).lineGap),o+=1;continue}if(m==="["){let O;for(const[C,P]of Object.entries(n)){const U=`[${C}]`;if(e.slice(_,_+U.length)===U){O=P;const x=[...a(ii,As).segment(U)].length-1;Wa(x).forEach(()=>{c.next()});break}}if(O){t=O;continue}}const p=a(this,pt).glyphs.get(m);if(!p)continue;const y=((l=p.kerning)==null?void 0:l[h])??0,I=t;if(p.type==="sprite"){s.push({type:"sprite",char:m,sprite:p.sprite,spriteColorMapping:Ja.of(O=>p.isTextColor(O)?I:null),lineNumber:o,leftTop:r.add(0,a(this,pt).ascent).sub(0,p.sprite.size.y).add(p.offset??D.of(0,0)).add(y,0)}),h=m,r=r.add(p.advance+y,0);continue}if(p.type==="pixels"){s.push({type:"pixels",char:m,pixels:p.pixels,color:I,lineNumber:o,leftTop:r.add(0,this.ascent).sub(0,p.pixels.size.y).add(p.offset??D.of(0,0)).add(y,0)}),h=m,r=r.add(p.advance+y,0);continue}if(p.type==="whitespace"){h=m,r=r.add(p.advance+y,0);continue}Tl()}return s}};As=new WeakMap,pt=new WeakMap,Ss=new WeakMap,d(ii,As,new Intl.Segmenter("en",{granularity:"grapheme",localeMatcher:"best fit"}));let es=ii;class hs{constructor(e,t,n,s,r){b(this,"type","static");b(this,"imageUrl");b(this,"size");b(this,"xy");t<0&&(t=-t,s-=t),n<0&&(n=-n,r-=n),this.imageUrl=e,this.xy=D.of(s,r).round(),this.size=D.of(s+t,r+n).round().sub(this.xy)}static from(e,t,n,s,r){return new hs(e,t,n,s,r)}clipBy(e,t){const n=this.xy.clamp(e,t),s=this.xy.add(this.size).clamp(e,t).sub(n);return new hs(this.imageUrl,s.x,s.y,n.x,n.y)}}var S,E;const Qa=class Qa{constructor(){d(this,S);b(this,"ascent",5);b(this,"descent",0);b(this,"lineGap",1);b(this,"glyphs",new Map([[" ",{type:"whitespace",advance:4}],["0",u(this,S,E).call(this,0,3)],["1",u(this,S,E).call(this,1,3)],["2",u(this,S,E).call(this,2,3)],["3",u(this,S,E).call(this,3,3)],["4",u(this,S,E).call(this,4,3)],["5",u(this,S,E).call(this,5,3)],["6",u(this,S,E).call(this,6,3)],["7",u(this,S,E).call(this,7,3)],["8",u(this,S,E).call(this,8,3)],["9",u(this,S,E).call(this,9,3)],["-",u(this,S,E).call(this,13,2)],["+",u(this,S,E).call(this,11,2)],["=",u(this,S,E).call(this,13,3)],["(",u(this,S,E).call(this,8,2)],[")",u(this,S,E).call(this,9,2)],["[",u(this,S,E).call(this,11,5)],["]",u(this,S,E).call(this,13,5)],["{",u(this,S,E).call(this,11,7)],["}",u(this,S,E).call(this,13,7)],["<",u(this,S,E).call(this,12,3)],[">",u(this,S,E).call(this,14,3)],["~",u(this,S,E).call(this,14,7)],["!",u(this,S,E).call(this,1,2)],["?",u(this,S,E).call(this,15,3)],["@",u(this,S,E).call(this,0,4)],["#",u(this,S,E).call(this,3,2)],["$",u(this,S,E).call(this,4,2)],["%",u(this,S,E).call(this,5,2)],["^",u(this,S,E).call(this,14,5)],["&",u(this,S,E).call(this,6,2)],["*",u(this,S,E).call(this,10,2)],["_",u(this,S,E).call(this,15,5)],[".",u(this,S,E).call(this,14,2)],[",",u(this,S,E).call(this,12,2)],[":",u(this,S,E).call(this,10,3)],[";",u(this,S,E).call(this,11,3)],["`",u(this,S,E).call(this,0,6)],["'",u(this,S,E).call(this,7,2)],['"',u(this,S,E).call(this,2,2)],["/",u(this,S,E).call(this,15,2)],["|",u(this,S,E).call(this,12,7)],["\\",u(this,S,E).call(this,12,5)],["a",u(this,S,E).call(this,1,6)],["b",u(this,S,E).call(this,2,6)],["c",u(this,S,E).call(this,3,6)],["d",u(this,S,E).call(this,4,6)],["e",u(this,S,E).call(this,5,6)],["f",u(this,S,E).call(this,6,6)],["g",u(this,S,E).call(this,7,6)],["h",u(this,S,E).call(this,8,6)],["i",u(this,S,E).call(this,9,6)],["j",u(this,S,E).call(this,10,6)],["k",u(this,S,E).call(this,11,6)],["l",u(this,S,E).call(this,12,6)],["m",u(this,S,E).call(this,13,6)],["n",u(this,S,E).call(this,14,6)],["o",u(this,S,E).call(this,15,6)],["p",u(this,S,E).call(this,0,7)],["q",u(this,S,E).call(this,1,7)],["r",u(this,S,E).call(this,2,7)],["s",u(this,S,E).call(this,3,7)],["t",u(this,S,E).call(this,4,7)],["u",u(this,S,E).call(this,5,7)],["v",u(this,S,E).call(this,6,7)],["w",u(this,S,E).call(this,7,7)],["x",u(this,S,E).call(this,8,7)],["y",u(this,S,E).call(this,9,7)],["z",u(this,S,E).call(this,10,7)],["⬅",u(this,S,E).call(this,11,8,7)],["➡",u(this,S,E).call(this,1,9,7)],["⬆",u(this,S,E).call(this,4,9,7)],["⬇",u(this,S,E).call(this,3,8,7)],["⭐",u(this,S,E).call(this,2,9,7)],["❤️",u(this,S,E).call(this,7,8,7)],["❎",u(this,S,E).call(this,7,9,7)],["⭕",u(this,S,E).call(this,14,8,7)],["♪",u(this,S,E).call(this,13,8,7)]]))}mapGrapheme(e){return e.toLowerCase()}};S=new WeakSet,E=function(e,t,n=3){const s=hs.from(Qa.spriteSheetUrl,n,5,e*8,t*8);return{type:"sprite",sprite:s,isTextColor:r=>(r==null?void 0:r.cssHex)===et.white.cssHex,advance:s.size.x+1}},b(Qa,"spriteSheetUrl",".beetpx/pico-8-font.png");let Jr=Qa;var M,F;class yu{constructor(){d(this,M);b(this,"ascent",4);b(this,"descent",0);b(this,"lineGap",2);b(this,"glyphs",new Map([[" ",u(this,M,F).call(this,`
        ----
        ----
        ----
        ----
      `)],[".",u(this,M,F).call(this,`
        -
        -
        -
        #
      `)],[":",u(this,M,F).call(this,`
        #
        -
        -
        #
      `)],["!",u(this,M,F).call(this,`
        #
        #
        #
        -
        #
      `)],["?",u(this,M,F).call(this,`
        -#-
        #-#
        --#
        -#-
        -#-
      `)],["'",u(this,M,F).call(this,`
        #
        #
        -
        -
        -
      `)],['"',u(this,M,F).call(this,`
        #-#
        #-#
        ---
        ---
        ---
      `)],["*",u(this,M,F).call(this,`
        #-#
        -#-
        #-#
        ---
      `)],["/",u(this,M,F).call(this,`
        --#
        -#-
        -#-
        #--
      `)],["+",u(this,M,F).call(this,`
        ---
        -#-
        ###
        -#-
      `)],["-",u(this,M,F).call(this,`
        ---
        ---
        ###
        ---
      `)],["0",u(this,M,F).call(this,`
        -#-
        #-#
        #-#
        -#-
      `)],["1",u(this,M,F).call(this,`
        -#-
        ##-
        -#-
        -#-
      `)],["2",u(this,M,F).call(this,`
        ##-
        -##
        #--
        ###
      `)],["3",u(this,M,F).call(this,`
        ###
        -##
        --#
        ###
      `)],["4",u(this,M,F).call(this,`
        #-#
        #-#
        ###
        --#
      `)],["5",u(this,M,F).call(this,`
        ###
        ##-
        --#
        ##-
      `)],["6",u(this,M,F).call(this,`
        -#-
        #--
        ###
        -#-
      `)],["7",u(this,M,F).call(this,`
        ###
        --#
        -#-
        #--
      `)],["8",u(this,M,F).call(this,`
        ###
        -#-
        #-#
        -#-
      `)],["9",u(this,M,F).call(this,`
        ###
        ###
        --#
        ##-
      `)],["%",u(this,M,F).call(this,`
        #--#
        --#-
        -#--
        #--#
      `)],["$",u(this,M,F).call(this,`
        -##
        ##-
        -##
        ##-
      `)],["(",u(this,M,F).call(this,`
        -#
        #-
        #-
        -#
      `)],[")",u(this,M,F).call(this,`
        #-
        -#
        -#
        #-
      `)],["[",u(this,M,F).call(this,`
        ##
        #-
        #-
        ##
      `)],["]",u(this,M,F).call(this,`
        ##
        -#
        -#
        ##
      `)],["{",u(this,M,F).call(this,`
        -#
        ##
        ##
        -#
      `)],["}",u(this,M,F).call(this,`
        #-
        ##
        ##
        #-
      `)],["<",u(this,M,F).call(this,`
        ---
        -##
        #--
        -##
      `)],[">",u(this,M,F).call(this,`
        ##-
        --#
        ##-
        ---
      `)],["a",u(this,M,F).call(this,`
        ##-
        #-#
        ###
        #-#
      `)],["b",u(this,M,F).call(this,`
        #--
        ##-
        #-#
        ###
      `)],["c",u(this,M,F).call(this,`
        -##
        #--
        #--
        -##
      `)],["d",u(this,M,F).call(this,`
        ##-
        #-#
        #-#
        ##-
      `)],["e",u(this,M,F).call(this,`
        ###
        ##-
        #--
        ###
      `)],["f",u(this,M,F).call(this,`
        ###
        #--
        ##-
        #--
      `)],["g",u(this,M,F).call(this,`
        -##
        #--
        #-#
        -##
      `)],["h",u(this,M,F).call(this,`
        #--
        ##-
        #-#
        #-#
      `)],["i",u(this,M,F).call(this,`
        #
        #
        #
        #
      `)],["j",u(this,M,F).call(this,`
        ##
        -#
        -#
        #-
      `)],["k",u(this,M,F).call(this,`
        #-#
        ##-
        #-#
        #-#
      `)],["l",u(this,M,F).call(this,`
        #-
        #-
        #-
        ##
      `)],["m",u(this,M,F).call(this,`
        #-#
        ###
        #-#
        #-#
      `)],["n",u(this,M,F).call(this,`
        ##-
        #-#
        #-#
        #-#
      `)],["o",u(this,M,F).call(this,`
        -##
        #-#
        #-#
        ##-
      `)],["p",u(this,M,F).call(this,`
        ###
        #-#
        ##-
        #--
      `)],["q",u(this,M,F).call(this,`
        -#-
        #-#
        ###
        -#-
      `)],["r",u(this,M,F).call(this,`
        ##-
        #-#
        ##-
        #-#
      `)],["s",u(this,M,F).call(this,`
        -##
        ##-
        --#
        ##-
      `)],["t",u(this,M,F).call(this,`
        ###
        -#-
        -#-
        -#-
      `)],["u",u(this,M,F).call(this,`
        #-#
        #-#
        #-#
        ##-
      `)],["v",u(this,M,F).call(this,`
        #-#
        #-#
        #-#
        -#-
      `)],["w",u(this,M,F).call(this,`
        #-#
        #-#
        ###
        #-#
      `)],["x",u(this,M,F).call(this,`
        #-#
        -#-
        #-#
        #-#
      `)],["y",u(this,M,F).call(this,`
        #-#
        #-#
        -#-
        -#-
      `)],["z",u(this,M,F).call(this,`
        ###
        -#-
        #--
        ###
      `)]]))}mapGrapheme(e){return e.toLowerCase()}}M=new WeakSet,F=function(e){const t=mr.from(e);return{type:"pixels",pixels:t,advance:t.size.x+1}};var v,A;class vu{constructor(){d(this,v);b(this,"ascent",5);b(this,"descent",0);b(this,"lineGap",2);b(this,"glyphs",new Map([[" ",u(this,v,A).call(this,`
        ----
        ----
        ----
        ----
        ----
      `)],[".",u(this,v,A).call(this,`
        --
        --
        --
        ##
        ##
      `)],[":",u(this,v,A).call(this,`
        #
        -
        -
        #
        -
      `)],["!",u(this,v,A).call(this,`
        ###
        ###
        -#-
        ---
        -#-
      `)],["?",u(this,v,A).call(this,`
        ###
        --#
        -#-
        ---
        -#-
      `)],["'",u(this,v,A).call(this,`
        -
        #
        #
        -
        -
      `)],['"',u(this,v,A).call(this,`
        #-#
        #-#
        ---
        ---
        ---
      `)],["*",u(this,v,A).call(this,`
        --
        ##
        ##
        --
        --
      `)],["/",u(this,v,A).call(this,`
        --#
        --#
        -#-
        #--
        #--
      `)],["+",u(this,v,A).call(this,`
        ---
        -#-
        ###
        -#-
        ---
      `)],["-",u(this,v,A).call(this,`
        ---
        ---
        ###
        ---
        ---
      `)],["0",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        #-#
        -#-
      `)],["1",u(this,v,A).call(this,`
        -#-
        ##-
        -#-
        -#-
        ###
      `)],["2",u(this,v,A).call(this,`
        -#-
        #-#
        --#
        -#-
        ###
      `)],["3",u(this,v,A).call(this,`
        ###
        --#
        -##
        --#
        ##-
      `)],["4",u(this,v,A).call(this,`
        --#
        -##
        #-#
        ###
        --#
      `)],["5",u(this,v,A).call(this,`
        ###
        #--
        ###
        --#
        ##-
      `)],["6",u(this,v,A).call(this,`
        ###
        #--
        ###
        #-#
        ###
      `)],["7",u(this,v,A).call(this,`
        ###
        --#
        -#-
        -#-
        -#-
      `)],["8",u(this,v,A).call(this,`
        ###
        #-#
        -#-
        #-#
        ###
      `)],["9",u(this,v,A).call(this,`
        ###
        #-#
        ###
        --#
        ###
      `)],["%",u(this,v,A).call(this,`
        #-#
        --#
        -#-
        #--
        #-#
      `)],["$",u(this,v,A).call(this,`
        ###
        ##-
        -##
        ###
        -#-
      `)],["(",u(this,v,A).call(this,`
        -#
        #-
        #-
        #-
        -#
      `)],[")",u(this,v,A).call(this,`
        #-
        -#
        -#
        -#
        #-
      `)],["[",u(this,v,A).call(this,`
        ##
        #-
        #-
        #-
        ##
      `)],["]",u(this,v,A).call(this,`
        ##
        -#
        -#
        -#
        ##
      `)],["{",u(this,v,A).call(this,`
        -##
        -#-
        #--
        -#-
        -##
      `)],["}",u(this,v,A).call(this,`
        ##-
        -#-
        --#
        -#-
        ##-
      `)],["<",u(this,v,A).call(this,`
        --#
        -#-
        #--
        -#-
        --#
      `)],[">",u(this,v,A).call(this,`
        #--
        -#-
        --#
        -#-
        #--
      `)],["A",u(this,v,A).call(this,`
        -#-
        #-#
        ###
        #-#
        #-#
      `)],["B",u(this,v,A).call(this,`
        ##-
        #-#
        ##-
        #-#
        ###
      `)],["C",u(this,v,A).call(this,`
        -#-
        #-#
        #--
        #-#
        -#-
      `)],["D",u(this,v,A).call(this,`
        ##-
        #-#
        #-#
        #-#
        ##-
      `)],["E",u(this,v,A).call(this,`
        ###
        #--
        ##-
        #--
        ###
      `)],["F",u(this,v,A).call(this,`
        ###
        #--
        ##-
        #--
        #--
      `)],["G",u(this,v,A).call(this,`
        -#-
        #-#
        #--
        #-#
        -##
      `)],["H",u(this,v,A).call(this,`
        #-#
        #-#
        ###
        #-#
        #-#
      `)],["I",u(this,v,A).call(this,`
        ###
        -#-
        -#-
        -#-
        ###
      `)],["J",u(this,v,A).call(this,`
        --#
        --#
        --#
        #-#
        -#-
      `)],["K",u(this,v,A).call(this,`
        #-#
        #-#
        ##-
        #-#
        #-#
      `)],["L",u(this,v,A).call(this,`
        #--
        #--
        #--
        #--
        ###
      `)],["M",u(this,v,A).call(this,`
        #-#
        ###
        ###
        #-#
        #-#
      `)],["N",u(this,v,A).call(this,`
        ##-
        ###
        #-#
        #-#
        #-#
      `)],["O",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        #-#
        -#-
      `)],["P",u(this,v,A).call(this,`
        ##-
        #-#
        ###
        #--
        #--
      `)],["Q",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        ###
        -##
      `)],["R",u(this,v,A).call(this,`
        ##-
        #-#
        ##-
        #-#
        #-#
      `)],["S",u(this,v,A).call(this,`
        ###
        #--
        -#-
        --#
        ##-
      `)],["T",u(this,v,A).call(this,`
        ###
        -#-
        -#-
        -#-
        -#-
      `)],["U",u(this,v,A).call(this,`
        #-#
        #-#
        #-#
        #-#
        ###
      `)],["V",u(this,v,A).call(this,`
        #-#
        #-#
        #-#
        -#-
        -#-
      `)],["W",u(this,v,A).call(this,`
        #-#
        #-#
        ###
        ###
        #-#
      `)],["X",u(this,v,A).call(this,`
        #-#
        #-#
        -#-
        #-#
        #-#
      `)],["Y",u(this,v,A).call(this,`
        #-#
        #-#
        -#-
        -#-
        -#-
      `)],["Z",u(this,v,A).call(this,`
        ###
        --#
        -#-
        #--
        ###
      `)],["a",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        ###
        #-#
      `)],["b",u(this,v,A).call(this,`
        #--
        #--
        ##-
        #-#
        ##-
      `)],["c",u(this,v,A).call(this,`
        -##
        #--
        #--
        #--
        -##
      `)],["d",u(this,v,A).call(this,`
        --#
        --#
        -##
        #-#
        ###
      `)],["e",u(this,v,A).call(this,`
        -#-
        #-#
        ###
        #--
        -##
      `)],["f",u(this,v,A).call(this,`
        -##
        -#-
        ###
        -#-
        -#-
      `)],["g",u(this,v,A).call(this,`
        -#-
        #-#
        #--
        #-#
        -##
      `)],["h",u(this,v,A).call(this,`
        #--
        #--
        ##-
        #-#
        #-#
      `)],["i",u(this,v,A).call(this,`
        -#
        --
        -#
        -#
        -#
      `)],["j",u(this,v,A).call(this,`
        -##
        --#
        --#
        #-#
        -#-
      `)],["k",u(this,v,A).call(this,`
        #-#
        #-#
        ##-
        #-#
        #-#
      `)],["l",u(this,v,A).call(this,`
        #
        #
        #
        #
        #
      `)],["m",u(this,v,A).call(this,`
        #-#
        ###
        ###
        #-#
        #-#
      `)],["n",u(this,v,A).call(this,`
        ##-
        #-#
        #-#
        #-#
        #-#
      `)],["o",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        #-#
        -#-
      `)],["p",u(this,v,A).call(this,`
        ##-
        #-#
        ###
        #--
        #--
      `)],["q",u(this,v,A).call(this,`
        -#-
        #-#
        #-#
        ###
        -##
      `)],["r",u(this,v,A).call(this,`
        -#-
        #-#
        #--
        #--
        #--
      `)],["s",u(this,v,A).call(this,`
        -##
        #--
        -#-
        --#
        ##-
      `)],["t",u(this,v,A).call(this,`
        -#-
        ###
        -#-
        -#-
        -##
      `)],["u",u(this,v,A).call(this,`
        #-#
        #-#
        #-#
        #-#
        -#-
      `)],["v",u(this,v,A).call(this,`
        #-#
        #-#
        #-#
        -#-
        -#-
      `)],["w",u(this,v,A).call(this,`
        #-#
        #-#
        ###
        ###
        #-#
      `)],["x",u(this,v,A).call(this,`
        #-#
        #-#
        -#-
        #-#
        #-#
      `)],["y",u(this,v,A).call(this,`
        #-#
        #-#
        -#-
        -#-
        -#-
      `)],["z",u(this,v,A).call(this,`
        ###
        --#
        -#-
        #--
        ###
      `)]]))}mapGrapheme(e){return e}}v=new WeakSet,A=function(e){const t=mr.from(e);return{type:"pixels",pixels:t,advance:t.size.x+1}};class Yl{static detect(e){const t=e.id.toLowerCase();return t.includes("dualsense")?"dualsense":t.includes("8bitdo")||t.includes("2dc8")?"8bitdo":t.includes("054c")?"dualsense":t.includes("xbox")||t.includes("045e")?"xbox":(t.includes("xinput"),"other")}}class N{static addLoadedClass(){document.body.classList.add("loaded")}static addStartedClass(){document.body.classList.add("started")}static showError(e){document.body.classList.add("error"),document.getElementById("screen_error__message").innerText=String(e)}static updateMutedClass(e){document.body.classList[e?"add":"remove"]("muted")}static updateDebugClass(e){document.body.classList[e?"add":"remove"]("debug")}static updatePressedClasses(e){document.body.classList[e.up?"add":"remove"]("pressed_u"),document.body.classList[e.down?"add":"remove"]("pressed_d"),document.body.classList[e.left?"add":"remove"]("pressed_l"),document.body.classList[e.right?"add":"remove"]("pressed_r"),document.body.classList[e.a?"add":"remove"]("pressed_a"),document.body.classList[e.b?"add":"remove"]("pressed_b"),document.body.classList[e.menu?"add":"remove"]("pressed_menu"),document.body.classList[e.mute?"add":"remove"]("pressed_mute"),document.body.classList[e.fullscreen?"add":"remove"]("pressed_fullscreen")}}b(N,"selectors",{fullScreenSubject:"body",canvas:"#game_canvas",startButton:"#screen_start_game__button",controlsLeft:"#dpad_l",controlsRight:"#dpad_r",controlsUp:"#dpad_u",controlsDown:"#dpad_d",controlsUpLeft:"#dpad_ul",controlsUpRight:"#dpad_ur",controlsDownLeft:"#dpad_dl",controlsDownRight:"#dpad_dr",controlsA:"#button_a",controlsB:"#button_b",controlsMenu:"#button_menu",controlsFullScreen:"#button_fullscreen",controlsMuteToggle:"#button_mute"});(function(i){if(i.TextEncoder&&i.TextDecoder)return!1;function e(n="utf-8"){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${n}') is invalid.`)}Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),e.prototype.encode=function(n,s={stream:!1}){if(s.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let r=0;const o=n.length;let h=0,c=Math.max(32,o+(o>>1)+7),l=new Uint8Array(c>>3<<3);for(;r<o;){let f=n.charCodeAt(r++);if(f>=55296&&f<=56319){if(r<o){const m=n.charCodeAt(r);(m&64512)===56320&&(++r,f=((f&1023)<<10)+(m&1023)+65536)}if(f>=55296&&f<=56319)continue}if(h+4>l.length){c+=8,c*=1+r/n.length*2,c=c>>3<<3;const m=new Uint8Array(c);m.set(l),l=m}if(f&4294967168)if(!(f&4294965248))l[h++]=f>>6&31|192;else if(!(f&4294901760))l[h++]=f>>12&15|224,l[h++]=f>>6&63|128;else if(!(f&4292870144))l[h++]=f>>18&7|240,l[h++]=f>>12&63|128,l[h++]=f>>6&63|128;else continue;else{l[h++]=f;continue}l[h++]=f&63|128}return l.slice(0,h)};function t(n="utf-8",s={fatal:!1}){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${n}') is invalid.`);if(s.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(t.prototype,"fatal",{value:!1}),Object.defineProperty(t.prototype,"ignoreBOM",{value:!1}),t.prototype.decode=function(n,s={stream:!1}){if(s.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const r=new Uint8Array(n);let o=0;const h=r.length,c=[];for(;o<h;){const l=r[o++];if(l===0)break;if(!(l&128))c.push(l);else if((l&224)===192){const f=r[o++]&63;c.push((l&31)<<6|f)}else if((l&240)===224){const f=r[o++]&63,m=r[o++]&63;c.push((l&31)<<12|f<<6|m)}else if((l&248)===240){const f=r[o++]&63,m=r[o++]&63,_=r[o++]&63;let p=(l&7)<<18|f<<12|m<<6|_;p>65535&&(p-=65536,c.push(p>>>10&1023|55296),p=56320|p&1023),c.push(p)}}return String.fromCharCode.apply(null,c)},i.TextEncoder=e,i.TextDecoder=t})(typeof window<"u"?window:typeof self<"u"?self:void 0);function Xl(i,e="utf8"){return new TextDecoder(e).decode(i)}const xu=new TextEncoder;function Au(i){return xu.encode(i)}const Su=1024*8,Eu=(()=>{const i=new Uint8Array(4),e=new Uint32Array(i.buffer);return!((e[0]=1)&i[0])})(),Sr={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class Ol{constructor(e=Su,t={}){let n=!1;typeof e=="number"?e=new ArrayBuffer(e):(n=!0,this.lastWrittenByte=e.byteLength);const s=t.offset?t.offset>>>0:0,r=e.byteLength-s;let o=s;(ArrayBuffer.isView(e)||e instanceof Ol)&&(e.byteLength!==e.buffer.byteLength&&(o=e.byteOffset+s),e=e.buffer),n?this.lastWrittenByte=r:this.lastWrittenByte=0,this.buffer=e,this.length=r,this.byteLength=r,this.byteOffset=o,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,o,r),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const n=(this.offset+e)*2,s=new Uint8Array(n);s.set(new Uint8Array(this.buffer)),this.buffer=s.buffer,this.length=this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,t){const n=Sr[t].BYTES_PER_ELEMENT*e,s=this.byteOffset+this.offset,r=this.buffer.slice(s,s+n);if(this.littleEndian===Eu&&t!=="uint8"&&t!=="int8"){const h=new Uint8Array(this.buffer.slice(s,s+n));h.reverse();const c=new Sr[t](h.buffer);return this.offset+=n,c.reverse(),c}const o=new Sr[t](r);return this.offset+=n,o}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let t="";for(let n=0;n<e;n++)t+=this.readChar();return t}readUtf8(e=1){return Xl(this.readBytes(e))}decodeText(e=1,t="utf-8"){return Xl(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(Au(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const ku=4,jl=0,Ql=1,Cu=2;function Wn(i){let e=i.length;for(;--e>=0;)i[e]=0}const Ru=0,nh=1,Tu=2,Mu=3,Ou=258,Fl=29,Sa=256,us=Sa+1+Fl,on=30,Dl=19,sh=2*us+1,pi=15,Er=16,Fu=7,Pl=256,ah=16,rh=17,lh=18,Wr=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),La=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Du=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),oh=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Pu=512,fe=new Array((us+2)*2);Wn(fe);const is=new Array(on*2);Wn(is);const fs=new Array(Pu);Wn(fs);const cs=new Array(Ou-Mu+1);Wn(cs);const Il=new Array(Fl);Wn(Il);const qa=new Array(on);Wn(qa);function kr(i,e,t,n,s){this.static_tree=i,this.extra_bits=e,this.extra_base=t,this.elems=n,this.max_length=s,this.has_stree=i&&i.length}let hh,uh,fh;function Cr(i,e){this.dyn_tree=i,this.max_code=0,this.stat_desc=e}const ch=i=>i<256?fs[i]:fs[256+(i>>>7)],ds=(i,e)=>{i.pending_buf[i.pending++]=e&255,i.pending_buf[i.pending++]=e>>>8&255},vt=(i,e,t)=>{i.bi_valid>Er-t?(i.bi_buf|=e<<i.bi_valid&65535,ds(i,i.bi_buf),i.bi_buf=e>>Er-i.bi_valid,i.bi_valid+=t-Er):(i.bi_buf|=e<<i.bi_valid&65535,i.bi_valid+=t)},ae=(i,e,t)=>{vt(i,t[e*2],t[e*2+1])},dh=(i,e)=>{let t=0;do t|=i&1,i>>>=1,t<<=1;while(--e>0);return t>>>1},Iu=i=>{i.bi_valid===16?(ds(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=i.bi_buf&255,i.bi_buf>>=8,i.bi_valid-=8)},Uu=(i,e)=>{const t=e.dyn_tree,n=e.max_code,s=e.stat_desc.static_tree,r=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,h=e.stat_desc.extra_base,c=e.stat_desc.max_length;let l,f,m,_,p,y,I=0;for(_=0;_<=pi;_++)i.bl_count[_]=0;for(t[i.heap[i.heap_max]*2+1]=0,l=i.heap_max+1;l<sh;l++)f=i.heap[l],_=t[t[f*2+1]*2+1]+1,_>c&&(_=c,I++),t[f*2+1]=_,!(f>n)&&(i.bl_count[_]++,p=0,f>=h&&(p=o[f-h]),y=t[f*2],i.opt_len+=y*(_+p),r&&(i.static_len+=y*(s[f*2+1]+p)));if(I!==0){do{for(_=c-1;i.bl_count[_]===0;)_--;i.bl_count[_]--,i.bl_count[_+1]+=2,i.bl_count[c]--,I-=2}while(I>0);for(_=c;_!==0;_--)for(f=i.bl_count[_];f!==0;)m=i.heap[--l],!(m>n)&&(t[m*2+1]!==_&&(i.opt_len+=(_-t[m*2+1])*t[m*2],t[m*2+1]=_),f--)}},ph=(i,e,t)=>{const n=new Array(pi+1);let s=0,r,o;for(r=1;r<=pi;r++)s=s+t[r-1]<<1,n[r]=s;for(o=0;o<=e;o++){let h=i[o*2+1];h!==0&&(i[o*2]=dh(n[h]++,h))}},zu=()=>{let i,e,t,n,s;const r=new Array(pi+1);for(t=0,n=0;n<Fl-1;n++)for(Il[n]=t,i=0;i<1<<Wr[n];i++)cs[t++]=n;for(cs[t-1]=n,s=0,n=0;n<16;n++)for(qa[n]=s,i=0;i<1<<La[n];i++)fs[s++]=n;for(s>>=7;n<on;n++)for(qa[n]=s<<7,i=0;i<1<<La[n]-7;i++)fs[256+s++]=n;for(e=0;e<=pi;e++)r[e]=0;for(i=0;i<=143;)fe[i*2+1]=8,i++,r[8]++;for(;i<=255;)fe[i*2+1]=9,i++,r[9]++;for(;i<=279;)fe[i*2+1]=7,i++,r[7]++;for(;i<=287;)fe[i*2+1]=8,i++,r[8]++;for(ph(fe,us+1,r),i=0;i<on;i++)is[i*2+1]=5,is[i*2]=dh(i,5);hh=new kr(fe,Wr,Sa+1,us,pi),uh=new kr(is,La,0,on,pi),fh=new kr(new Array(0),Du,0,Dl,Fu)},gh=i=>{let e;for(e=0;e<us;e++)i.dyn_ltree[e*2]=0;for(e=0;e<on;e++)i.dyn_dtree[e*2]=0;for(e=0;e<Dl;e++)i.bl_tree[e*2]=0;i.dyn_ltree[Pl*2]=1,i.opt_len=i.static_len=0,i.sym_next=i.matches=0},_h=i=>{i.bi_valid>8?ds(i,i.bi_buf):i.bi_valid>0&&(i.pending_buf[i.pending++]=i.bi_buf),i.bi_buf=0,i.bi_valid=0},Vl=(i,e,t,n)=>{const s=e*2,r=t*2;return i[s]<i[r]||i[s]===i[r]&&n[e]<=n[t]},Rr=(i,e,t)=>{const n=i.heap[t];let s=t<<1;for(;s<=i.heap_len&&(s<i.heap_len&&Vl(e,i.heap[s+1],i.heap[s],i.depth)&&s++,!Vl(e,n,i.heap[s],i.depth));)i.heap[t]=i.heap[s],t=s,s<<=1;i.heap[t]=n},to=(i,e,t)=>{let n,s,r=0,o,h;if(i.sym_next!==0)do n=i.pending_buf[i.sym_buf+r++]&255,n+=(i.pending_buf[i.sym_buf+r++]&255)<<8,s=i.pending_buf[i.sym_buf+r++],n===0?ae(i,s,e):(o=cs[s],ae(i,o+Sa+1,e),h=Wr[o],h!==0&&(s-=Il[o],vt(i,s,h)),n--,o=ch(n),ae(i,o,t),h=La[o],h!==0&&(n-=qa[o],vt(i,n,h)));while(r<i.sym_next);ae(i,Pl,e)},qr=(i,e)=>{const t=e.dyn_tree,n=e.stat_desc.static_tree,s=e.stat_desc.has_stree,r=e.stat_desc.elems;let o,h,c=-1,l;for(i.heap_len=0,i.heap_max=sh,o=0;o<r;o++)t[o*2]!==0?(i.heap[++i.heap_len]=c=o,i.depth[o]=0):t[o*2+1]=0;for(;i.heap_len<2;)l=i.heap[++i.heap_len]=c<2?++c:0,t[l*2]=1,i.depth[l]=0,i.opt_len--,s&&(i.static_len-=n[l*2+1]);for(e.max_code=c,o=i.heap_len>>1;o>=1;o--)Rr(i,t,o);l=r;do o=i.heap[1],i.heap[1]=i.heap[i.heap_len--],Rr(i,t,1),h=i.heap[1],i.heap[--i.heap_max]=o,i.heap[--i.heap_max]=h,t[l*2]=t[o*2]+t[h*2],i.depth[l]=(i.depth[o]>=i.depth[h]?i.depth[o]:i.depth[h])+1,t[o*2+1]=t[h*2+1]=l,i.heap[1]=l++,Rr(i,t,1);while(i.heap_len>=2);i.heap[--i.heap_max]=i.heap[1],Uu(i,e),ph(t,c,i.bl_count)},eo=(i,e,t)=>{let n,s=-1,r,o=e[0*2+1],h=0,c=7,l=4;for(o===0&&(c=138,l=3),e[(t+1)*2+1]=65535,n=0;n<=t;n++)r=o,o=e[(n+1)*2+1],!(++h<c&&r===o)&&(h<l?i.bl_tree[r*2]+=h:r!==0?(r!==s&&i.bl_tree[r*2]++,i.bl_tree[ah*2]++):h<=10?i.bl_tree[rh*2]++:i.bl_tree[lh*2]++,h=0,s=r,o===0?(c=138,l=3):r===o?(c=6,l=3):(c=7,l=4))},io=(i,e,t)=>{let n,s=-1,r,o=e[0*2+1],h=0,c=7,l=4;for(o===0&&(c=138,l=3),n=0;n<=t;n++)if(r=o,o=e[(n+1)*2+1],!(++h<c&&r===o)){if(h<l)do ae(i,r,i.bl_tree);while(--h!==0);else r!==0?(r!==s&&(ae(i,r,i.bl_tree),h--),ae(i,ah,i.bl_tree),vt(i,h-3,2)):h<=10?(ae(i,rh,i.bl_tree),vt(i,h-3,3)):(ae(i,lh,i.bl_tree),vt(i,h-11,7));h=0,s=r,o===0?(c=138,l=3):r===o?(c=6,l=3):(c=7,l=4)}},Nu=i=>{let e;for(eo(i,i.dyn_ltree,i.l_desc.max_code),eo(i,i.dyn_dtree,i.d_desc.max_code),qr(i,i.bl_desc),e=Dl-1;e>=3&&i.bl_tree[oh[e]*2+1]===0;e--);return i.opt_len+=3*(e+1)+5+5+4,e},Bu=(i,e,t,n)=>{let s;for(vt(i,e-257,5),vt(i,t-1,5),vt(i,n-4,4),s=0;s<n;s++)vt(i,i.bl_tree[oh[s]*2+1],3);io(i,i.dyn_ltree,e-1),io(i,i.dyn_dtree,t-1)},Lu=i=>{let e=4093624447,t;for(t=0;t<=31;t++,e>>>=1)if(e&1&&i.dyn_ltree[t*2]!==0)return jl;if(i.dyn_ltree[9*2]!==0||i.dyn_ltree[10*2]!==0||i.dyn_ltree[13*2]!==0)return Ql;for(t=32;t<Sa;t++)if(i.dyn_ltree[t*2]!==0)return Ql;return jl};let no=!1;const $u=i=>{no||(zu(),no=!0),i.l_desc=new Cr(i.dyn_ltree,hh),i.d_desc=new Cr(i.dyn_dtree,uh),i.bl_desc=new Cr(i.bl_tree,fh),i.bi_buf=0,i.bi_valid=0,gh(i)},mh=(i,e,t,n)=>{vt(i,(Ru<<1)+(n?1:0),3),_h(i),ds(i,t),ds(i,~t),t&&i.pending_buf.set(i.window.subarray(e,e+t),i.pending),i.pending+=t},Gu=i=>{vt(i,nh<<1,3),ae(i,Pl,fe),Iu(i)},Zu=(i,e,t,n)=>{let s,r,o=0;i.level>0?(i.strm.data_type===Cu&&(i.strm.data_type=Lu(i)),qr(i,i.l_desc),qr(i,i.d_desc),o=Nu(i),s=i.opt_len+3+7>>>3,r=i.static_len+3+7>>>3,r<=s&&(s=r)):s=r=t+5,t+4<=s&&e!==-1?mh(i,e,t,n):i.strategy===ku||r===s?(vt(i,(nh<<1)+(n?1:0),3),to(i,fe,is)):(vt(i,(Tu<<1)+(n?1:0),3),Bu(i,i.l_desc.max_code+1,i.d_desc.max_code+1,o+1),to(i,i.dyn_ltree,i.dyn_dtree)),gh(i),n&&_h(i)},Hu=(i,e,t)=>(i.pending_buf[i.sym_buf+i.sym_next++]=e,i.pending_buf[i.sym_buf+i.sym_next++]=e>>8,i.pending_buf[i.sym_buf+i.sym_next++]=t,e===0?i.dyn_ltree[t*2]++:(i.matches++,e--,i.dyn_ltree[(cs[t]+Sa+1)*2]++,i.dyn_dtree[ch(e)*2]++),i.sym_next===i.sym_end);var Ju=$u,Wu=mh,qu=Zu,Ku=Hu,Yu=Gu,Xu={_tr_init:Ju,_tr_stored_block:Wu,_tr_flush_block:qu,_tr_tally:Ku,_tr_align:Yu};const ju=(i,e,t,n)=>{let s=i&65535|0,r=i>>>16&65535|0,o=0;for(;t!==0;){o=t>2e3?2e3:t,t-=o;do s=s+e[n++]|0,r=r+s|0;while(--o);s%=65521,r%=65521}return s|r<<16|0};var ps=ju;const Qu=()=>{let i,e=[];for(var t=0;t<256;t++){i=t;for(var n=0;n<8;n++)i=i&1?3988292384^i>>>1:i>>>1;e[t]=i}return e},Vu=new Uint32Array(Qu()),tf=(i,e,t,n)=>{const s=Vu,r=n+t;i^=-1;for(let o=n;o<r;o++)i=i>>>8^s[(i^e[o])&255];return i^-1};var it=tf,$n={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ea={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:ef,_tr_stored_block:Kr,_tr_flush_block:nf,_tr_tally:Ye,_tr_align:sf}=Xu,{Z_NO_FLUSH:Xe,Z_PARTIAL_FLUSH:af,Z_FULL_FLUSH:rf,Z_FINISH:Pt,Z_BLOCK:so,Z_OK:nt,Z_STREAM_END:ao,Z_STREAM_ERROR:re,Z_DATA_ERROR:lf,Z_BUF_ERROR:Tr,Z_DEFAULT_COMPRESSION:of,Z_FILTERED:hf,Z_HUFFMAN_ONLY:Oa,Z_RLE:uf,Z_FIXED:ff,Z_DEFAULT_STRATEGY:cf,Z_UNKNOWN:df,Z_DEFLATED:br}=Ea,pf=9,gf=15,_f=8,mf=29,bf=256,Yr=bf+1+mf,wf=30,yf=19,vf=2*Yr+1,xf=15,H=3,Ke=258,le=Ke+H+1,Af=32,Gn=42,Ul=57,Xr=69,jr=73,Qr=91,Vr=103,gi=113,Qn=666,ct=1,qn=2,Vi=3,Kn=4,Sf=3,_i=(i,e)=>(i.msg=$n[e],e),ro=i=>i*2-(i>4?9:0),Te=i=>{let e=i.length;for(;--e>=0;)i[e]=0},Ef=i=>{let e,t,n,s=i.w_size;e=i.hash_size,n=e;do t=i.head[--n],i.head[n]=t>=s?t-s:0;while(--e);e=s,n=e;do t=i.prev[--n],i.prev[n]=t>=s?t-s:0;while(--e)};let kf=(i,e,t)=>(e<<i.hash_shift^t)&i.hash_mask,je=kf;const St=i=>{const e=i.state;let t=e.pending;t>i.avail_out&&(t=i.avail_out),t!==0&&(i.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),i.next_out),i.next_out+=t,e.pending_out+=t,i.total_out+=t,i.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},Et=(i,e)=>{nf(i,i.block_start>=0?i.block_start:-1,i.strstart-i.block_start,e),i.block_start=i.strstart,St(i.strm)},J=(i,e)=>{i.pending_buf[i.pending++]=e},Yn=(i,e)=>{i.pending_buf[i.pending++]=e>>>8&255,i.pending_buf[i.pending++]=e&255},tl=(i,e,t,n)=>{let s=i.avail_in;return s>n&&(s=n),s===0?0:(i.avail_in-=s,e.set(i.input.subarray(i.next_in,i.next_in+s),t),i.state.wrap===1?i.adler=ps(i.adler,e,s,t):i.state.wrap===2&&(i.adler=it(i.adler,e,s,t)),i.next_in+=s,i.total_in+=s,s)},bh=(i,e)=>{let t=i.max_chain_length,n=i.strstart,s,r,o=i.prev_length,h=i.nice_match;const c=i.strstart>i.w_size-le?i.strstart-(i.w_size-le):0,l=i.window,f=i.w_mask,m=i.prev,_=i.strstart+Ke;let p=l[n+o-1],y=l[n+o];i.prev_length>=i.good_match&&(t>>=2),h>i.lookahead&&(h=i.lookahead);do if(s=e,!(l[s+o]!==y||l[s+o-1]!==p||l[s]!==l[n]||l[++s]!==l[n+1])){n+=2,s++;do;while(l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&n<_);if(r=Ke-(_-n),n=_-Ke,r>o){if(i.match_start=e,o=r,r>=h)break;p=l[n+o-1],y=l[n+o]}}while((e=m[e&f])>c&&--t!==0);return o<=i.lookahead?o:i.lookahead},Zn=i=>{const e=i.w_size;let t,n,s;do{if(n=i.window_size-i.lookahead-i.strstart,i.strstart>=e+(e-le)&&(i.window.set(i.window.subarray(e,e+e-n),0),i.match_start-=e,i.strstart-=e,i.block_start-=e,i.insert>i.strstart&&(i.insert=i.strstart),Ef(i),n+=e),i.strm.avail_in===0)break;if(t=tl(i.strm,i.window,i.strstart+i.lookahead,n),i.lookahead+=t,i.lookahead+i.insert>=H)for(s=i.strstart-i.insert,i.ins_h=i.window[s],i.ins_h=je(i,i.ins_h,i.window[s+1]);i.insert&&(i.ins_h=je(i,i.ins_h,i.window[s+H-1]),i.prev[s&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=s,s++,i.insert--,!(i.lookahead+i.insert<H)););}while(i.lookahead<le&&i.strm.avail_in!==0)},wh=(i,e)=>{let t=i.pending_buf_size-5>i.w_size?i.w_size:i.pending_buf_size-5,n,s,r,o=0,h=i.strm.avail_in;do{if(n=65535,r=i.bi_valid+42>>3,i.strm.avail_out<r||(r=i.strm.avail_out-r,s=i.strstart-i.block_start,n>s+i.strm.avail_in&&(n=s+i.strm.avail_in),n>r&&(n=r),n<t&&(n===0&&e!==Pt||e===Xe||n!==s+i.strm.avail_in)))break;o=e===Pt&&n===s+i.strm.avail_in?1:0,Kr(i,0,0,o),i.pending_buf[i.pending-4]=n,i.pending_buf[i.pending-3]=n>>8,i.pending_buf[i.pending-2]=~n,i.pending_buf[i.pending-1]=~n>>8,St(i.strm),s&&(s>n&&(s=n),i.strm.output.set(i.window.subarray(i.block_start,i.block_start+s),i.strm.next_out),i.strm.next_out+=s,i.strm.avail_out-=s,i.strm.total_out+=s,i.block_start+=s,n-=s),n&&(tl(i.strm,i.strm.output,i.strm.next_out,n),i.strm.next_out+=n,i.strm.avail_out-=n,i.strm.total_out+=n)}while(o===0);return h-=i.strm.avail_in,h&&(h>=i.w_size?(i.matches=2,i.window.set(i.strm.input.subarray(i.strm.next_in-i.w_size,i.strm.next_in),0),i.strstart=i.w_size,i.insert=i.strstart):(i.window_size-i.strstart<=h&&(i.strstart-=i.w_size,i.window.set(i.window.subarray(i.w_size,i.w_size+i.strstart),0),i.matches<2&&i.matches++,i.insert>i.strstart&&(i.insert=i.strstart)),i.window.set(i.strm.input.subarray(i.strm.next_in-h,i.strm.next_in),i.strstart),i.strstart+=h,i.insert+=h>i.w_size-i.insert?i.w_size-i.insert:h),i.block_start=i.strstart),i.high_water<i.strstart&&(i.high_water=i.strstart),o?Kn:e!==Xe&&e!==Pt&&i.strm.avail_in===0&&i.strstart===i.block_start?qn:(r=i.window_size-i.strstart,i.strm.avail_in>r&&i.block_start>=i.w_size&&(i.block_start-=i.w_size,i.strstart-=i.w_size,i.window.set(i.window.subarray(i.w_size,i.w_size+i.strstart),0),i.matches<2&&i.matches++,r+=i.w_size,i.insert>i.strstart&&(i.insert=i.strstart)),r>i.strm.avail_in&&(r=i.strm.avail_in),r&&(tl(i.strm,i.window,i.strstart,r),i.strstart+=r,i.insert+=r>i.w_size-i.insert?i.w_size-i.insert:r),i.high_water<i.strstart&&(i.high_water=i.strstart),r=i.bi_valid+42>>3,r=i.pending_buf_size-r>65535?65535:i.pending_buf_size-r,t=r>i.w_size?i.w_size:r,s=i.strstart-i.block_start,(s>=t||(s||e===Pt)&&e!==Xe&&i.strm.avail_in===0&&s<=r)&&(n=s>r?r:s,o=e===Pt&&i.strm.avail_in===0&&n===s?1:0,Kr(i,i.block_start,n,o),i.block_start+=n,St(i.strm)),o?Vi:ct)},Mr=(i,e)=>{let t,n;for(;;){if(i.lookahead<le){if(Zn(i),i.lookahead<le&&e===Xe)return ct;if(i.lookahead===0)break}if(t=0,i.lookahead>=H&&(i.ins_h=je(i,i.ins_h,i.window[i.strstart+H-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),t!==0&&i.strstart-t<=i.w_size-le&&(i.match_length=bh(i,t)),i.match_length>=H)if(n=Ye(i,i.strstart-i.match_start,i.match_length-H),i.lookahead-=i.match_length,i.match_length<=i.max_lazy_match&&i.lookahead>=H){i.match_length--;do i.strstart++,i.ins_h=je(i,i.ins_h,i.window[i.strstart+H-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart;while(--i.match_length!==0);i.strstart++}else i.strstart+=i.match_length,i.match_length=0,i.ins_h=i.window[i.strstart],i.ins_h=je(i,i.ins_h,i.window[i.strstart+1]);else n=Ye(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++;if(n&&(Et(i,!1),i.strm.avail_out===0))return ct}return i.insert=i.strstart<H-1?i.strstart:H-1,e===Pt?(Et(i,!0),i.strm.avail_out===0?Vi:Kn):i.sym_next&&(Et(i,!1),i.strm.avail_out===0)?ct:qn},nn=(i,e)=>{let t,n,s;for(;;){if(i.lookahead<le){if(Zn(i),i.lookahead<le&&e===Xe)return ct;if(i.lookahead===0)break}if(t=0,i.lookahead>=H&&(i.ins_h=je(i,i.ins_h,i.window[i.strstart+H-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),i.prev_length=i.match_length,i.prev_match=i.match_start,i.match_length=H-1,t!==0&&i.prev_length<i.max_lazy_match&&i.strstart-t<=i.w_size-le&&(i.match_length=bh(i,t),i.match_length<=5&&(i.strategy===hf||i.match_length===H&&i.strstart-i.match_start>4096)&&(i.match_length=H-1)),i.prev_length>=H&&i.match_length<=i.prev_length){s=i.strstart+i.lookahead-H,n=Ye(i,i.strstart-1-i.prev_match,i.prev_length-H),i.lookahead-=i.prev_length-1,i.prev_length-=2;do++i.strstart<=s&&(i.ins_h=je(i,i.ins_h,i.window[i.strstart+H-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart);while(--i.prev_length!==0);if(i.match_available=0,i.match_length=H-1,i.strstart++,n&&(Et(i,!1),i.strm.avail_out===0))return ct}else if(i.match_available){if(n=Ye(i,0,i.window[i.strstart-1]),n&&Et(i,!1),i.strstart++,i.lookahead--,i.strm.avail_out===0)return ct}else i.match_available=1,i.strstart++,i.lookahead--}return i.match_available&&(n=Ye(i,0,i.window[i.strstart-1]),i.match_available=0),i.insert=i.strstart<H-1?i.strstart:H-1,e===Pt?(Et(i,!0),i.strm.avail_out===0?Vi:Kn):i.sym_next&&(Et(i,!1),i.strm.avail_out===0)?ct:qn},Cf=(i,e)=>{let t,n,s,r;const o=i.window;for(;;){if(i.lookahead<=Ke){if(Zn(i),i.lookahead<=Ke&&e===Xe)return ct;if(i.lookahead===0)break}if(i.match_length=0,i.lookahead>=H&&i.strstart>0&&(s=i.strstart-1,n=o[s],n===o[++s]&&n===o[++s]&&n===o[++s])){r=i.strstart+Ke;do;while(n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&s<r);i.match_length=Ke-(r-s),i.match_length>i.lookahead&&(i.match_length=i.lookahead)}if(i.match_length>=H?(t=Ye(i,1,i.match_length-H),i.lookahead-=i.match_length,i.strstart+=i.match_length,i.match_length=0):(t=Ye(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++),t&&(Et(i,!1),i.strm.avail_out===0))return ct}return i.insert=0,e===Pt?(Et(i,!0),i.strm.avail_out===0?Vi:Kn):i.sym_next&&(Et(i,!1),i.strm.avail_out===0)?ct:qn},Rf=(i,e)=>{let t;for(;;){if(i.lookahead===0&&(Zn(i),i.lookahead===0)){if(e===Xe)return ct;break}if(i.match_length=0,t=Ye(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++,t&&(Et(i,!1),i.strm.avail_out===0))return ct}return i.insert=0,e===Pt?(Et(i,!0),i.strm.avail_out===0?Vi:Kn):i.sym_next&&(Et(i,!1),i.strm.avail_out===0)?ct:qn};function Yt(i,e,t,n,s){this.good_length=i,this.max_lazy=e,this.nice_length=t,this.max_chain=n,this.func=s}const Vn=[new Yt(0,0,0,0,wh),new Yt(4,4,8,4,Mr),new Yt(4,5,16,8,Mr),new Yt(4,6,32,32,Mr),new Yt(4,4,16,16,nn),new Yt(8,16,32,32,nn),new Yt(8,16,128,128,nn),new Yt(8,32,128,256,nn),new Yt(32,128,258,1024,nn),new Yt(32,258,258,4096,nn)],Tf=i=>{i.window_size=2*i.w_size,Te(i.head),i.max_lazy_match=Vn[i.level].max_lazy,i.good_match=Vn[i.level].good_length,i.nice_match=Vn[i.level].nice_length,i.max_chain_length=Vn[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=H-1,i.match_available=0,i.ins_h=0};function Mf(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=br,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(vf*2),this.dyn_dtree=new Uint16Array((2*wf+1)*2),this.bl_tree=new Uint16Array((2*yf+1)*2),Te(this.dyn_ltree),Te(this.dyn_dtree),Te(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(xf+1),this.heap=new Uint16Array(2*Yr+1),Te(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Yr+1),Te(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const ka=i=>{if(!i)return 1;const e=i.state;return!e||e.strm!==i||e.status!==Gn&&e.status!==Ul&&e.status!==Xr&&e.status!==jr&&e.status!==Qr&&e.status!==Vr&&e.status!==gi&&e.status!==Qn?1:0},yh=i=>{if(ka(i))return _i(i,re);i.total_in=i.total_out=0,i.data_type=df;const e=i.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?Ul:e.wrap?Gn:gi,i.adler=e.wrap===2?0:1,e.last_flush=-2,ef(e),nt},vh=i=>{const e=yh(i);return e===nt&&Tf(i.state),e},Of=(i,e)=>ka(i)||i.state.wrap!==2?re:(i.state.gzhead=e,nt),xh=(i,e,t,n,s,r)=>{if(!i)return re;let o=1;if(e===of&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),s<1||s>pf||t!==br||n<8||n>15||e<0||e>9||r<0||r>ff||n===8&&o!==1)return _i(i,re);n===8&&(n=9);const h=new Mf;return i.state=h,h.strm=i,h.status=Gn,h.wrap=o,h.gzhead=null,h.w_bits=n,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=s+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+H-1)/H),h.window=new Uint8Array(h.w_size*2),h.head=new Uint16Array(h.hash_size),h.prev=new Uint16Array(h.w_size),h.lit_bufsize=1<<s+6,h.pending_buf_size=h.lit_bufsize*4,h.pending_buf=new Uint8Array(h.pending_buf_size),h.sym_buf=h.lit_bufsize,h.sym_end=(h.lit_bufsize-1)*3,h.level=e,h.strategy=r,h.method=t,vh(i)},Ff=(i,e)=>xh(i,e,br,gf,_f,cf),Df=(i,e)=>{if(ka(i)||e>so||e<0)return i?_i(i,re):re;const t=i.state;if(!i.output||i.avail_in!==0&&!i.input||t.status===Qn&&e!==Pt)return _i(i,i.avail_out===0?Tr:re);const n=t.last_flush;if(t.last_flush=e,t.pending!==0){if(St(i),i.avail_out===0)return t.last_flush=-1,nt}else if(i.avail_in===0&&ro(e)<=ro(n)&&e!==Pt)return _i(i,Tr);if(t.status===Qn&&i.avail_in!==0)return _i(i,Tr);if(t.status===Gn&&t.wrap===0&&(t.status=gi),t.status===Gn){let s=br+(t.w_bits-8<<4)<<8,r=-1;if(t.strategy>=Oa||t.level<2?r=0:t.level<6?r=1:t.level===6?r=2:r=3,s|=r<<6,t.strstart!==0&&(s|=Af),s+=31-s%31,Yn(t,s),t.strstart!==0&&(Yn(t,i.adler>>>16),Yn(t,i.adler&65535)),i.adler=1,t.status=gi,St(i),t.pending!==0)return t.last_flush=-1,nt}if(t.status===Ul){if(i.adler=0,J(t,31),J(t,139),J(t,8),t.gzhead)J(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),J(t,t.gzhead.time&255),J(t,t.gzhead.time>>8&255),J(t,t.gzhead.time>>16&255),J(t,t.gzhead.time>>24&255),J(t,t.level===9?2:t.strategy>=Oa||t.level<2?4:0),J(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(J(t,t.gzhead.extra.length&255),J(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(i.adler=it(i.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=Xr;else if(J(t,0),J(t,0),J(t,0),J(t,0),J(t,0),J(t,t.level===9?2:t.strategy>=Oa||t.level<2?4:0),J(t,Sf),t.status=gi,St(i),t.pending!==0)return t.last_flush=-1,nt}if(t.status===Xr){if(t.gzhead.extra){let s=t.pending,r=(t.gzhead.extra.length&65535)-t.gzindex;for(;t.pending+r>t.pending_buf_size;){let h=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+h),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>s&&(i.adler=it(i.adler,t.pending_buf,t.pending-s,s)),t.gzindex+=h,St(i),t.pending!==0)return t.last_flush=-1,nt;s=0,r-=h}let o=new Uint8Array(t.gzhead.extra);t.pending_buf.set(o.subarray(t.gzindex,t.gzindex+r),t.pending),t.pending+=r,t.gzhead.hcrc&&t.pending>s&&(i.adler=it(i.adler,t.pending_buf,t.pending-s,s)),t.gzindex=0}t.status=jr}if(t.status===jr){if(t.gzhead.name){let s=t.pending,r;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>s&&(i.adler=it(i.adler,t.pending_buf,t.pending-s,s)),St(i),t.pending!==0)return t.last_flush=-1,nt;s=0}t.gzindex<t.gzhead.name.length?r=t.gzhead.name.charCodeAt(t.gzindex++)&255:r=0,J(t,r)}while(r!==0);t.gzhead.hcrc&&t.pending>s&&(i.adler=it(i.adler,t.pending_buf,t.pending-s,s)),t.gzindex=0}t.status=Qr}if(t.status===Qr){if(t.gzhead.comment){let s=t.pending,r;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>s&&(i.adler=it(i.adler,t.pending_buf,t.pending-s,s)),St(i),t.pending!==0)return t.last_flush=-1,nt;s=0}t.gzindex<t.gzhead.comment.length?r=t.gzhead.comment.charCodeAt(t.gzindex++)&255:r=0,J(t,r)}while(r!==0);t.gzhead.hcrc&&t.pending>s&&(i.adler=it(i.adler,t.pending_buf,t.pending-s,s))}t.status=Vr}if(t.status===Vr){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(St(i),t.pending!==0))return t.last_flush=-1,nt;J(t,i.adler&255),J(t,i.adler>>8&255),i.adler=0}if(t.status=gi,St(i),t.pending!==0)return t.last_flush=-1,nt}if(i.avail_in!==0||t.lookahead!==0||e!==Xe&&t.status!==Qn){let s=t.level===0?wh(t,e):t.strategy===Oa?Rf(t,e):t.strategy===uf?Cf(t,e):Vn[t.level].func(t,e);if((s===Vi||s===Kn)&&(t.status=Qn),s===ct||s===Vi)return i.avail_out===0&&(t.last_flush=-1),nt;if(s===qn&&(e===af?sf(t):e!==so&&(Kr(t,0,0,!1),e===rf&&(Te(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),St(i),i.avail_out===0))return t.last_flush=-1,nt}return e!==Pt?nt:t.wrap<=0?ao:(t.wrap===2?(J(t,i.adler&255),J(t,i.adler>>8&255),J(t,i.adler>>16&255),J(t,i.adler>>24&255),J(t,i.total_in&255),J(t,i.total_in>>8&255),J(t,i.total_in>>16&255),J(t,i.total_in>>24&255)):(Yn(t,i.adler>>>16),Yn(t,i.adler&65535)),St(i),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?nt:ao)},Pf=i=>{if(ka(i))return re;const e=i.state.status;return i.state=null,e===gi?_i(i,lf):nt},If=(i,e)=>{let t=e.length;if(ka(i))return re;const n=i.state,s=n.wrap;if(s===2||s===1&&n.status!==Gn||n.lookahead)return re;if(s===1&&(i.adler=ps(i.adler,e,t,0)),n.wrap=0,t>=n.w_size){s===0&&(Te(n.head),n.strstart=0,n.block_start=0,n.insert=0);let c=new Uint8Array(n.w_size);c.set(e.subarray(t-n.w_size,t),0),e=c,t=n.w_size}const r=i.avail_in,o=i.next_in,h=i.input;for(i.avail_in=t,i.next_in=0,i.input=e,Zn(n);n.lookahead>=H;){let c=n.strstart,l=n.lookahead-(H-1);do n.ins_h=je(n,n.ins_h,n.window[c+H-1]),n.prev[c&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=c,c++;while(--l);n.strstart=c,n.lookahead=H-1,Zn(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=H-1,n.match_available=0,i.next_in=o,i.input=h,i.avail_in=r,n.wrap=s,nt};var Uf=Ff,zf=xh,Nf=vh,Bf=yh,Lf=Of,$f=Df,Gf=Pf,Zf=If,Hf="pako deflate (from Nodeca project)",ns={deflateInit:Uf,deflateInit2:zf,deflateReset:Nf,deflateResetKeep:Bf,deflateSetHeader:Lf,deflate:$f,deflateEnd:Gf,deflateSetDictionary:Zf,deflateInfo:Hf};const Jf=(i,e)=>Object.prototype.hasOwnProperty.call(i,e);var Wf=function(i){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const n in t)Jf(t,n)&&(i[n]=t[n])}}return i},qf=i=>{let e=0;for(let n=0,s=i.length;n<s;n++)e+=i[n].length;const t=new Uint8Array(e);for(let n=0,s=0,r=i.length;n<r;n++){let o=i[n];t.set(o,s),s+=o.length}return t},wr={assign:Wf,flattenChunks:qf};let Ah=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Ah=!1}const gs=new Uint8Array(256);for(let i=0;i<256;i++)gs[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;gs[254]=gs[254]=1;var Kf=i=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(i);let e,t,n,s,r,o=i.length,h=0;for(s=0;s<o;s++)t=i.charCodeAt(s),(t&64512)===55296&&s+1<o&&(n=i.charCodeAt(s+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),s++)),h+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(h),r=0,s=0;r<h;s++)t=i.charCodeAt(s),(t&64512)===55296&&s+1<o&&(n=i.charCodeAt(s+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),s++)),t<128?e[r++]=t:t<2048?(e[r++]=192|t>>>6,e[r++]=128|t&63):t<65536?(e[r++]=224|t>>>12,e[r++]=128|t>>>6&63,e[r++]=128|t&63):(e[r++]=240|t>>>18,e[r++]=128|t>>>12&63,e[r++]=128|t>>>6&63,e[r++]=128|t&63);return e};const Yf=(i,e)=>{if(e<65534&&i.subarray&&Ah)return String.fromCharCode.apply(null,i.length===e?i:i.subarray(0,e));let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(i[n]);return t};var Xf=(i,e)=>{const t=e||i.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(i.subarray(0,e));let n,s;const r=new Array(t*2);for(s=0,n=0;n<t;){let o=i[n++];if(o<128){r[s++]=o;continue}let h=gs[o];if(h>4){r[s++]=65533,n+=h-1;continue}for(o&=h===2?31:h===3?15:7;h>1&&n<t;)o=o<<6|i[n++]&63,h--;if(h>1){r[s++]=65533;continue}o<65536?r[s++]=o:(o-=65536,r[s++]=55296|o>>10&1023,r[s++]=56320|o&1023)}return Yf(r,s)},jf=(i,e)=>{e=e||i.length,e>i.length&&(e=i.length);let t=e-1;for(;t>=0&&(i[t]&192)===128;)t--;return t<0||t===0?e:t+gs[i[t]]>e?t:e},_s={string2buf:Kf,buf2string:Xf,utf8border:jf};function Qf(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Sh=Qf;const Eh=Object.prototype.toString,{Z_NO_FLUSH:Vf,Z_SYNC_FLUSH:tc,Z_FULL_FLUSH:ec,Z_FINISH:ic,Z_OK:Ka,Z_STREAM_END:nc,Z_DEFAULT_COMPRESSION:sc,Z_DEFAULT_STRATEGY:ac,Z_DEFLATED:rc}=Ea;function zl(i){this.options=wr.assign({level:sc,method:rc,chunkSize:16384,windowBits:15,memLevel:8,strategy:ac},i||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Sh,this.strm.avail_out=0;let t=ns.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==Ka)throw new Error($n[t]);if(e.header&&ns.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=_s.string2buf(e.dictionary):Eh.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,t=ns.deflateSetDictionary(this.strm,n),t!==Ka)throw new Error($n[t]);this._dict_set=!0}}zl.prototype.push=function(i,e){const t=this.strm,n=this.options.chunkSize;let s,r;if(this.ended)return!1;for(e===~~e?r=e:r=e===!0?ic:Vf,typeof i=="string"?t.input=_s.string2buf(i):Eh.call(i)==="[object ArrayBuffer]"?t.input=new Uint8Array(i):t.input=i,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),(r===tc||r===ec)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(s=ns.deflate(t,r),s===nc)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),s=ns.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Ka;if(t.avail_out===0){this.onData(t.output);continue}if(r>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};zl.prototype.onData=function(i){this.chunks.push(i)};zl.prototype.onEnd=function(i){i===Ka&&(this.result=wr.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};const Fa=16209,lc=16191;var oc=function(e,t){let n,s,r,o,h,c,l,f,m,_,p,y,I,O,C,P,U,x,$,B,k,W,G,L;const Z=e.state;n=e.next_in,G=e.input,s=n+(e.avail_in-5),r=e.next_out,L=e.output,o=r-(t-e.avail_out),h=r+(e.avail_out-257),c=Z.dmax,l=Z.wsize,f=Z.whave,m=Z.wnext,_=Z.window,p=Z.hold,y=Z.bits,I=Z.lencode,O=Z.distcode,C=(1<<Z.lenbits)-1,P=(1<<Z.distbits)-1;t:do{y<15&&(p+=G[n++]<<y,y+=8,p+=G[n++]<<y,y+=8),U=I[p&C];e:for(;;){if(x=U>>>24,p>>>=x,y-=x,x=U>>>16&255,x===0)L[r++]=U&65535;else if(x&16){$=U&65535,x&=15,x&&(y<x&&(p+=G[n++]<<y,y+=8),$+=p&(1<<x)-1,p>>>=x,y-=x),y<15&&(p+=G[n++]<<y,y+=8,p+=G[n++]<<y,y+=8),U=O[p&P];i:for(;;){if(x=U>>>24,p>>>=x,y-=x,x=U>>>16&255,x&16){if(B=U&65535,x&=15,y<x&&(p+=G[n++]<<y,y+=8,y<x&&(p+=G[n++]<<y,y+=8)),B+=p&(1<<x)-1,B>c){e.msg="invalid distance too far back",Z.mode=Fa;break t}if(p>>>=x,y-=x,x=r-o,B>x){if(x=B-x,x>f&&Z.sane){e.msg="invalid distance too far back",Z.mode=Fa;break t}if(k=0,W=_,m===0){if(k+=l-x,x<$){$-=x;do L[r++]=_[k++];while(--x);k=r-B,W=L}}else if(m<x){if(k+=l+m-x,x-=m,x<$){$-=x;do L[r++]=_[k++];while(--x);if(k=0,m<$){x=m,$-=x;do L[r++]=_[k++];while(--x);k=r-B,W=L}}}else if(k+=m-x,x<$){$-=x;do L[r++]=_[k++];while(--x);k=r-B,W=L}for(;$>2;)L[r++]=W[k++],L[r++]=W[k++],L[r++]=W[k++],$-=3;$&&(L[r++]=W[k++],$>1&&(L[r++]=W[k++]))}else{k=r-B;do L[r++]=L[k++],L[r++]=L[k++],L[r++]=L[k++],$-=3;while($>2);$&&(L[r++]=L[k++],$>1&&(L[r++]=L[k++]))}}else if(x&64){e.msg="invalid distance code",Z.mode=Fa;break t}else{U=O[(U&65535)+(p&(1<<x)-1)];continue i}break}}else if(x&64)if(x&32){Z.mode=lc;break t}else{e.msg="invalid literal/length code",Z.mode=Fa;break t}else{U=I[(U&65535)+(p&(1<<x)-1)];continue e}break}}while(n<s&&r<h);$=y>>3,n-=$,y-=$<<3,p&=(1<<y)-1,e.next_in=n,e.next_out=r,e.avail_in=n<s?5+(s-n):5-(n-s),e.avail_out=r<h?257+(h-r):257-(r-h),Z.hold=p,Z.bits=y};const sn=15,lo=852,oo=592,ho=0,Or=1,uo=2,hc=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),uc=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),fc=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),cc=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),dc=(i,e,t,n,s,r,o,h)=>{const c=h.bits;let l=0,f=0,m=0,_=0,p=0,y=0,I=0,O=0,C=0,P=0,U,x,$,B,k,W=null,G;const L=new Uint16Array(sn+1),Z=new Uint16Array(sn+1);let zt=null,Kl,Ta,Ma;for(l=0;l<=sn;l++)L[l]=0;for(f=0;f<n;f++)L[e[t+f]]++;for(p=c,_=sn;_>=1&&L[_]===0;_--);if(p>_&&(p=_),_===0)return s[r++]=1<<24|64<<16|0,s[r++]=1<<24|64<<16|0,h.bits=1,0;for(m=1;m<_&&L[m]===0;m++);for(p<m&&(p=m),O=1,l=1;l<=sn;l++)if(O<<=1,O-=L[l],O<0)return-1;if(O>0&&(i===ho||_!==1))return-1;for(Z[1]=0,l=1;l<sn;l++)Z[l+1]=Z[l]+L[l];for(f=0;f<n;f++)e[t+f]!==0&&(o[Z[e[t+f]]++]=f);if(i===ho?(W=zt=o,G=20):i===Or?(W=hc,zt=uc,G=257):(W=fc,zt=cc,G=0),P=0,f=0,l=m,k=r,y=p,I=0,$=-1,C=1<<p,B=C-1,i===Or&&C>lo||i===uo&&C>oo)return 1;for(;;){Kl=l-I,o[f]+1<G?(Ta=0,Ma=o[f]):o[f]>=G?(Ta=zt[o[f]-G],Ma=W[o[f]-G]):(Ta=96,Ma=0),U=1<<l-I,x=1<<y,m=x;do x-=U,s[k+(P>>I)+x]=Kl<<24|Ta<<16|Ma|0;while(x!==0);for(U=1<<l-1;P&U;)U>>=1;if(U!==0?(P&=U-1,P+=U):P=0,f++,--L[l]===0){if(l===_)break;l=e[t+o[f]]}if(l>p&&(P&B)!==$){for(I===0&&(I=p),k+=m,y=l-I,O=1<<y;y+I<_&&(O-=L[y+I],!(O<=0));)y++,O<<=1;if(C+=1<<y,i===Or&&C>lo||i===uo&&C>oo)return 1;$=P&B,s[$]=p<<24|y<<16|k-r|0}}return P!==0&&(s[k+P]=l-I<<24|64<<16|0),h.bits=p,0};var ss=dc;const pc=0,kh=1,Ch=2,{Z_FINISH:fo,Z_BLOCK:gc,Z_TREES:Da,Z_OK:tn,Z_STREAM_END:_c,Z_NEED_DICT:mc,Z_STREAM_ERROR:It,Z_DATA_ERROR:Rh,Z_MEM_ERROR:Th,Z_BUF_ERROR:bc,Z_DEFLATED:co}=Ea,yr=16180,po=16181,go=16182,_o=16183,mo=16184,bo=16185,wo=16186,yo=16187,vo=16188,xo=16189,Ya=16190,he=16191,Fr=16192,Ao=16193,Dr=16194,So=16195,Eo=16196,ko=16197,Co=16198,Pa=16199,Ia=16200,Ro=16201,To=16202,Mo=16203,Oo=16204,Fo=16205,Pr=16206,Do=16207,Po=16208,Y=16209,Mh=16210,Oh=16211,wc=852,yc=592,vc=15,xc=vc,Io=i=>(i>>>24&255)+(i>>>8&65280)+((i&65280)<<8)+((i&255)<<24);function Ac(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const en=i=>{if(!i)return 1;const e=i.state;return!e||e.strm!==i||e.mode<yr||e.mode>Oh?1:0},Fh=i=>{if(en(i))return It;const e=i.state;return i.total_in=i.total_out=e.total=0,i.msg="",e.wrap&&(i.adler=e.wrap&1),e.mode=yr,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(wc),e.distcode=e.distdyn=new Int32Array(yc),e.sane=1,e.back=-1,tn},Dh=i=>{if(en(i))return It;const e=i.state;return e.wsize=0,e.whave=0,e.wnext=0,Fh(i)},Ph=(i,e)=>{let t;if(en(i))return It;const n=i.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?It:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,Dh(i))},Ih=(i,e)=>{if(!i)return It;const t=new Ac;i.state=t,t.strm=i,t.window=null,t.mode=yr;const n=Ph(i,e);return n!==tn&&(i.state=null),n},Sc=i=>Ih(i,xc);let Uo=!0,Ir,Ur;const Ec=i=>{if(Uo){Ir=new Int32Array(512),Ur=new Int32Array(32);let e=0;for(;e<144;)i.lens[e++]=8;for(;e<256;)i.lens[e++]=9;for(;e<280;)i.lens[e++]=7;for(;e<288;)i.lens[e++]=8;for(ss(kh,i.lens,0,288,Ir,0,i.work,{bits:9}),e=0;e<32;)i.lens[e++]=5;ss(Ch,i.lens,0,32,Ur,0,i.work,{bits:5}),Uo=!1}i.lencode=Ir,i.lenbits=9,i.distcode=Ur,i.distbits=5},Uh=(i,e,t,n)=>{let s;const r=i.state;return r.window===null&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),n>=r.wsize?(r.window.set(e.subarray(t-r.wsize,t),0),r.wnext=0,r.whave=r.wsize):(s=r.wsize-r.wnext,s>n&&(s=n),r.window.set(e.subarray(t-n,t-n+s),r.wnext),n-=s,n?(r.window.set(e.subarray(t-n,t),0),r.wnext=n,r.whave=r.wsize):(r.wnext+=s,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=s))),0},kc=(i,e)=>{let t,n,s,r,o,h,c,l,f,m,_,p,y,I,O=0,C,P,U,x,$,B,k,W;const G=new Uint8Array(4);let L,Z;const zt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(en(i)||!i.output||!i.input&&i.avail_in!==0)return It;t=i.state,t.mode===he&&(t.mode=Fr),o=i.next_out,s=i.output,c=i.avail_out,r=i.next_in,n=i.input,h=i.avail_in,l=t.hold,f=t.bits,m=h,_=c,W=tn;t:for(;;)switch(t.mode){case yr:if(t.wrap===0){t.mode=Fr;break}for(;f<16;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}if(t.wrap&2&&l===35615){t.wbits===0&&(t.wbits=15),t.check=0,G[0]=l&255,G[1]=l>>>8&255,t.check=it(t.check,G,2,0),l=0,f=0,t.mode=po;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((l&255)<<8)+(l>>8))%31){i.msg="incorrect header check",t.mode=Y;break}if((l&15)!==co){i.msg="unknown compression method",t.mode=Y;break}if(l>>>=4,f-=4,k=(l&15)+8,t.wbits===0&&(t.wbits=k),k>15||k>t.wbits){i.msg="invalid window size",t.mode=Y;break}t.dmax=1<<t.wbits,t.flags=0,i.adler=t.check=1,t.mode=l&512?xo:he,l=0,f=0;break;case po:for(;f<16;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}if(t.flags=l,(t.flags&255)!==co){i.msg="unknown compression method",t.mode=Y;break}if(t.flags&57344){i.msg="unknown header flags set",t.mode=Y;break}t.head&&(t.head.text=l>>8&1),t.flags&512&&t.wrap&4&&(G[0]=l&255,G[1]=l>>>8&255,t.check=it(t.check,G,2,0)),l=0,f=0,t.mode=go;case go:for(;f<32;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}t.head&&(t.head.time=l),t.flags&512&&t.wrap&4&&(G[0]=l&255,G[1]=l>>>8&255,G[2]=l>>>16&255,G[3]=l>>>24&255,t.check=it(t.check,G,4,0)),l=0,f=0,t.mode=_o;case _o:for(;f<16;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}t.head&&(t.head.xflags=l&255,t.head.os=l>>8),t.flags&512&&t.wrap&4&&(G[0]=l&255,G[1]=l>>>8&255,t.check=it(t.check,G,2,0)),l=0,f=0,t.mode=mo;case mo:if(t.flags&1024){for(;f<16;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}t.length=l,t.head&&(t.head.extra_len=l),t.flags&512&&t.wrap&4&&(G[0]=l&255,G[1]=l>>>8&255,t.check=it(t.check,G,2,0)),l=0,f=0}else t.head&&(t.head.extra=null);t.mode=bo;case bo:if(t.flags&1024&&(p=t.length,p>h&&(p=h),p&&(t.head&&(k=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(r,r+p),k)),t.flags&512&&t.wrap&4&&(t.check=it(t.check,n,p,r)),h-=p,r+=p,t.length-=p),t.length))break t;t.length=0,t.mode=wo;case wo:if(t.flags&2048){if(h===0)break t;p=0;do k=n[r+p++],t.head&&k&&t.length<65536&&(t.head.name+=String.fromCharCode(k));while(k&&p<h);if(t.flags&512&&t.wrap&4&&(t.check=it(t.check,n,p,r)),h-=p,r+=p,k)break t}else t.head&&(t.head.name=null);t.length=0,t.mode=yo;case yo:if(t.flags&4096){if(h===0)break t;p=0;do k=n[r+p++],t.head&&k&&t.length<65536&&(t.head.comment+=String.fromCharCode(k));while(k&&p<h);if(t.flags&512&&t.wrap&4&&(t.check=it(t.check,n,p,r)),h-=p,r+=p,k)break t}else t.head&&(t.head.comment=null);t.mode=vo;case vo:if(t.flags&512){for(;f<16;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}if(t.wrap&4&&l!==(t.check&65535)){i.msg="header crc mismatch",t.mode=Y;break}l=0,f=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),i.adler=t.check=0,t.mode=he;break;case xo:for(;f<32;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}i.adler=t.check=Io(l),l=0,f=0,t.mode=Ya;case Ya:if(t.havedict===0)return i.next_out=o,i.avail_out=c,i.next_in=r,i.avail_in=h,t.hold=l,t.bits=f,mc;i.adler=t.check=1,t.mode=he;case he:if(e===gc||e===Da)break t;case Fr:if(t.last){l>>>=f&7,f-=f&7,t.mode=Pr;break}for(;f<3;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}switch(t.last=l&1,l>>>=1,f-=1,l&3){case 0:t.mode=Ao;break;case 1:if(Ec(t),t.mode=Pa,e===Da){l>>>=2,f-=2;break t}break;case 2:t.mode=Eo;break;case 3:i.msg="invalid block type",t.mode=Y}l>>>=2,f-=2;break;case Ao:for(l>>>=f&7,f-=f&7;f<32;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}if((l&65535)!==(l>>>16^65535)){i.msg="invalid stored block lengths",t.mode=Y;break}if(t.length=l&65535,l=0,f=0,t.mode=Dr,e===Da)break t;case Dr:t.mode=So;case So:if(p=t.length,p){if(p>h&&(p=h),p>c&&(p=c),p===0)break t;s.set(n.subarray(r,r+p),o),h-=p,r+=p,c-=p,o+=p,t.length-=p;break}t.mode=he;break;case Eo:for(;f<14;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}if(t.nlen=(l&31)+257,l>>>=5,f-=5,t.ndist=(l&31)+1,l>>>=5,f-=5,t.ncode=(l&15)+4,l>>>=4,f-=4,t.nlen>286||t.ndist>30){i.msg="too many length or distance symbols",t.mode=Y;break}t.have=0,t.mode=ko;case ko:for(;t.have<t.ncode;){for(;f<3;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}t.lens[zt[t.have++]]=l&7,l>>>=3,f-=3}for(;t.have<19;)t.lens[zt[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,L={bits:t.lenbits},W=ss(pc,t.lens,0,19,t.lencode,0,t.work,L),t.lenbits=L.bits,W){i.msg="invalid code lengths set",t.mode=Y;break}t.have=0,t.mode=Co;case Co:for(;t.have<t.nlen+t.ndist;){for(;O=t.lencode[l&(1<<t.lenbits)-1],C=O>>>24,P=O>>>16&255,U=O&65535,!(C<=f);){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}if(U<16)l>>>=C,f-=C,t.lens[t.have++]=U;else{if(U===16){for(Z=C+2;f<Z;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}if(l>>>=C,f-=C,t.have===0){i.msg="invalid bit length repeat",t.mode=Y;break}k=t.lens[t.have-1],p=3+(l&3),l>>>=2,f-=2}else if(U===17){for(Z=C+3;f<Z;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}l>>>=C,f-=C,k=0,p=3+(l&7),l>>>=3,f-=3}else{for(Z=C+7;f<Z;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}l>>>=C,f-=C,k=0,p=11+(l&127),l>>>=7,f-=7}if(t.have+p>t.nlen+t.ndist){i.msg="invalid bit length repeat",t.mode=Y;break}for(;p--;)t.lens[t.have++]=k}}if(t.mode===Y)break;if(t.lens[256]===0){i.msg="invalid code -- missing end-of-block",t.mode=Y;break}if(t.lenbits=9,L={bits:t.lenbits},W=ss(kh,t.lens,0,t.nlen,t.lencode,0,t.work,L),t.lenbits=L.bits,W){i.msg="invalid literal/lengths set",t.mode=Y;break}if(t.distbits=6,t.distcode=t.distdyn,L={bits:t.distbits},W=ss(Ch,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,L),t.distbits=L.bits,W){i.msg="invalid distances set",t.mode=Y;break}if(t.mode=Pa,e===Da)break t;case Pa:t.mode=Ia;case Ia:if(h>=6&&c>=258){i.next_out=o,i.avail_out=c,i.next_in=r,i.avail_in=h,t.hold=l,t.bits=f,oc(i,_),o=i.next_out,s=i.output,c=i.avail_out,r=i.next_in,n=i.input,h=i.avail_in,l=t.hold,f=t.bits,t.mode===he&&(t.back=-1);break}for(t.back=0;O=t.lencode[l&(1<<t.lenbits)-1],C=O>>>24,P=O>>>16&255,U=O&65535,!(C<=f);){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}if(P&&!(P&240)){for(x=C,$=P,B=U;O=t.lencode[B+((l&(1<<x+$)-1)>>x)],C=O>>>24,P=O>>>16&255,U=O&65535,!(x+C<=f);){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}l>>>=x,f-=x,t.back+=x}if(l>>>=C,f-=C,t.back+=C,t.length=U,P===0){t.mode=Fo;break}if(P&32){t.back=-1,t.mode=he;break}if(P&64){i.msg="invalid literal/length code",t.mode=Y;break}t.extra=P&15,t.mode=Ro;case Ro:if(t.extra){for(Z=t.extra;f<Z;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}t.length+=l&(1<<t.extra)-1,l>>>=t.extra,f-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=To;case To:for(;O=t.distcode[l&(1<<t.distbits)-1],C=O>>>24,P=O>>>16&255,U=O&65535,!(C<=f);){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}if(!(P&240)){for(x=C,$=P,B=U;O=t.distcode[B+((l&(1<<x+$)-1)>>x)],C=O>>>24,P=O>>>16&255,U=O&65535,!(x+C<=f);){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}l>>>=x,f-=x,t.back+=x}if(l>>>=C,f-=C,t.back+=C,P&64){i.msg="invalid distance code",t.mode=Y;break}t.offset=U,t.extra=P&15,t.mode=Mo;case Mo:if(t.extra){for(Z=t.extra;f<Z;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}t.offset+=l&(1<<t.extra)-1,l>>>=t.extra,f-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){i.msg="invalid distance too far back",t.mode=Y;break}t.mode=Oo;case Oo:if(c===0)break t;if(p=_-c,t.offset>p){if(p=t.offset-p,p>t.whave&&t.sane){i.msg="invalid distance too far back",t.mode=Y;break}p>t.wnext?(p-=t.wnext,y=t.wsize-p):y=t.wnext-p,p>t.length&&(p=t.length),I=t.window}else I=s,y=o-t.offset,p=t.length;p>c&&(p=c),c-=p,t.length-=p;do s[o++]=I[y++];while(--p);t.length===0&&(t.mode=Ia);break;case Fo:if(c===0)break t;s[o++]=t.length,c--,t.mode=Ia;break;case Pr:if(t.wrap){for(;f<32;){if(h===0)break t;h--,l|=n[r++]<<f,f+=8}if(_-=c,i.total_out+=_,t.total+=_,t.wrap&4&&_&&(i.adler=t.check=t.flags?it(t.check,s,_,o-_):ps(t.check,s,_,o-_)),_=c,t.wrap&4&&(t.flags?l:Io(l))!==t.check){i.msg="incorrect data check",t.mode=Y;break}l=0,f=0}t.mode=Do;case Do:if(t.wrap&&t.flags){for(;f<32;){if(h===0)break t;h--,l+=n[r++]<<f,f+=8}if(t.wrap&4&&l!==(t.total&4294967295)){i.msg="incorrect length check",t.mode=Y;break}l=0,f=0}t.mode=Po;case Po:W=_c;break t;case Y:W=Rh;break t;case Mh:return Th;case Oh:default:return It}return i.next_out=o,i.avail_out=c,i.next_in=r,i.avail_in=h,t.hold=l,t.bits=f,(t.wsize||_!==i.avail_out&&t.mode<Y&&(t.mode<Pr||e!==fo))&&Uh(i,i.output,i.next_out,_-i.avail_out),m-=i.avail_in,_-=i.avail_out,i.total_in+=m,i.total_out+=_,t.total+=_,t.wrap&4&&_&&(i.adler=t.check=t.flags?it(t.check,s,_,i.next_out-_):ps(t.check,s,_,i.next_out-_)),i.data_type=t.bits+(t.last?64:0)+(t.mode===he?128:0)+(t.mode===Pa||t.mode===Dr?256:0),(m===0&&_===0||e===fo)&&W===tn&&(W=bc),W},Cc=i=>{if(en(i))return It;let e=i.state;return e.window&&(e.window=null),i.state=null,tn},Rc=(i,e)=>{if(en(i))return It;const t=i.state;return t.wrap&2?(t.head=e,e.done=!1,tn):It},Tc=(i,e)=>{const t=e.length;let n,s,r;return en(i)||(n=i.state,n.wrap!==0&&n.mode!==Ya)?It:n.mode===Ya&&(s=1,s=ps(s,e,t,0),s!==n.check)?Rh:(r=Uh(i,e,t,t),r?(n.mode=Mh,Th):(n.havedict=1,tn))};var Mc=Dh,Oc=Ph,Fc=Fh,Dc=Sc,Pc=Ih,Ic=kc,Uc=Cc,zc=Rc,Nc=Tc,Bc="pako inflate (from Nodeca project)",ce={inflateReset:Mc,inflateReset2:Oc,inflateResetKeep:Fc,inflateInit:Dc,inflateInit2:Pc,inflate:Ic,inflateEnd:Uc,inflateGetHeader:zc,inflateSetDictionary:Nc,inflateInfo:Bc};function Lc(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var $c=Lc;const zh=Object.prototype.toString,{Z_NO_FLUSH:Gc,Z_FINISH:Zc,Z_OK:ms,Z_STREAM_END:zr,Z_NEED_DICT:Nr,Z_STREAM_ERROR:Hc,Z_DATA_ERROR:zo,Z_MEM_ERROR:Jc}=Ea;function Ca(i){this.options=wr.assign({chunkSize:1024*64,windowBits:15,to:""},i||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(i&&i.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Sh,this.strm.avail_out=0;let t=ce.inflateInit2(this.strm,e.windowBits);if(t!==ms)throw new Error($n[t]);if(this.header=new $c,ce.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=_s.string2buf(e.dictionary):zh.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=ce.inflateSetDictionary(this.strm,e.dictionary),t!==ms)))throw new Error($n[t])}Ca.prototype.push=function(i,e){const t=this.strm,n=this.options.chunkSize,s=this.options.dictionary;let r,o,h;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?Zc:Gc,zh.call(i)==="[object ArrayBuffer]"?t.input=new Uint8Array(i):t.input=i,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),r=ce.inflate(t,o),r===Nr&&s&&(r=ce.inflateSetDictionary(t,s),r===ms?r=ce.inflate(t,o):r===zo&&(r=Nr));t.avail_in>0&&r===zr&&t.state.wrap>0&&i[t.next_in]!==0;)ce.inflateReset(t),r=ce.inflate(t,o);switch(r){case Hc:case zo:case Nr:case Jc:return this.onEnd(r),this.ended=!0,!1}if(h=t.avail_out,t.next_out&&(t.avail_out===0||r===zr))if(this.options.to==="string"){let c=_s.utf8border(t.output,t.next_out),l=t.next_out-c,f=_s.buf2string(t.output,c);t.next_out=l,t.avail_out=n-l,l&&t.output.set(t.output.subarray(c,c+l),0),this.onData(f)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(r===ms&&h===0)){if(r===zr)return r=ce.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};Ca.prototype.onData=function(i){this.chunks.push(i)};Ca.prototype.onEnd=function(i){i===ms&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=wr.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};function Nl(i,e){const t=new Ca(e);if(t.push(i),t.err)throw t.msg||$n[t.err];return t.result}function Wc(i,e){return e=e||{},e.raw=!0,Nl(i,e)}var qc=Ca,Kc=Nl,Yc=Wc,Xc=Nl,jc=Ea,Qc={Inflate:qc,inflate:Kc,inflateRaw:Yc,ungzip:Xc,constants:jc};const{Inflate:Vc,inflate:td,inflateRaw:mp,ungzip:bp}=Qc;var ed=Vc,id=td;const Br=[137,80,78,71,13,10,26,10],Nh=[];for(let i=0;i<256;i++){let e=i;for(let t=0;t<8;t++)e&1?e=3988292384^e>>>1:e=e>>>1;Nh[i]=e}const No=4294967295;function nd(i,e,t){let n=i;for(let s=0;s<t;s++)n=Nh[(n^e[s])&255]^n>>>8;return n}function sd(i,e){return(nd(No,i,e)^No)>>>0}var Bt;(function(i){i[i.UNKNOWN=-1]="UNKNOWN",i[i.GREYSCALE=0]="GREYSCALE",i[i.TRUECOLOUR=2]="TRUECOLOUR",i[i.INDEXED_COLOUR=3]="INDEXED_COLOUR",i[i.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",i[i.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"})(Bt||(Bt={}));var as;(function(i){i[i.UNKNOWN=-1]="UNKNOWN",i[i.DEFLATE=0]="DEFLATE"})(as||(as={}));var Xa;(function(i){i[i.UNKNOWN=-1]="UNKNOWN",i[i.ADAPTIVE=0]="ADAPTIVE"})(Xa||(Xa={}));var ja;(function(i){i[i.UNKNOWN=-1]="UNKNOWN",i[i.NO_INTERLACE=0]="NO_INTERLACE",i[i.ADAM7=1]="ADAM7"})(ja||(ja={}));const ad=new Uint8Array(0),Bo="\0",rd=new Uint16Array([255]),ld=new Uint8Array(rd.buffer),od=ld[0]===255;class hd extends Ol{constructor(e,t={}){super(e);const{checkCrc:n=!1}=t;this._checkCrc=n,this._inflator=new ed,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=as.UNKNOWN,this._filterMethod=Xa.UNKNOWN,this._interlaceMethod=ja.UNKNOWN,this._colorType=Bt.UNKNOWN,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let e=0;e<Br.length;e++)if(this.readUint8()!==Br[e])throw new Error(`wrong PNG signature. Byte at ${e} should be ${Br[e]}.`)}decodeChunk(){const e=this.readUint32(),t=this.readChars(4),n=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case"tEXt":this.decodetEXt(e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e);break}if(this.offset-n!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);if(this._checkCrc){const s=this.readUint32(),r=e+4,o=sd(new Uint8Array(this.buffer,this.byteOffset+this.offset-r-4,r),r);if(o!==s)throw new Error(`CRC mismatch for chunk ${t}. Expected ${s}, found ${o}`)}else this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=md(this.readUint8());const t=this.readUint8();this._colorType=t;let n;switch(t){case Bt.GREYSCALE:n=1;break;case Bt.TRUECOLOUR:n=3;break;case Bt.INDEXED_COLOUR:n=1;break;case Bt.GREYSCALE_ALPHA:n=2;break;case Bt.TRUECOLOUR_ALPHA:n=4;break;default:throw new Error(`Unknown color type: ${t}`)}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==as.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(e){if(e%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);const t=e/3;this._hasPalette=!0;const n=[];this._palette=n;for(let s=0;s<t;s++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,e)),this.skip(e)}decodetRNS(e){switch(this._colorType){case Bt.GREYSCALE:case Bt.TRUECOLOUR:{if(e%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${e}`);if(e/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${e/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let t=0;t<e/2;t++)this._transparency[t]=this.readUint16();break}case Bt.INDEXED_COLOUR:{if(e>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let t=0;for(;t<e;t++){const n=this.readByte();this._palette[t].push(n)}for(;t<this._palette.length;t++)this._palette[t].push(255);break}default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(e){let t="",n;for(;(n=this.readChar())!==Bo;)t+=n;const s=this.readUint8();if(s!==as.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${s}`);const r=this.readBytes(e-t.length-2);this._png.iccEmbeddedProfile={name:t,profile:id(r)}}decodetEXt(e){let t="",n;for(;(n=this.readChar())!==Bo;)t+=n;this._png.text[t]=this.readChars(e-t.length-1)}decodepHYs(){const e=this.readUint32(),t=this.readUint32(),n=this.readByte();this._png.resolution={x:e,y:t,unit:n}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const e=this._inflator.result;if(this._filterMethod!==Xa.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===ja.NO_INTERLACE)this.decodeInterlaceNull(e);else throw new Error(`Interlace method ${this._interlaceMethod} not supported`)}decodeInterlaceNull(e){const t=this._png.height,n=this._png.channels*this._png.depth/8,s=this._png.width*n,r=new Uint8Array(this._png.height*s);let o=ad,h=0,c,l;for(let f=0;f<t;f++){switch(c=e.subarray(h+1,h+1+s),l=r.subarray(f*s,(f+1)*s),e[h]){case 0:ud(c,l,s);break;case 1:fd(c,l,s,n);break;case 2:cd(c,l,o,s);break;case 3:dd(c,l,o,s,n);break;case 4:pd(c,l,o,s,n);break;default:throw new Error(`Unsupported filter: ${e[h]}`)}o=l,h+=s+1}if(this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency),this._png.depth===16){const f=new Uint16Array(r.buffer);if(od)for(let m=0;m<f.length;m++)f[m]=_d(f[m]);this._png.data=f}else this._png.data=r}}function ud(i,e,t){for(let n=0;n<t;n++)e[n]=i[n]}function fd(i,e,t,n){let s=0;for(;s<n;s++)e[s]=i[s];for(;s<t;s++)e[s]=i[s]+e[s-n]&255}function cd(i,e,t,n){let s=0;if(t.length===0)for(;s<n;s++)e[s]=i[s];else for(;s<n;s++)e[s]=i[s]+t[s]&255}function dd(i,e,t,n,s){let r=0;if(t.length===0){for(;r<s;r++)e[r]=i[r];for(;r<n;r++)e[r]=i[r]+(e[r-s]>>1)&255}else{for(;r<s;r++)e[r]=i[r]+(t[r]>>1)&255;for(;r<n;r++)e[r]=i[r]+(e[r-s]+t[r]>>1)&255}}function pd(i,e,t,n,s){let r=0;if(t.length===0){for(;r<s;r++)e[r]=i[r];for(;r<n;r++)e[r]=i[r]+e[r-s]&255}else{for(;r<s;r++)e[r]=i[r]+t[r]&255;for(;r<n;r++)e[r]=i[r]+gd(e[r-s],t[r],t[r-s])&255}}function gd(i,e,t){const n=i+e-t,s=Math.abs(n-i),r=Math.abs(n-e),o=Math.abs(n-t);return s<=r&&s<=o?i:r<=o?e:t}function _d(i){return(i&255)<<8|i>>8&255}function md(i){if(i!==1&&i!==2&&i!==4&&i!==8&&i!==16)throw new Error(`invalid bit depth: ${i}`);return i}var Lo;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.METRE=1]="METRE"})(Lo||(Lo={}));function bd(i,e){return new hd(i,e).decode()}var hn,Es,Me;class Kt{static loadFromStorage(){g(this,Me,window.localStorage.getItem(a(this,hn))!==a(this,Es)),N.updateDebugClass(this.enabled)}static get enabled(){return a(this,Me)}static set enabled(e){g(this,Me,e),z.infoBeetPx(`Debug flag set to: ${a(this,Me)}`),N.updateDebugClass(this.enabled),a(this,Me)?window.localStorage.removeItem(a(this,hn)):window.localStorage.setItem(a(this,hn),a(this,Es))}}hn=new WeakMap,Es=new WeakMap,Me=new WeakMap,d(Kt,hn,"beetpx__debug_disabled"),d(Kt,Es,"yes"),d(Kt,Me,!1);var bi;const Lt=class Lt{static debugBeetPx(...e){Lt.debug(a(Lt,bi),...e)}static debug(...e){Kt.enabled&&console.debug(...e.map(t=>t.__printDebug?t.__printDebug():t))}static infoBeetPx(...e){Lt.info(a(Lt,bi),...e)}static info(...e){console.info(...e.map(t=>t.__printDebug?t.__printDebug():t))}static warnBeetPx(...e){Lt.warn(a(Lt,bi),...e)}static warn(...e){console.warn(...e.map(t=>t.__printDebug?t.__printDebug():t))}static errorBeetPx(...e){Lt.error(a(Lt,bi),...e)}static error(...e){console.error(...e.map(t=>t.__printDebug?t.__printDebug():t))}};bi=new WeakMap,d(Lt,bi,"[BeetPx]");let z=Lt;var wi,ks,Cs,el,Rs,il,Ts,nl,Va,Bh,tr,Lh,er,$h,un,$a;class wd{constructor(e,t){d(this,Cs);d(this,Rs);d(this,Ts);d(this,Va);d(this,tr);d(this,er);d(this,un);d(this,wi,void 0);d(this,ks,void 0);g(this,wi,e),g(this,ks,t.decodeAudioData)}async loadAssets(e){const t=e.map(s=>s.trim()).filter(s=>s.length>0),n=t.filter(s=>!u(this,Cs,el).call(this,s)&&!u(this,Rs,il).call(this,s)&&!u(this,Ts,nl).call(this,s));if(n.length>0)throw Error("Assets: following URLs don't look like any of supported formats: "+n.map(s=>`"${s}"`).join(", ")+'. Supported formats are: ".png", ".wav", ".flac", ".json", ".ldtk"');await Promise.all([...t.filter(s=>u(this,Cs,el).call(this,s)).map(s=>u(this,Va,Bh).call(this,s)),...t.filter(s=>u(this,Rs,il).call(this,s)).map(s=>u(this,tr,Lh).call(this,s)),...t.filter(s=>u(this,Ts,nl).call(this,s)).map(s=>u(this,er,$h).call(this,s))])}}wi=new WeakMap,ks=new WeakMap,Cs=new WeakSet,el=function(e){return e.toLowerCase().endsWith(".png")},Rs=new WeakSet,il=function(e){return e.toLowerCase().endsWith(".wav")||e.toLowerCase().endsWith(".flac")},Ts=new WeakSet,nl=function(e){return e.toLowerCase().endsWith(".json")||e.toLowerCase().endsWith(".ldtk")},Va=new WeakSet,Bh=async function(e){z.infoBeetPx(`Assets: loading image "${e}"`);const t=await fetch(e);if(!u(this,un,$a).call(this,t.status))throw Error(`Assets: could not fetch PNG file: "${e}"`);const n=await t.arrayBuffer(),s=bd(n);if(s.channels!==3&&s.channels!==4)throw Error(`Assets: only PNG image files with 3 or 4 channels are supported. The file which seems to have ${s.channels} channels instead: "${e}"`);a(this,wi).addImageAsset(e,{width:s.width,height:s.height,channels:s.channels,rgba8bitData:s.data})},tr=new WeakSet,Lh=async function(e){z.infoBeetPx(`Assets: loading sound "${e}"`);const t=await fetch(e);if(!u(this,un,$a).call(this,t.status))throw Error(`Assets: could not fetch sound file: "${e}"`);const n=await t.arrayBuffer(),s=await a(this,ks).call(this,n);a(this,wi).addSoundAsset(e,{audioBuffer:s})},er=new WeakSet,$h=async function(e){z.infoBeetPx(`Assets: loading JSON "${e}"`);const t=await fetch(e);if(!u(this,un,$a).call(this,t.status))throw Error(`Assets: could not fetch JSON file: "${e}"`);const n=await t.json();a(this,wi).addJsonAsset(e,{json:n})},un=new WeakSet,$a=function(e){return e>=200&&e<300};var Ms,Os,Fs;class yd{constructor(){d(this,Ms,new Map);d(this,Os,new Map);d(this,Fs,new Map)}addImageAsset(e,t){a(this,Ms).set(e,t)}addSoundAsset(e,t){a(this,Os).set(e,t)}addJsonAsset(e,t){a(this,Fs).set(e,t)}getImageAsset(e){const t=a(this,Ms).get(e);if(!t)throw Error(`Assets: There is no image loaded for: ${e}`);return t}getSoundAsset(e){const t=a(this,Os).get(e);if(!t)throw Error(`Assets: There is no sound loaded for: ${e}`);return t}getJsonAsset(e){const t=a(this,Fs).get(e);if(!t)throw Error(`Assets: There is no JSON loaded for: ${e}`);return t}}Ms=new WeakMap,Os=new WeakMap,Fs=new WeakMap;function sl(){}var fn,Ga;const ls=class ls{static muteGain(e,t,n,s=sl){var r;n=Math.max(0,n),z.debugBeetPx(`AudioHelpers.muteGain (audioContextCurrentTime: ${t}, fadeOutMillis: ${n})`),u(r=ls,fn,Ga).call(r,15,100,()=>{n>0?e.gain.setValueCurveAtTime([e.gain.value,0],t,n/1e3):e.gain.setValueAtTime(0,t)}).catch(()=>{}),setTimeout(()=>{s()},n)}static unmuteGain(e,t,n,s=sl){var r;n=Math.max(0,n),z.debugBeetPx(`AudioHelpers.unmuteGain (audioContextCurrentTime: ${t}, fadeInMillis: ${n})`),u(r=ls,fn,Ga).call(r,15,100,()=>{n>0?e.gain.setValueCurveAtTime([e.gain.value,1],t,n/1e3):e.gain.setValueAtTime(1,t)}).catch(o=>{}),setTimeout(()=>{s()},n)}};fn=new WeakSet,Ga=async function(e,t,n){if(e<=0)return z.warnBeetPx("AudioHelpers.#tryNTimes: Failed to perform the action in N trials."),Promise.reject();try{n()}catch(s){return z.debugBeetPx("AudioHelpers.#tryNTimes: err:",s),new Promise((r,o)=>{z.debugBeetPx(`AudioHelpers.#tryNTimes: Failed to perform the action, trying ${e} more times…`),setTimeout(()=>{u(this,fn,Ga).call(this,e-1,t,n).then(r,o)},t)})}},d(ls,fn);let Ee=ls;var Xt,Rt,ht,cn,at,Ds,al,Ps,rl,Is,ll,Us,ol;const ue=class ue{constructor(e,t,n,s,r){d(this,Ds);d(this,Ps);d(this,Is);d(this,Us);b(this,"onEnded");b(this,"startedAtMs");b(this,"pausedAtMs");b(this,"accumulatedPauseMs");b(this,"isPausedByEngine");b(this,"isPausedByGame");d(this,Xt,void 0);d(this,Rt,void 0);d(this,ht,void 0);d(this,cn,void 0);d(this,at,void 0);s==="pause"?ue.playbacksToPauseOnGamePause.add(this):s==="mute"&&ue.playbacksToMuteOnGamePause.add(this),this.onEnded=()=>{r(),ue.playbacksToPauseOnGamePause.delete(this),ue.playbacksToMuteOnGamePause.delete(this)},g(this,ht,e),g(this,cn,t),g(this,at,a(this,ht).createGain()),a(this,at).gain.value=n?0:1,a(this,at).connect(a(this,cn)),this.isPausedByGame=!1,this.isPausedByEngine=!1,g(this,Rt,n),g(this,Xt,!1),this.startedAtMs=a(this,ht).currentTime*1e3,this.pausedAtMs=null,this.accumulatedPauseMs=0}mute(e){z.debugBeetPx(`AudioPlayback.mute (id: ${this.id}, type: ${this.type}, fadeOutMillis: ${e})`),!a(this,Rt)&&(g(this,Rt,!0),!a(this,Xt)&&(this.isPausedByGame||this.isPausedByEngine||u(this,Ds,al).call(this,e)))}muteByEngine(){z.debugBeetPx(`AudioPlayback.muteByEngine (id: ${this.id}, type: ${this.type})`),!a(this,Xt)&&(g(this,Xt,!0),!a(this,Rt)&&(this.isPausedByGame||this.isPausedByEngine||u(this,Ds,al).call(this,mi.muteUnmuteDefaultFadeMillis)))}unmute(e){z.debugBeetPx(`AudioPlayback.unmute (id: ${this.id}, type: ${this.type}, fadeInMillis: ${e})`),a(this,Rt)&&(g(this,Rt,!1),!a(this,Xt)&&(this.isPausedByGame||this.isPausedByEngine||u(this,Ps,rl).call(this,e)))}unmuteByEngine(){z.debugBeetPx(`AudioPlayback.unmuteByEngine (id: ${this.id}, type: ${this.type})`),a(this,Xt)&&(g(this,Xt,!1),!a(this,Rt)&&(this.isPausedByGame||this.isPausedByEngine||u(this,Ps,rl).call(this,mi.muteUnmuteDefaultFadeMillis)))}stop(e){if(z.debugBeetPx(`AudioPlayback.stop (id: ${this.id}, type: ${this.type}, fadeOutMillis: ${e})`),this.isPausedByGame||this.isPausedByEngine){this.onEnded();return}Ee.muteGain(a(this,at),a(this,ht).currentTime,e,()=>{this.stopAllNodes(),!this.isPausedByGame&&!this.isPausedByEngine&&this.onEnded()})}pause(){z.debugBeetPx(`AudioPlayback.pause (id: ${this.id}, type: ${this.type}})`),!this.isPausedByGame&&(this.isPausedByGame=!0,!this.isPausedByEngine&&u(this,Is,ll).call(this))}pauseByEngine(){z.debugBeetPx(`AudioPlayback.pauseByEngine (id: ${this.id}, type: ${this.type}})`),!this.isPausedByEngine&&(this.isPausedByEngine=!0,!this.isPausedByGame&&u(this,Is,ll).call(this))}resume(){z.debugBeetPx(`AudioPlayback.resume (id: ${this.id}, type: ${this.type})`),this.isPausedByGame&&(this.isPausedByGame=!1,!this.isPausedByEngine&&u(this,Us,ol).call(this))}resumeByEngine(){z.debugBeetPx(`AudioPlayback.resumeByEngine (id: ${this.id}, type: ${this.type})`),this.isPausedByEngine&&(this.isPausedByEngine=!1,!this.isPausedByGame&&u(this,Us,ol).call(this))}createSourceNode(){return a(this,ht).createBufferSource()}connectToMainGainNode(e){e.connect(a(this,at))}disconnectFromOutput(){a(this,at).disconnect()}};Xt=new WeakMap,Rt=new WeakMap,ht=new WeakMap,cn=new WeakMap,at=new WeakMap,Ds=new WeakSet,al=function(e){Ee.muteGain(a(this,at),a(this,ht).currentTime,e)},Ps=new WeakSet,rl=function(e){Ee.unmuteGain(a(this,at),a(this,ht).currentTime,e)},Is=new WeakSet,ll=function(){this.pausedAtMs=a(this,ht).currentTime*1e3,Ee.muteGain(a(this,at),a(this,ht).currentTime,mi.muteUnmuteDefaultFadeMillis,()=>{this.stopAllNodes()})},Us=new WeakSet,ol=function(){g(this,at,a(this,ht).createGain()),a(this,at).gain.value=a(this,Rt)||this.isPausedByEngine?0:1,a(this,at).connect(a(this,cn)),this.setupAndStartNodes(),this.pausedAtMs!=null&&(this.accumulatedPauseMs+=a(this,ht).currentTime*1e3-this.pausedAtMs,this.pausedAtMs=null),!a(this,Rt)&&!this.isPausedByEngine&&Ee.unmuteGain(a(this,at),a(this,ht).currentTime,mi.muteUnmuteDefaultFadeMillis,()=>{})},b(ue,"playbacksToPauseOnGamePause",new Set),b(ue,"playbacksToMuteOnGamePause",new Set),b(ue,"nextPlaybackId",1);let xt=ue;var dn,Tt,zs;class vd extends xt{constructor(t,n){super(n.audioContext,n.target,n.muteOnStart,n.onGamePause,n.onEnded);b(this,"id",xt.nextPlaybackId++);b(this,"type","looped");d(this,dn,void 0);d(this,Tt,void 0);d(this,zs,void 0);g(this,dn,n.assets.getSoundAsset(t)),g(this,zs,a(this,dn).audioBuffer.duration*1e3),g(this,Tt,this.createSourceNode()),this.setupAndStartNodes()}stopAllNodes(){a(this,Tt).stop()}setupAndStartNodes(){this.pausedAtMs!=null&&g(this,Tt,this.createSourceNode()),a(this,Tt).buffer=a(this,dn).audioBuffer,a(this,Tt).loop=!0,this.connectToMainGainNode(a(this,Tt)),a(this,Tt).addEventListener("ended",()=>{a(this,Tt).disconnect(),this.disconnectFromOutput(),!this.isPausedByGame&&!this.isPausedByEngine&&this.onEnded()});const t=this.pausedAtMs?(this.pausedAtMs-this.startedAtMs-this.accumulatedPauseMs)%a(this,zs):0;a(this,Tt).start(0,t/1e3)}}dn=new WeakMap,Tt=new WeakMap,zs=new WeakMap;var Ns,$t;class xd extends xt{constructor(t,n){super(n.audioContext,n.target,n.muteOnStart,n.onGamePause,n.onEnded);b(this,"id",xt.nextPlaybackId++);b(this,"type","once");d(this,Ns,void 0);d(this,$t,void 0);g(this,Ns,n.assets.getSoundAsset(t)),g(this,$t,this.createSourceNode()),this.setupAndStartNodes()}stopAllNodes(){a(this,$t).stop()}setupAndStartNodes(){this.pausedAtMs!=null&&g(this,$t,this.createSourceNode()),a(this,$t).buffer=a(this,Ns).audioBuffer,this.connectToMainGainNode(a(this,$t)),a(this,$t).addEventListener("ended",()=>{a(this,$t).disconnect(),this.disconnectFromOutput(),!this.isPausedByGame&&!this.isPausedByEngine&&this.onEnded()});const t=this.pausedAtMs?this.pausedAtMs-this.startedAtMs-this.accumulatedPauseMs:0;a(this,$t).start(0,t/1e3)}}Ns=new WeakMap,$t=new WeakMap;function Ad(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var s=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return i[n]}})}),t}var Lr={},Bl=function(e){if(typeof window>"u")return null;var t=window.OfflineAudioContext||window.webkitOfflineAudioContext,n=window.AudioContext||window.webkitAudioContext;if(!n)return null;typeof e=="number"&&(e={sampleRate:e});var s=e&&e.sampleRate;if(e&&e.offline)return t?new t(e.channels||2,e.length,s||44100):null;var r=Lr[s];if(r)return r;try{r=new n(e)}catch{r=new n}return Lr[r.sampleRate]=Lr[s]=r,r},Sd=Bl,Gh=Qe;function Qe(i,e){if(!(this instanceof Qe))return new Qe(i,e);if(e||(e=i,i=e&&e.context),e||(e={}),i===void 0&&(i=Sd()),e.numberOfChannels==null&&(e.numberOfChannels=1),e.sampleRate==null&&(e.sampleRate=i&&i.sampleRate||this.sampleRate),e.length==null&&(e.duration!=null?e.length=e.duration*e.sampleRate:e.length=1),i&&i.createBuffer)return i.createBuffer(e.numberOfChannels,Math.ceil(e.length),e.sampleRate);this.length=Math.ceil(e.length),this.numberOfChannels=e.numberOfChannels,this.sampleRate=e.sampleRate,this.duration=this.length/this.sampleRate,this._data=new Float32Array(this.length*this.numberOfChannels),this._channelData=[];for(var t=0;t<this.numberOfChannels;t++)this._channelData.push(this._data.subarray(t*this.length,(t+1)*this.length))}Qe.prototype.numberOfChannels=1;Qe.prototype.sampleRate=44100;Qe.prototype.getChannelData=function(i){if(i>=this.numberOfChannels||i<0||i==null)throw Error("Cannot getChannelData: channel number ("+i+") exceeds number of channels ("+this.numberOfChannels+")");return this._channelData[i]};Qe.prototype.copyFromChannel=function(i,e,t){t==null&&(t=0);for(var n=this._channelData[e],s=t,r=0;s<this.length&&r<i.length;s++,r++)i[r]=n[s]};Qe.prototype.copyToChannel=function(i,e,t){var n=this._channelData[e];t||(t=0);for(var s=t,r=0;s<this.length&&r<i.length;s++,r++)n[s]=i[r]};var vr=function(e){return e!=null&&typeof e.length=="number"&&typeof e.sampleRate=="number"&&typeof e.getChannelData=="function"&&typeof e.duration=="number"},Ed=kd;function kd(i,e,t){return e<t?i<e?e:i>t?t:i:i<t?t:i>e?e:i}var Cd=Object.prototype.toString,Zh=function(i){var e;return Cd.call(i)==="[object Object]"&&(e=Object.getPrototypeOf(i),e===null||e===Object.getPrototypeOf({}))};const Rd={},Td=Object.freeze(Object.defineProperty({__proto__:null,default:Rd},Symbol.toStringTag,{value:"Module"})),Hh=Ad(Td);/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var Md=function(i){return i!=null&&(Jh(i)||Od(i)||!!i._isBuffer)};function Jh(i){return!!i.constructor&&typeof i.constructor.isBuffer=="function"&&i.constructor.isBuffer(i)}function Od(i){return typeof i.readFloatLE=="function"&&typeof i.slice=="function"&&Jh(i.slice(0,0))}const Fd={8e3:8e3,11025:11025,16e3:16e3,22050:22050,44100:44100,48e3:48e3,88200:88200,96e3:96e3,176400:176400,192e3:192e3,352800:352800,384e3:384e3};/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var Dd=function(i){return i!=null&&(Wh(i)||Pd(i)||!!i._isBuffer)};function Wh(i){return!!i.constructor&&typeof i.constructor.isBuffer=="function"&&i.constructor.isBuffer(i)}function Pd(i){return typeof i.readFloatLE=="function"&&typeof i.slice=="function"&&Wh(i.slice(0,0))}var qh=function(e,t,n){var s={},r,o;if(typeof t=="string"&&(t=$o(t)),Array.isArray(t)){var h={};for(o=0;o<t.length;o++)h[t[o]]=!0;t=h}for(r in t)t[r]=$o(t[r]);var c={};for(r in t){var l=t[r];if(Array.isArray(l))for(o=0;o<l.length;o++){var f=l[o];if(n&&(c[f]=!0),f in e){if(s[r]=e[f],n)for(var m=o;m<l.length;m++)c[l[m]]=!0;break}}else r in e&&(t[r]&&(s[r]=e[r]),n&&(c[r]=!0))}if(n)for(r in e)c[r]||(s[r]=e[r]);return s},$r={};function $o(i){return $r[i]?$r[i]:(typeof i=="string"&&(i=$r[i]=i.split(/\s*,\s*|\s+/)),i)}var Go=Fd,Zo=Hh,Id=vr,Ud=Dd,zd=Zh,Nd=qh,Kh={parse:jh,stringify:Ld,detect:hl,type:Qh},Yh=Zo.endianness instanceof Function?Zo.endianness().toLowerCase():"le",Ho={uint:"uint32",uint8:"uint8",uint8_clamped:"uint8",uint16:"uint16",uint32:"uint32",int:"int32",int8:"int8",int16:"int16",int32:"int32",float:"float32",float32:"float32",float64:"float64",array:"array",arraybuffer:"arraybuffer",buffer:"buffer",audiobuffer:"audiobuffer",ndarray:"ndarray",ndsamples:"ndsamples"},bs={mono:1,stereo:2,quad:4,"5.1":6,"2.1":3,"3-channel":3,"5-channel":5},Bd=32;for(var Ua=6;Ua<Bd;Ua++)bs[Ua+"-channel"]=Ua;var Xh={};for(var Jo in bs)Xh[bs[Jo]]=Jo;function jh(i){for(var e={},t=i.split(/\s*[,;_]\s*|\s+/),n=0;n<t.length;n++){var s=t[n].toLowerCase();if(s==="planar"&&e.interleaved==null)e.interleaved=!1,e.channels==null&&(e.channels=2);else if((s==="interleave"||s==="interleaved")&&e.interleaved==null)e.interleaved=!0,e.channels==null&&(e.channels=2);else if(bs[s])e.channels=bs[s];else if(s==="le"||s==="LE"||s==="littleendian"||s==="bigEndian")e.endianness="le";else if(s==="be"||s==="BE"||s==="bigendian"||s==="bigEndian")e.endianness="be";else if(Ho[s])e.type=Ho[s],s==="audiobuffer"&&(e.endianness=Yh,e.interleaved=!1);else if(Go[s])e.sampleRate=Go[s];else if(/^\d+$/.test(s))e.sampleRate=parseInt(s);else throw Error("Cannot identify part `"+s+"`")}return e}function hl(i){if(!i)return{};var e=Nd(i,{channels:"channel channels numberOfChannels channelCount",sampleRate:"sampleRate rate",interleaved:"interleave interleaved",type:"type dtype",endianness:"endianness"});if(i.format&&(e.type="ndsamples"),e.sampleRate==null&&i.format&&i.format.sampleRate&&(e.sampleRate=i.format.sampleRate),i.planar&&(e.interleaved=!1),e.interleaved!=null&&e.channels==null&&(e.channels=2),e.type==null){var t=Qh(i);t&&(e.type=t)}return e.type==="audiobuffer"&&(e.endianness=Yh,e.interleaved=!1),e}function Ld(i,e){e===void 0?e={endianness:"le"}:e==null?e={}:typeof e=="string"?e=jh(e):e=hl(e),zd(i)||(i=hl(i));var t=[];return i.type!=null&&i.type!==e.type&&t.push(i.type||"float32"),i.channels!=null&&i.channels!==e.channels&&t.push(Xh[i.channels]),i.endianness!=null&&i.endianness!==e.endianness&&t.push(i.endianness||"le"),i.interleaved!=null&&i.interleaved!==e.interleaved&&i.type!=="audiobuffer"&&t.push(i.interleaved?"interleaved":"planar"),i.sampleRate!=null&&i.sampleRate!==e.sampleRate&&t.push(i.sampleRate),t.join(" ")}function Qh(i){if(Id(i))return"audiobuffer";if(Ud(i))return"buffer";if(Array.isArray(i))return"array";if(i instanceof ArrayBuffer)return"arraybuffer";if(i.shape&&i.dtype)return i.format?"ndsamples":"ndarray";if(i instanceof Float32Array)return"float32";if(i instanceof Float64Array)return"float64";if(i instanceof Uint8Array)return"uint8";if(i instanceof Uint8ClampedArray)return"uint8_clamped";if(i instanceof Int8Array)return"int8";if(i instanceof Int16Array)return"int16";if(i instanceof Uint16Array)return"uint16";if(i instanceof Int32Array)return"int32";if(i instanceof Uint32Array)return"uint32"}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Wo=Object.getOwnPropertySymbols,$d=Object.prototype.hasOwnProperty,Gd=Object.prototype.propertyIsEnumerable;function Zd(i){if(i==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(i)}function Hd(){try{if(!Object.assign)return!1;var i=new String("abc");if(i[5]="de",Object.getOwnPropertyNames(i)[0]==="5")return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;var n=Object.getOwnPropertyNames(e).map(function(r){return e[r]});if(n.join("")!=="0123456789")return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach(function(r){s[r]=r}),Object.keys(Object.assign({},s)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var Jd=Hd()?Object.assign:function(i,e){for(var t,n=Zd(i),s,r=1;r<arguments.length;r++){t=Object(arguments[r]);for(var o in t)$d.call(t,o)&&(n[o]=t[o]);if(Wo){s=Wo(t);for(var h=0;h<s.length;h++)Gd.call(t,s[h])&&(n[s[h]]=t[s[h]])}}return n},qo=Hh,Wd=Md,Ce=Kh,Ko=Jd,qd=vr,Kd=Yd;function Yd(i,e,t,n){if(qo(i,"First argument should be data"),qo(e,"Second argument should be format string or object"),e===t)return i;if(Yo(e))n=e,t=Ce.detect(n),e=Ce.detect(i);else if(t===void 0&&n===void 0)t=za(e),e=Ce.detect(i);else if(Yo(t))n=t,t=za(e),e=Ce.detect(i);else{var s=za(e),r=Ce.detect(i);r.dtype=s.type==="arraybuffer"?r.type:s.type,e=Ko(s,r);var o=za(t),h=Ce.detect(n);o.type&&(h.dtype=o.type==="arraybuffer"?h.type||e.dtype:o.type),t=Ko(o,h)}if(t.channels==null&&e.channels!=null&&(t.channels=e.channels),t.type==null&&(t.type=e.type,t.dtype=e.dtype),t.interleaved!=null&&e.channels==null&&(e.channels=2),e.type===t.type&&e.interleaved===t.interleaved&&e.endianness===t.endianness)return i;Xo(e),Xo(t),(i.buffers||i.buffer&&i.buffer.buffers)&&(i.buffer&&(i=i.buffer),i.buffers&&(i=i.join()));var c;if(qd(i))if(i._data)c=i._data;else{c=new Float32Array(i.length*i.numberOfChannels);for(var l=0,f=i.numberOfChannels;l<f;l++)c.set(i.getChannelData(l),i.length*l)}else i instanceof ArrayBuffer?c=new Na[e.dtype](i):Wd(i)?(i.byteOffset!=null?c=i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength):c=i.buffer,c=new Na[e.dtype](c)):c=i;var m=t.type==="array"?Array.from(c):new Na[t.dtype](c);if(e.max!==t.max)for(var _=e.max-e.min,p=t.max-t.min,y=0,f=c.length;y<f;y++){var I=c[y],O=(I-e.min)/_;I=O*p+t.min,m[y]=Math.max(t.min,Math.min(t.max,I))}if(e.interleaved!=t.interleaved){var C=e.channels,P=Math.floor(c.length/C);e.interleaved&&!t.interleaved?m=m.map(function(W,G,L){var Z=G%P,zt=~~(G/P);return L[Z*C+zt]}):!e.interleaved&&t.interleaved&&(m=m.map(function(W,G,L){var Z=~~(G/C),zt=G%C;return L[zt*P+Z]}))}if(t.dtype!="array"&&t.dtype!="int8"&&t.dtype!="uint8"&&e.endianness&&t.endianness&&e.endianness!==t.endianness)for(var U=t.endianness==="le",x=new DataView(m.buffer),$=m.BYTES_PER_ELEMENT,B="set"+t.dtype[0].toUpperCase()+t.dtype.slice(1),y=0,f=m.length;y<f;y++)x[B](y*$,m[y],U);if(t.type,n){if(Array.isArray(n))for(var y=0;y<m.length;y++)n[y]=m[y];else if(n instanceof ArrayBuffer){var k=new Na[t.dtype](n);k.set(m),n=k}else n.set(m);m=n}return(t.type==="arraybuffer"||t.type==="buffer")&&(m=m.buffer),m}function za(i){return typeof i=="string"?Ce.parse(i):Ce.detect(i)}function Yo(i){return typeof i!="string"&&(Array.isArray(i)||ArrayBuffer.isView(i)||i instanceof ArrayBuffer)}var Na={uint8:Uint8Array,uint8_clamped:Uint8ClampedArray,uint16:Uint16Array,uint32:Uint32Array,int8:Int8Array,int16:Int16Array,int32:Int32Array,float32:Float32Array,float64:Float64Array,array:Array,arraybuffer:Uint8Array,buffer:Uint8Array},Xd={float32:"float32",audiobuffer:"float32",ndsamples:"float32",ndarray:"float32",float64:"float64",buffer:"uint8",arraybuffer:"uint8",uint8:"uint8",uint8_clamped:"uint8",uint16:"uint16",uint32:"uint32",int8:"int8",int16:"int16",int32:"int32",array:"array"};function Xo(i){switch(i.dtype||(i.dtype=Xd[i.type]||"array"),i.dtype){case"float32":case"float64":case"audiobuffer":case"ndsamples":case"ndarray":i.min=-1,i.max=1;break;case"uint8":i.min=0,i.max=255;break;case"uint16":i.min=0,i.max=65535;break;case"uint32":i.min=0,i.max=4294967295;break;case"int8":i.min=-128,i.max=127;break;case"int16":i.min=-32768,i.max=32767;break;case"int32":i.min=-2147483648,i.max=2147483647;break;default:i.min=-1,i.max=1;break}return i}var jd=function(e){return atob(e)},ul={exports:{}};(function(i,e){(function(t){function n(s,r){if(s instanceof Boolean||typeof s=="boolean"||(r instanceof Object||(r={}),r.hasOwnProperty("allowBlank")&&!r.allowBlank&&s===""))return!1;var o="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+/]{3}=)?";return r.mime&&(o="(data:\\w+\\/[a-zA-Z\\+\\-\\.]+;base64,)?"+o),r.paddingRequired===!1&&(o="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}(==)?|[A-Za-z0-9+\\/]{3}=?)?"),new RegExp("^"+o+"$","gi").test(s)}i.exports&&(e=i.exports=n),e.isBase64=n})()})(ul,ul.exports);var Qd=ul.exports,Vh=jd,Vd=Qd,t0=function(e){if(typeof e!="string")throw Error("Argument should be a string");return/^data\:/i.test(e)?e0(e):(Vd(e)&&(e=Vh(e)),tu(e))};function tu(i){for(var e=new Uint8Array(i.length),t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e.buffer}function e0(i){i=i.replace(/\r?\n/g,"");var e=i.indexOf(",");if(e===-1||e<=4)throw new TypeError("malformed data-URI");for(var t=i.substring(5,e).split(";"),n=!1,s="US-ASCII",r=0;r<t.length;r++)t[r]=="base64"?n=!0:t[r].indexOf("charset=")==0&&(s=t[r].substring(8));var o=unescape(i.substring(e+1));n&&(o=Vh(o));var h=tu(o);return h.type=t[0]||"text/plain",h.charset=s,h}var i0=Gh,n0=vr,s0=Zh,a0=Bl,r0=Kd,jo=Kh,l0=t0,o0=qh,h0=function i(e,t){var n,s,r,o,h,c,l;if(typeof t=="number"?t={channels:t}:typeof t=="string"?t={format:t}:t===void 0&&(s0(e)?(t=e,e=void 0):t={}),t=o0(t,{format:"format type dtype dataType",channels:"channel channels numberOfChannels channelCount",sampleRate:"sampleRate rate",length:"length size",duration:"duration time"}),r=t.channels,o=t.sampleRate,t.format&&(h=Qo(t.format)),h&&(r&&!h.channels?h.channels=r:h.channels&&!r&&(r=h.channels),!o&&h.sampleRate&&(o=h.sampleRate)),e==null)t.duration!=null?(o||(o=44100),n=o*t.duration):n=t.length;else if(n0(e))if(n=e.length,r==null&&(r=e.numberOfChannels),o==null&&(o=e.sampleRate),e._channelData)s=e._channelData.slice(0,r);else for(s=[],c=0,l=r;c<l;c++)s[c]=e.getChannelData(c);else if(typeof e=="number")n=e;else if(Array.isArray(e)&&(Array.isArray(e[0])||ArrayBuffer.isView(e[0])))for(n=e[0].length,s=[],r||(r=e.length),c=0;c<r;c++)s[c]=e[c]instanceof Float32Array?e[c]:new Float32Array(e[c]);else{if(e.shape&&e.data)return e.shape&&(r=e.shape[1]),!o&&e.format&&(o=e.format.sampleRate),i(e.data,{channels:r,sampleRate:o});for(typeof e=="string"&&(e=l0(e)),h||(h=Qo(e)),r||(r=h.channels||1),e=r0(e,h,"float32 planar"),n=Math.floor(e.length/r),s=[],c=0;c<r;c++)s[c]=e.subarray(c*n,(c+1)*n)}var f=new i0(t.context===null||n===0?null:t.context||a0(),{length:n??1,numberOfChannels:r||1,sampleRate:o||44100});if(s)for(c=0,l=s.length;c<l;c++)f.getChannelData(c).set(s[c]);return f};function Qo(i){return typeof i=="string"?jo.parse(i):jo.detect(i)}var eu=Gh,Ra=vr,u0=Ed,f0=Bl,c0=h0,d0=function(i){return i===0&&1/i===-1/0},Ut=function(e,t){return e==null?0:d0(e)?t:e<=-t?0:e<0?t+e%t:Math.min(t,e)},Gr,xr={create:Hn,copy:Ll,shallow:iu,clone:p0,reverse:g0,invert:_0,zero:m0,noise:b0,equal:nu,fill:Ve,slice:$l,concat:ws,resize:v0,pad:Gl,padLeft:x0,padRight:A0,rotate:S0,shift:E0,normalize:k0,removeStatic:C0,trim:T0,trimLeft:M0,trimRight:O0,mix:F0,size:D0,data:P0,subbuffer:y0,repeat:w0};Object.defineProperty(xr,"context",{get:function(){return Gr||(Gr=f0()),Gr}});var Xn=xr;function Hn(i,e,t){return typeof e=="number"?e={channels:e}:typeof e=="string"?e={format:e}:e||(e={}),t&&(e.sampleRate=t),e.context=xr.context,c0(i,e)}function Ll(i,e,t){Q(i),Q(e),t=t||0;for(var n=0,s=Math.min(i.numberOfChannels,e.numberOfChannels);n<s;n++)e.getChannelData(n).set(i.getChannelData(n),t);return e}function Q(i){if(!Ra(i))throw new Error("Argument should be an AudioBuffer instance.")}function iu(i){return Q(i),xr.context.createBuffer(i.numberOfChannels,i.length,i.sampleRate)}function p0(i){return Ll(i,iu(i))}function g0(i,e,t,n){Q(i),!Ra(e)&&e!=null&&(n=t,t=e,e=null),e?(Q(e),Ll(i,e)):e=i,t=t==null?0:Ut(t,i.length),n=n==null?i.length:Ut(n,i.length);for(var s=0,r=e.numberOfChannels;s<r;++s)e.getChannelData(s).subarray(t,n).reverse();return e}function _0(i,e,t,n){return!Ra(e)&&e!=null&&(n=t,t=e,e=null),Ve(i,e,function(s){return-s},t,n)}function m0(i,e,t,n){return Ve(i,e,0,t,n)}function b0(i,e,t,n){return Ve(i,e,function(s){return Math.random()*2-1},t,n)}function nu(i,e){if(arguments.length>2){for(var t=0,n=arguments.length-1;t<n;t++)if(!nu(arguments[t],arguments[t+1]))return!1;return!0}if(Q(i),Q(e),i.length!==e.length||i.numberOfChannels!==e.numberOfChannels)return!1;for(var s=0;s<i.numberOfChannels;s++)for(var r=i.getChannelData(s),o=e.getChannelData(s),t=0;t<r.length;t++)if(r[t]!==o[t])return!1;return!0}function Ve(i,e,t,n,s){if(Q(i),!Ra(e)&&e!=null&&(typeof t=="function"||(s=n,n=t,t=e),e=null),e?Q(e):e=i,n=n==null?0:Ut(n,i.length),s=s==null?i.length:Ut(s,i.length),t instanceof Function)for(var r=0,o=i.numberOfChannels;r<o;r++)for(var l=i.getChannelData(r),h=e.getChannelData(r),c=n;c<s;c++)h[c]=t.call(i,l[c],c,r,l);else for(var r=0,o=i.numberOfChannels;r<o;r++)for(var h=e.getChannelData(r),c=n;c<s;c++)h[c]=t;return e}function w0(i,e){if(Q(i),!e||e<0)return new eu(null,{length:0,numberOfChannels:i.numberOfChannels,sampleRate:i.sampleRate});if(e===1)return i;for(var t=[],n=0;n<e;n++)t.push(i);return ws(t)}function $l(i,e,t){Q(i),e=e==null?0:Ut(e,i.length),t=t==null?i.length:Ut(t,i.length);for(var n=[],s=0;s<i.numberOfChannels;s++){var r=i.getChannelData(s);n.push(r.slice(e,t))}return Hn(n,i.numberOfChannels,i.sampleRate)}function y0(i,e,t,n){if(Q(i),Array.isArray(e)?(n=e,e=0,t=-0):Array.isArray(t)&&(n=t,t=-0),!Array.isArray(n)){n=Array(i.numberOfChannels);for(var s=0;s<i.numberOfChannels;s++)n[s]=s}e=e==null?0:Ut(e,i.length),t=t==null?i.length:Ut(t,i.length);for(var r=[],o=0;o<n.length;o++){var h=n[o],c=i.getChannelData(h);r.push(c.subarray(e,t))}var l=new eu(null,{length:0,sampleRate:i.sampleRate,numberOfChannels:i.numberOfChannels});return l.length=r[0].length,l._data=null,l._channelData=r,l.duration=l.length/l.sampleRate,l}function ws(){for(var i=[],e=0,t=arguments.length;e<t;e++){var n=arguments[e];if(Array.isArray(n))for(var s=0;s<n.length;s++)i.push(n[s]);else i.push(n)}for(var r=1,o=0,h=0,e=0;e<i.length;e++){var c=i[e];Q(c),o+=c.length,r=Math.max(c.numberOfChannels,r),h=Math.max(c.sampleRate,h)}for(var l=[],f=0;f<r;f++){for(var m=new Float32Array(o),_=0,e=0;e<i.length;e++){var c=i[e];f<c.numberOfChannels&&m.set(c.getChannelData(f),_),_+=c.length}l.push(m)}return Hn(l,r,h)}function v0(i,e){return Q(i),e<i.length?$l(i,0,e):ws(i,Hn(e-i.length,i.numberOfChannels))}function Gl(i,e,t){var n,s;return typeof i=="number"?(n=e,s=i):(n=i,s=e),t=t||0,Q(n),s<n.length?n:n===e?ws(Ve(Hn(s-n.length,n.numberOfChannels),t),n):ws(n,Ve(Hn(s-n.length,n.numberOfChannels),t))}function x0(i,e,t){return Gl(e,i,t)}function A0(i,e,t){return Gl(i,e,t)}function S0(i,e){Q(i);for(var t=0;t<i.numberOfChannels;t++)for(var n=i.getChannelData(t),s=n.slice(),r=0,o=n.length,h;r<o;r++)h=(e+(e+r<0?o+r:r))%o,n[h]=s[r];return i}function E0(i,e){Q(i);for(var t=0;t<i.numberOfChannels;t++){var n=i.getChannelData(t);if(e>0)for(var s=n.length-e;s--;)n[s+e]=n[s];else for(var s=-e,r=n.length-e;s<r;s++)n[s+e]=n[s]||0}return i}function k0(i,e,t,n){Ra(e)||(n=t,t=e,e=null),t=t==null?0:Ut(t,i.length),n=n==null?i.length:Ut(n,i.length);for(var s=0,r=0;r<i.numberOfChannels;r++)for(var o=i.getChannelData(r),h=t;h<n;h++)s=Math.max(Math.abs(o[h]),s);var c=Math.max(1/s,1);return Ve(i,e,function(l,f,m){return u0(l*c,-1,1)},t,n)}function C0(i,e,t,n){var s=R0(i,t,n);return Ve(i,e,function(r,o,h){return r-s[h]},t,n)}function R0(i,e,t){if(Q(i),e=e==null?0:Ut(e,i.length),t=t==null?i.length:Ut(t,i.length),t-e<1)return[];for(var n=[],s=0;s<i.numberOfChannels;s++){for(var r=0,o=i.getChannelData(s),h=e;h<t;h++)r+=o[h];n.push(r/(t-e))}return n}function T0(i,e){return Zl(i,e,!0,!0)}function M0(i,e){return Zl(i,e,!0,!1)}function O0(i,e){return Zl(i,e,!1,!0)}function Zl(i,e,t,n){Q(i),e=e==null?0:Math.abs(e);var s,r;if(t){s=i.length;for(var o=0,h=i.numberOfChannels;o<h;o++)for(var c=i.getChannelData(o),l=0;l<c.length&&!(l>s);l++)if(Math.abs(c[l])>e){s=l;break}}else s=0;if(n){r=0;for(var o=0,h=i.numberOfChannels;o<h;o++)for(var c=i.getChannelData(o),l=c.length-1;l>=0&&!(l<r);l--)if(Math.abs(c[l])>e){r=l+1;break}}else r=i.length;return $l(i,s,r)}function F0(i,e,t,n){Q(i),Q(e),t==null&&(t=.5);var s=t instanceof Function?t:function(f,m){return f*(1-t)+m*t};n==null?n=0:n<0&&(n+=i.length);for(var r=0;r<i.numberOfChannels;r++)for(var o=i.getChannelData(r),h=e.getChannelData(r),c=n,l=0;c<i.length&&l<e.length;c++,l++)o[c]=s.call(i,o[c],h[l],l,r);return i}function D0(i){return Q(i),i.numberOfChannels*i.getChannelData(0).byteLength}function P0(i,e){Q(i),e=e||[];for(var t=0;t<i.numberOfChannels;t++)ArrayBuffer.isView(e[t])?e[t].set(i.getChannelData(t)):e[t]=i.getChannelData(t);return e}var pn,Oe,gn,gt,Bs,fl,ir,su;class I0 extends xt{constructor(t,n){super(n.audioContext,n.target,n.muteOnStart,n.onGamePause,n.onEnded);d(this,Bs);d(this,ir);b(this,"id",xt.nextPlaybackId++);b(this,"type","sequence");d(this,pn,void 0);d(this,Oe,void 0);d(this,gn,void 0);d(this,gt,void 0);const s=t.intro??[],r=t.loop??[];if(s.length+r.length<=0)throw Error("Cannot play an empty sound sequence");const o=s.map(c=>u(this,Bs,fl).call(this,c,n.assets)),h=r.map(c=>u(this,Bs,fl).call(this,c,n.assets));g(this,pn,u(this,ir,su).call(this,[...o,...h])),g(this,Oe,o.reduce((c,l)=>c+l.durationMs,0)),g(this,gn,h.reduce((c,l)=>c+l.durationMs,0)),g(this,gt,this.createSourceNode()),this.setupAndStartNodes()}stopAllNodes(){a(this,gt).stop()}setupAndStartNodes(){this.pausedAtMs!=null&&g(this,gt,this.createSourceNode()),a(this,gt).buffer=a(this,pn),a(this,gn)>0&&(a(this,gt).loop=!0,a(this,gt).loopStart=a(this,Oe)/1e3,a(this,gt).loopEnd=a(this,pn).duration),this.connectToMainGainNode(a(this,gt)),a(this,gt).addEventListener("ended",()=>{a(this,gt).disconnect(),this.disconnectFromOutput(),!this.isPausedByGame&&!this.isPausedByEngine&&this.onEnded()});let t=this.pausedAtMs?this.pausedAtMs-this.startedAtMs-this.accumulatedPauseMs:0;t>a(this,Oe)&&(t=(t-a(this,Oe))%a(this,gn)+a(this,Oe)),a(this,gt).start(0,t/1e3)}}pn=new WeakMap,Oe=new WeakMap,gn=new WeakMap,gt=new WeakMap,Bs=new WeakSet,fl=function(t,n){if(t.length<1)throw Error("Each intro sequence entry needs at least 1 sound");const[s,...r]=t,o=typeof s!="string"?s.url:s,h=n.getSoundAsset(o).audioBuffer,c=h.duration*1e3,l=typeof s!="string"&&s.durationMs?s.durationMs(c):c,f=Xn.resize(h,l/1e3*h.sampleRate),m=r.map(_=>typeof _=="string"?{url:_}:_).map(({url:_})=>n.getSoundAsset(_).audioBuffer).map(_=>Xn.resize(_,l/1e3*_.sampleRate));return{firstBuffer:f,otherBuffers:m,durationMs:l}},ir=new WeakSet,su=function(t){const n=(r,o)=>Ln(-1,r+o,1),s=t.map(r=>r.otherBuffers.reduce((o,h)=>Xn.mix(o,h,n),Xn.clone(r.firstBuffer)));return Xn.concat(...s)};var _n,Ls,yi,_t,Mt,rt,ut,nr,au,sr,ru,$s,cl;const st=class st{constructor(e,t){d(this,nr);d(this,sr);d(this,$s);d(this,yi,void 0);d(this,_t,void 0);d(this,Mt,void 0);d(this,rt,new Map);d(this,ut,void 0);g(this,yi,e),g(this,_t,t),g(this,ut,u(this,sr,ru).call(this)),N.updateMutedClass(a(this,ut)),g(this,Mt,a(this,_t).createGain()),a(this,Mt).gain.value=a(this,ut)?0:1,a(this,Mt).connect(a(this,_t).destination)}restart(){u(this,nr,au).call(this),a(this,rt).clear()}async tryToResumeAudioContextSuspendedByBrowserForSecurityReasons(){return z.debugBeetPx("AudioApi.tryToResumeAudioContextSuspendedByBrowserForSecurityReasons"),a(this,_t).state==="running"?(z.debugBeetPx("Audio Context is already running"),Promise.resolve(!0)):a(this,_t).resume().then(()=>(z.debugBeetPx("Audio Context got resumed"),!0)).catch(e=>(z.errorBeetPx(e),!1))}startPlayback(e,t){t??(t={}),t.muteOnStart??(t.muteOnStart=!1),t.onGamePause??(t.onGamePause="pause"),z.debugBeetPx(`AudioApi.startPlayback (muteOnStart: ${t.muteOnStart}, onGamePause: ${t.onGamePause})`);const n=new xd(e,{assets:a(this,yi),audioContext:a(this,_t),target:a(this,Mt),muteOnStart:t.muteOnStart,onGamePause:t.onGamePause,onEnded:()=>{z.debugBeetPx(`AudioApi: deleting playback ${n.id}`),a(this,rt).delete(n.id)}});return a(this,rt).set(n.id,n),n.id}startPlaybackLooped(e,t){t??(t={}),t.muteOnStart??(t.muteOnStart=!1),t.onGamePause??(t.onGamePause="pause"),z.debugBeetPx(`AudioApi.startPlaybackLooped (muteOnStart: ${t.muteOnStart}, onGamePause: ${t.onGamePause})`);const n=new vd(e,{assets:a(this,yi),audioContext:a(this,_t),target:a(this,Mt),muteOnStart:t.muteOnStart,onGamePause:t.onGamePause,onEnded:()=>{z.debugBeetPx(`AudioApi: deleting playback ${n.id}`),a(this,rt).delete(n.id)}});return a(this,rt).set(n.id,n),n.id}startPlaybackSequence(e,t){t??(t={}),t.muteOnStart??(t.muteOnStart=!1),t.onGamePause??(t.onGamePause="pause"),z.debugBeetPx(`AudioApi.startPlaybackSequence (muteOnStart: ${t.muteOnStart}, onGamePause: ${t.onGamePause})`);const n=new I0(e,{assets:a(this,yi),audioContext:a(this,_t),target:a(this,Mt),muteOnStart:t.muteOnStart,onGamePause:t.onGamePause,onEnded:()=>{z.debugBeetPx(`AudioApi: deleting playback ${n.id}`),a(this,rt).delete(n.id)}});return a(this,rt).set(n.id,n),n.id}isAudioMuted(){return a(this,ut)}muteAudio(e={}){z.debugBeetPx(`AudioApi.muteAudio (fadeOutMillis: ${e.fadeOutMillis})`),!a(this,ut)&&(u(this,$s,cl).call(this,!0),g(this,ut,!0),N.updateMutedClass(a(this,ut)),Ee.muteGain(a(this,Mt),a(this,_t).currentTime,e.fadeOutMillis??st.muteUnmuteDefaultFadeMillis))}unmuteAudio(e={}){z.debugBeetPx(`AudioApi.unmuteAudio (fadeInMillis: ${e.fadeInMillis})`),a(this,ut)&&(u(this,$s,cl).call(this,!1),g(this,ut,!1),N.updateMutedClass(a(this,ut)),Ee.unmuteGain(a(this,Mt),a(this,_t).currentTime,e.fadeInMillis??st.muteUnmuteDefaultFadeMillis))}mutePlayback(e,t={}){var n;z.debugBeetPx(`AudioApi.mutePlayback (fadeOutMillis: ${t.fadeOutMillis})`),(n=a(this,rt).get(e))==null||n.mute(t.fadeOutMillis??st.muteUnmuteDefaultFadeMillis)}unmutePlayback(e,t={}){var n;z.debugBeetPx(`AudioApi.unmutePlayback (fadeInMillis: ${t.fadeInMillis})`),(n=a(this,rt).get(e))==null||n.unmute(t.fadeInMillis??st.muteUnmuteDefaultFadeMillis)}stopPlayback(e,t={}){var n;z.debugBeetPx(`AudioApi.stopPlayback (fadeOutMillis: ${t.fadeOutMillis})`),(n=a(this,rt).get(e))==null||n.stop(a(this,ut)?0:t.fadeOutMillis??st.muteUnmuteDefaultFadeMillis)}pausePlayback(e){var t;z.debugBeetPx("AudioApi.pausePlayback"),(t=a(this,rt).get(e))==null||t.pause()}resumePlayback(e){var t;z.debugBeetPx("AudioApi.resumePlayback"),(t=a(this,rt).get(e))==null||t.resume()}getAudioContext(){return a(this,_t)}getGlobalGainNode(){return a(this,Mt)}};_n=new WeakMap,Ls=new WeakMap,yi=new WeakMap,_t=new WeakMap,Mt=new WeakMap,rt=new WeakMap,ut=new WeakMap,nr=new WeakSet,au=function(e={}){z.debugBeetPx(`AudioApi.#stopAllPlaybacks (fadeOutMillis: ${e.fadeOutMillis})`);for(const t of a(this,rt).values())t.stop(a(this,ut)?0:e.fadeOutMillis??st.muteUnmuteDefaultFadeMillis)},sr=new WeakSet,ru=function(){return window.localStorage.getItem(a(st,_n))===a(st,Ls)},$s=new WeakSet,cl=function(e){e?window.localStorage.setItem(a(st,_n),a(st,Ls)):window.localStorage.removeItem(a(st,_n))},d(st,_n,"audio_api__muted"),d(st,Ls,"yes"),b(st,"muteUnmuteDefaultFadeMillis",100);let mi=st;class U0{static detect(e){const t=(e==null?void 0:e.toLowerCase())??"";return t.includes("firefox")?t.includes("win64")?"firefox_windows":"firefox_other":t.includes("chrome")?"chromium":t.includes("safari")?"safari":"other"}}function Qi(i){throw Error(i)}var de,pe,Fe,De,mn;class z0{constructor(e){b(this,"canvasSize");d(this,de,void 0);d(this,pe,void 0);d(this,Fe,void 0);d(this,De,void 0);d(this,mn,null);this.canvasSize=e.round(),g(this,de,0),g(this,pe,0),g(this,Fe,this.canvasSize.x-1),g(this,De,this.canvasSize.y-1)}setClippingRegion(e,t){const n=[D.of(a(this,de),a(this,pe)),D.of(a(this,Fe)-a(this,de)+1,a(this,De)-a(this,pe)+1)],[s,r]=D.minMax(e.round(),e.add(t).round());return g(this,de,s.x),g(this,pe,s.y),g(this,Fe,r.x-1),g(this,De,r.y-1),n}removeClippingRegion(){return this.setClippingRegion(D.of(0,0),this.canvasSize)}canSetAny(e,t,n,s){return n>=a(this,de)&&s>=a(this,pe)&&e<=a(this,Fe)&&t<=a(this,De)}canSetAt(e,t){return e>=a(this,de)&&t>=a(this,pe)&&e<=a(this,Fe)&&t<=a(this,De)}takeSnapshot(){g(this,mn,this.newSnapshot())}getMostRecentSnapshot(){return a(this,mn)}render(){g(this,mn,null),this.doRender()}}de=new WeakMap,pe=new WeakMap,Fe=new WeakMap,De=new WeakMap,mn=new WeakMap;var ge,Gs;class N0{constructor(e,t){d(this,ge,void 0);d(this,Gs,void 0);g(this,ge,e),g(this,Gs,t)}getColorAt(e,t){const n=t*a(this,Gs)+e;if(n>=a(this,ge).length/4)throw Error(`index out of bounds: index = ${n}, max allowed index = ${a(this,ge).length/4-1}`);const s=n*4;return j.of(a(this,ge)[s],a(this,ge)[s+1],a(this,ge)[s+2])}}ge=new WeakMap,Gs=new WeakMap;var bn,Pe,wn,Gt,Zt,ar,lu;class B0 extends z0{constructor(t,n,s){super(t);d(this,ar);d(this,bn,void 0);d(this,Pe,void 0);d(this,wn,void 0);d(this,Gt,void 0);d(this,Zt,void 0);g(this,bn,t.x*t.y),g(this,Pe,n),a(this,Pe).style.backgroundColor=s.cssHex,g(this,wn,a(this,Pe).getContext("2d",{colorSpace:"srgb",alpha:!0})??Qi("Was unable to obtain '2d' context from <canvas>")),a(this,wn).imageSmoothingEnabled=!1;const r=document.createElement("canvas").transferControlToOffscreen();r.width=t.x,r.height=t.y,g(this,Gt,r.getContext("2d",{colorSpace:"srgb",alpha:!1})??Qi("Was unable to obtain '2d' context from OffscreenCanvas")),g(this,Zt,a(this,Gt).createImageData(a(this,Gt).canvas.width,a(this,Gt).canvas.height,{colorSpace:"srgb"})),u(this,ar,lu).call(this)}set(t,n,s){if(n<0||s<0||n>=this.canvasSize.x||s>=this.canvasSize.y)throw Error(`(x,y) index out of bounds: (x,y) = (${n},${s}), bottom bound = (0,0), upper bound = (${this.canvasSize.x-1},${this.canvasSize.y-1})`);const r=s*this.canvasSize.x+n;if(r>=a(this,bn))throw Error(`index out of bounds: index = ${r}, max allowed index = ${a(this,bn)-1}`);const o=r*4;a(this,Zt).data[o]=t.r,a(this,Zt).data[o+1]=t.g,a(this,Zt).data[o+2]=t.b}newSnapshot(){return new N0(a(this,Zt).data.slice(),this.canvasSize.x)}doRender(){a(this,Gt).putImageData(a(this,Zt),0,0);const t=D.of(a(this,Pe).width,a(this,Pe).height),n=Math.max(1,Math.min(t.div(this.canvasSize).floor().x,t.div(this.canvasSize).floor().y)),s=t.sub(this.canvasSize.mul(n)).div(2).floor();a(this,wn).drawImage(a(this,Gt).canvas,0,0,a(this,Gt).canvas.width,a(this,Gt).canvas.height,s.x,s.y,n*this.canvasSize.x,n*this.canvasSize.y)}}bn=new WeakMap,Pe=new WeakMap,wn=new WeakMap,Gt=new WeakMap,Zt=new WeakMap,ar=new WeakSet,lu=function(){for(let t=3;t<a(this,Zt).data.length;t+=4)a(this,Zt).data[t]=255};var jt,_e,Ie,yn,vi,Zs,xi,me,Qt,tt,mt,Hs,bt,Ct,be,ti;const Wl=class Wl{constructor(e,t){d(this,bt);d(this,be);d(this,jt,void 0);d(this,_e,void 0);d(this,Ie,void 0);d(this,yn,void 0);d(this,vi,void 0);d(this,Zs,void 0);d(this,xi,void 0);d(this,me,void 0);d(this,Qt,void 0);d(this,tt,void 0);d(this,mt,void 0);d(this,Hs,void 0);g(this,Zs,t.onGamePause==="ignore"),g(this,xi,t.onGamePause),g(this,jt,[...e.intro,...e.loop].map(n=>({name:n[0],frames:Math.max(0,Math.round(n[1]))}))),g(this,_e,e.loop.map(n=>({name:n[0],frames:Math.max(0,Math.round(n[1]))}))),g(this,Ie,a(this,jt).reduce((n,s)=>n+s.frames,0)),g(this,yn,a(this,_e).reduce((n,s)=>n+s.frames,0)),g(this,vi,a(this,be,ti)+t.delayFrames),g(this,tt,rs.for({frames:a(this,Ie),loop:!1,pause:t.pause,delayFrames:t.delayFrames,onGamePause:a(this,xi)})),g(this,mt,a(this,_e).length>0?rs.for({frames:a(this,yn),loop:!0,pause:t.pause,delayFrames:t.delayFrames+a(this,Ie),onGamePause:a(this,xi)}):null),g(this,me,!1),g(this,Qt,null),t.pause&&this.pause()}static of(e,t){return new Wl(e,t)}get justFinishedPhase(){return this.hasJustFinishedOverall||a(this,bt,Ct).t===0?a(this,bt,Ct).recentlyFinishedPhase:null}get currentPhase(){var e;return((e=a(this,bt,Ct).phase)==null?void 0:e.name)??null}get t(){return a(this,bt,Ct).t}get progress(){return a(this,bt,Ct).phase&&a(this,bt,Ct).phase.frames>0?a(this,bt,Ct).t/a(this,bt,Ct).phase.frames:1}get framesLeft(){return a(this,bt,Ct).phase?a(this,bt,Ct).phase.frames-a(this,bt,Ct).t:0}get tOverall(){var e;return a(this,tt).hasFinished?((e=a(this,mt))==null?void 0:e.t)??a(this,tt).t:a(this,tt).t}get framesLeftOverall(){var e;return a(this,tt).hasFinished?((e=a(this,mt))==null?void 0:e.framesLeft)??a(this,tt).framesLeft:a(this,tt).framesLeft}get progressOverall(){var e;return a(this,tt).hasFinished?((e=a(this,mt))==null?void 0:e.progress)??a(this,tt).progress:a(this,tt).progress}get hasFinishedOverall(){return a(this,tt).hasFinished}get hasJustFinishedOverall(){var e;return((e=a(this,mt))==null?void 0:e.hasJustFinished)||a(this,tt).hasJustFinished}pause(){var e;a(this,me)||(g(this,me,!0),g(this,Qt,a(this,be,ti)),a(this,tt).pause(),(e=a(this,mt))==null||e.pause())}resume(){var e;a(this,me)&&(g(this,me,!1),g(this,vi,a(this,vi)+(a(this,be,ti)-(a(this,Qt)??0))),g(this,Qt,null),a(this,tt).resume(),(e=a(this,mt))==null||e.resume())}restart(){g(this,vi,a(this,be,ti)),g(this,me,!1),g(this,Qt,null),a(this,tt).restart(),a(this,mt)&&g(this,mt,rs.for({frames:a(this,yn),loop:!0,pause:!1,delayFrames:a(this,Ie),onGamePause:a(this,xi)}))}};jt=new WeakMap,_e=new WeakMap,Ie=new WeakMap,yn=new WeakMap,vi=new WeakMap,Zs=new WeakMap,xi=new WeakMap,me=new WeakMap,Qt=new WeakMap,tt=new WeakMap,mt=new WeakMap,Hs=new WeakMap,bt=new WeakSet,Ct=function(){var o;if(((o=a(this,Hs))==null?void 0:o.frameNumber)===(a(this,Qt)??a(this,be,ti)))return a(this,Hs).value;if(!a(this,mt)||(a(this,Qt)??a(this,be,ti))<a(this,vi)+a(this,Ie)){const h=a(this,tt).t;let c=0,l=null,f=0;for(;f<a(this,jt).length-1;){let _=a(this,jt)[f];if(h<c+_.frames)return{recentlyFinishedPhase:(l==null?void 0:l.name)??null,phase:_,t:h-c};c+=_.frames,l=_,f+=1}let m=a(this,jt)[f]??null;return{recentlyFinishedPhase:a(this,tt).hasJustFinished?(m==null?void 0:m.name)??null:(l==null?void 0:l.name)??null,phase:m,t:h-c}}const e=a(this,mt).t;let t=0,n=a(this,jt)[a(this,jt).length-1]??null,s=0;for(;s<a(this,_e).length-1;){let h=a(this,_e)[s];if(e<t+h.frames)return{recentlyFinishedPhase:(n==null?void 0:n.name)??null,phase:h,t:e-t};t+=h.frames,n=h,s+=1}let r=a(this,_e)[s]??null;return{recentlyFinishedPhase:(n==null?void 0:n.name)??null,phase:r,t:e-t}},be=new WeakSet,ti=function(){return a(this,Zs)?kt.frameNumber:kt.frameNumberOutsidePause};let dl=Wl;function Hl(i,e){return i instanceof es?es.basedOn(i,e??Ml):es.of(i)}const Jl=Hl(new Jr),L0=Hl(new yu),$0=Hl(new vu);function oe(i,e,t){return typeof i=="string"?j.fromCssHex(i):j.of(i,e??0,t??0)}const G0=oe("#000000"),Z0=oe("#ffffff");oe("#ff0000");oe("#00ff00");oe("#0000ff");oe("#00ffff");oe("#ff00ff");oe("#ffff00");const pl=et;function H0(i){return(e,t,n,s)=>hs.from(i,e,t,n,s)}function J0(i,e){return dl.of({intro:i.intro??[],loop:i.loop??[]},{pause:(e==null?void 0:e.pause)??!1,delayFrames:(e==null?void 0:e.delayFrames)??0,onGamePause:(e==null?void 0:e.onGamePause)??"pause"})}function At(i,e){return D.of(i,e??i)}const Jn=At(0,0),Ba=At(1,1);var Ue,Js,vn,Ws,qs,ze,Ne,Be;class W0{constructor(e,t,n){d(this,Ue,void 0);d(this,Js,void 0);d(this,vn,void 0);d(this,Ws,void 0);d(this,qs,void 0);d(this,ze,void 0);d(this,Ne,void 0);d(this,Be,void 0);g(this,Ue,e),g(this,Js,n.color??pl.orange),g(this,vn,t);const s=n.placement??"top-right";g(this,qs,s.endsWith("-left")),g(this,Ws,s.startsWith("top-")),g(this,ze,Array.from({length:15},()=>0)),g(this,Ne,0),g(this,Be,0)}drawRenderingFps(e){if(a(this,ze)[a(this,Ne)]=e,g(this,Ne,di(a(this,Ne)+1,a(this,ze).length)),a(this,Ne)===0){g(this,Be,0);for(const r of a(this,ze))g(this,Be,a(this,Be)+r);g(this,Be,a(this,Be)/a(this,ze).length)}const t=a(this,Ue).useFont(Jl),n=a(this,Be).toFixed(),s=Ha.measureText(n).wh;a(this,Ue).drawText(n,a(this,Ue).cameraXy.add(a(this,qs)?1:a(this,vn).x-s.x-1,a(this,Ws)?1:a(this,vn).y-s.y-1),a(this,Js)),a(this,Ue).useFont(t)}}Ue=new WeakMap,Js=new WeakMap,vn=new WeakMap,Ws=new WeakMap,qs=new WeakMap,ze=new WeakMap,Ne=new WeakMap,Be=new WeakMap;var xn;const rr=class rr{static get active(){return a(rr,xn)}static set active(e){g(this,xn,e),z.infoBeetPx(`FrameByFrame flag set to: ${a(this,xn)}`)}};xn=new WeakMap,d(rr,xn,!1);let ei=rr;var Ai;class q0{constructor(e){d(this,Ai,void 0);g(this,Ai,e)}draw(e){for(let t=0;t<a(this,Ai).canvasSize.x;++t)for(let n=0;n<a(this,Ai).canvasSize.y;++n)a(this,Ai).set(e,t,n)}}Ai=new WeakMap;var ft,X,V;class K0{constructor(e){d(this,X);d(this,ft,void 0);g(this,ft,e)}draw(e,t,n,s,r){const[o,h]=D.minMax(e.round(),e.add(t).round());if(h.x-o.x<=0||h.y-o.y<=0||!a(this,ft).canSetAny(o.x,o.y,h.x-1,h.y-1))return;const c=n.type==="pattern"?n.primary:n,l=n.type==="pattern"?n.secondary:null,f=(c==null?void 0:c.type)==="canvas_snapshot_mapping"?a(this,ft).getMostRecentSnapshot():null,m=r;let _=h.x-o.x-1,p=h.y-o.y-1,y=p&1,I=o.x,O=h.x-1,C=o.y+Math.floor((p+1)/2),P=C-y,U=4*(1-_)*p*p,x=4*(y+1)*_*_,$=U+x+y*_*_;_=8*_*_,y=8*p*p;do{if(u(this,X,V).call(this,I,P,c,l,m,f),u(this,X,V).call(this,O,P,c,l,m,f),u(this,X,V).call(this,O,C,c,l,m,f),u(this,X,V).call(this,I,C,c,l,m,f),s==="inside")for(let k=I+1;k<O;++k)u(this,X,V).call(this,k,P,c,l,m,f),u(this,X,V).call(this,k,C,c,l,m,f);else if(s==="outside"){for(let k=0;k<I;++k)u(this,X,V).call(this,k,P,c,l,m,f),u(this,X,V).call(this,k,C,c,l,m,f);for(let k=O+1;k<a(this,ft).canvasSize.x;++k)u(this,X,V).call(this,k,P,c,l,m,f),u(this,X,V).call(this,k,C,c,l,m,f)}const B=$;2*B<=x&&(C+=1,P-=1,x+=_,$+=x),(2*B>=U||2*$>x)&&(I+=1,O-=1,U+=y,$+=U)}while(I<=O);for(;C-P<=p;){if(u(this,X,V).call(this,I-1,C,c,l,m,f),u(this,X,V).call(this,O+1,C,c,l,m,f),s==="outside"){for(let B=0;B<I-1;++B)u(this,X,V).call(this,B,C,c,l,m,f);for(let B=O+2;B<a(this,ft).canvasSize.x;++B)u(this,X,V).call(this,B,C,c,l,m,f)}if(C+=1,u(this,X,V).call(this,I-1,P,c,l,m,f),u(this,X,V).call(this,O+1,P,c,l,m,f),s==="outside"){for(let B=0;B<I-1;++B)u(this,X,V).call(this,B,P,c,l,m,f);for(let B=O+2;B<a(this,ft).canvasSize.x;++B)u(this,X,V).call(this,B,P,c,l,m,f)}P-=1}if(s==="outside")for(let B=0;B<a(this,ft).canvasSize.x;++B){for(let k=0;k<P+1;++k)u(this,X,V).call(this,B,k,c,l,m,f);for(let k=C;k<a(this,ft).canvasSize.y;++k)u(this,X,V).call(this,B,k,c,l,m,f)}}}ft=new WeakMap,X=new WeakSet,V=function(e,t,n,s,r,o){if(a(this,ft).canSetAt(e,t))if(r.hasPrimaryColorAt(e,t)){if(n)if(n.type==="rgb")a(this,ft).set(n,e,t);else{const h=n.getMappedColor(o,e,t);h&&a(this,ft).set(h,e,t)}}else s!=null&&a(this,ft).set(s,e,t)};var we,lr,ou;class Y0{constructor(e){d(this,lr);d(this,we,void 0);g(this,we,e)}draw(e,t,n,s){const r=e.round(),o=e.add(t).round();if(o.x-r.x===0||o.y-r.y===0)return;t=o.sub(r);const h=t.sub(t.sign()),c=n.type==="pattern"?n.primary:n,l=n.type==="pattern"?n.secondary:null,f=(c==null?void 0:c.type)==="canvas_snapshot_mapping"?a(this,we).getMostRecentSnapshot():null,m=s;let _=h.abs().mul(At(1,-1)),p=r;const y=r.add(h),I=h.sign();let O=_.x+_.y;for(;u(this,lr,ou).call(this,p.x,p.y,c,l,m,f),!p.eq(y);){const C=O;2*C>=_.y&&(p=p.add(At(I.x,0)),O+=_.y),2*C<=_.x&&(p=p.add(At(0,I.y)),O+=_.x)}}}we=new WeakMap,lr=new WeakSet,ou=function(e,t,n,s,r,o){if(a(this,we).canSetAt(e,t))if(r.hasPrimaryColorAt(e,t)){if(n)if(n.type==="rgb")a(this,we).set(n,e,t);else{const h=n.getMappedColor(o,e,t);h&&a(this,we).set(h,e,t)}}else s!=null&&a(this,we).set(s,e,t)};var An;class X0{constructor(e){d(this,An,void 0);g(this,An,e)}draw(e,t,n){e=e.round(),a(this,An).canSetAt(e.x,e.y)&&n.hasPrimaryColorAt(e.x,e.y)&&a(this,An).set(t,e.x,e.y)}}An=new WeakMap;var Sn,Ks;class hu{constructor(e,t={}){d(this,Sn,void 0);d(this,Ks,void 0);g(this,Sn,e),g(this,Ks,t)}draw(e,t,n,s,r,o){t=a(this,Ks).disableRounding?t:t.round(),s=D.max(s.floor(),Jn);for(let h=0;h<e.asciiRows.length;h+=1){const c=t.y+(r[1]?e.size.y-1-h:h)*s.y;for(let l=0;l<e.asciiRows[h].length;l+=1){const f=t.x+(r[0]?e.size.x-1-l:l)*s.x;if(e.asciiRows[h][l]==="#")for(let m=0;m<s.y;++m)for(let _=0;_<s.x;++_){const p=c+m,y=f+_;o.hasPrimaryColorAt(y,p)&&a(this,Sn).canSetAt(y,p)&&a(this,Sn).set(n,y,p)}}}}}Sn=new WeakMap,Ks=new WeakMap;var wt,lt,dt;class j0{constructor(e){d(this,lt);d(this,wt,void 0);g(this,wt,e)}draw(e,t,n,s,r){const[o,h]=D.minMax(e.round(),e.add(t).round());if(!a(this,wt).canSetAny(o.x,o.y,h.x-1,h.y-1))return;const c=n.type==="pattern"?n.primary:n,l=n.type==="pattern"?n.secondary:null,f=(c==null?void 0:c.type)==="canvas_snapshot_mapping"?a(this,wt).getMostRecentSnapshot():null,m=r;for(let _=o.x;_<h.x;_+=1)u(this,lt,dt).call(this,_,o.y,c,l,m,f),u(this,lt,dt).call(this,_,h.y-1,c,l,m,f);for(let _=o.y+1;_<h.y-1;_+=1)u(this,lt,dt).call(this,o.x,_,c,l,m,f),u(this,lt,dt).call(this,h.x-1,_,c,l,m,f);if(s==="inside")for(let _=o.x;_<h.x;_+=1)for(let p=o.y+1;p<h.y-1;p+=1)u(this,lt,dt).call(this,_,p,c,l,m,f);else if(s==="outside"){for(let _=0;_<o.x;_+=1){for(let p=0;p<o.y;p+=1)u(this,lt,dt).call(this,_,p,c,l,m,f);for(let p=o.y;p<h.y;p+=1)u(this,lt,dt).call(this,_,p,c,l,m,f);for(let p=h.y;p<a(this,wt).canvasSize.y;p+=1)u(this,lt,dt).call(this,_,p,c,l,m,f)}for(let _=o.x;_<h.x;_+=1)for(let p=0;p<o.y;p+=1)u(this,lt,dt).call(this,_,p,c,l,m,f);for(let _=o.x;_<h.x;_+=1)for(let p=h.y;p<a(this,wt).canvasSize.y;p+=1)u(this,lt,dt).call(this,_,p,c,l,m,f);for(let _=h.x;_<a(this,wt).canvasSize.x;_+=1){for(let p=0;p<o.y;p+=1)u(this,lt,dt).call(this,_,p,c,l,m,f);for(let p=o.y;p<h.y;p+=1)u(this,lt,dt).call(this,_,p,c,l,m,f);for(let p=h.y;p<a(this,wt).canvasSize.y;p+=1)u(this,lt,dt).call(this,_,p,c,l,m,f)}}}}wt=new WeakMap,lt=new WeakSet,dt=function(e,t,n,s,r,o){if(a(this,wt).canSetAt(e,t))if(r.hasPrimaryColorAt(e,t)){if(n)if(n.type==="rgb")a(this,wt).set(n,e,t);else{const h=n.getMappedColor(o,e,t);h&&a(this,wt).set(h,e,t)}}else s!=null&&a(this,wt).set(s,e,t)};var En;class Q0{constructor(){d(this,En,new Map)}prepareOrGetFromCache(e,t,n,s){const r=e.imageUrl+"::"+e.xy.x.toString()+":"+e.xy.y.toString()+":"+e.size.x.toString()+":"+e.size.y.toString();if(a(this,En).has(r))return a(this,En).get(r);const o=e.size.x,h=e.size.y,c=Wa(o).map(()=>Wa(h).map(()=>null));for(let f=0;f<h;++f){const m=e.xy.y+f;for(let _=0;_<o;++_){const p=e.xy.x+_,y=(m*n+p)*s;c[_][f]=s===3||t[y+3]>=255/2?oe(t[y],t[y+1],t[y+2]):null}}const l={w:e.size.x,h:e.size.y,colors:c,cacheHit:!0};return a(this,En).set(r,l),{...l,cacheHit:!1}}}En=new WeakMap;var or,Si,Ys;class uu{constructor(e,t={}){d(this,or,new Q0);d(this,Si,void 0);d(this,Ys,void 0);g(this,Si,e),g(this,Ys,t)}draw(e,t,n,s,r,o,h){n=a(this,Ys).disableRounding?n:n.round(),s=D.max(s.floor(),Jn);const{width:c,height:l,channels:f,rgba8bitData:m}=t;if(e=e.clipBy(Jn,At(c,l)),!a(this,Si).canSetAny(n.x,n.y,n.x+e.size.x*s.x-1,n.y+e.size.y*s.y-1))return;const _=a(this,or).prepareOrGetFromCache(e,m,c,f);for(let p=0;p<_.h;p+=1){const y=n.y+(r[1]?e.size.y-1-p:p)*s.y;for(let I=0;I<_.w;I+=1){const O=n.x+(r[0]?e.size.x-1-I:I)*s.x;for(let C=0;C<s.y;++C)for(let P=0;P<s.x;++P){const U=O+P,x=y+C;if(a(this,Si).canSetAt(U,x)&&h.hasPrimaryColorAt(U,x)){const $=_.colors[I][p];if($){const B=o.getMappedColor($,I,p);B&&a(this,Si).set(B,U,x)}}}}}}}or=new WeakMap,Si=new WeakMap,Ys=new WeakMap;var kn,Xs,js,Qs;class V0{constructor(e,t){d(this,kn,void 0);d(this,Xs,void 0);d(this,js,void 0);d(this,Qs,void 0);g(this,kn,e),g(this,Xs,t),g(this,js,new uu(a(this,kn),{disableRounding:!0})),g(this,Qs,new hu(a(this,kn),{disableRounding:!0}))}draw(e,t,n,s,r,o,h){n=n.round(),o=D.max(o.floor(),Jn);for(const c of t.arrangeGlyphsFor(e,s,r)){if(c.type==="line_break")continue;const l=n.add(c.leftTop.mul(o));c.type==="sprite"?a(this,js).draw(c.sprite,a(this,Xs).getImageAsset(c.sprite.imageUrl),l,o,[!1,!1],c.spriteColorMapping,h):c.type==="pixels"?a(this,Qs).draw(c.pixels,l,c.color,o,[!1,!1],h):Tl()}}}kn=new WeakMap,Xs=new WeakMap,js=new WeakMap,Qs=new WeakMap;var Vs,Ei,ta,ea,ia,na,ki,Ci,sa,aa,ot,Cn,Vt,Ri;class tp{constructor(e){d(this,Vs,void 0);d(this,Ei,void 0);d(this,ta,void 0);d(this,ea,void 0);d(this,ia,void 0);d(this,na,void 0);d(this,ki,void 0);d(this,Ci,void 0);d(this,sa,void 0);d(this,aa,void 0);b(this,"cameraXy",At(0,0));d(this,ot,Zr.primaryOnly);d(this,Cn,Ja.noMapping);d(this,Vt,Jl);d(this,Ri,{});g(this,Vs,e.assets),g(this,Ei,e.canvas),g(this,ta,new q0(e.canvas)),g(this,ea,new X0(e.canvas)),g(this,ia,new hu(e.canvas)),g(this,na,new Y0(e.canvas)),g(this,ki,new j0(e.canvas)),g(this,Ci,new K0(e.canvas)),g(this,sa,new uu(e.canvas)),g(this,aa,new V0(e.canvas,e.assets))}clearCanvas(e){a(this,ta).draw(e)}setClippingRegion(e,t){return a(this,Ei).setClippingRegion(e,t)}removeClippingRegion(){return a(this,Ei).removeClippingRegion()}setCameraXy(e){const t=this.cameraXy;return this.cameraXy=e,t}setDrawingPattern(e){const t=a(this,ot);return g(this,ot,e),t}drawPixel(e,t){a(this,ea).draw(e.sub(this.cameraXy),t,a(this,ot))}drawPixels(e,t,n,s){var o,h;const r=(s==null?void 0:s.centerXy)??[!1,!1];(r[0]||r[1])&&(t=t.sub(r[0]?e.size.x*(((o=s==null?void 0:s.scaleXy)==null?void 0:o.x)??1)/2:0,r[1]?e.size.y*(((h=s==null?void 0:s.scaleXy)==null?void 0:h.y)??1)/2:0)),a(this,ia).draw(e,t.sub(this.cameraXy),n,(s==null?void 0:s.scaleXy)??Ba,(s==null?void 0:s.flipXy)??[!1,!1],a(this,ot))}drawLine(e,t,n){a(this,na).draw(e.sub(this.cameraXy),t,n,a(this,ot))}drawRect(e,t,n){a(this,ki).draw(e.sub(this.cameraXy),t,n,"none",a(this,ot))}drawRectFilled(e,t,n){a(this,ki).draw(e.sub(this.cameraXy),t,n,"inside",a(this,ot))}drawRectOutsideFilled(e,t,n){a(this,ki).draw(e.sub(this.cameraXy),t,n,"outside",a(this,ot))}drawEllipse(e,t,n){a(this,Ci).draw(e.sub(this.cameraXy),t,n,"none",a(this,ot))}drawEllipseFilled(e,t,n){a(this,Ci).draw(e.sub(this.cameraXy),t,n,"inside",a(this,ot))}drawEllipseOutsideFilled(e,t,n){a(this,Ci).draw(e.sub(this.cameraXy),t,n,"outside",a(this,ot))}setSpriteColorMapping(e){const t=a(this,Cn);return g(this,Cn,e),t}drawSprite(e,t,n){var o,h;const s=(n==null?void 0:n.centerXy)??[!1,!1];(s[0]||s[1])&&(t=t.sub(s[0]?e.size.x*(((o=n==null?void 0:n.scaleXy)==null?void 0:o.x)??1)/2:0,s[1]?e.size.y*(((h=n==null?void 0:n.scaleXy)==null?void 0:h.y)??1)/2:0));const r=a(this,Vs).getImageAsset(e.imageUrl);a(this,sa).draw(e.type==="static"?e:e.current,r,t.sub(this.cameraXy),(n==null?void 0:n.scaleXy)??Ba,(n==null?void 0:n.flipXy)??[!1,!1],a(this,Cn),a(this,ot))}useFont(e){const t=a(this,Vt);return g(this,Vt,e),t}setTextColorMarkers(e){const t=a(this,Ri);return g(this,Ri,e),t}measureText(e,t){var h,c;let n=0,s=0;for(const l of a(this,Vt).arrangeGlyphsFor(e,Z0,a(this,Ri)))l.type==="line_break"?n=Math.max(n,l.lineNumber+1):(n=Math.max(n,l.lineNumber),s=Math.max(s,l.leftTop.x+(l.type==="sprite"?l.sprite.size.x:l.pixels.size.x)));const r=At(s,(n+1)*(a(this,Vt).ascent+a(this,Vt).descent)+n*a(this,Vt).lineGap).mul((t==null?void 0:t.scaleXy)??Ba),o=At((h=t==null?void 0:t.centerXy)!=null&&h[0]?-r.x/2:0,(c=t==null?void 0:t.centerXy)!=null&&c[1]?-r.y/2:0);return{wh:r,offset:o}}drawText(e,t,n,s){const r=(s==null?void 0:s.centerXy)??[!1,!1];if(r[0]||r[1]){const{offset:o}=this.measureText(e,{scaleXy:s==null?void 0:s.scaleXy,centerXy:s==null?void 0:s.centerXy});t=t.add(o)}a(this,aa).draw(e,a(this,Vt),t.sub(this.cameraXy),n,a(this,Ri),(s==null?void 0:s.scaleXy)??Ba,a(this,ot))}takeCanvasSnapshot(){return a(this,Ei).takeSnapshot()}}Vs=new WeakMap,Ei=new WeakMap,ta=new WeakMap,ea=new WeakMap,ia=new WeakMap,na=new WeakMap,ki=new WeakMap,Ci=new WeakMap,sa=new WeakMap,aa=new WeakMap,ot=new WeakMap,Cn=new WeakMap,Vt=new WeakMap,Ri=new WeakMap;var Le,Ti,Mi,Oi,Fi,Rn,Za;class Dt{constructor(){d(this,Rn);d(this,Le,!1);d(this,Ti,!1);d(this,Mi,null);d(this,Oi,null);d(this,Fi,null)}setRepeating(e){g(this,Mi,e.firstRepeatFrames),g(this,Oi,e.loopedRepeatFrames)}get isPressed(){return a(this,Le)}get wasJustPressed(){var e;return a(this,Ti)&&a(this,Le)||a(this,Rn,Za)&&((e=a(this,Fi))==null?void 0:e.justFinishedPhase)!=null}get wasJustReleased(){var e;return a(this,Ti)&&!a(this,Le)||a(this,Rn,Za)&&((e=a(this,Fi))==null?void 0:e.justFinishedPhase)!=null}update(e){e?a(this,Ti)&&a(this,Rn,Za)&&g(this,Fi,J0({intro:a(this,Mi)?[["first",a(this,Mi)]]:void 0,loop:a(this,Oi)?[["looped",a(this,Oi)]]:void 0},{onGamePause:"ignore"})):g(this,Fi,null),g(this,Ti,a(this,Le)!==e),g(this,Le,e)}}Le=new WeakMap,Ti=new WeakMap,Mi=new WeakMap,Oi=new WeakMap,Fi=new WeakMap,Rn=new WeakSet,Za=function(){return a(this,Mi)!=null||a(this,Oi)!=null};var Ht,Jt,Wt,qt,te,ee,ie;class ep{constructor(){d(this,Ht,new Dt);d(this,Jt,new Dt);d(this,Wt,new Dt);d(this,qt,new Dt);d(this,te,new Dt);d(this,ee,new Dt);d(this,ie,new Dt)}update(e){a(this,Ht).update(e.has("button_left")),a(this,Jt).update(e.has("button_right")),a(this,Wt).update(e.has("button_up")),a(this,qt).update(e.has("button_down")),a(this,te).update(e.has("button_a")),a(this,ee).update(e.has("button_b")),a(this,ie).update(e.has("button_menu"))}isAnyPressed(){return a(this,Ht).isPressed||a(this,Jt).isPressed||a(this,Wt).isPressed||a(this,qt).isPressed||a(this,te).isPressed||a(this,ee).isPressed||a(this,ie).isPressed}isPressed(e){switch(e){case"left":return a(this,Ht).isPressed;case"right":return a(this,Jt).isPressed;case"up":return a(this,Wt).isPressed;case"down":return a(this,qt).isPressed;case"a":return a(this,te).isPressed;case"b":return a(this,ee).isPressed;case"menu":return a(this,ie).isPressed}}getPressedDirection(){return At((a(this,Ht).isPressed?-1:0)+(a(this,Jt).isPressed?1:0),(a(this,Wt).isPressed?-1:0)+(a(this,qt).isPressed?1:0))}setButtonRepeating(e,t){switch(e){case"left":a(this,Ht).setRepeating(t);return;case"right":a(this,Jt).setRepeating(t);return;case"up":a(this,Wt).setRepeating(t);return;case"down":a(this,qt).setRepeating(t);return;case"a":a(this,te).setRepeating(t);return;case"b":a(this,ee).setRepeating(t);return;case"menu":a(this,ie).setRepeating(t);return}}wasAnyJustPressed(){return a(this,Ht).wasJustPressed||a(this,Jt).wasJustPressed||a(this,Wt).wasJustPressed||a(this,qt).wasJustPressed||a(this,te).wasJustPressed||a(this,ee).wasJustPressed||a(this,ie).wasJustPressed}wasJustPressed(e){switch(e){case"left":return a(this,Ht).wasJustPressed;case"right":return a(this,Jt).wasJustPressed;case"up":return a(this,Wt).wasJustPressed;case"down":return a(this,qt).wasJustPressed;case"a":return a(this,te).wasJustPressed;case"b":return a(this,ee).wasJustPressed;case"menu":return a(this,ie).wasJustPressed}}wasJustReleased(e){switch(e){case"left":return a(this,Ht).wasJustReleased;case"right":return a(this,Jt).wasJustReleased;case"up":return a(this,Wt).wasJustReleased;case"down":return a(this,qt).wasJustReleased;case"a":return a(this,te).wasJustReleased;case"b":return a(this,ee).wasJustReleased;case"menu":return a(this,ie).wasJustReleased}}}Ht=new WeakMap,Jt=new WeakMap,Wt=new WeakMap,qt=new WeakMap,te=new WeakMap,ee=new WeakMap,ie=new WeakMap;function fu(i){return i!=null}var Di;const ni=class ni{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 0:case 4:return"button_a";case 1:case 3:return"button_b";case 10:case 11:return"button_menu"}return null}eventsForAxisValue(e,t){if(e===9){const n=t*7+8;if(n<.5||n>15.5||n>7.5&&n<8.5)return[];switch(Math.round(n)){case 1:return["button_up"];case 3:return["button_up","button_right"];case 5:return["button_right"];case 7:return["button_down","button_right"];case 9:return["button_down"];case 11:return["button_down","button_left"];case 13:return["button_left"];case 15:return["button_up","button_left"];default:return[]}}switch(e){case 0:case 2:return t>a(ni,Di)?["button_right"]:t<-a(ni,Di)?["button_left"]:[];case 1:case 5:return t>a(ni,Di)?["button_down"]:t<-a(ni,Di)?["button_up"]:[];default:return[]}}};Di=new WeakMap,d(ni,Di,.6);let gl=ni;var Pi;const si=class si{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 0:case 3:case 4:case 7:return"button_a";case 1:case 2:case 5:case 6:return"button_b";case 12:return"button_up";case 13:return"button_down";case 14:return"button_left";case 15:return"button_right";case 8:case 9:case 10:case 11:case 16:case 17:return"button_menu"}return null}eventsForAxisValue(e,t){switch(e){case 0:case 2:return t>a(si,Pi)?["button_right"]:t<-a(si,Pi)?["button_left"]:[];case 1:case 3:return t>a(si,Pi)?["button_down"]:t<-a(si,Pi)?["button_up"]:[];default:return[]}}};Pi=new WeakMap,d(si,Pi,.6);let _l=si;var Ii;const ai=class ai{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 0:case 4:return"button_a";case 1:case 3:return"button_b";case 10:case 11:return"button_menu"}return null}eventsForAxisValue(e,t){if(e===0){const n=t*7+8;if(n<.5||n>15.5||n>7.5&&n<8.5)return[];switch(Math.round(n)){case 1:return["button_up"];case 3:return["button_up","button_right"];case 5:return["button_right"];case 7:return["button_down","button_right"];case 9:return["button_down"];case 11:return["button_down","button_left"];case 13:return["button_left"];case 15:return["button_up","button_left"];default:return[]}}switch(e){case 1:case 3:return t>a(ai,Ii)?["button_right"]:t<-a(ai,Ii)?["button_left"]:[];case 2:case 4:return t>a(ai,Ii)?["button_down"]:t<-a(ai,Ii)?["button_up"]:[];default:return[]}}};Ii=new WeakMap,d(ai,Ii,.6);let ml=ai;var Ui;const ri=class ri{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 0:case 4:return"button_a";case 1:case 3:return"button_b";case 10:case 11:return"button_menu"}return null}eventsForAxisValue(e,t){if(e===9){const n=t*7+8;if(n<.5||n>15.5||n>7.5&&n<8.5)return[];switch(Math.round(n)){case 1:return["button_up"];case 3:return["button_up","button_right"];case 5:return["button_right"];case 7:return["button_down","button_right"];case 9:return["button_down"];case 11:return["button_down","button_left"];case 13:return["button_left"];case 15:return["button_up","button_left"];default:return[]}}switch(e){case 0:case 2:return t>a(ri,Ui)?["button_right"]:t<-a(ri,Ui)?["button_left"]:[];case 1:case 5:return t>a(ri,Ui)?["button_down"]:t<-a(ri,Ui)?["button_up"]:[];default:return[]}}};Ui=new WeakMap,d(ri,Ui,.6);let bl=ri;var zi;const li=class li{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 1:case 3:return"button_a";case 0:case 2:return"button_b";case 9:return"button_menu"}return null}eventsForAxisValue(e,t){if(e===4){const n=t*7+8;if(n<.5||n>15.5||n>7.5&&n<8.5)return[];switch(Math.round(n)){case 1:return["button_up"];case 3:return["button_up","button_right"];case 5:return["button_right"];case 7:return["button_down","button_right"];case 9:return["button_down"];case 11:return["button_down","button_left"];case 13:return["button_left"];case 15:return["button_up","button_left"];default:return[]}}switch(e){case 0:case 2:return t>a(li,zi)?["button_right"]:t<-a(li,zi)?["button_left"]:[];case 1:case 3:return t>a(li,zi)?["button_down"]:t<-a(li,zi)?["button_up"]:[];default:return[]}}};zi=new WeakMap,d(li,zi,.6);let wl=li;var Ni;const oi=class oi{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 1:case 3:return"button_a";case 0:case 2:return"button_b";case 9:return"button_menu"}return null}eventsForAxisValue(e,t){switch(e){case 0:case 2:return t>a(oi,Ni)?["button_right"]:t<-a(oi,Ni)?["button_left"]:[];case 1:case 5:return t>a(oi,Ni)?["button_down"]:t<-a(oi,Ni)?["button_up"]:[];default:return[]}}};Ni=new WeakMap,d(oi,Ni,.6);let yl=oi;var Bi;const hi=class hi{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 1:case 5:case 4:case 7:return"button_a";case 2:case 3:case 0:case 6:return"button_b";case 12:return"button_up";case 13:return"button_down";case 14:return"button_left";case 15:return"button_right";case 16:case 8:case 9:case 10:case 11:case 17:return"button_menu"}return null}eventsForAxisValue(e,t){switch(e){case 0:case 2:return t>a(hi,Bi)?["button_right"]:t<-a(hi,Bi)?["button_left"]:[];case 1:case 3:return t>a(hi,Bi)?["button_down"]:t<-a(hi,Bi)?["button_up"]:[];default:return[]}}};Bi=new WeakMap,d(hi,Bi,.6);let vl=hi;var Li;const ui=class ui{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 0:case 3:return"button_a";case 1:case 2:return"button_b";case 12:return"button_up";case 13:return"button_down";case 14:return"button_left";case 15:return"button_right";case 8:case 9:return"button_menu"}return null}eventsForAxisValue(e,t){switch(e){case 0:case 2:return t>a(ui,Li)?["button_right"]:t<-a(ui,Li)?["button_left"]:[];case 1:case 3:return t>a(ui,Li)?["button_down"]:t<-a(ui,Li)?["button_up"]:[];default:return[]}}};Li=new WeakMap,d(ui,Li,.6);let xl=ui;var $i;const fi=class fi{eventForButton(e,t){if(!t.pressed)return null;switch(e){case 0:case 3:return"button_a";case 1:case 2:return"button_b";case 12:return"button_up";case 13:return"button_down";case 14:return"button_left";case 15:return"button_right";case 9:return"button_menu"}return null}eventsForAxisValue(e,t){switch(e){case 0:case 2:return t>a(fi,$i)?["button_right"]:t<-a(fi,$i)?["button_left"]:[];case 1:case 3:return t>a(fi,$i)?["button_down"]:t<-a(fi,$i)?["button_up"]:[];default:return[]}}};$i=new WeakMap,d(fi,$i,.6);let Al=fi;var ye,Ot,hr,cu;class ip{constructor(e){d(this,hr);b(this,"inputMethod","gamepad");d(this,ye,void 0);d(this,Ot,{standard:new Al,firefoxDualSenseWindows:new yl,firefoxDualSenseOther:new wl,firefox8bitdoWindows:new bl,firefox8bitdoOther:new ml,firefoxOther:new vl,safari8bitdo:new xl,"8bitdo":new gl,other:new _l});g(this,ye,e.browserType)}startListening(){}update(e){let t=!1;for(const n of navigator.getGamepads()){if(!n)continue;const s=u(this,hr,cu).call(this,n);for(let r=0;r<n.buttons.length;++r){const o=s.eventForButton(r,n.buttons[r]);o&&(e.add(o),t=!0)}for(let r=0;r<n.axes.length;++r)s.eventsForAxisValue(r,n.axes[r]).forEach(o=>{e.add(o),t=!0})}return t}connectedGamepadTypes(){return new Set(navigator.getGamepads().filter(fu).map(e=>Yl.detect(e)))}}ye=new WeakMap,Ot=new WeakMap,hr=new WeakSet,cu=function(e){const t=Yl.detect(e);return a(this,ye)==="firefox_windows"||a(this,ye)==="firefox_other"?t==="dualsense"?a(this,ye)==="firefox_windows"?a(this,Ot).firefoxDualSenseWindows:a(this,Ot).firefoxDualSenseOther:t==="8bitdo"?a(this,ye)==="firefox_windows"?a(this,Ot).firefox8bitdoWindows:a(this,Ot).firefox8bitdoOther:a(this,Ot).firefoxOther:t==="8bitdo"?a(this,ye)==="safari"?a(this,Ot).safari8bitdo:a(this,Ot)["8bitdo"]:e.mapping==="standard"?a(this,Ot).standard:a(this,Ot).other};var $e,Gi;class np{constructor(e){b(this,"inputMethod","keyboard");d(this,$e,new Map([["ArrowLeft","button_left"],["ArrowRight","button_right"],["ArrowUp","button_up"],["ArrowDown","button_down"],["w","button_up"],["W","button_up"],["s","button_down"],["S","button_down"],["a","button_left"],["A","button_left"],["d","button_right"],["D","button_right"],["j","button_a"],["J","button_a"],["k","button_b"],["K","button_b"],["c","button_a"],["C","button_a"],["x","button_b"],["x","button_b"],["p","button_menu"],["P","button_menu"],["Escape","button_menu"],["Enter","button_menu"],["m","mute_unmute_toggle"],["M","mute_unmute_toggle"],["f","full_screen"],["F","full_screen"]]));d(this,Gi,new Set);e.enableDebugToggle&&a(this,$e).set(";","debug_toggle"),e.enableFrameByFrameControls&&(a(this,$e).set(",","frame_by_frame_toggle"),a(this,$e).set(".","frame_by_frame_step"))}startListening(){document.addEventListener("keydown",e=>{const t=a(this,$e).get(e.key);t&&(e.preventDefault(),a(this,Gi).add(t))}),document.addEventListener("keyup",e=>{const t=a(this,$e).get(e.key);t&&(e.preventDefault(),a(this,Gi).delete(t))})}update(e){let t=!1;for(const n of a(this,Gi))e.add(n),t=!0;return a(this,Gi).delete("full_screen"),t}}$e=new WeakMap,Gi=new WeakMap;var Zi;const ur=class ur{constructor(){b(this,"inputMethod","mouse");d(this,Zi,new Set)}startListening(){ur.mapping.forEach(({event:e,selector:t})=>{document.querySelectorAll(t).forEach(n=>{n.addEventListener("mousedown",()=>{a(this,Zi).add(e)}),n.addEventListener("mouseup",()=>{a(this,Zi).delete(e)})})})}update(e){let t=!1;for(const n of a(this,Zi))e.add(n),t=!0;return a(this,Zi).delete("full_screen"),t}};Zi=new WeakMap,b(ur,"mapping",[{event:"button_left",selector:N.selectors.controlsLeft},{event:"button_left",selector:N.selectors.controlsUpLeft},{event:"button_left",selector:N.selectors.controlsDownLeft},{event:"button_right",selector:N.selectors.controlsRight},{event:"button_right",selector:N.selectors.controlsUpRight},{event:"button_right",selector:N.selectors.controlsDownRight},{event:"button_up",selector:N.selectors.controlsUp},{event:"button_up",selector:N.selectors.controlsUpLeft},{event:"button_up",selector:N.selectors.controlsUpRight},{event:"button_down",selector:N.selectors.controlsDown},{event:"button_down",selector:N.selectors.controlsDownLeft},{event:"button_down",selector:N.selectors.controlsDownRight},{event:"button_a",selector:N.selectors.controlsA},{event:"button_b",selector:N.selectors.controlsB},{event:"button_menu",selector:N.selectors.controlsMenu},{event:"mute_unmute_toggle",selector:N.selectors.controlsMuteToggle},{event:"full_screen",selector:N.selectors.controlsFullScreen}]);let Sl=ur;var K,Hi,Ge,Ji,ts,ra,kl;const q=class q{constructor(){d(this,Ji);d(this,ra);b(this,"inputMethod","touch");d(this,Hi,[{bitMask:a(q,K).up|a(q,K).left,events:["button_up","button_left"],requiresStart:!1,selector:N.selectors.controlsUpLeft,elements:[]},{bitMask:a(q,K).up,events:["button_up"],requiresStart:!1,selector:N.selectors.controlsUp,elements:[]},{bitMask:a(q,K).up|a(q,K).right,events:["button_up","button_right"],requiresStart:!1,selector:N.selectors.controlsUpRight,elements:[]},{bitMask:a(q,K).left,events:["button_left"],requiresStart:!1,selector:N.selectors.controlsLeft,elements:[]},{bitMask:a(q,K).right,events:["button_right"],requiresStart:!1,selector:N.selectors.controlsRight,elements:[]},{bitMask:a(q,K).down|a(q,K).left,events:["button_down","button_left"],requiresStart:!1,selector:N.selectors.controlsDownLeft,elements:[]},{bitMask:a(q,K).down,events:["button_down"],requiresStart:!1,selector:N.selectors.controlsDown,elements:[]},{bitMask:a(q,K).down|a(q,K).right,events:["button_down","button_right"],requiresStart:!1,selector:N.selectors.controlsDownRight,elements:[]},{bitMask:a(q,K).a,events:["button_a"],requiresStart:!1,selector:N.selectors.controlsA,elements:[]},{bitMask:a(q,K).b,events:["button_b"],requiresStart:!1,selector:N.selectors.controlsB,elements:[]},{bitMask:a(q,K).menu,events:["button_menu"],requiresStart:!0,selector:N.selectors.controlsMenu,elements:[]},{bitMask:a(q,K).muteUnmute,events:["mute_unmute_toggle"],requiresStart:!0,selector:N.selectors.controlsMuteToggle,elements:[]},{bitMask:a(q,K).fullScreen,events:["full_screen"],requiresStart:!0,selector:N.selectors.controlsFullScreen,elements:[]}]);d(this,Ge,new Map);a(this,Hi).forEach(({selector:e,elements:t})=>{t.push(...document.querySelectorAll(e))})}startListening(){document.addEventListener("touchstart",u(this,Ji,ts).bind(this)),document.addEventListener("touchmove",u(this,Ji,ts).bind(this)),document.addEventListener("touchcancel",u(this,Ji,ts).bind(this)),document.addEventListener("touchend",u(this,Ji,ts).bind(this))}update(e){let t=!1;for(const[n,s]of a(this,Ge).entries()){for(const{bitMask:r,events:o}of a(this,Hi))if((s&r)===r)for(const h of o)e.add(h);s&a(q,K).fullScreen&&a(this,Ge).set(n,s&~a(q,K).fullScreen)}return t}};K=new WeakMap,Hi=new WeakMap,Ge=new WeakMap,Ji=new WeakSet,ts=function(e){e.preventDefault();for(const t of e.changedTouches)if(e.type==="touchmove"){let n=0;for(const{elements:s,bitMask:r,requiresStart:o}of a(this,Hi))!o&&u(this,ra,kl).call(this,s,t,r)&&(n|=r);a(this,Ge).set(t.identifier,n)}else if(e.type==="touchstart"){let n=0;for(const{elements:s,bitMask:r,events:o}of a(this,Hi))u(this,ra,kl).call(this,s,t,r)&&(n|=r);a(this,Ge).set(t.identifier,n)}else(e.type==="touchend"||e.type==="touchcancel")&&a(this,Ge).delete(t.identifier)},ra=new WeakSet,kl=function(e,t,n){for(const s of e){const r=s.getBoundingClientRect();if(t.clientX>=r.left-(n&a(q,K).left?r.width:0)&&t.clientX<=r.right+(n&a(q,K).right?r.width:0)&&t.clientY>=r.top-(n&a(q,K).up?r.height:0)&&t.clientY<=r.bottom+(n&a(q,K).down?r.height:0))return!0}return!1},d(q,K,{up:256,down:128,left:64,right:32,a:16,b:8,menu:4,muteUnmute:2,fullScreen:1});let El=q;var la,Tn;class sp{constructor(e){b(this,"gameInputsSpecialized");b(this,"gameInputGamepad");b(this,"gameButtons");b(this,"buttonFullScreen");b(this,"buttonMuteUnmute");b(this,"buttonDebugToggle");b(this,"buttonFrameByFrameToggle");b(this,"buttonFrameByFrameStep");d(this,la,new Set);d(this,Tn,new Set);this.gameInputGamepad=new ip({browserType:e.browserType}),this.gameInputsSpecialized=[new Sl,new np({enableDebugToggle:e.enableDebugToggle,enableFrameByFrameControls:e.enableFrameByFrameControls}),new El,this.gameInputGamepad],this.gameButtons=new ep,this.buttonFullScreen=new Dt,this.buttonMuteUnmute=new Dt,this.buttonDebugToggle=new Dt,this.buttonFrameByFrameToggle=new Dt,this.buttonFrameByFrameStep=new Dt}startListening(){for(const e of this.gameInputsSpecialized)e.startListening()}update(e){a(this,Tn).clear();const t=new Set;for(const n of this.gameInputsSpecialized)n.update(t)&&a(this,Tn).add(n.inputMethod);return g(this,la,t),e.skipGameButtons||this.gameButtons.update(t),this.buttonFullScreen.update(t.has("full_screen")),this.buttonMuteUnmute.update(t.has("mute_unmute_toggle")),this.buttonDebugToggle.update(t.has("debug_toggle")),this.buttonFrameByFrameToggle.update(t.has("frame_by_frame_toggle")),this.buttonFrameByFrameStep.update(t.has("frame_by_frame_step")),N.updatePressedClasses({up:this.gameButtons.isPressed("up"),down:this.gameButtons.isPressed("down"),left:this.gameButtons.isPressed("left"),right:this.gameButtons.isPressed("right"),a:this.gameButtons.isPressed("a"),b:this.gameButtons.isPressed("b"),menu:this.gameButtons.isPressed("menu"),mute:this.buttonMuteUnmute.isPressed,fullscreen:this.buttonFullScreen.isPressed}),t.size>0}getRecentInputMethods(){return a(this,Tn)}getConnectedGamepadTypes(){return this.gameInputGamepad.connectedGamepadTypes()}getEventsCapturedInLastUpdate(){return a(this,la)}}la=new WeakMap,Tn=new WeakMap;var Wi,oa,qi,Mn,Ki,Ze,On,ha,Fn;const fr=class fr{constructor(e){d(this,Wi,void 0);d(this,oa,void 0);d(this,qi,{updateFn:()=>{},renderFn:()=>{}});d(this,Mn,void 0);d(this,Ki,void 0);d(this,Ze,0);d(this,On,0);d(this,ha,5);d(this,Fn,e=>{if(a(this,oa).visibilityState==="hidden"){g(this,Ki,e),a(this,Wi).call(this,a(this,Fn));return}const t=e-(a(this,Ki)??e);for(g(this,Ze,a(this,Ze)+t),g(this,Ki,e),g(this,On,0);a(this,Ze)>=a(this,Mn);)g(this,On,a(this,On)+1),a(this,On)<=a(this,ha)?(a(this,qi).updateFn(),g(this,Ze,a(this,Ze)-a(this,Mn))):(g(this,Ze,0),z.warnBeetPx(`Reached the safety limit of ${a(this,ha)} update calls`));const n=Math.floor(Math.min(1e3/t,fr.renderFpsResultCap));a(this,qi).renderFn(n),a(this,Wi).call(this,a(this,Fn))});g(this,Wi,e.rafFn),g(this,oa,e.documentVisibilityStateProvider),g(this,Mn,1e3/e.fixedTimestepFps)}start(e){a(this,qi).updateFn=e.updateFn,a(this,qi).renderFn=e.renderFn,g(this,Ki,void 0),g(this,Ze,0),a(this,Wi).call(this,a(this,Fn))}};Wi=new WeakMap,oa=new WeakMap,qi=new WeakMap,Mn=new WeakMap,Ki=new WeakMap,Ze=new WeakMap,On=new WeakMap,ha=new WeakMap,Fn=new WeakMap,b(fr,"renderFpsResultCap",999);let Cl=fr;var ua;const os=class os{isFullScreenSupported(){return a(os,ua)}static create(){return a(os,ua)?new rp:new ap}};ua=new WeakMap,d(os,ua,!!(!(typeof document>"u")&&(document.fullscreenEnabled||document.webkitFullscreenEnabled)));let ys=os;class ap extends ys{constructor(){super(),document.querySelectorAll(N.selectors.controlsFullScreen).forEach(e=>{e.style.display="none"})}isInFullScreen(){return!1}toggleFullScreen(){}}var Yi,fa,ca,cr,du,dr,pu;class rp extends ys{constructor(){super();d(this,cr);d(this,dr);d(this,Yi,void 0);d(this,fa,void 0);d(this,ca,void 0);const t=document.querySelector(N.selectors.fullScreenSubject);if(!t)throw Error(`Was unable to find a full screen subject by selector '${N.selectors.fullScreenSubject}'`);g(this,Yi,t);const n=a(this,Yi).requestFullscreen??a(this,Yi).webkitRequestFullscreen??(()=>{});g(this,fa,n.bind(a(this,Yi)));const s=document.exitFullscreen??document.webkitExitFullscreen??(()=>{});g(this,ca,s.bind(document))}isInFullScreen(){return!!(document.fullscreenElement||document.webkitFullscreenElement)}toggleFullScreen(){this.isInFullScreen()?u(this,dr,pu).call(this):u(this,cr,du).call(this)}}Yi=new WeakMap,fa=new WeakMap,ca=new WeakMap,cr=new WeakSet,du=function(){const t=a(this,fa).call(this);typeof t=="object"&&t.catch(n=>{z.errorBeetPx(n)})},dr=new WeakSet,pu=function(){const t=a(this,ca).call(this);typeof t=="object"&&t.catch(n=>{z.errorBeetPx(n)})};function gu(i){return new Promise(e=>{setTimeout(()=>e(),i)})}var pr,Dn,da;class lp{constructor(e){d(this,pr,gu(750));d(this,Dn,void 0);d(this,da,void 0);g(this,Dn,document.querySelector(N.selectors.startButton)??Qi(`Unable to find a start button under a selector "${N.selectors.startButton}"`)),g(this,da,new Promise(t=>{a(this,Dn).addEventListener("click",()=>{e.onStartClicked(),t()})}))}async showStartScreen(){await a(this,pr),N.addLoadedClass(),a(this,Dn).focus(),await a(this,da),N.addStartedClass()}}pr=new WeakMap,Dn=new WeakMap,da=new WeakMap;var He,Pn,ve;const ci=class ci{static enable(){g(this,He,!0)}static get isActive(){return a(this,He)?a(this,ve):!1}static get wasJustActivated(){return a(this,He)?a(this,ve)&&!a(this,Pn):!1}static get wasJustDeactivated(){return a(this,He)?!a(this,ve)&&a(this,Pn):!1}static update(){if(a(this,He)){if(ci.wasJustActivated){for(const e of xt.playbacksToPauseOnGamePause)e.pauseByEngine();for(const e of xt.playbacksToMuteOnGamePause)e.muteByEngine()}else if(ci.wasJustDeactivated){for(const e of xt.playbacksToPauseOnGamePause)e.resumeByEngine();for(const e of xt.playbacksToMuteOnGamePause)e.unmuteByEngine()}g(this,Pn,a(this,ve))}}static activate(){g(this,ve,!0)}static deactivate(){g(this,ve,!1)}};He=new WeakMap,Pn=new WeakMap,ve=new WeakMap,d(ci,He,!1),d(ci,Pn,!1),d(ci,ve,!1);let yt=ci;var In;const ln=class ln{savePersistedState(e){window.localStorage.setItem(a(ln,In),JSON.stringify(e,null,2))}loadPersistedState(){const e=window.localStorage.getItem(a(ln,In));return e?JSON.parse(e):null}clearPersistedState(){window.localStorage.removeItem(a(ln,In))}};In=new WeakMap,d(ln,In,"game_stored_state");let Rl=ln;var Je,Un,gr,pa,ga,_a,zn,ma,ba,Nn,wa,ya,ne,xe,va,xa,Bn,_r,_u;class op{constructor(e={}){d(this,_r);d(this,Je,void 0);d(this,Un,void 0);b(this,"canvasSize");d(this,gr,j.fromCssHex("#000000"));d(this,pa,void 0);b(this,"gameInput");d(this,ga,void 0);b(this,"audioApi");b(this,"fullScreen");b(this,"storageApi");d(this,_a,void 0);b(this,"assets");d(this,zn,void 0);b(this,"drawApi");d(this,ma,void 0);d(this,ba,!1);b(this,"isInsideDrawOrStartedCallback",!1);d(this,Nn,void 0);d(this,wa,void 0);d(this,ya,void 0);d(this,ne,0);d(this,xe,0);d(this,va,1);d(this,xa,!1);d(this,Bn,!1);var r,o,h,c,l,f,m,_;e.canvasSize??(e.canvasSize="128x128"),e.fixedTimestep??(e.fixedTimestep="60fps"),window.addEventListener("error",p=>{var y;return N.showError(p.message),(y=this.audioApi)==null||y.getAudioContext().suspend().then(()=>{}),!0}),window.addEventListener("unhandledrejection",p=>{var y;N.showError(p.reason),(y=this.audioApi)==null||y.getAudioContext().suspend().then(()=>{})}),(r=e.globalPause)!=null&&r.available&&yt.enable(),Kt.loadFromStorage(),(o=e.debugMode)!=null&&o.available?e.debugMode.forceEnabledOnStart&&(Kt.enabled=!0):Kt.enabled=!1,(h=e.frameByFrame)!=null&&h.available&&((c=e.frameByFrame)!=null&&c.activateOnStart)&&(ei.active=!0),z.debugBeetPx("Engine init params:",e),g(this,Je,e.assets??[]),a(this,Je).push(...Jl.spriteSheetUrls),a(this,Je).push(...L0.spriteSheetUrls),a(this,Je).push(...$0.spriteSheetUrls);const t=e.fixedTimestep==="60fps"?60:e.fixedTimestep==="30fps"?30:Qi(`Unsupported fixedTimestep: "${e.fixedTimestep}"`);g(this,Un,U0.detect(navigator.userAgent)),this.canvasSize=e.canvasSize==="64x64"?At(64,64):e.canvasSize==="128x128"?At(128,128):e.canvasSize==="256x256"?At(256,256):Qi(`Unsupported canvasSize: "${e.canvasSize}"`),this.gameInput=new sp({enableDebugToggle:((l=e.debugMode)==null?void 0:l.available)??!1,enableFrameByFrameControls:((f=e.frameByFrame)==null?void 0:f.available)??!1,browserType:a(this,Un)}),g(this,ga,new Cl({fixedTimestepFps:t,rafFn:window.requestAnimationFrame.bind(window),documentVisibilityStateProvider:document})),this.storageApi=new Rl;const n=new AudioContext;this.assets=new yd,g(this,_a,new wd(this.assets,{decodeAudioData:p=>n.decodeAudioData(p)})),this.audioApi=new mi(this.assets,n),g(this,pa,new lp({onStartClicked:()=>{this.audioApi.tryToResumeAudioContextSuspendedByBrowserForSecurityReasons().then(p=>{p&&g(this,Bn,!0)})}})),this.fullScreen=ys.create();const s=document.querySelector(N.selectors.canvas)??Qi(`Was unable to find <canvas> by selector '${N.selectors.canvas}'`);g(this,zn,new B0(this.canvasSize,s,a(this,gr))),this.drawApi=new tp({canvas:a(this,zn),assets:this.assets}),(_=(m=e.debugMode)==null?void 0:m.fpsDisplay)!=null&&_.enabled&&g(this,ma,new W0(this.drawApi,this.canvasSize,{color:e.debugMode.fpsDisplay.color,placement:e.debugMode.fpsDisplay.placement}))}get frameNumber(){return a(this,ne)}get frameNumberOutsidePause(){return a(this,xe)}get renderingFps(){return a(this,va)}get detectedBrowserType(){return a(this,Un)}async init(){return await a(this,_a).loadAssets(a(this,Je)),{startGame:u(this,_r,_u).bind(this)}}setOnStarted(e){g(this,Nn,e)}setOnUpdate(e){g(this,wa,e)}setOnDraw(e){g(this,ya,e)}restart(){var e;g(this,ne,0),g(this,xe,0),this.audioApi.restart(),this.drawApi.clearCanvas(G0),xt.playbacksToPauseOnGamePause.clear(),xt.playbacksToMuteOnGamePause.clear(),yt.deactivate(),this.isInsideDrawOrStartedCallback=!0,(e=a(this,Nn))==null||e.call(this),this.isInsideDrawOrStartedCallback=!1}}Je=new WeakMap,Un=new WeakMap,gr=new WeakMap,pa=new WeakMap,ga=new WeakMap,_a=new WeakMap,zn=new WeakMap,ma=new WeakMap,ba=new WeakMap,Nn=new WeakMap,wa=new WeakMap,ya=new WeakMap,ne=new WeakMap,xe=new WeakMap,va=new WeakMap,xa=new WeakMap,Bn=new WeakMap,_r=new WeakSet,_u=async function(){var e;if(a(this,ba))throw Error("Tried to start a game, but it is already started");g(this,ba,!0),window.BEETPX__IS_PROD&&window.addEventListener("beforeunload",t=>(t.preventDefault(),t.returnValue="","")),g(this,ne,0),g(this,xe,0),await a(this,pa).showStartScreen(),this.isInsideDrawOrStartedCallback=!0,(e=a(this,Nn))==null||e.call(this),this.isInsideDrawOrStartedCallback=!1,this.gameInput.startListening(),a(this,ga).start({updateFn:()=>{var s;this.gameInput.buttonFullScreen.wasJustPressed&&this.fullScreen.toggleFullScreen(),this.gameInput.buttonMuteUnmute.wasJustPressed&&(this.audioApi.isAudioMuted()?this.audioApi.unmuteAudio():this.audioApi.muteAudio()),this.gameInput.gameButtons.wasJustPressed("menu")&&(yt.isActive?yt.deactivate():yt.activate()),yt.update(),this.gameInput.buttonDebugToggle.wasJustPressed&&(Kt.enabled=!Kt.enabled),this.gameInput.buttonFrameByFrameToggle.wasJustPressed&&(ei.active=!ei.active);const t=!ei.active||this.gameInput.buttonFrameByFrameStep.wasJustPressed;this.gameInput.update({skipGameButtons:!t})&&!a(this,Bn)&&this.audioApi.tryToResumeAudioContextSuspendedByBrowserForSecurityReasons().then(r=>{r&&g(this,Bn,!0)}),t&&(ei.active&&z.infoBeetPx(`Running onUpdate for frame: ${a(this,ne)}`),(s=a(this,wa))==null||s.call(this),g(this,xa,!0),g(this,ne,a(this,ne)>=Number.MAX_SAFE_INTEGER?0:a(this,ne)+1),yt.isActive||g(this,xe,a(this,xe)>=Number.MAX_SAFE_INTEGER?0:a(this,xe)+1))},renderFn:t=>{var n,s;g(this,va,t),this.isInsideDrawOrStartedCallback=!0,a(this,xa)&&((n=a(this,ya))==null||n.call(this),Kt.enabled&&((s=a(this,ma))==null||s.drawRenderingFps(t))),this.isInsideDrawOrStartedCallback=!1,a(this,zn).render()}})};function hp(i,e){return i>0?((e==null?void 0:e.onGamePause)==="ignore"?kt.frameNumber:kt.frameNumberOutsidePause)%(i*2)<i:!0}function mu(){return[D.of(-1,-1),D.of(0,-1),D.of(1,-1),D.of(1,0),D.of(1,1),D.of(0,1),D.of(-1,1),D.of(-1,0)]}function up(i,e,t,n,s){for(const r of mu())kt.draw.text(i,e.add(r),n,{centerXy:s==null?void 0:s.centerXy,scaleXy:s==null?void 0:s.scaleXy});kt.draw.text(i,e,t,{centerXy:s==null?void 0:s.centerXy,scaleXy:s==null?void 0:s.scaleXy})}function fp(){return[D.of(-1,-1),D.of(1,-1),D.of(1,1),D.of(-1,1)]}function cp(i){if(!(i.length<=0))return i[Math.floor(Math.random()*i.length)]}function dp(i,e){i=i>0?Math.round(i):0;const t=new Array(i*e.length);for(let n=0;n<t.length;n++)t[n]=e[Math.floor(n/i)];return t}var We,R,T;const w=class w{static async init(e){z.infoBeetPx(`BeetPx ${window.BEETPX__VERSION} : Initializing…`),g(this,We,new op(e));const{startGame:t}=await a(this,We).init();return z.infoBeetPx(`BeetPx ${window.BEETPX__VERSION} : Initialized`),{startGame:t}}static get debug(){return Kt.enabled}static get canvasSize(){return u(this,R,T).call(this).canvasSize}static get frameNumber(){return u(this,R,T).call(this).frameNumber}static get frameNumberOutsidePause(){return u(this,R,T).call(this).frameNumberOutsidePause}static get renderingFps(){return u(this,R,T).call(this).renderingFps}static get detectedBrowserType(){return u(this,R,T).call(this).detectedBrowserType}static get isPaused(){return yt.isActive}static get wasJustPaused(){return yt.wasJustActivated}static get wasJustResumed(){return yt.wasJustDeactivated}static pause(){yt.activate()}static resume(){yt.deactivate()}};We=new WeakMap,R=new WeakSet,T=function(e){if(!a(this,We))throw Error("Tried to access BeetPx API without calling BeetPx.init(…) first.");return e&&!a(this,We).isInsideDrawOrStartedCallback&&z.warnBeetPx(`Used "${e}" outside of either "setOnDraw" or "setOnStarted" callback.`),a(this,We)},d(w,R),d(w,We,void 0),b(w,"setOnStarted",(...e)=>{var t;return u(t=w,R,T).call(t).setOnStarted(...e)}),b(w,"setOnUpdate",(...e)=>{var t;return u(t=w,R,T).call(t).setOnUpdate(...e)}),b(w,"setOnDraw",(...e)=>{var t;return u(t=w,R,T).call(t).setOnDraw(...e)}),b(w,"restart",(...e)=>{var t;return u(t=w,R,T).call(t).restart(...e)}),b(w,"logDebug",(...e)=>z.debug(...e)),b(w,"logInfo",(...e)=>z.info(...e)),b(w,"logWarn",(...e)=>z.warn(...e)),b(w,"logError",(...e)=>z.error(...e)),b(w,"wasAnyButtonJustPressed",(...e)=>{var t;return u(t=w,R,T).call(t).gameInput.gameButtons.wasAnyJustPressed(...e)}),b(w,"wasButtonJustPressed",(...e)=>{var t;return u(t=w,R,T).call(t).gameInput.gameButtons.wasJustPressed(...e)}),b(w,"wasButtonJustReleased",(...e)=>{var t;return u(t=w,R,T).call(t).gameInput.gameButtons.wasJustReleased(...e)}),b(w,"isAnyButtonPressed",(...e)=>{var t;return u(t=w,R,T).call(t).gameInput.gameButtons.isAnyPressed(...e)}),b(w,"isButtonPressed",(...e)=>{var t;return u(t=w,R,T).call(t).gameInput.gameButtons.isPressed(...e)}),b(w,"getPressedDirection",(...e)=>{var t;return u(t=w,R,T).call(t).gameInput.gameButtons.getPressedDirection(...e)}),b(w,"setButtonRepeating",(...e)=>{var t;return u(t=w,R,T).call(t).gameInput.gameButtons.setButtonRepeating(...e)}),b(w,"getRecentInputMethods",(...e)=>{var t;return u(t=w,R,T).call(t).gameInput.getRecentInputMethods(...e)}),b(w,"getConnectedGamepadTypes",(...e)=>{var t;return u(t=w,R,T).call(t).gameInput.getConnectedGamepadTypes(...e)}),b(w,"getEventsCapturedInLastUpdate",(...e)=>{var t;return u(t=w,R,T).call(t).gameInput.getEventsCapturedInLastUpdate(...e)}),b(w,"isAudioMuted",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.isAudioMuted(...e)}),b(w,"muteAudio",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.muteAudio(...e)}),b(w,"unmuteAudio",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.unmuteAudio(...e)}),b(w,"startPlayback",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.startPlayback(...e)}),b(w,"startPlaybackLooped",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.startPlaybackLooped(...e)}),b(w,"startPlaybackSequence",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.startPlaybackSequence(...e)}),b(w,"mutePlayback",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.mutePlayback(...e)}),b(w,"unmutePlayback",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.unmutePlayback(...e)}),b(w,"stopPlayback",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.stopPlayback(...e)}),b(w,"pausePlayback",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.pausePlayback(...e)}),b(w,"resumePlayback",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.resumePlayback(...e)}),b(w,"getAudioContext",(...e)=>{var t;return u(t=w,R,T).call(t).audioApi.getAudioContext(...e)}),b(w,"isFullScreenSupported",(...e)=>{var t;return u(t=w,R,T).call(t).fullScreen.isFullScreenSupported(...e)}),b(w,"isInFullScreen",(...e)=>{var t;return u(t=w,R,T).call(t).fullScreen.isInFullScreen(...e)}),b(w,"toggleFullScreen",(...e)=>{var t;return u(t=w,R,T).call(t).fullScreen.toggleFullScreen(...e)}),b(w,"savePersistedState",(...e)=>{var t;return u(t=w,R,T).call(t).storageApi.savePersistedState(...e)}),b(w,"loadPersistedState",(...e)=>{var t;return u(t=w,R,T).call(t).storageApi.loadPersistedState(...e)}),b(w,"clearPersistedState",(...e)=>{var t;return u(t=w,R,T).call(t).storageApi.clearPersistedState(...e)}),b(w,"getImageAsset",(...e)=>{var t;return u(t=w,R,T).call(t).assets.getImageAsset(...e)}),b(w,"getSoundAsset",(...e)=>{var t;return u(t=w,R,T).call(t).assets.getSoundAsset(...e)}),b(w,"getJsonAsset",(...e)=>{var t;return u(t=w,R,T).call(t).assets.getJsonAsset(...e)}),b(w,"draw",{clearCanvas(e){var t;u(t=w,R,T).call(t,"clearCanvas").drawApi.clearCanvas(e)},setClippingRegion(e,t){var n;return u(n=w,R,T).call(n,"setClippingRegion").drawApi.setClippingRegion(e,t)},removeClippingRegion(){var e;return u(e=w,R,T).call(e,"removeClippingRegion").drawApi.removeClippingRegion()},setCameraXy(e){var t;return u(t=w,R,T).call(t,"setCameraXy").drawApi.setCameraXy(e)},setDrawingPattern(e){var t;return u(t=w,R,T).call(t,"setDrawingPattern").drawApi.setDrawingPattern(e)},pixel(e,t){var n;u(n=w,R,T).call(n,"pixel").drawApi.drawPixel(e,t)},pixels(e,t,n,s){var r;u(r=w,R,T).call(r,"pixels").drawApi.drawPixels(e,t,n,s)},line(e,t,n){var s;u(s=w,R,T).call(s,"line").drawApi.drawLine(e,t,n)},rect(e,t,n){var s;u(s=w,R,T).call(s,"rect").drawApi.drawRect(e,t,n)},rectFilled(e,t,n){var s;u(s=w,R,T).call(s,"rectFilled").drawApi.drawRectFilled(e,t,n)},rectOutsideFilled(e,t,n){var s;u(s=w,R,T).call(s,"rectOutsideFilled").drawApi.drawRectOutsideFilled(e,t,n)},ellipse(e,t,n){var s;u(s=w,R,T).call(s,"ellipse").drawApi.drawEllipse(e,t,n)},ellipseFilled(e,t,n){var s;u(s=w,R,T).call(s,"ellipseFilled").drawApi.drawEllipseFilled(e,t,n)},ellipseOutsideFilled(e,t,n){var s;u(s=w,R,T).call(s,"ellipseOutsideFilled").drawApi.drawEllipseOutsideFilled(e,t,n)},setSpriteColorMapping(e){var t;return u(t=w,R,T).call(t,"setSpriteColorMapping").drawApi.setSpriteColorMapping(e)},sprite(e,t,n){var s;u(s=w,R,T).call(s,"sprite").drawApi.drawSprite(e,t,n)},useFont(e){var t;return u(t=w,R,T).call(t,"useFont").drawApi.useFont(e)},setTextColorMarkers(e){var t;return u(t=w,R,T).call(t,"setTextColorMarkers").drawApi.setTextColorMarkers(e)},measureText(e,t){var n;return u(n=w,R,T).call(n,"measureText").drawApi.measureText(e,t)},text(e,t,n,s){var r;u(r=w,R,T).call(r,"text").drawApi.drawText(e,t,n,s)},takeCanvasSnapshot(){var e;u(e=w,R,T).call(e,"takeCanvasSnapshot").drawApi.takeCanvasSnapshot()}}),b(w,"utils",{assertUnreachable:Tl,booleanChangingEveryNthFrame:hp,clamp:Ln,drawTextWithOutline:up,identity:Ml,isDefined:fu,lerp:Hr,mod:di,noop:sl,offset4Directions:fp,offset8Directions:mu,randomElementOf:cp,range:Wa,repeatEachElement:dp,throwError:Qi,trigAtan2:th,trigCos:eh,trigSin:ih,wait:gu});let kt=w;const Nt=kt,Ha=kt.draw,pp=kt.utils;var Ft,Xi,Aa,Ae,ji,Se,qe,an,se,ke;const ql=class ql{constructor(e){d(this,qe);d(this,se);d(this,Ft,void 0);d(this,Xi,void 0);d(this,Aa,void 0);d(this,Ae,void 0);d(this,ji,void 0);d(this,Se,void 0);g(this,Aa,e.onGamePause==="ignore"),g(this,Ft,Math.max(0,Math.round(e.frames))),g(this,Xi,e.loop),g(this,ji,a(this,qe,an)+e.delayFrames),g(this,Ae,!1),g(this,Se,null),e.pause&&this.pause()}static for(e){return new ql(e)}get t(){return a(this,Xi)?a(this,se,ke)>=0?di(a(this,se,ke),a(this,Ft)):0:Ln(0,a(this,se,ke),a(this,Ft))}get framesLeft(){return a(this,Ft)-this.t}get progress(){return a(this,Ft)>0?this.t/a(this,Ft):1}get hasFinished(){return a(this,se,ke)>=a(this,Ft)}get hasJustFinished(){return a(this,Ft)>0?a(this,Xi)?a(this,se,ke)>0&&this.t===0:a(this,se,ke)===a(this,Ft):a(this,Xi)?!0:a(this,se,ke)===0}pause(){a(this,Ae)||(g(this,Ae,!0),g(this,Se,a(this,qe,an)))}resume(){a(this,Ae)&&(g(this,Ae,!1),g(this,ji,a(this,ji)+(a(this,qe,an)-(a(this,Se)??0))),g(this,Se,null))}restart(){g(this,ji,a(this,qe,an)),g(this,Se,null),g(this,Ae,!1)}};Ft=new WeakMap,Xi=new WeakMap,Aa=new WeakMap,Ae=new WeakMap,ji=new WeakMap,Se=new WeakMap,qe=new WeakSet,an=function(){return a(this,Aa)?kt.frameNumber:kt.frameNumberOutsidePause},se=new WeakSet,ke=function(){return(a(this,Se)??a(this,qe,an))-a(this,ji)};let rs=ql;const gp=H0("logo.png")(16,16,0,0);let jn=Jn,Vo=Jn;Nt.init({assets:["logo.png","music_melody.flac"],debugMode:{available:!0,fpsDisplay:{enabled:!0}},frameByFrame:{available:!0}}).then(async({startGame:i})=>{Nt.setOnStarted(()=>{Nt.startPlaybackLooped("music_melody.flac"),jn=Nt.canvasSize.div(2)}),Nt.setOnUpdate(()=>{jn=jn.add(Nt.getPressedDirection().mul(3)),Vo=jn.add(At(32).mul(Math.cos(Nt.frameNumber/120*Math.PI),Math.sin(Nt.frameNumber/120*Math.PI))),Nt.isButtonPressed("menu")&&Nt.restart()}),Nt.setOnDraw(()=>{Ha.clearCanvas(pl.storm),pp.booleanChangingEveryNthFrame(30)&&Ha.pixel(jn,pl.ember),Ha.sprite(gp,Vo,{centerXy:[!0,!0]})}),await i()});
